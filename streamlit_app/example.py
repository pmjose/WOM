import streamlit as st
import streamlit.components.v1 as components
import pandas as pd
import altair as alt

SNOWFLAKE_CSS = """
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root {
        --sf-blue: #29B5E8;
        --sf-blue-dark: #1A8BC4;
        --sf-blue-light: #E8F7FC;
        --sf-navy: #1B2A4E;
        --sf-gray: #6B7280;
        --sf-gray-light: #F3F4F6;
        --sf-white: #FFFFFF;
        --sf-gradient: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%);
    }
    
    .stApp {
        font-family: 'Inter', sans-serif;
        background-color: #FFFFFF !important;
    }
    
    [data-testid="stAppViewContainer"] {
        background-color: #FFFFFF !important;
        scroll-behavior: smooth;
    }
    
    section.main {
        scroll-behavior: smooth;
    }
    
    #page-top {
        scroll-margin-top: 0;
    }
    
    [data-testid="stHeader"] {
        background-color: #FFFFFF !important;
    }
    
    /* ===== SIDEBAR ANIMATIONS ===== */
    @keyframes menu-item-pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.02); }
    }
    @keyframes menu-item-glow {
        0%, 100% { box-shadow: 0 2px 8px rgba(41, 181, 232, 0.3); }
        50% { box-shadow: 0 4px 20px rgba(41, 181, 232, 0.6), 0 0 30px rgba(41, 181, 232, 0.3); }
    }
    @keyframes menu-shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
    @keyframes sidebar-border-flow {
        0%, 100% { border-right-color: #29B5E8; }
        50% { border-right-color: #1A8BC4; }
    }
    
    section[data-testid="stSidebar"] {
        background: linear-gradient(180deg, #FFFFFF 0%, #F8FAFC 100%) !important;
        border-right: 3px solid #29B5E8;
        animation: sidebar-border-flow 3s ease-in-out infinite;
    }
    
    section[data-testid="stSidebar"] [data-testid="stSidebarContent"] {
        background: transparent !important;
        padding: 1rem 0.75rem !important;
    }
    
    section[data-testid="stSidebar"] .stRadio > div {
        gap: 4px !important;
        display: flex !important;
        flex-direction: column !important;
        width: 100% !important;
    }
    
    /* Hide the radio button circle */
    section[data-testid="stSidebar"] .stRadio > div > label > div:first-child {
        display: none !important;
    }
    
    section[data-testid="stSidebar"] .stRadio > div > label {
        background: white !important;
        border: 1px solid #E2E8F0 !important;
        border-radius: 8px !important;
        padding: 0.75rem 1rem !important;
        margin: 0 !important;
        color: #1B2A4E !important;
        font-weight: 500 !important;
        font-size: 0.85rem !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        box-shadow: 0 1px 2px rgba(0,0,0,0.04) !important;
        width: 100% !important;
        display: block !important;
        box-sizing: border-box !important;
        cursor: pointer !important;
        position: relative;
        overflow: hidden;
    }
    
    /* Shimmer effect on hover */
    section[data-testid="stSidebar"] .stRadio > div > label::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(41, 181, 232, 0.1), transparent);
        transition: left 0.5s ease;
    }
    
    section[data-testid="stSidebar"] .stRadio > div > label:hover:not(:has(input:checked))::before {
        left: 100%;
    }
    
    /* Hover state - only for NON-selected items */
    section[data-testid="stSidebar"] .stRadio > div > label:hover:not(:has(input:checked)) {
        background: #F8FAFC !important;
        border-color: #CBD5E1 !important;
        color: #1B2A4E !important;
        transform: translateX(4px) !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
    }
    
    /* Default: ALL checked radio items look like normal (non-selected) items */
    section[data-testid="stSidebar"] .stRadio > div > label:has(input:checked) {
        background: white !important;
        border-color: #E2E8F0 !important;
        color: #1B2A4E !important;
        animation: none !important;
        transform: none !important;
        box-shadow: 0 1px 2px rgba(0,0,0,0.04) !important;
    }
    
    section[data-testid="stSidebar"] .stRadio > div > label:has(input:checked)::before {
        display: none !important;
    }
    
    /* The ACTUAL selected page gets highlighted via dynamic CSS injected below */
    .current-page-highlight {
        background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%) !important;
        border-color: #29B5E8 !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(41, 181, 232, 0.3) !important;
        transform: translateX(4px) !important;
    }
    
    .main-header {
        background: var(--sf-gradient);
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        color: white;
    }
    
    .main-header h1 {
        margin: 0;
        font-weight: 700;
        font-size: 2rem;
    }
    
    .main-header p {
        margin: 0.5rem 0 0 0;
        opacity: 0.9;
        font-size: 1.1rem;
    }
    
    .metric-card {
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
    }
    
    .metric-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--sf-navy);
    }
    
    .metric-label {
        font-size: 0.875rem;
        color: var(--sf-gray);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    @keyframes section-underline {
        0%, 100% { width: 60px; opacity: 0.7; }
        50% { width: 100px; opacity: 1; }
    }
    .section-header {
        color: var(--sf-navy);
        font-weight: 600;
        font-size: 1.25rem;
        margin: 2rem 0 1rem 0;
        padding-bottom: 0.5rem;
        border-bottom: none;
        position: relative;
    }
    .section-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        width: 60px;
        background: linear-gradient(90deg, var(--sf-blue), #0EA5E9);
        border-radius: 2px;
        animation: section-underline 2s ease-in-out infinite;
    }
    
    .question-card {
        background: linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 100%);
        border-left: 4px solid var(--sf-blue);
        padding: 1rem 1.5rem;
        margin: 1rem 0;
        border-radius: 0 8px 8px 0;
    }
    
    .question-card p {
        color: var(--sf-navy);
        font-weight: 500;
        margin: 0;
        font-style: italic;
    }
    
    .insight-list {
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 8px;
        padding: 1rem 1.5rem;
        margin: 0.5rem 0;
    }
    
    .talking-point {
        background: var(--sf-blue-light);
        border-radius: 8px;
        padding: 1rem;
        margin: 0.5rem 0;
        color: var(--sf-blue-dark);
        font-weight: 500;
    }
    
    .persona-badge {
        display: inline-block;
        background: var(--sf-navy);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
        margin-bottom: 1rem;
    }
    
    .semantic-view-badge {
        display: inline-block;
        background: var(--sf-blue);
        color: white;
        padding: 0.2rem 0.6rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 500;
        margin: 0.1rem;
    }
    
    .architecture-box {
        background: white;
        border: 2px solid var(--sf-blue);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        margin: 0.5rem;
    }
    
    .architecture-box h4 {
        color: var(--sf-navy);
        margin: 0 0 0.5rem 0;
    }
    
    .architecture-box p {
        color: var(--sf-gray);
        margin: 0;
        font-size: 0.875rem;
    }
    
    .snowflake-logo-sidebar {
        text-align: center;
        padding: 1.5rem 0 2rem 0;
        border-bottom: 2px solid #E8F7FC;
        margin-bottom: 1rem;
    }
    
    .sidebar-section-title {
        color: #29B5E8;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        padding: 1rem 0 0.5rem 0;
    }
    
    /* ===== GLOBAL CHART ANIMATIONS ===== */
    @keyframes chart-fade-rise {
        0% { opacity: 0; transform: translateY(20px); }
        100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes chart-scale-in {
        0% { opacity: 0; transform: scale(0.9); }
        100% { opacity: 1; transform: scale(1); }
    }
    @keyframes chart-sweep-reveal {
        0% { clip-path: inset(0 100% 0 0); }
        100% { clip-path: inset(0 0 0 0); }
    }
    @keyframes chart-grow-reveal {
        0% { clip-path: inset(100% 0 0 0); }
        100% { clip-path: inset(0 0 0 0); }
    }
    @keyframes chart-center-grow {
        0% { clip-path: circle(0% at 50% 50%); }
        100% { clip-path: circle(100% at 50% 50%); }
    }
    
    /* Apply fade-rise to all Altair chart containers */
    [data-testid="stVegaLiteChart"] {
        animation: chart-fade-rise 0.8s ease-out forwards;
    }
    
    /* Stagger multiple charts in columns */
    [data-testid="column"]:nth-child(1) [data-testid="stVegaLiteChart"] { animation-delay: 0s; }
    [data-testid="column"]:nth-child(2) [data-testid="stVegaLiteChart"] { animation-delay: 0.15s; }
    [data-testid="column"]:nth-child(3) [data-testid="stVegaLiteChart"] { animation-delay: 0.3s; }
    [data-testid="column"]:nth-child(4) [data-testid="stVegaLiteChart"] { animation-delay: 0.45s; }
    
    /* SVG content animations - target the canvas/svg element */
    [data-testid="stVegaLiteChart"] canvas,
    [data-testid="stVegaLiteChart"] svg {
        animation: chart-sweep-reveal 1.2s ease-out forwards;
    }
    
    /* Chart container hover effect */
    [data-testid="stVegaLiteChart"]:hover {
        transform: translateY(-2px);
        transition: transform 0.2s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    /* Animated chart wrapper class - apply to specific chart sections */
    .chart-animate-sweep [data-testid="stVegaLiteChart"] canvas,
    .chart-animate-sweep [data-testid="stVegaLiteChart"] svg {
        animation: chart-sweep-reveal 1.2s ease-out forwards;
    }
    .chart-animate-grow [data-testid="stVegaLiteChart"] canvas,
    .chart-animate-grow [data-testid="stVegaLiteChart"] svg {
        animation: chart-grow-reveal 1s ease-out forwards;
    }
    .chart-animate-center [data-testid="stVegaLiteChart"] canvas,
    .chart-animate-center [data-testid="stVegaLiteChart"] svg {
        animation: chart-center-grow 1s ease-out forwards;
    }
    
    /* ===== GLOBAL LOOPING BAR ANIMATIONS ===== */
    @keyframes bar-wave-loop {
        0%, 100% { transform: scaleY(1); }
        50% { transform: scaleY(0.6); }
    }
    @keyframes bar-pulse-loop {
        0%, 100% { opacity: 0.7; transform: scaleY(0.85); }
        50% { opacity: 1; transform: scaleY(1); }
    }
    @keyframes bar-bounce-loop {
        0%, 100% { transform: scaleY(1) translateY(0); }
        25% { transform: scaleY(0.9) translateY(2px); }
        50% { transform: scaleY(1.1) translateY(-3px); }
        75% { transform: scaleY(0.95) translateY(1px); }
    }
    @keyframes bar-glow-loop {
        0%, 100% { filter: brightness(1) saturate(1); box-shadow: none; }
        50% { filter: brightness(1.3) saturate(1.2); box-shadow: 0 0 8px currentColor; }
    }
    .loop-bars { display: flex; justify-content: center; align-items: flex-end; gap: 3px; height: 45px; }
    .loop-bars .bar { border-radius: 2px; animation: bar-wave-loop 1.5s ease-in-out infinite; transform-origin: bottom; }
    .loop-bars .bar:nth-child(1) { animation-delay: 0s; }
    .loop-bars .bar:nth-child(2) { animation-delay: 0.12s; }
    .loop-bars .bar:nth-child(3) { animation-delay: 0.24s; }
    .loop-bars .bar:nth-child(4) { animation-delay: 0.36s; }
    .loop-bars .bar:nth-child(5) { animation-delay: 0.48s; }
    .loop-bars .bar:nth-child(6) { animation-delay: 0.60s; }
    .loop-bars .bar:nth-child(7) { animation-delay: 0.72s; }
    .loop-bars.bounce .bar { animation-name: bar-bounce-loop; animation-duration: 2s; }
    .loop-bars.pulse .bar { animation-name: bar-pulse-loop; animation-duration: 1.8s; }
    .loop-bars.glow .bar { animation-name: bar-glow-loop; animation-duration: 2s; }
    
    /* ===== IMPRESSIVE ANIMATION SUITE ===== */
    
    /* 1. Animated Gradient Backgrounds */
    @keyframes gradient-shift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    .main-header {
        background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 50%, #BAE6FD 100%) !important;
        color: #1B2A4E !important;
        border: 1px solid #BAE6FD !important;
    }
    .main-header h1, .main-header p { color: #1B2A4E !important; }
    
    /* 2. 3D Tilt Cards */
    @keyframes card-entrance {
        0% { opacity: 0; transform: perspective(1000px) rotateX(-10deg) translateY(20px); }
        100% { opacity: 1; transform: perspective(1000px) rotateX(0) translateY(0); }
    }
    .tilt-card, .kpi-card, .metric-card {
        transform-style: preserve-3d;
        transition: transform 0.4s ease, box-shadow 0.4s ease;
        animation: card-entrance 0.6s ease-out forwards;
    }
    .tilt-card:hover, .kpi-card:hover, .metric-card:hover {
        transform: perspective(1000px) rotateX(2deg) rotateY(-3deg) translateY(-5px) !important;
        box-shadow: 8px 12px 25px rgba(0,0,0,0.15) !important;
    }
    
    /* 3. Neon Glow Effects */
    @keyframes neon-pulse-green {
        0%, 100% { box-shadow: 0 0 5px rgba(16,185,129,0.5), 0 0 10px rgba(16,185,129,0.3); }
        50% { box-shadow: 0 0 10px rgba(16,185,129,0.8), 0 0 20px rgba(16,185,129,0.5), 0 0 30px rgba(16,185,129,0.3); }
    }
    @keyframes neon-pulse-red {
        0%, 100% { box-shadow: 0 0 5px rgba(220,38,38,0.5), 0 0 10px rgba(220,38,38,0.3); }
        50% { box-shadow: 0 0 10px rgba(220,38,38,0.8), 0 0 20px rgba(220,38,38,0.5), 0 0 30px rgba(220,38,38,0.3); }
    }
    @keyframes neon-pulse-blue {
        0%, 100% { box-shadow: 0 0 5px rgba(41,181,232,0.5), 0 0 10px rgba(41,181,232,0.3); }
        50% { box-shadow: 0 0 10px rgba(41,181,232,0.8), 0 0 20px rgba(41,181,232,0.5), 0 0 30px rgba(41,181,232,0.3); }
    }
    .neon-green { animation: neon-pulse-green 2s ease-in-out infinite; }
    .neon-red { animation: neon-pulse-red 1.5s ease-in-out infinite; }
    .neon-blue { animation: neon-pulse-blue 2s ease-in-out infinite; }
    
    /* Global neon glow on all delta indicators */
    .kpi-delta.positive, .ceo-kpi-delta.positive, [class*="-delta"].positive {
        animation: neon-pulse-green 2.5s ease-in-out infinite !important;
    }
    .kpi-delta.negative, .ceo-kpi-delta.negative, [class*="-delta"].negative {
        animation: neon-pulse-red 2s ease-in-out infinite !important;
    }
    
    /* 4. Animated Circular Progress */
    @keyframes circle-fill {
        0% { stroke-dashoffset: 283; }
    }
    @keyframes circle-glow {
        0%, 100% { filter: drop-shadow(0 0 3px currentColor); }
        50% { filter: drop-shadow(0 0 8px currentColor); }
    }
    .progress-ring {
        transform: rotate(-90deg);
    }
    .progress-ring circle.progress {
        stroke-linecap: round;
        animation: circle-glow 2s ease-in-out infinite;
        transition: stroke-dashoffset 1.5s ease-out;
    }
    
    /* 5. Matrix Data Rain */
    @keyframes matrix-fall {
        0% { transform: translateY(-100%); opacity: 0; }
        10% { opacity: 0.7; }
        90% { opacity: 0.7; }
        100% { transform: translateY(100%); opacity: 0; }
    }
    @keyframes matrix-glow {
        0%, 100% { text-shadow: 0 0 5px #10B981; }
        50% { text-shadow: 0 0 15px #10B981, 0 0 25px #10B981; }
    }
    .matrix-container {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        pointer-events: none;
        opacity: 0.15;
    }
    .matrix-column {
        position: absolute;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        color: #10B981;
        writing-mode: vertical-rl;
        animation: matrix-fall linear infinite, matrix-glow 2s ease-in-out infinite;
    }
    
    /* 6. Particle Stream */
    @keyframes particle-float {
        0%, 100% { transform: translateY(0) translateX(0); }
        25% { transform: translateY(-10px) translateX(5px); }
        50% { transform: translateY(0) translateX(10px); }
        75% { transform: translateY(10px) translateX(5px); }
    }
    @keyframes particle-stream-right {
        0% { transform: translateX(-20px); opacity: 0; }
        20% { opacity: 1; }
        80% { opacity: 1; }
        100% { transform: translateX(100px); opacity: 0; }
    }
    .particle {
        position: absolute;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #29B5E8;
        animation: particle-float 3s ease-in-out infinite;
    }
    
    /* 7. Value Counter Animation */
    @keyframes value-count-up {
        0% { opacity: 0; transform: translateY(20px); }
        100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes value-glow {
        0%, 100% { text-shadow: none; }
        50% { text-shadow: 0 0 20px rgba(41,181,232,0.5); }
    }
    .counting-value {
        animation: value-count-up 0.8s ease-out forwards, value-glow 3s ease-in-out 0.8s infinite;
    }
    
    /* 8. Shimmer Effect */
    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
    .shimmer {
        background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.4) 50%, transparent 100%);
        background-size: 200% 100%;
        animation: shimmer 2s infinite;
    }
    
    /* ===== ENHANCED UI/UX ANIMATIONS ===== */
    
    /* 9. Question Card Hover Effects */
    @keyframes question-card-glow {
        0%, 100% { box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        50% { box-shadow: 0 4px 20px rgba(41,181,232,0.2); }
    }
    .question-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }
    .question-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(41,181,232,0.1), transparent);
        transition: left 0.5s ease;
    }
    .question-card::after {
        content: '❄️ Click to ask →';
        position: absolute;
        bottom: 0.5rem;
        right: 0.75rem;
        font-size: 0.7rem;
        color: #29B5E8;
        font-weight: 600;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .question-card:hover {
        transform: translateY(-4px) scale(1.01) !important;
        box-shadow: 0 8px 30px rgba(41,181,232,0.2) !important;
        border-color: #29B5E8 !important;
    }
    .question-card:hover::before {
        left: 100%;
    }
    .question-card:hover::after {
        opacity: 1;
    }
    .question-card:active {
        transform: scale(0.98) !important;
    }
    
    /* 10. Live Data Pulse Indicator */
    @keyframes live-pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.3); opacity: 0.7; }
    }
    @keyframes live-ring {
        0% { transform: scale(1); opacity: 0.8; }
        100% { transform: scale(2); opacity: 0; }
    }
    .live-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    .live-dot {
        width: 8px;
        height: 8px;
        background: #10B981;
        border-radius: 50%;
        position: relative;
        animation: live-pulse 1.5s ease-in-out infinite;
    }
    .live-dot::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #10B981;
        border-radius: 50%;
        animation: live-ring 1.5s ease-out infinite;
    }
    
    /* 11. Skeleton Loading States */
    @keyframes skeleton-shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
    .skeleton {
        background: linear-gradient(90deg, #E5E7EB 25%, #F3F4F6 50%, #E5E7EB 75%);
        background-size: 200% 100%;
        animation: skeleton-shimmer 1.5s ease-in-out infinite;
        border-radius: 4px;
    }
    .skeleton-text { height: 1rem; margin-bottom: 0.5rem; }
    .skeleton-title { height: 1.5rem; width: 60%; margin-bottom: 1rem; }
    .skeleton-avatar { width: 40px; height: 40px; border-radius: 50%; }
    .skeleton-card { height: 120px; border-radius: 12px; }
    
    /* 12. Alert/Notification Badge Animations */
    @keyframes alert-bounce {
        0%, 100% { transform: scale(1); }
        25% { transform: scale(1.2); }
        50% { transform: scale(0.9); }
        75% { transform: scale(1.1); }
    }
    @keyframes alert-critical {
        0%, 100% { background: #DC2626; box-shadow: 0 0 0 0 rgba(220,38,38,0.4); }
        50% { background: #EF4444; box-shadow: 0 0 15px 5px rgba(220,38,38,0.3); }
    }
    @keyframes alert-warning {
        0%, 100% { background: #D97706; box-shadow: 0 0 0 0 rgba(217,119,6,0.3); }
        50% { background: #F59E0B; box-shadow: 0 0 10px 3px rgba(245,158,11,0.3); }
    }
    .alert-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
    }
    .alert-badge.critical {
        animation: alert-critical 1s ease-in-out infinite, alert-bounce 0.6s ease-out;
    }
    .alert-badge.warning {
        animation: alert-warning 1.5s ease-in-out infinite;
    }
    .alert-badge.success {
        background: #10B981;
    }
    
    /* 13. Table Row Animations */
    @keyframes row-slide-in {
        0% { opacity: 0; transform: translateX(-20px); }
        100% { opacity: 1; transform: translateX(0); }
    }
    @keyframes row-highlight {
        0%, 100% { background: transparent; }
        50% { background: rgba(41,181,232,0.1); }
    }
    .animated-table tr {
        animation: row-slide-in 0.4s ease-out forwards;
        opacity: 0;
        transition: background 0.2s ease;
    }
    .animated-table tr:nth-child(1) { animation-delay: 0.05s; }
    .animated-table tr:nth-child(2) { animation-delay: 0.1s; }
    .animated-table tr:nth-child(3) { animation-delay: 0.15s; }
    .animated-table tr:nth-child(4) { animation-delay: 0.2s; }
    .animated-table tr:nth-child(5) { animation-delay: 0.25s; }
    .animated-table tr:nth-child(n+6) { animation-delay: 0.3s; }
    .animated-table tr:hover {
        background: rgba(41,181,232,0.08) !important;
    }
    
    /* 14. Status Badge Animations */
    @keyframes status-healthy {
        0%, 100% { box-shadow: 0 0 0 0 rgba(16,185,129,0.4); }
        50% { box-shadow: 0 0 8px 2px rgba(16,185,129,0.3); }
    }
    @keyframes status-warning {
        0%, 100% { box-shadow: 0 0 0 0 rgba(245,158,11,0.4); }
        50% { box-shadow: 0 0 10px 3px rgba(245,158,11,0.4); }
    }
    @keyframes status-critical {
        0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.5); transform: scale(1); }
        50% { box-shadow: 0 0 12px 4px rgba(239,68,68,0.4); transform: scale(1.05); }
    }
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .status-badge.healthy {
        background: #D1FAE5;
        color: #059669;
        animation: status-healthy 2s ease-in-out infinite;
    }
    .status-badge.warning {
        background: #FEF3C7;
        color: #D97706;
        animation: status-warning 1.5s ease-in-out infinite;
    }
    .status-badge.critical {
        background: #FEE2E2;
        color: #DC2626;
        animation: status-critical 1s ease-in-out infinite;
    }
    .status-badge .status-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: currentColor;
    }
    
    /* 15. Floating Action Button */
    @keyframes fab-float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }
    @keyframes fab-pulse {
        0%, 100% { box-shadow: 0 4px 15px rgba(41,181,232,0.3); }
        50% { box-shadow: 0 6px 25px rgba(41,181,232,0.5); }
    }
    .floating-action {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(135deg, #29B5E8, #0EA5E9);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        cursor: pointer;
        animation: fab-float 3s ease-in-out infinite, fab-pulse 2s ease-in-out infinite;
        transition: transform 0.3s ease;
        z-index: 1000;
    }
    .floating-action:hover {
        transform: scale(1.1) !important;
    }
    
    /* 16. Number Counter Animation (Enhanced) */
    @keyframes number-pop {
        0% { opacity: 0; transform: scale(0.5) translateY(10px); }
        60% { transform: scale(1.1) translateY(-5px); }
        100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    @keyframes number-glow-pulse {
        0%, 100% { text-shadow: none; }
        50% { text-shadow: 0 0 15px currentColor; }
    }
    .animated-number {
        animation: number-pop 0.6s ease-out forwards;
        opacity: 0;
    }
    .animated-number.glow {
        animation: number-pop 0.6s ease-out forwards, number-glow-pulse 2s ease-in-out 0.6s infinite;
    }
    
    /* 17. Insight Card Animations */
    @keyframes insight-reveal {
        0% { opacity: 0; transform: translateY(15px) rotateX(-10deg); }
        100% { opacity: 1; transform: translateY(0) rotateX(0); }
    }
    .insight-card {
        animation: insight-reveal 0.5s ease-out forwards;
        opacity: 0;
        transition: all 0.3s ease;
    }
    .insight-card:nth-child(1) { animation-delay: 0.1s; }
    .insight-card:nth-child(2) { animation-delay: 0.2s; }
    .insight-card:nth-child(3) { animation-delay: 0.3s; }
    .insight-card:nth-child(4) { animation-delay: 0.4s; }
    .insight-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    
    /* 18. Progress Bar Animation */
    @keyframes progress-fill {
        0% { width: 0%; }
    }
    @keyframes progress-shine {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    .animated-progress {
        height: 8px;
        background: #E5E7EB;
        border-radius: 4px;
        overflow: hidden;
        position: relative;
    }
    .animated-progress .fill {
        height: 100%;
        border-radius: 4px;
        animation: progress-fill 1s ease-out forwards;
        position: relative;
        overflow: hidden;
    }
    .animated-progress .fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 50%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        animation: progress-shine 2s ease-in-out infinite 1s;
    }
    .animated-progress .fill.green { background: linear-gradient(90deg, #10B981, #059669); }
    .animated-progress .fill.blue { background: linear-gradient(90deg, #29B5E8, #0EA5E9); }
    .animated-progress .fill.orange { background: linear-gradient(90deg, #F59E0B, #D97706); }
    .animated-progress .fill.red { background: linear-gradient(90deg, #EF4444, #DC2626); }
    
    /* 19. Tooltip Animation */
    @keyframes tooltip-appear {
        0% { opacity: 0; transform: translateY(5px) scale(0.95); }
        100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    .animated-tooltip {
        position: relative;
    }
    .animated-tooltip .tooltip-content {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #1B2A4E;
        color: white;
        padding: 0.5rem 0.75rem;
        border-radius: 6px;
        font-size: 0.75rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: all 0.2s ease;
        margin-bottom: 8px;
    }
    .animated-tooltip .tooltip-content::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: #1B2A4E;
    }
    .animated-tooltip:hover .tooltip-content {
        opacity: 1;
        animation: tooltip-appear 0.2s ease-out;
    }
    
    /* 20. Data Refresh Animation */
    @keyframes refresh-spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    @keyframes refresh-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    .refresh-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: #6B7280;
        font-size: 0.75rem;
    }
    .refresh-indicator.loading .refresh-icon {
        animation: refresh-spin 1s linear infinite;
    }
    .refresh-indicator.loading .refresh-text {
        animation: refresh-pulse 1s ease-in-out infinite;
    }
    
    /* 21. Streamlit Dataframe Animations */
    @keyframes table-row-enter {
        0% { opacity: 0; transform: translateX(-10px); }
        100% { opacity: 1; transform: translateX(0); }
    }
    [data-testid="stDataFrame"] {
        animation: chart-fade-rise 0.5s ease-out forwards;
    }
    [data-testid="stDataFrame"] [role="row"] {
        transition: background-color 0.2s ease;
    }
    [data-testid="stDataFrame"] [role="row"]:hover {
        background-color: rgba(41, 181, 232, 0.08) !important;
    }
    
    /* 22. Container Border Animation */
    @keyframes container-border-glow {
        0%, 100% { border-color: #E5E7EB; }
        50% { border-color: #29B5E8; }
    }
    [data-testid="stVerticalBlock"] > div[data-testid="stVerticalBlockBorderWrapper"] {
        transition: all 0.3s ease;
    }
    [data-testid="stVerticalBlock"] > div[data-testid="stVerticalBlockBorderWrapper"]:hover {
        box-shadow: 0 4px 20px rgba(41, 181, 232, 0.1);
        border-color: #29B5E8 !important;
    }
    
    /* 23. Metric Card Entrance */
    @keyframes metric-card-enter {
        0% { opacity: 0; transform: translateY(20px) scale(0.95); }
        100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    [data-testid="metric-container"] {
        animation: metric-card-enter 0.5s ease-out forwards;
    }
    [data-testid="stMetric"]:hover {
        transform: translateY(-2px);
        transition: transform 0.2s ease;
    }
    
    /* 24. Expander Animation */
    @keyframes expander-content-reveal {
        0% { opacity: 0; max-height: 0; }
        100% { opacity: 1; max-height: 1000px; }
    }
    [data-testid="stExpander"] details[open] > div {
        animation: expander-content-reveal 0.3s ease-out forwards;
    }
    [data-testid="stExpander"] summary {
        transition: all 0.2s ease;
    }
    [data-testid="stExpander"] summary:hover {
        color: #29B5E8;
    }
    
    /* 25. Button Enhancements */
    .stButton > button {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative;
        overflow: hidden;
    }
    .stButton > button::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.6s ease, height 0.6s ease;
    }
    .stButton > button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(41, 181, 232, 0.3);
    }
    .stButton > button:hover::before {
        width: 300px;
        height: 300px;
    }
    .stButton > button:active {
        transform: translateY(0);
    }
    
    /* 26. SelectBox Animation */
    [data-testid="stSelectbox"] > div {
        transition: all 0.2s ease;
    }
    [data-testid="stSelectbox"] > div:focus-within {
        box-shadow: 0 0 0 2px rgba(41, 181, 232, 0.3);
    }
    
    /* 27. Text Input Animation */
    [data-testid="stTextInput"] input {
        transition: all 0.2s ease !important;
    }
    [data-testid="stTextInput"] input:focus {
        border-color: #29B5E8 !important;
        box-shadow: 0 0 0 2px rgba(41, 181, 232, 0.2) !important;
    }
    
    /* 28. Tabs Animation */
    .stTabs [data-baseweb="tab-list"] button {
        transition: all 0.2s ease;
    }
    .stTabs [data-baseweb="tab-list"] button:hover {
        color: #29B5E8;
        background: rgba(41, 181, 232, 0.08);
    }
    .stTabs [data-baseweb="tab-list"] button[aria-selected="true"] {
        position: relative;
    }
    .stTabs [data-baseweb="tab-list"] button[aria-selected="true"]::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #29B5E8, #0EA5E9);
        border-radius: 3px 3px 0 0;
    }
    
    /* Reduce motion for accessibility */
    @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
</style>
"""

PAGES = {
    "Executive_Summary": {
        "title": "Executive Summary",
        "persona": "All Executives",
        "duration": "5 minutes",
        "focus": "High-level business overview, key metrics at a glance, strategic priorities",
        "views": ["MOBILE", "FINANCE", "NETWORK_OPS", "SUPPORT", "PROPENSITY"],
        "questions": [
            "What is our total subscriber count and how has it changed this quarter?",
            "Show me our revenue performance - total revenue, ARPU, and growth trends.",
            "What is our current NPS score across all customer segments?",
            "How is our network performing? Show me availability and quality metrics.",
            "What are the top 3 business priorities we should focus on this month?"
        ],
        "insights": [
            "30,000+ total subscribers (70% Consumer, 26% SMB, 4% Enterprise)",
            "Revenue growth tracking vs targets",
            "NPS trending by segment",
            "Network availability: 99.5%+",
            "Strategic priorities dashboard"
        ]
    },
    "SnowTelco_Website": {
        "title": "SnowTelco Website",
        "persona": "Customer / Prospect",
        "duration": "Browse",
        "focus": "Customer-facing website showcasing plans, products, and services",
        "views": [],
        "questions": [],
        "insights": []
    },
    "Persona_Hub": {
        "title": "Persona Hub",
        "persona": "All Users",
        "duration": "Browse",
        "focus": "Navigate to any persona dashboard, search by role or topic",
        "views": [],
        "questions": [],
        "insights": []
    },
    "00_WOW_Executive_Showcase": {
        "title": "Executive Showcase",
        "persona": "CEO / Board Member / Executive Sponsor",
        "duration": "10-15 minutes",
        "focus": "Cross-domain analysis, conversational memory, data+document fusion, predictive insights",
        "views": ["MOBILE", "FINANCE", "NETWORK_OPS", "NETWORK_QOE", "SUPPORT", "PROPENSITY", "MARKET_INTELLIGENCE", "PARTNER", "PORTING", "CUSTOMER_EXPERIENCE", "SLA"],
        "questions": [
            "I'm preparing for a board meeting tomorrow. Give me a complete health check of SnowTelco - our subscriber base, revenue performance, customer satisfaction, and network quality. What are the 3 most critical things I need to know?",
            "Tell me more about our churn situation. What's our current churn rate, which customer segments are most at risk, and how much revenue could we lose?",
            "Show me the profile of our highest-risk customers. What do they have in common? Are there patterns we should be worried about?",
            "What retention offers can we make to these at-risk customers? Check our retention policy and tell me what discounts or incentives are available.",
            "How does our pricing compare to competitors? Are we losing customers because of price?",
            "Is network quality contributing to our churn? Show me if there's a correlation between network problems and customer satisfaction.",
            "What about our support experience? Are churned customers calling us more before they leave?",
            "Based on everything we've discussed, create a prioritized action plan for reducing churn.",
            "Create an executive summary for my board presentation - 5 bullet points covering business performance, key risks, recommended actions, and expected outcomes."
        ],
        "insights": [
            "Cross-domain analysis spanning multiple semantic views",
            "Conversational memory building context",
            "Data + document fusion for policy-aware recommendations",
            "AI-synthesized strategic recommendations"
        ]
    },
    "01_CEO_Strategic": {
        "title": "CEO Strategic Overview",
        "persona": "Chief Executive Officer",
        "duration": "10 minutes",
        "focus": "Overall business performance, market position, strategic KPIs, competitive landscape",
        "views": ["MOBILE", "PORTING", "NETWORK_OPS", "MARKET_INTELLIGENCE"],
        "questions": [
            "Give me an executive summary of SnowTelco's current performance - total subscribers, ARPU, and NPS split by B2C consumers versus B2B business customers.",
            "Show me our port-in versus port-out analysis - which competitors are we winning customers from and losing customers to?",
            "What are our top network quality issues affecting customer satisfaction? Show me the correlation between network problems and NPS scores by city.",
            "Compare our performance against our main competitors - how do we rank in terms of market share, customer satisfaction, and service quality?",
            "Based on all this data, what are the 3 most critical strategic priorities I should focus on this quarter?"
        ],
        "insights": [
            "Total subscribers: ~30,000 (70% Consumer, 26% SMB, 4% Enterprise)",
            "ARPU and NPS by customer type",
            "Port-in/port-out competitive analysis",
            "Network performance correlation with customer satisfaction"
        ]
    },
    "02_CFO_Finance": {
        "title": "CFO Financial Performance",
        "persona": "Chief Financial Officer",
        "duration": "10 minutes",
        "focus": "Revenue, margins, ARPU trends, billing efficiency, cost management, vendor spend",
        "views": ["FINANCE", "BILLING", "MOBILE", "SALES"],
        "questions": [
            "Show me our revenue breakdown by customer type - Consumer, SMB, and Enterprise - with average bill amounts.",
            "What's our ARPU by customer type and segment? Show me Consumer vs SMB vs Enterprise, and break down by value tier.",
            "What's our payment status distribution? Show me Paid vs Pending vs Overdue by customer type.",
            "What are our top vendor expenses by department and what's the approval status?",
            "What revenue is at risk from churned customers? Show me lifetime value lost by customer type and segment."
        ],
        "insights": [
            "Revenue split: Consumer (~70%) vs SMB (~26%) vs Enterprise (~4%)",
            "ARPU by type: Enterprise (~£100-150) > SMB (~£50-80) > Consumer (~£25-40)",
            "Payment status: ~70% Paid, ~20% Pending, ~10% Overdue",
            "Vendor spend visibility and approval status"
        ]
    },
    "03_CMO_Marketing": {
        "title": "CMO Marketing Performance",
        "persona": "Chief Marketing Officer",
        "duration": "10 minutes",
        "focus": "Campaign performance, customer acquisition, brand health, NPS, churn prevention",
        "views": ["MARKETING", "MOBILE", "PORTING"],
        "questions": [
            "Which marketing campaigns have delivered the best ROI? Show me spend, leads generated, and impressions by campaign.",
            "Where are our customers coming from? Break down by acquisition channel for Consumer vs B2B customers.",
            "What's our NPS score by customer type and segment? Compare Consumer vs SMB vs Enterprise.",
            "What are the top reasons customers are churning? Show me churn reasons by customer type and which competitors they're leaving for.",
            "Show me our port-in versus port-out by competitor. Which carriers are we winning from and losing to?"
        ],
        "insights": [
            "Campaign ROI: spend vs leads generated",
            "Acquisition channels: Online, Retail, App, Direct Sales, Partner",
            "NPS by segment: VIP > Premium > Standard > Budget",
            "Churn reasons: Price, Network Coverage, Competitor Promotion"
        ]
    },
    "04_CTO_Technology": {
        "title": "CTO Technology & Network",
        "persona": "Chief Technology Officer",
        "duration": "10 minutes",
        "focus": "Network strategy, 5G rollout, IT systems, technology investments, digital transformation",
        "views": ["NETWORK_OPS", "NETWORK_QOE", "IT_OPS", "SLA", "RAN"],
        "questions": [
            "Show me our network performance metrics by city - availability, latency, and throughput. Which cities have the best and worst performance?",
            "What's our 5G rollout status by region? Show me sites that are live, in progress, and planned.",
            "Which network elements have the highest utilization? Show me capacity hotspots that may need upgrades.",
            "What's the status of our critical IT systems? Show me open incidents by severity and resolution times.",
            "What's the customer experience quality on our network? Show me download speeds, latency, and video quality scores.",
            "What are the key initiatives in our digital transformation roadmap for 2026?",
            "Are we meeting our network SLAs? Show me SLA compliance rates and any breaches this month."
        ],
        "insights": [
            "Network availability target: 99%+",
            "5G deployment status by region",
            "IT incident MTTR by severity",
            "QoE metrics: download speeds, video quality (1-5)"
        ]
    },
    "05_COO_Operations": {
        "title": "COO Operations Excellence",
        "persona": "Chief Operating Officer",
        "duration": "10 minutes",
        "focus": "Operational efficiency, process performance, service quality, supply chain, workforce productivity",
        "views": ["SUPPORT", "SUPPORT_TICKET", "NETWORK_OPS", "NETWORK_ALARM", "ACTIVATION", "ASSET", "ORDER"],
        "questions": [
            "Give me a snapshot of our operational performance - contact centre wait times and CSAT, network availability, and SIM activation times.",
            "How is our contact centre performing? Show me handle times, first call resolution rates, and CSAT by team.",
            "What's our SIM activation performance? Show me average activation times by channel and any pending activations.",
            "What's our inventory position? Show me stock levels by warehouse and items at risk of stock-out.",
            "What's the health of our network? Show me availability, alarms by severity, MTTR, and any critical issues.",
            "What are our operational KPI targets and process standards?"
        ],
        "insights": [
            "Contact centre: AHT, FCR, CSAT by queue",
            "SIM activation times by channel",
            "Inventory stock status",
            "Network MTTR by severity"
        ]
    },
    "06_CCO_Commercial": {
        "title": "CCO Commercial Performance",
        "persona": "Chief Commercial Officer",
        "duration": "10 minutes",
        "focus": "Revenue growth, sales performance, partner channel, pricing strategy, market expansion",
        "views": ["SALES_PIPELINE", "PARTNER", "MOBILE", "PORTING", "MARKET_INTELLIGENCE"],
        "questions": [
            "Show me our revenue performance - total revenue by customer type and ARPU trends.",
            "What does our B2B sales pipeline look like? Show me opportunities by stage and expected close dates.",
            "How are our partner channels performing? Show me partner revenue, commissions, and top performers by tier.",
            "What's our subscriber mix? Show me 5G vs 4G adoption, plan types, and ARPU by network generation.",
            "How do we compare to competitors? Show me port-in vs port-out by carrier and competitor pricing."
        ],
        "insights": [
            "Revenue by customer type",
            "B2B pipeline by stage",
            "Partner performance by tier (Gold, Silver, Bronze)",
            "5G vs 4G subscriber mix and ARPU"
        ]
    },
    "07_CXO_Customer_Experience": {
        "title": "CXO Customer Experience",
        "persona": "Chief Experience Officer",
        "duration": "10 minutes",
        "focus": "Customer journey optimization, NPS improvement, experience transformation",
        "views": ["CUSTOMER_EXPERIENCE", "MOBILE", "SUPPORT"],
        "questions": [
            "What's the distribution of customer interactions by journey stage?",
            "Which channels have the highest customer effort scores?",
            "Show me the average sentiment score by channel this month.",
            "What's our conversion rate by channel? Show me conversions vs total interactions.",
            "Which channels have the highest resolution rates?",
            "Compare digital vs physical channel performance - sentiment and effort scores.",
            "What's the average session duration by journey stage?",
            "Show me customer satisfaction (NPS) by customer segment."
        ],
        "insights": [
            "Journey stages: Awareness, Consideration, Purchase, Support, Usage, Renewal",
            "Sentiment by channel",
            "Effort scores (lower is better)",
            "Conversion metrics by channel"
        ]
    },
    "08_CNO_Network_QoE": {
        "title": "CNO Network Quality of Experience",
        "persona": "Chief Networks Officer",
        "duration": "10 minutes",
        "focus": "Network performance, RAN operations, customer experience correlation, 5G rollout",
        "views": ["NETWORK_QOE", "NETWORK_OPS", "RAN"],
        "questions": [
            "What's the average download speed by network generation (3G/4G/5G)?",
            "Show me the cells with the worst latency performance.",
            "What's our video streaming quality score across the network?",
            "How does network performance correlate with churn risk?",
            "Which app categories are most affected by poor network quality?",
            "Compare 5G vs 4G customer experience metrics.",
            "Show me QoE metrics by city.",
            "Which cells need capacity upgrades based on customer experience?"
        ],
        "insights": [
            "5G delivers 5-10x better speeds than 4G",
            "Video quality correlates with customer satisfaction",
            "Geographic variations in network experience",
            "App-specific performance requirements"
        ]
    },
    "09_CDO_Data_Science": {
        "title": "CDO AI/ML Propensity Analytics",
        "persona": "Chief Data Officer / Head of Data Science",
        "duration": "10 minutes",
        "focus": "Predictive analytics, ML operations, data-driven decision making",
        "views": ["PROPENSITY", "MOBILE"],
        "questions": [
            "How many customers are at high risk of churning?",
            "Show me the churn risk by customer segment.",
            "What's the predicted revenue at risk from high-churn customers?",
            "Which customers have the highest upsell propensity?",
            "Show me the next best action distribution.",
            "What's the average predicted CLV by customer type?",
            "What's the confidence score distribution for our predictions?",
            "Compare churn risk for 5G vs non-5G customers.",
            "What are our AI/ML strategic objectives and use cases for 2026?"
        ],
        "insights": [
            "Churn risk distribution by segment",
            "Predicted CLV and revenue at risk",
            "Next best action recommendations",
            "ML model confidence scores"
        ]
    },
    "10_CSO_Sustainability": {
        "title": "CSO Sustainability & ESG",
        "persona": "Chief Sustainability Officer",
        "duration": "10 minutes",
        "focus": "Carbon reduction, renewable energy, net zero targets, ESG reporting",
        "views": ["SUSTAINABILITY"],
        "questions": [
            "What's our total energy consumption this year?",
            "What percentage of our energy comes from renewable sources?",
            "Show me our carbon emissions trend.",
            "Which sites consume the most energy?",
            "What's our average PUE (Power Usage Effectiveness) ratio?",
            "Compare energy consumption by site type (Macro vs Small Cell).",
            "Which sites have the highest carbon intensity?",
            "What's our progress toward net zero?",
            "How many customers are on green tariffs?",
            "What's our e-waste recycling rate?"
        ],
        "insights": [
            "Renewable energy: 40% -> 65% progress",
            "Carbon emissions decreasing YoY",
            "Small cells more energy efficient",
            "Net zero progress tracking"
        ]
    },
    "11_VP_Customer_Service": {
        "title": "VP Customer Service",
        "persona": "VP Customer Service / Director of Customer Experience",
        "duration": "10 minutes",
        "focus": "Contact centre operations, ticket management, CSAT, complaint handling",
        "views": ["SUPPORT", "SUPPORT_TICKET", "COMPLAINT", "MOBILE"],
        "questions": [
            "Show me our contact centre performance - average handle time, wait time, and CSAT scores by queue.",
            "How does our support performance differ between Consumer and B2B customers?",
            "What are the top support ticket categories? Show me ticket volumes and resolution times.",
            "Show me our formal complaint volumes and resolution times. What are the main complaint categories?",
            "Who are our top performing agents by CSAT? Show me agent rankings and team performance."
        ],
        "insights": [
            "AHT, FCR, CSAT by queue",
            "Ticket categories and resolution times",
            "Complaint volumes and Ombudsman escalation rate",
            "Agent CSAT rankings"
        ]
    },
    "12_VP_Network_Operations": {
        "title": "VP Network Operations",
        "persona": "VP Network Operations / Head of Network Management Centre",
        "duration": "10 minutes",
        "focus": "Network availability, alarm management, capacity planning, RF optimization, incident response, SLA delivery",
        "views": ["NETWORK_OPS", "NETWORK_ALARM", "SLA", "MOBILE", "RAN"],
        "questions": [
            "Show me the current health of our network - average availability, latency, and throughput.",
            "Show me our network alarms - alarm counts by severity, MTTR, and average alarm duration.",
            "How is our network performing by region? Show me availability and latency for major cities.",
            "Which network elements have the highest utilization? Show me elements above 60% utilization.",
            "Show me RF optimization KPIs - RSRP, RSRQ, SINR, handover success, and call drop rate by site.",
            "Are we meeting our SLAs? Show me SLA measurements - how many met versus breached."
        ],
        "insights": [
            "Network availability: 99.5-99.9%",
            "MTTR by severity",
            "Regional performance comparison",
            "RF signal quality and handover success trends",
            "SLA attainment and breach tracking"
        ]
    },
    "Alert_Center": {
        "title": "Network Alert Center",
        "persona": "NOC Manager / Network Operations",
        "duration": "10 minutes",
        "focus": "Real-time alert monitoring, incident management, SLA tracking, impact analysis",
        "views": ["NETWORK_ALARM", "NETWORK_OPS", "SLA"],
        "questions": [
            "Show me all P1 critical alerts with their MTTR and affected subscribers.",
            "Which network sites have the most recurring alerts this month?",
            "What's our SLA compliance rate by region and alert severity?",
            "Show me the correlation between alerts and customer churn risk."
        ],
        "insights": [
            "Real-time alert feed with severity levels",
            "UK map with tower status",
            "MTTR performance vs SLA targets",
            "SLA credit exposure tracking"
        ]
    },
    "13_Head_of_Partners": {
        "title": "Head of Partners",
        "persona": "Head of Partners / Director of Channel Sales",
        "duration": "10 minutes",
        "focus": "Partner performance, commission management, recruitment, training, partner experience",
        "views": ["PARTNER", "ORDER", "SALES"],
        "questions": [
            "Give me an overview of our partner channel - total partners, active this month, and revenue contribution.",
            "Who are our top performing partners this quarter? Show me by revenue, orders, and customer acquisition.",
            "What commissions have we paid this month and what's accrued for next payment?",
            "Which partners are underperforming or at risk? Show me activity levels and engagement indicators.",
            "What does our partner recruitment pipeline look like? How many new partners have we onboarded?"
        ],
        "insights": [
            "Partner revenue by tier (Gold, Silver, Bronze)",
            "Commission paid and accrued",
            "Partner health indicators",
            "Recruitment pipeline status"
        ]
    },
    "14_VP_Billing_Revenue": {
        "title": "VP Billing & Revenue",
        "persona": "VP Billing & Revenue / Director of Revenue Management",
        "duration": "10 minutes",
        "focus": "Billing accuracy, payment status, revenue assurance, dispute management",
        "views": ["BILLING", "MOBILE", "REVENUE_ASSURANCE", "DISPUTE"],
        "questions": [
            "Show me our billing performance - total invoices, amount billed, and average invoice value.",
            "What's our payment status distribution? Show me Paid vs Pending vs Overdue by customer type.",
            "Are there any revenue leakage risks? Show me unbilled usage, credit notes, and adjustments.",
            "How many credit notes have we issued? Show me amounts by reason and approval status.",
            "Show me our billing disputes - volumes, categories, and resolution times."
        ],
        "insights": [
            "Invoice generation and billing amounts",
            "Payment status distribution",
            "Revenue leakage (unbilled usage)",
            "Dispute resolution performance"
        ]
    },
    "15_VP_IT_Digital": {
        "title": "VP IT & Digital",
        "persona": "VP IT / Director of IT Operations",
        "duration": "10 minutes",
        "focus": "IT incident management, SLA compliance, application health, service delivery",
        "views": ["IT_OPS", "SLA", "CUSTOMER_EXPERIENCE"],
        "questions": [
            "Show me our open IT incidents by severity - how many P1, P2, P3, P4 issues do we have?",
            "What's our Mean Time to Resolve (MTTR) by severity? Are we meeting our SLA targets?",
            "What are the main root causes of our IT incidents? Show me categories and patterns.",
            "Which applications have the most incidents? Show me the top affected systems.",
            "How are we performing against our SLAs? Show me attainment rates and any breaches."
        ],
        "insights": [
            "Open incidents by severity (P1-P4)",
            "MTTR targets: P1: 4hr, P2: 8hr, P3: 24hr, P4: 72hr",
            "Root cause categories",
            "SLA attainment and breach analysis"
        ]
    },
    "16_VP_Field_Operations": {
        "title": "VP Field Operations",
        "persona": "VP of Field Operations",
        "duration": "10 minutes",
        "focus": "Workforce optimization, SLA compliance, cost management, first-time fix rates",
        "views": ["FIELD_OPERATIONS"],
        "questions": [
            "What's our overall first-time fix rate?",
            "Show me technician performance rankings.",
            "Which technicians have the highest customer satisfaction scores?",
            "What's our SLA compliance rate by region?",
            "Show me the average delay time by visit type.",
            "How many visits were rescheduled last month and why?",
            "What's the average cost per visit by type?",
            "Which visit types have the highest parts costs?",
            "What are our field technician KPI targets and safety requirements?"
        ],
        "insights": [
            "First-time fix rate target: 90%",
            "SLA compliance target: 95%",
            "Technician CSAT rankings",
            "Cost per visit analysis"
        ]
    },
    "17_VP_Strategy": {
        "title": "VP Strategy",
        "persona": "VP of Strategy / Head of Competitive Intelligence",
        "duration": "10 minutes",
        "focus": "Market positioning, competitive analysis, pricing strategy, growth opportunities",
        "views": ["MARKET_INTELLIGENCE"],
        "questions": [
            "What's our current market share vs competitors?",
            "How has our market share trended over the past year?",
            "Which regions are we strongest/weakest in?",
            "How does our ARPU compare to competitors?",
            "Which competitors are gaining/losing share?",
            "Compare our pricing to competitors for similar plans.",
            "What's the total addressable market by region?",
            "Which competitor's customers are most likely to switch?"
        ],
        "insights": [
            "SnowTelco: ~5% market share (growing challenger)",
            "Regional strengths/weaknesses",
            "Competitive pricing analysis",
            "MVNO vs MNO market dynamics"
        ]
    },
    "18_VP_Communications": {
        "title": "VP Communications",
        "persona": "VP of Communications / Head of Brand",
        "duration": "10 minutes",
        "focus": "Brand reputation, social media monitoring, crisis management, voice of customer",
        "views": ["SOCIAL_SENTIMENT"],
        "questions": [
            "What's our overall social media sentiment this month?",
            "Show me the sentiment trend over the past week.",
            "Which platforms have the most negative mentions?",
            "What topics are customers talking about most?",
            "Show me negative mentions about network quality.",
            "Which topics have the worst sentiment?",
            "How many mentions require a response that we haven't responded to?",
            "What's our average response time to negative mentions?",
            "Show me high-reach negative mentions from influencers.",
            "What is our crisis response protocol and escalation timeline?"
        ],
        "insights": [
            "Sentiment: 35% positive, 40% negative, 25% neutral",
            "Platform-specific patterns",
            "Response backlog tracking",
            "Crisis playbook protocols"
        ]
    },
    "19_Regulatory_Compliance": {
        "title": "Regulatory & Compliance",
        "persona": "Head of Regulatory Affairs / Compliance Director",
        "duration": "10 minutes",
        "focus": "Ofcom compliance, SLA management, GDPR, complaint handling, service quality reporting",
        "views": ["SLA", "COMPLAINT", "NETWORK_OPS", "MOBILE"],
        "questions": [
            "Show me our regulatory compliance status - SLA performance, complaint metrics, and any areas of concern.",
            "How are we performing against our published SLAs? Show me breach rates and credit liability.",
            "Are we meeting Ofcom complaint handling requirements? Show me resolution times and escalation rates.",
            "Are we meeting our network quality commitments? Show me coverage, availability, and performance metrics.",
            "What data do we need for our quarterly Ofcom submission? Summarize key metrics."
        ],
        "insights": [
            "SLA attainment rate",
            "Complaint-to-subscriber ratio",
            "Ombudsman escalation rate",
            "Ofcom reporting requirements"
        ]
    },
    "20_VP_Security": {
        "title": "VP Security & Fraud Prevention",
        "persona": "VP Security & Fraud Prevention",
        "duration": "10 minutes",
        "focus": "Fraud detection, loss prevention, security analytics",
        "views": ["FRAUD_DETECTION"],
        "questions": [
            "What is our total fraud detection volume by category and what losses have we prevented this year?",
            "How effective are our different detection methods - ML models vs rule engines vs manual review?",
            "Show me critical and high severity fraud cases - what types are causing the most damage?",
            "What's our fraud case resolution rate and average time to resolution?",
            "Are we seeing repeat offenders and what monthly trends do we have in fraud activity?"
        ],
        "insights": [
            "Fraud categories: Identity, Traffic, Device, Channel, Internal",
            "ML model effectiveness",
            "SIM swap and account takeover trends",
            "Prevention ROI"
        ]
    },
    "21_VP_Enterprise_Sales": {
        "title": "VP Enterprise Sales",
        "persona": "VP Enterprise Sales",
        "duration": "10 minutes",
        "focus": "B2B contract renewals, enterprise revenue retention, competitive threats",
        "views": ["B2B_CONTRACT"],
        "questions": [
            "What is our total B2B contract portfolio value by product type and renewal status?",
            "Show me contracts coming up for renewal in the next 90 days with their renewal probability.",
            "Which contracts have competitive threats and who are we losing deals to?",
            "What upgrade and expansion opportunities do we have in the renewal pipeline?",
            "What is our total at-risk contract value and what's driving churn risk?"
        ],
        "insights": [
            "ACV by product type",
            "Renewal probability analysis",
            "Competitive threats: BT, Vodafone, Virgin Media O2",
            "At-risk revenue identification"
        ]
    },
    "22_VP_Wholesale": {
        "title": "VP Wholesale & MVNO",
        "persona": "VP Wholesale & MVNO Partnerships",
        "duration": "10 minutes",
        "focus": "MVNO traffic, wholesale revenue, partner settlements",
        "views": ["WHOLESALE_MVNO"],
        "questions": [
            "What is our total MVNO partner portfolio and wholesale revenue by partner?",
            "Show me MVNO traffic trends - voice, SMS, and data volumes by partner.",
            "What's our wholesale revenue breakdown by voice, SMS, and data?",
            "Show me overdue MVNO settlements - which partners have overdue payments and how many days overdue?",
            "Which MVNO partners are growing fastest and which are underperforming their commitments?",
            "What are our wholesale pricing tiers and minimum commitment terms?"
        ],
        "insights": [
            "Top 3 MVNOs: Tesco Mobile, Lebara, Lycamobile",
            "Data traffic growing 40% YoY",
            "Settlement status tracking",
            "Partner growth analysis"
        ]
    },
    "23_VP_Retail": {
        "title": "VP Retail Operations",
        "persona": "VP Retail Operations",
        "duration": "10 minutes",
        "focus": "Store performance, sales, footfall, conversion",
        "views": ["RETAIL"],
        "questions": [
            "What is our total retail sales revenue by store type and region?",
            "What are our top selling product categories and how do contract vs PAYG sales compare?",
            "What are our footfall trends and conversion rates by store type?",
            "Which stores are our top and bottom performers by sales per square foot?",
            "How are retail staff performing in terms of commission and sales per employee?"
        ],
        "insights": [
            "170 stores across UK",
            "Store types: Flagship, Standard, Express, Kiosk",
            "Conversion rates: 15-35%",
            "Sales per square foot analysis"
        ]
    },
    "24_CHRO_People": {
        "title": "CHRO People & Workforce",
        "persona": "Chief Human Resources Officer (CHRO)",
        "duration": "10 minutes",
        "focus": "Workforce analytics, engagement, talent management",
        "views": ["WORKFORCE"],
        "questions": [
            "What is our current headcount by department and work location?",
            "What are our employee engagement scores by department and how do they trend?",
            "What is our employee Net Promoter Score and which teams have the highest/lowest?",
            "What are our average salaries by job level and how does performance rating correlate?",
            "What's our tenure distribution and which departments have the highest turnover risk?",
            "What are our critical skills gaps and hiring priorities for 2026?",
            "What were the key findings from our latest employee engagement survey?"
        ],
        "insights": [
            "2,000+ employees across retail, contact centres, operations",
            "Engagement score: 3.8/5",
            "eNPS: +25",
            "Skills gaps: 5G Core, AI/ML, Cloud"
        ]
    },
    "25_VP_Legal": {
        "title": "VP Legal & General Counsel",
        "persona": "VP Legal / General Counsel",
        "duration": "10 minutes",
        "focus": "Contracts, regulatory compliance, disputes, risk management",
        "views": ["B2B_CONTRACT", "COMPLAINT", "SLA", "FINANCE"],
        "questions": [
            "What is our B2B contract portfolio? Show me total contract value, contracts by status, and upcoming renewals.",
            "Show me our formal complaint trends - how many Ofcom escalations and ombudsman cases do we have?",
            "What's our SLA compliance rate? Show me any breaches and potential financial exposure.",
            "What are the key liability and indemnity terms in our strategic vendor contracts?",
            "What is our GDPR compliance framework? Show me data protection obligations and privacy-related complaints.",
            "What active legal matters do we have? Show me open disputes, litigation status, and potential financial exposure.",
            "Which B2B contracts have the highest risk?"
        ],
        "insights": [
            "Contract portfolio: £50M+ ACV",
            "Ofcom escalations tracking",
            "SLA breach credits",
            "Legal matters and exposure"
        ]
    },
    "26_VP_Product": {
        "title": "VP Product Management",
        "persona": "VP Product Management",
        "duration": "10 minutes",
        "focus": "Product portfolio, plan performance, pricing strategy, feature adoption",
        "views": ["PLAN", "MOBILE", "MARKET_INTELLIGENCE"],
        "questions": [
            "What is our mobile plan portfolio? Show me all plans with pricing, data allowances, and 5G availability.",
            "Which plans have the most subscribers? Show me subscriber count by plan name and plan type.",
            "What's our 5G adoption rate? Show me subscribers on 5G vs 4G plans by customer segment.",
            "How do our plan prices compare to competitors for similar data allowances?",
            "Which plan features drive the most value? Show me plans with roaming included and family eligibility.",
            "What's our ARPU by plan type? Compare Pay Monthly, SIM Only, and PAYG."
        ],
        "insights": [
            "Portfolio: £10 PAYG to £80+ premium",
            "5G in 60% of plans",
            "Plan type distribution",
            "ARPU: Pay Monthly 3x SIM Only"
        ]
    },
    "27_VP_Procurement": {
        "title": "VP Procurement",
        "persona": "VP Procurement / Head of Vendor Management",
        "duration": "10 minutes",
        "focus": "Vendor spend, supplier relationships, contract management, cost optimization",
        "views": ["FINANCE", "ASSET"],
        "questions": [
            "What is our total vendor spend by category? Show me the top spending areas and approval status.",
            "Who are our top 10 vendors by spend? Show me vendor names, total spend, and transaction counts.",
            "How is our spend distributed by procurement method? Show me RFP, contract, emergency, and quote-based purchases.",
            "What's our vendor spend by department? Which departments have the highest expenses?",
            "What's the status of our purchase approvals? Show me pending, approved, and rejected transactions.",
            "What are the key terms in our strategic vendor contracts?",
            "Where can we optimize vendor spend? Show me duplicate vendors, small transactions, and consolidation opportunities."
        ],
        "insights": [
            "£100M+ annual spend",
            "Technology/Network: 70% of spend",
            "Top 5 vendors: 60% of spend",
            "£2M savings opportunity identified"
        ]
    }
}

def render_snowflake_logo():
    st.markdown("""
    <div class="snowflake-logo-sidebar">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRC2EE5gdCo6g0hDT6SK6Qmyjcgwueghr2cAg&s" alt="Snowflake" style="height: 50px; margin-bottom: 0.5rem;">
        <div style="color: #29B5E8; font-size: 0.7rem; margin-top: 0.5rem; letter-spacing: 0.1em;">INTELLIGENCE PLATFORM</div>
    </div>
    """, unsafe_allow_html=True)

def render_page_header(title, persona, duration, focus):
    st.markdown(f"""
    <div class="main-header">
        <h1>{title}</h1>
        <p>{focus}</p>
    </div>
    <div style="margin-bottom: 1.5rem;">
        <span class="persona-badge">{persona}</span>
        <span style="color: #6B7280; margin-left: 1rem;">Duration: {duration}</span>
    </div>
    """, unsafe_allow_html=True)

def render_semantic_views(views):
    st.markdown('<div class="section-header">Semantic Views Used</div>', unsafe_allow_html=True)
    views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in views])
    st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)

def render_questions(questions):
    st.markdown('<div class="section-header">Demo Questions for Snowflake Intelligence</div>', unsafe_allow_html=True)
    sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
    for i, q in enumerate(questions, 1):
        escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
        st.markdown(f"""
        <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
            <div class="question-card">
                <p><strong>Q{i}:</strong> "{q}"</p>
            </div>
        </a>
        """, unsafe_allow_html=True)
    
    # Link to Snowflake Intelligence
    st.markdown(f"""
    <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
        <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
            ❄️ Ask these questions in Snowflake Intelligence →
        </a>
    </div>
    """, unsafe_allow_html=True)

def render_insights(insights):
    st.markdown('<div class="section-header">Expected Insights</div>', unsafe_allow_html=True)
    st.markdown('<div class="insight-list">', unsafe_allow_html=True)
    for insight in insights:
        st.markdown(f"- {insight}")
    st.markdown('</div>', unsafe_allow_html=True)

def render_executive_summary():
    # EXECUTIVE SUMMARY - DATA CLOUD BANNER (Hub & Spoke) with Floating Particles
    st.markdown("""
    <style>
    @keyframes hub-pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 25px rgba(41,181,232,0.5); } 50% { transform: scale(1.08); box-shadow: 0 0 45px rgba(41,181,232,0.8); } }
    @keyframes hub-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    @keyframes hub-arrow { 0%, 100% { opacity: 0.4; transform: translateX(0); } 50% { opacity: 1; transform: translateX(5px); } }
    @keyframes particle-drift {
        0% { transform: translateY(0) translateX(0) scale(1); opacity: 0; }
        10% { opacity: 0.8; }
        90% { opacity: 0.8; }
        100% { transform: translateY(-100px) translateX(30px) scale(0.5); opacity: 0; }
    }
    @keyframes sparkle { 0%, 100% { opacity: 0.3; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } }
    .hub-banner { background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; position: relative; overflow: hidden; border: 1px solid #BAE6FD; }
    .hub-particles { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; overflow: hidden; }
    .hub-particle { position: absolute; width: 6px; height: 6px; background: #29B5E8; border-radius: 50%; animation: particle-drift 4s ease-out infinite; }
    .hub-particle.small { width: 4px; height: 4px; background: rgba(41,181,232,0.6); }
    .hub-sparkle { position: absolute; width: 8px; height: 8px; background: white; border-radius: 50%; animation: sparkle 2s ease-in-out infinite; }
    .hub-title { text-align: center; color: #1B2A4E; font-size: 1.8rem; font-weight: 700; margin-bottom: 0.3rem; position: relative; z-index: 1; }
    .hub-subtitle { text-align: center; color: #64748B; font-size: 0.85rem; margin-bottom: 1.5rem; position: relative; z-index: 1; }
    .hub-content { display: flex; align-items: center; justify-content: center; gap: 0.8rem; position: relative; z-index: 1; }
    .hub-sources { display: flex; flex-direction: column; gap: 0.6rem; }
    .hub-source { background: white; border-radius: 10px; padding: 0.7rem 1rem; display: flex; align-items: center; gap: 0.6rem; border: 1px solid #E2E8F0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); animation: hub-float 3s ease-in-out infinite; }
    .hub-source:nth-child(2) { animation-delay: 0.3s; }
    .hub-source:nth-child(3) { animation-delay: 0.6s; }
    .hub-source-icon { font-size: 1.3rem; }
    .hub-source-label { color: #1B2A4E; font-size: 0.75rem; font-weight: 600; }
    .hub-arrows { display: flex; flex-direction: column; gap: 1.2rem; padding: 0 0.5rem; }
    .hub-arrow { color: #29B5E8; font-size: 1.2rem; animation: hub-arrow 1.5s ease-in-out infinite; }
    .hub-arrow:nth-child(2) { animation-delay: 0.2s; }
    .hub-arrow:nth-child(3) { animation-delay: 0.4s; }
    .hub-center { background: linear-gradient(135deg, #29B5E8, #0EA5E9); border-radius: 50%; width: 120px; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; animation: hub-pulse 2s ease-in-out infinite; flex-shrink: 0; position: relative; }
    .hub-center::after { content: ''; position: absolute; width: 140px; height: 140px; border: 2px solid rgba(41,181,232,0.3); border-radius: 50%; animation: hub-pulse 2s ease-in-out infinite 0.5s; }
    .hub-center-icon { font-size: 2.5rem; }
    .hub-center-label { color: white; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; margin-top: 4px; }
    .hub-stats { display: flex; justify-content: center; gap: 3rem; margin-top: 1.5rem; position: relative; z-index: 1; }
    .hub-stat { text-align: center; animation: hub-float 3s ease-in-out infinite; }
    .hub-stat:nth-child(2) { animation-delay: 0.25s; }
    .hub-stat:nth-child(3) { animation-delay: 0.5s; }
    .hub-stat:nth-child(4) { animation-delay: 0.75s; }
    .hub-stat-value { color: #29B5E8; font-size: 1.4rem; font-weight: 700; }
    .hub-stat-label { color: #64748B; font-size: 0.65rem; text-transform: uppercase; }
    </style>
    """, unsafe_allow_html=True)
    st.markdown("""<div class="hub-banner">
        <div class="hub-particles">
            <div class="hub-particle" style="left: 10%; top: 80%; animation-delay: 0s;"></div>
            <div class="hub-particle small" style="left: 20%; top: 70%; animation-delay: 0.5s;"></div>
            <div class="hub-particle" style="left: 30%; top: 85%; animation-delay: 1s;"></div>
            <div class="hub-particle small" style="left: 40%; top: 75%; animation-delay: 1.5s;"></div>
            <div class="hub-particle" style="left: 50%; top: 90%; animation-delay: 2s;"></div>
            <div class="hub-particle small" style="left: 60%; top: 80%; animation-delay: 2.5s;"></div>
            <div class="hub-particle" style="left: 70%; top: 85%; animation-delay: 3s;"></div>
            <div class="hub-particle small" style="left: 80%; top: 75%; animation-delay: 3.5s;"></div>
            <div class="hub-particle" style="left: 90%; top: 80%; animation-delay: 0.8s;"></div>
            <div class="hub-sparkle" style="left: 15%; top: 20%; animation-delay: 0s;"></div>
            <div class="hub-sparkle" style="left: 85%; top: 30%; animation-delay: 1s;"></div>
            <div class="hub-sparkle" style="left: 45%; top: 15%; animation-delay: 2s;"></div>
        </div>
        <div class="hub-title">❄️ Snowflake AI Data Cloud</div><div class="hub-subtitle">Breaking Down Data Silos in Real-Time</div><div class="hub-content"><div class="hub-sources"><div class="hub-source"><span class="hub-source-icon">📡</span><span class="hub-source-label">Network</span></div><div class="hub-source"><span class="hub-source-icon">⚙️</span><span class="hub-source-label">OSS/BSS</span></div><div class="hub-source"><span class="hub-source-icon">🏪</span><span class="hub-source-label">Marketplace</span></div></div><div class="hub-arrows"><span class="hub-arrow">→</span><span class="hub-arrow">→</span><span class="hub-arrow">→</span></div><div class="hub-center"><span class="hub-center-icon">❄️</span><span class="hub-center-label">Snowflake</span></div><div class="hub-arrows"><span class="hub-arrow">→</span><span class="hub-arrow">→</span><span class="hub-arrow">→</span></div><div class="hub-sources"><div class="hub-source"><span class="hub-source-icon">📊</span><span class="hub-source-label">Analytics</span></div><div class="hub-source"><span class="hub-source-icon">🤖</span><span class="hub-source-label">AI/ML</span></div><div class="hub-source"><span class="hub-source-icon">💡</span><span class="hub-source-label">Insights</span></div></div></div><div class="hub-stats"><div class="hub-stat"><div class="hub-stat-value">60%</div><div class="hub-stat-label">Faster Insights</div></div><div class="hub-stat"><div class="hub-stat-value">40%</div><div class="hub-stat-label">Cost Reduction</div></div><div class="hub-stat"><div class="hub-stat-value">100%</div><div class="hub-stat-label">Data Unified</div></div><div class="hub-stat"><div class="hub-stat-value">5x</div><div class="hub-stat-label">ROI</div></div></div></div>""", unsafe_allow_html=True)
    
    st.markdown('<div class="section-header">About Snowflake</div>', unsafe_allow_html=True)
    
    col1, col2, col3, col4 = st.columns(4)
    metrics = [
        ("11,000+", "Enterprise Customers"),
        ("$3.5B+", "Annual Revenue"),
        ("~50%", "Fortune 500 Companies"),
        ("#1", "Data Cloud Platform")
    ]
    for col, (value, label) in zip([col1, col2, col3, col4], metrics):
        with col:
            st.markdown(f"""
            <div class="metric-card" style="text-align: center;">
                <div class="metric-value" style="color: #29B5E8;">{value}</div>
                <div class="metric-label">{label}</div>
            </div>
            """, unsafe_allow_html=True)
    
    st.markdown('<div class="section-header">Why Snowflake for Telecom</div>', unsafe_allow_html=True)
    
    col1, col2, col3 = st.columns(3)
    
    with col1:
        st.markdown("""
        <div class="architecture-box" style="min-height: 220px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">🚀</div>
            <h4>Bring Data & AI to Life</h4>
            <p>Save time on building, configuring and tuning infrastructure with a single, 
            fully managed platform. Streamline workflows, power business-critical use cases 
            and uncover new commercial strategies.</p>
        </div>
        """, unsafe_allow_html=True)
    
    with col2:
        st.markdown("""
        <div class="architecture-box" style="min-height: 220px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">🔗</div>
            <h4>Connected Ecosystem</h4>
            <p>Connect with mobile network operators, content providers, network equipment providers, 
            and top data solutions providers. Optimize network performance, enhance customer experiences 
            and monetize services more effectively.</p>
        </div>
        """, unsafe_allow_html=True)
    
    with col3:
        st.markdown("""
        <div class="architecture-box" style="min-height: 220px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">🔒</div>
            <h4>Trusted Governance</h4>
            <p>Govern and protect your data with best-in-class security. Use AI and large language models 
            within Snowflake's security perimeter, with built-in policies, access controls and 
            end-to-end observability.</p>
        </div>
        """, unsafe_allow_html=True)
    
    st.markdown('<div class="section-header">Leading Telcos Trust Snowflake</div>', unsafe_allow_html=True)
    
    customers = [
        {"name": "AT&T", "logo": "https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/AT%26T_logo_2016.svg/200px-AT%26T_logo_2016.svg.png"},
        {"name": "T-Mobile", "logo": "https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/T-Mobile_US_Logo_2022_RGB_Magenta_on_Transparent.svg/500px-T-Mobile_US_Logo_2022_RGB_Magenta_on_Transparent.svg.png"},
        {"name": "Deutsche Telekom", "logo": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Deutsche_Telekom_2022.svg/250px-Deutsche_Telekom_2022.svg.png"},
        {"name": "Vodafone", "logo": "https://upload.wikimedia.org/wikipedia/en/thumb/c/cc/Vodafone_2017_logo.svg/500px-Vodafone_2017_logo.svg.png"},
    ]
    
    cols = st.columns(4)
    for col, customer in zip(cols, customers):
        with col:
            st.markdown(f"""
            <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; text-align: center; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <div style="height: 60px; display: flex; align-items: center; justify-content: center;">
                    <img src="{customer['logo']}" alt="{customer['name']}" style="max-height: 50px; max-width: 120px; object-fit: contain;">
                </div>
            </div>
            """, unsafe_allow_html=True)
    
    st.markdown('<div class="section-header">Business Benefits & KPIs</div>', unsafe_allow_html=True)
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown("""
        <div style="background: linear-gradient(135deg, #E8F7FC 0%, #F0FAFF 100%); border-radius: 12px; padding: 1.5rem;">
            <h4 style="color: #1B2A4E; margin-top: 0;">💰 Revenue & Growth</h4>
            <ul style="color: #1B2A4E; margin: 0; padding-left: 1.2rem;">
                <li><strong>15-25%</strong> reduction in customer churn</li>
                <li><strong>20-30%</strong> increase in upsell conversion</li>
                <li><strong>10-15%</strong> ARPU improvement</li>
                <li><strong>$10M+</strong> fraud prevention savings</li>
            </ul>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown("")
        
        st.markdown("""
        <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FFFBEB 100%); border-radius: 12px; padding: 1.5rem;">
            <h4 style="color: #1B2A4E; margin-top: 0;">⚡ Operational Excellence</h4>
            <ul style="color: #1B2A4E; margin: 0; padding-left: 1.2rem;">
                <li><strong>40-60%</strong> faster time-to-insight</li>
                <li><strong>30%</strong> network ops cost reduction</li>
                <li><strong>50%</strong> less data engineering effort</li>
                <li><strong>80%</strong> faster reporting</li>
            </ul>
        </div>
        """, unsafe_allow_html=True)
    
    with col2:
        st.markdown("""
        <div style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-radius: 12px; padding: 1.5rem;">
            <h4 style="color: #1B2A4E; margin-top: 0;">📈 Customer Experience</h4>
            <ul style="color: #1B2A4E; margin: 0; padding-left: 1.2rem;">
                <li><strong>+15 pts</strong> NPS improvement</li>
                <li><strong>25%</strong> call center volume reduction</li>
                <li><strong>Real-time</strong> network issue detection</li>
                <li><strong>360°</strong> unified customer view</li>
            </ul>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown("")
        
        st.markdown("""
        <div style="background: linear-gradient(135deg, #EDE9FE 0%, #F5F3FF 100%); border-radius: 12px; padding: 1.5rem;">
            <h4 style="color: #1B2A4E; margin-top: 0;">🔒 Security & Governance</h4>
            <ul style="color: #1B2A4E; margin: 0; padding-left: 1.2rem;">
                <li><strong>Single source</strong> of truth</li>
                <li><strong>GDPR/CCPA</strong> compliance built-in</li>
                <li><strong>Row/column</strong> level access control</li>
                <li><strong>Full audit</strong> trail & lineage</li>
            </ul>
        </div>
        """, unsafe_allow_html=True)
    
    st.markdown('<div class="section-header">Join the Connected Future of Telecom</div>', unsafe_allow_html=True)
    
    use_cases = [
        ("Churn Prediction", "Identify at-risk customers with ML models"),
        ("Network Analytics", "Real-time performance monitoring"),
        ("Revenue Assurance", "Detect billing anomalies and leakage"),
        ("Customer 360", "Unified cross-channel customer view"),
        ("Fraud Detection", "AI-powered SIM swap detection"),
        ("5G Monetization", "Optimize 5G pricing and adoption"),
    ]
    
    cols = st.columns(3)
    for i, (title, desc) in enumerate(use_cases):
        with cols[i % 3]:
            st.markdown(f"""
            <div class="talking-point" style="min-height: 70px;">
                <strong>{title}</strong><br>
                <span style="font-weight: 400; font-size: 0.85rem;">{desc}</span>
            </div>
            """, unsafe_allow_html=True)
    
    st.markdown('<div class="section-header">About This Demo</div>', unsafe_allow_html=True)
    
    st.markdown("""
    <div style="background: white; border: 2px solid #29B5E8; border-radius: 12px; padding: 1.5rem;">
        <h4 style="color: #1B2A4E; margin-top: 0;">SnowTelco — Snowflake Intelligence Demo</h4>
        <p style="color: #1B2A4E;">A comprehensive demo showcasing <strong>Snowflake Intelligence</strong> for a fictional UK telco:</p>
        <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem;">
            <div style="flex: 1; min-width: 150px; background: #F8FAFC; padding: 1rem; border-radius: 8px; text-align: center;">
                <strong style="color: #29B5E8; font-size: 1.5rem;">30K+</strong><br>
                <span style="color: #6B7280; font-size: 0.8rem;">Subscribers</span>
            </div>
            <div style="flex: 1; min-width: 150px; background: #F8FAFC; padding: 1rem; border-radius: 8px; text-align: center;">
                <strong style="color: #29B5E8; font-size: 1.5rem;">34</strong><br>
                <span style="color: #6B7280; font-size: 0.8rem;">Semantic Views</span>
            </div>
            <div style="flex: 1; min-width: 150px; background: #F8FAFC; padding: 1rem; border-radius: 8px; text-align: center;">
                <strong style="color: #29B5E8; font-size: 1.5rem;">32</strong><br>
                <span style="color: #6B7280; font-size: 0.8rem;">Dashboards</span>
            </div>
            <div style="flex: 1; min-width: 150px; background: #F8FAFC; padding: 1rem; border-radius: 8px; text-align: center;">
                <strong style="color: #29B5E8; font-size: 1.5rem;">7</strong><br>
                <span style="color: #6B7280; font-size: 0.8rem;">Search Services</span>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown("""
        <div style="background: #F8FAFC; border-radius: 12px; padding: 1.5rem; margin-top: 1rem;">
            <h4 style="color: #1B2A4E; margin-top: 0;">📊 Data Scale</h4>
            <table style="width: 100%; color: #1B2A4E; font-size: 0.9rem;">
                <tr><td style="padding: 0.3rem 0;"><strong>Subscribers</strong></td><td style="text-align: right;">30,000+ (B2C, SMB, Enterprise)</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Network Sites</strong></td><td style="text-align: right;">500+ cell sites (4G/5G)</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Support Tickets</strong></td><td style="text-align: right;">50,000+ historical records</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Billing Records</strong></td><td style="text-align: right;">100,000+ invoices</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Network Alarms</strong></td><td style="text-align: right;">25,000+ events</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Partner Channels</strong></td><td style="text-align: right;">150+ retail partners</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Retail Stores</strong></td><td style="text-align: right;">170 locations UK-wide</td></tr>
            </table>
        </div>
        """, unsafe_allow_html=True)
    
    with col2:
        st.markdown("""
        <div style="background: #F8FAFC; border-radius: 12px; padding: 1.5rem; margin-top: 1rem;">
            <h4 style="color: #1B2A4E; margin-top: 0;">🤖 AI Capabilities</h4>
            <table style="width: 100%; color: #1B2A4E; font-size: 0.9rem;">
                <tr><td style="padding: 0.3rem 0;"><strong>Cortex Agent</strong></td><td style="text-align: right;">1 Executive Agent</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Agent Tools</strong></td><td style="text-align: right;">41 tools (34 Analyst + 7 Search)</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Semantic Views</strong></td><td style="text-align: right;">34 business domains</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Cortex Search</strong></td><td style="text-align: right;">7 document collections</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>ML Models</strong></td><td style="text-align: right;">Churn, Upsell, CLV propensity</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Document Pages</strong></td><td style="text-align: right;">200+ policy & strategy docs</td></tr>
                <tr><td style="padding: 0.3rem 0;"><strong>Demo Questions</strong></td><td style="text-align: right;">150+ curated questions</td></tr>
            </table>
        </div>
        """, unsafe_allow_html=True)
    
    st.markdown("""
    <div style="background: #F8FAFC; border-radius: 12px; padding: 1.5rem; margin-top: 1rem; border: 1px solid #E2E8F0;">
        <h4 style="color: #1B2A4E; margin-top: 0;">🎯 Demo Coverage</h4>
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Finance & Billing</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Network Operations</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Customer Service</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Sales & Marketing</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">HR & Workforce</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Fraud Detection</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Partner Management</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Retail Operations</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">B2B Contracts</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Wholesale/MVNO</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Sustainability</span>
            <span style="background: rgba(41,181,232,0.2); color: #29B5E8; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Regulatory/SLA</span>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ANIMATED ARCHITECTURE DIAGRAM
    st.markdown('<div class="section-header">Architecture Overview</div>', unsafe_allow_html=True)
    
    st.markdown("""
    <style>
    @keyframes arch-particle { 0% { left: 0%; opacity: 0; } 15% { opacity: 1; } 85% { opacity: 1; } 100% { left: 100%; opacity: 0; } }
    @keyframes arch-pulse { 0%, 100% { transform: scale(1); box-shadow: 0 4px 15px rgba(41,181,232,0.3); } 50% { transform: scale(1.02); box-shadow: 0 6px 25px rgba(41,181,232,0.5); } }
    @keyframes arch-glow { 0%, 100% { border-color: rgba(41,181,232,0.3); } 50% { border-color: rgba(41,181,232,0.8); } }
    .arch-container { background: linear-gradient(180deg, #F8FAFC 0%, #EFF6FF 100%); border-radius: 16px; padding: 2rem; border: 2px solid #E5E7EB; }
    .arch-row { display: flex; align-items: center; justify-content: center; gap: 1rem; margin: 1rem 0; }
    .arch-column { display: flex; flex-direction: column; gap: 0.6rem; min-width: 140px; }
    .arch-box { background: white; border: 2px solid #E5E7EB; border-radius: 10px; padding: 0.6rem 1rem; display: flex; align-items: center; gap: 0.5rem; animation: arch-glow 3s ease-in-out infinite; transition: all 0.3s; }
    .arch-box:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .arch-box.source { border-left: 4px solid #F59E0B; }
    .arch-box.output { border-left: 4px solid #10B981; }
    .arch-icon { font-size: 1.2rem; }
    .arch-label { font-size: 0.75rem; font-weight: 600; color: #1B2A4E; }
    .arch-sublabel { font-size: 0.6rem; color: #6B7280; }
    .arch-center { background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%); border-radius: 16px; padding: 1.5rem 2rem; animation: arch-pulse 3s ease-in-out infinite; min-width: 200px; }
    .arch-center-title { color: white; font-size: 1.1rem; font-weight: 700; text-align: center; margin-bottom: 0.3rem; }
    .arch-center-sub { color: rgba(255,255,255,0.8); font-size: 0.7rem; text-align: center; }
    .arch-center-features { display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; margin-top: 0.8rem; }
    .arch-feature { background: rgba(255,255,255,0.2); color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.6rem; }
    .arch-pipes { position: relative; width: 60px; height: 200px; }
    .arch-pipe { position: absolute; width: 100%; height: 2px; background: linear-gradient(90deg, #F59E0B, #29B5E8); }
    .arch-pipe.out { background: linear-gradient(90deg, #29B5E8, #10B981); }
    .arch-dot { position: absolute; width: 8px; height: 8px; border-radius: 50%; top: -3px; background: #F59E0B; animation: arch-particle 2.5s linear infinite; }
    .arch-pipe.out .arch-dot { background: #10B981; }
    .arch-section-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; color: #6B7280; margin-bottom: 0.5rem; font-weight: 600; }
    </style>
    <div class="arch-container">
        <div class="arch-row">
            <div class="arch-column">
                <div class="arch-section-label">Data Sources</div>
                <div class="arch-box source"><span class="arch-icon">📡</span><div><div class="arch-label">Network Ops</div><div class="arch-sublabel">Performance & Sites</div></div></div>
                <div class="arch-box source"><span class="arch-icon">🚨</span><div><div class="arch-label">Network Alarms</div><div class="arch-sublabel">NOC Events</div></div></div>
                <div class="arch-box source"><span class="arch-icon">📶</span><div><div class="arch-label">RAN Data</div><div class="arch-sublabel">Cell Site Analytics</div></div></div>
                <div class="arch-box source"><span class="arch-icon">💳</span><div><div class="arch-label">Billing</div><div class="arch-sublabel">Revenue & Invoices</div></div></div>
                <div class="arch-box source"><span class="arch-icon">👥</span><div><div class="arch-label">Subscribers</div><div class="arch-sublabel">Customer Records</div></div></div>
                <div class="arch-box source"><span class="arch-icon">🎫</span><div><div class="arch-label">Support Tickets</div><div class="arch-sublabel">Contact Center</div></div></div>
                <div class="arch-box source"><span class="arch-icon">📦</span><div><div class="arch-label">Orders</div><div class="arch-sublabel">Activations & SIMs</div></div></div>
                <div class="arch-box source"><span class="arch-icon">🤝</span><div><div class="arch-label">Partners</div><div class="arch-sublabel">Channel & Retail</div></div></div>
                <div class="arch-box source"><span class="arch-icon">📊</span><div><div class="arch-label">Market Intel</div><div class="arch-sublabel">Competitor Data</div></div></div>
                <div class="arch-box source"><span class="arch-icon">📄</span><div><div class="arch-label">Documents</div><div class="arch-sublabel">Policies & Strategy</div></div></div>
            </div>
            <div class="arch-pipes" style="height: 340px;">
                <div class="arch-pipe" style="top: 6%;"><div class="arch-dot" style="animation-delay: 0s;"></div></div>
                <div class="arch-pipe" style="top: 16%;"><div class="arch-dot" style="animation-delay: 0.25s;"></div></div>
                <div class="arch-pipe" style="top: 26%;"><div class="arch-dot" style="animation-delay: 0.5s;"></div></div>
                <div class="arch-pipe" style="top: 36%;"><div class="arch-dot" style="animation-delay: 0.75s;"></div></div>
                <div class="arch-pipe" style="top: 46%;"><div class="arch-dot" style="animation-delay: 1s;"></div></div>
                <div class="arch-pipe" style="top: 56%;"><div class="arch-dot" style="animation-delay: 1.25s;"></div></div>
                <div class="arch-pipe" style="top: 66%;"><div class="arch-dot" style="animation-delay: 1.5s;"></div></div>
                <div class="arch-pipe" style="top: 76%;"><div class="arch-dot" style="animation-delay: 1.75s;"></div></div>
                <div class="arch-pipe" style="top: 86%;"><div class="arch-dot" style="animation-delay: 2s;"></div></div>
                <div class="arch-pipe" style="top: 96%;"><div class="arch-dot" style="animation-delay: 2.25s;"></div></div>
            </div>
            <div class="arch-center">
                <div class="arch-center-title">❄️ Snowflake</div>
                <div class="arch-center-sub">AI Data Cloud</div>
                <div class="arch-center-features">
                    <span class="arch-feature">Cortex AI</span>
                    <span class="arch-feature">ML Models</span>
                    <span class="arch-feature">Semantic Views</span>
                    <span class="arch-feature">Search</span>
                    <span class="arch-feature">Notebooks</span>
                    <span class="arch-feature">Streamlit</span>
                </div>
            </div>
            <div class="arch-pipes" style="height: 340px;">
                <div class="arch-pipe out" style="top: 6%;"><div class="arch-dot" style="animation-delay: 0.1s;"></div></div>
                <div class="arch-pipe out" style="top: 16%;"><div class="arch-dot" style="animation-delay: 0.35s;"></div></div>
                <div class="arch-pipe out" style="top: 26%;"><div class="arch-dot" style="animation-delay: 0.6s;"></div></div>
                <div class="arch-pipe out" style="top: 36%;"><div class="arch-dot" style="animation-delay: 0.85s;"></div></div>
                <div class="arch-pipe out" style="top: 46%;"><div class="arch-dot" style="animation-delay: 1.1s;"></div></div>
                <div class="arch-pipe out" style="top: 56%;"><div class="arch-dot" style="animation-delay: 1.35s;"></div></div>
                <div class="arch-pipe out" style="top: 66%;"><div class="arch-dot" style="animation-delay: 1.6s;"></div></div>
                <div class="arch-pipe out" style="top: 76%;"><div class="arch-dot" style="animation-delay: 1.85s;"></div></div>
                <div class="arch-pipe out" style="top: 86%;"><div class="arch-dot" style="animation-delay: 2.1s;"></div></div>
                <div class="arch-pipe out" style="top: 96%;"><div class="arch-dot" style="animation-delay: 2.35s;"></div></div>
            </div>
            <div class="arch-column">
                <div class="arch-section-label">Intelligence</div>
                <div class="arch-box output"><span class="arch-icon">🧠</span><div><div class="arch-label">Snowflake Intelligence</div><div class="arch-sublabel">Natural Language</div></div></div>
                <div class="arch-box output"><span class="arch-icon">📊</span><div><div class="arch-label">Dashboards</div><div class="arch-sublabel">32 Executive Views</div></div></div>
                <div class="arch-box output"><span class="arch-icon">🔮</span><div><div class="arch-label">Churn Model</div><div class="arch-sublabel">ML Predictions</div></div></div>
                <div class="arch-box output"><span class="arch-icon">📈</span><div><div class="arch-label">Upsell Model</div><div class="arch-sublabel">Propensity Scores</div></div></div>
                <div class="arch-box output"><span class="arch-icon">🔍</span><div><div class="arch-label">Document Search</div><div class="arch-sublabel">7 Collections</div></div></div>
                <div class="arch-box output"><span class="arch-icon">📋</span><div><div class="arch-label">Semantic Views</div><div class="arch-sublabel">34 Business Domains</div></div></div>
                <div class="arch-box output"><span class="arch-icon">💡</span><div><div class="arch-label">Real-time Insights</div><div class="arch-sublabel">Live Analytics</div></div></div>
                <div class="arch-box output"><span class="arch-icon">🎯</span><div><div class="arch-label">Analyst Tools</div><div class="arch-sublabel">41 AI Tools</div></div></div>
                <div class="arch-box output"><span class="arch-icon">📱</span><div><div class="arch-label">Streamlit Apps</div><div class="arch-sublabel">Interactive UI</div></div></div>
                <div class="arch-box output"><span class="arch-icon">📝</span><div><div class="arch-label">Notebooks</div><div class="arch-sublabel">Data Science</div></div></div>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    st.markdown("""
    <div style="text-align: center; margin-top: 2rem; padding: 1rem; color: #6B7280; font-size: 0.8rem;">
        Learn more at <a href="https://www.snowflake.com/en/solutions/industries/telecom/" target="_blank" style="color: #29B5E8;">snowflake.com/telecom</a>
    </div>
    """, unsafe_allow_html=True)

def render_snowtelco_website():
    """Render the SnowTelco customer-facing website"""
    
    # ===== GLOBAL STYLES FOR WEBSITE =====
    st.markdown("""
    <style>
    /* Website Global Styles */
    @keyframes hero-gradient { 
        0% { background-position: 0% 50%; } 
        50% { background-position: 100% 50%; } 
        100% { background-position: 0% 50%; } 
    }
    @keyframes float-up { 
        0%, 100% { transform: translateY(0); } 
        50% { transform: translateY(-10px); } 
    }
    @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 4px 20px rgba(41, 181, 232, 0.3); }
        50% { box-shadow: 0 8px 40px rgba(41, 181, 232, 0.5); }
    }
    @keyframes slide-in-left {
        0% { opacity: 0; transform: translateX(-30px); }
        100% { opacity: 1; transform: translateX(0); }
    }
    @keyframes slide-in-right {
        0% { opacity: 0; transform: translateX(30px); }
        100% { opacity: 1; transform: translateX(0); }
    }
    @keyframes fade-in-up {
        0% { opacity: 0; transform: translateY(20px); }
        100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes shine {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    @keyframes network-pulse {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(1.5); }
    }
    
    /* Navigation Bar */
    .web-navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        background: white;
        border-bottom: 1px solid #E5E7EB;
        margin: -1rem -1rem 0 -1rem;
        position: sticky;
        top: 0;
        z-index: 100;
    }
    .web-logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    .web-logo-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }
    .web-logo-text {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1B2A4E;
    }
    .web-logo-text span { color: #29B5E8; }
    .web-nav-links {
        display: flex;
        gap: 2rem;
    }
    .web-nav-link {
        color: #1B2A4E;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.95rem;
        padding: 0.5rem 0;
        position: relative;
        transition: color 0.2s ease;
    }
    .web-nav-link:hover { color: #29B5E8; }
    .web-nav-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: #29B5E8;
        transition: width 0.3s ease;
    }
    .web-nav-link:hover::after { width: 100%; }
    .web-nav-cta {
        display: flex;
        gap: 1rem;
    }
    .web-btn {
        padding: 0.6rem 1.5rem;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.9rem;
        text-decoration: none;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    .web-btn-outline {
        border: 2px solid #29B5E8;
        color: #29B5E8;
        background: transparent;
    }
    .web-btn-outline:hover {
        background: #29B5E8;
        color: white;
    }
    .web-btn-primary {
        background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%);
        color: white;
        border: none;
    }
    .web-btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(41, 181, 232, 0.4);
    }
    
    /* Hero Section */
    .web-hero {
        background: linear-gradient(135deg, #0F172A 0%, #1E3A5F 50%, #0F172A 100%);
        background-size: 200% 200%;
        animation: hero-gradient 15s ease infinite;
        padding: 1.5rem 2rem;
        border-radius: 0 0 20px 20px;
        margin: 0 -1rem 1.5rem -1rem;
        position: relative;
        overflow: hidden;
    }
    .web-hero::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2329B5E8' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.5;
    }
    .hero-content {
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
        position: relative;
        z-index: 1;
    }
    .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        background: rgba(41, 181, 232, 0.2);
        color: #29B5E8;
        padding: 0.35rem 0.85rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        animation: fade-in-up 0.6s ease-out;
    }
    .hero-badge-dot {
        width: 8px;
        height: 8px;
        background: #10B981;
        border-radius: 50%;
        animation: pulse-glow 2s ease-in-out infinite;
    }
    .hero-title {
        font-size: 2.2rem;
        font-weight: 800;
        color: #FFFFFF !important;
        line-height: 1.1;
        margin-bottom: 0.75rem;
        animation: slide-in-left 0.8s ease-out;
        text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    .hero-title span { 
        background: linear-gradient(135deg, #29B5E8, #06B6D4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: none;
        filter: drop-shadow(0 2px 4px rgba(41, 181, 232, 0.4));
    }
    .hero-subtitle {
        font-size: 1rem;
        color: rgba(255,255,255,0.95) !important;
        margin-bottom: 1.25rem;
        animation: slide-in-right 0.8s ease-out 0.2s both;
        text-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .hero-cta {
        display: flex;
        gap: 1rem;
        justify-content: center;
        animation: fade-in-up 0.8s ease-out 0.4s both;
    }
    .hero-btn {
        padding: 0.7rem 1.75rem;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.9rem;
        text-decoration: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    .hero-btn-primary {
        background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%);
        color: white;
        box-shadow: 0 4px 20px rgba(41, 181, 232, 0.4);
    }
    .hero-btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 30px rgba(41, 181, 232, 0.5);
    }
    .hero-btn-secondary {
        background: rgba(255,255,255,0.1);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
    }
    .hero-btn-secondary:hover {
        background: rgba(255,255,255,0.2);
    }
    .hero-stats {
        display: flex;
        justify-content: center;
        gap: 2.5rem;
        margin-top: 1.5rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(255,255,255,0.1);
        animation: fade-in-up 0.8s ease-out 0.6s both;
    }
    .hero-stat {
        text-align: center;
    }
    .hero-stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #29B5E8;
    }
    .hero-stat-label {
        font-size: 0.75rem;
        color: rgba(255,255,255,0.6);
        margin-top: 0.15rem;
    }
    
    /* Network Animation in Hero */
    .network-nodes {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        pointer-events: none;
    }
    .network-node {
        position: absolute;
        width: 6px;
        height: 6px;
        background: #29B5E8;
        border-radius: 50%;
        animation: network-pulse 3s ease-in-out infinite;
    }
    .network-node:nth-child(1) { top: 20%; left: 10%; animation-delay: 0s; }
    .network-node:nth-child(2) { top: 30%; left: 25%; animation-delay: 0.5s; }
    .network-node:nth-child(3) { top: 15%; right: 20%; animation-delay: 1s; }
    .network-node:nth-child(4) { top: 40%; right: 15%; animation-delay: 1.5s; }
    .network-node:nth-child(5) { bottom: 25%; left: 15%; animation-delay: 2s; }
    .network-node:nth-child(6) { bottom: 30%; right: 25%; animation-delay: 2.5s; }
    
    /* Section Styles */
    .web-section {
        padding: 3rem 0;
    }
    .web-section-header {
        text-align: center;
        margin-bottom: 2.5rem;
    }
    .web-section-badge {
        display: inline-block;
        background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
        color: #29B5E8;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    .web-section-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1B2A4E;
        margin-bottom: 0.75rem;
    }
    .web-section-subtitle {
        font-size: 1.1rem;
        color: #6B7280;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
        text-align: center;
    }
    
    /* Plan Cards */
    .plans-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
    }
    .plan-card {
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 20px;
        padding: 2rem;
        position: relative;
        transition: all 0.3s ease;
        overflow: hidden;
    }
    .plan-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        border-color: #29B5E8;
    }
    .plan-card.featured {
        border: 2px solid #29B5E8;
        background: linear-gradient(180deg, #F0F9FF 0%, white 100%);
    }
    .plan-card.featured::before {
        content: 'MOST POPULAR';
        position: absolute;
        top: 15px;
        right: -35px;
        background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%);
        color: white;
        font-size: 0.65rem;
        font-weight: 700;
        padding: 0.3rem 3rem;
        transform: rotate(45deg);
    }
    .plan-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
    }
    .plan-name {
        font-size: 1.4rem;
        font-weight: 700;
        color: #1B2A4E;
        margin-bottom: 0.5rem;
    }
    .plan-desc {
        font-size: 0.9rem;
        color: #6B7280;
        margin-bottom: 1.5rem;
    }
    .plan-price {
        display: flex;
        align-items: baseline;
        gap: 0.25rem;
        margin-bottom: 1.5rem;
    }
    .plan-currency {
        font-size: 1.2rem;
        font-weight: 600;
        color: #1B2A4E;
    }
    .plan-amount {
        font-size: 3rem;
        font-weight: 800;
        color: #1B2A4E;
    }
    .plan-period {
        font-size: 0.9rem;
        color: #6B7280;
    }
    .plan-features {
        list-style: none;
        padding: 0;
        margin: 0 0 1.5rem 0;
    }
    .plan-feature {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.6rem 0;
        border-bottom: 1px solid #F3F4F6;
        font-size: 0.9rem;
        color: #4B5563;
    }
    .plan-feature:last-child { border-bottom: none; }
    .plan-feature-check {
        width: 20px;
        height: 20px;
        background: #D1FAE5;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #10B981;
        font-size: 0.7rem;
    }
    .plan-cta {
        width: 100%;
        padding: 1rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
    }
    .plan-cta-primary {
        background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%);
        color: white;
        border: none;
    }
    .plan-cta-primary:hover {
        box-shadow: 0 4px 15px rgba(41, 181, 232, 0.4);
    }
    .plan-cta-outline {
        background: white;
        color: #29B5E8;
        border: 2px solid #29B5E8;
    }
    .plan-cta-outline:hover {
        background: #29B5E8;
        color: white;
    }
    
    /* Device Cards */
    .devices-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
    }
    .device-card {
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 16px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    .device-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }
    .device-card.new::before {
        content: 'NEW';
        position: absolute;
        top: 10px;
        left: 10px;
        background: #10B981;
        color: white;
        font-size: 0.65rem;
        font-weight: 700;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
    }
    .device-image {
        width: 100px;
        height: 180px;
        background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%);
        border-radius: 20px;
        margin: 0 auto 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        border: 3px solid #3a3a3a;
    }
    .device-image::before {
        content: '';
        position: absolute;
        top: 8px;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 6px;
        background: #1a1a1a;
        border-radius: 3px;
    }
    .device-image::after {
        content: '';
        position: absolute;
        top: 8px;
        right: 15px;
        width: 8px;
        height: 8px;
        background: #1a1a1a;
        border-radius: 50%;
    }
    .device-screen {
        width: 85%;
        height: 85%;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-size: 4rem;
    }
    .device-name {
        font-size: 1rem;
        font-weight: 700;
        color: #1B2A4E;
        margin-bottom: 0.25rem;
    }
    .device-specs {
        font-size: 0.8rem;
        color: #6B7280;
        margin-bottom: 1rem;
    }
    .device-price {
        font-size: 1.1rem;
        font-weight: 700;
        color: #29B5E8;
        margin-bottom: 0.25rem;
    }
    .device-finance {
        font-size: 0.75rem;
        color: #6B7280;
    }
    
    /* Features Section */
    .features-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
    }
    .feature-card {
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 16px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
    }
    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(41, 181, 232, 0.15);
        border-color: #29B5E8;
    }
    .feature-icon {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin: 0 auto 1rem;
    }
    .feature-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1B2A4E;
        margin-bottom: 0.5rem;
    }
    .feature-desc {
        font-size: 0.85rem;
        color: #6B7280;
        line-height: 1.5;
    }
    
    /* Coverage Map */
    .coverage-section {
        background: linear-gradient(135deg, #0F172A 0%, #1E3A5F 100%);
        padding: 3rem 2rem;
        border-radius: 24px;
        margin: 2rem 0;
        position: relative;
        overflow: hidden;
    }
    .coverage-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 3rem;
        align-items: center;
    }
    .coverage-text h3 {
        font-size: 2rem;
        font-weight: 700;
        color: white;
        margin-bottom: 1rem;
    }
    .coverage-text p {
        color: rgba(255,255,255,0.7);
        font-size: 1rem;
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }
    .coverage-stats {
        display: flex;
        gap: 2rem;
    }
    .coverage-stat {
        text-align: center;
    }
    .coverage-stat-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: #29B5E8;
    }
    .coverage-stat-label {
        font-size: 0.8rem;
        color: rgba(255,255,255,0.6);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    .coverage-map {
        background: rgba(255,255,255,0.05);
        border-radius: 16px;
        padding: 2rem;
        position: relative;
        height: 300px;
    }
    .map-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        grid-template-rows: repeat(6, 1fr);
        gap: 4px;
        height: 100%;
    }
    .map-cell {
        background: rgba(41, 181, 232, 0.2);
        border-radius: 4px;
        transition: all 0.3s ease;
    }
    .map-cell.active {
        background: rgba(41, 181, 232, 0.6);
        animation: network-pulse 2s ease-in-out infinite;
    }
    .map-cell.strong {
        background: #29B5E8;
    }
    
    /* Testimonials */
    .testimonials-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
    }
    .testimonial-card {
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 16px;
        padding: 1.5rem;
        transition: all 0.3s ease;
    }
    .testimonial-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.08);
    }
    .testimonial-stars {
        color: #F59E0B;
        font-size: 1rem;
        margin-bottom: 1rem;
    }
    .testimonial-text {
        font-size: 0.95rem;
        color: #4B5563;
        line-height: 1.6;
        margin-bottom: 1rem;
        font-style: italic;
    }
    .testimonial-author {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    .testimonial-avatar {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
    }
    .testimonial-name {
        font-weight: 600;
        color: #1B2A4E;
        font-size: 0.9rem;
    }
    .testimonial-role {
        color: #6B7280;
        font-size: 0.8rem;
    }
    
    /* Business Section */
    .business-section {
        background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%);
        padding: 3rem 2rem;
        border-radius: 24px;
        margin: 2rem 0;
    }
    .business-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
    }
    .business-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }
    .business-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(41, 181, 232, 0.15);
    }
    .business-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }
    .business-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1B2A4E;
        margin-bottom: 0.5rem;
    }
    .business-desc {
        font-size: 0.85rem;
        color: #6B7280;
        line-height: 1.5;
    }
    
    /* Support Section */
    .support-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
    }
    .support-card {
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 16px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    .support-card:hover {
        border-color: #29B5E8;
        box-shadow: 0 10px 25px rgba(41, 181, 232, 0.15);
    }
    .support-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin: 0 auto 1rem;
    }
    .support-title {
        font-size: 1rem;
        font-weight: 700;
        color: #1B2A4E;
        margin-bottom: 0.25rem;
    }
    .support-desc {
        font-size: 0.8rem;
        color: #6B7280;
    }
    
    /* Footer */
    .web-footer {
        background: #0F172A;
        padding: 3rem 2rem 1.5rem;
        border-radius: 24px 24px 0 0;
        margin: 3rem -1rem -1rem -1rem;
    }
    .footer-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }
    .footer-brand {
        color: white;
    }
    .footer-logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }
    .footer-logo-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }
    .footer-logo-text {
        font-size: 1.3rem;
        font-weight: 700;
    }
    .footer-desc {
        color: rgba(255,255,255,0.6);
        font-size: 0.85rem;
        line-height: 1.6;
        margin-bottom: 1rem;
    }
    .footer-social {
        display: flex;
        gap: 0.75rem;
    }
    .social-icon {
        width: 36px;
        height: 36px;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }
    .social-icon:hover {
        background: #29B5E8;
        transform: translateY(-3px);
    }
    .footer-column h4 {
        color: white;
        font-size: 0.95rem;
        font-weight: 700;
        margin-bottom: 1rem;
    }
    .footer-links {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .footer-link {
        color: rgba(255,255,255,0.6);
        font-size: 0.85rem;
        padding: 0.4rem 0;
        display: block;
        transition: color 0.2s ease;
        text-decoration: none;
    }
    .footer-link:hover {
        color: #29B5E8;
    }
    .footer-bottom {
        border-top: 1px solid rgba(255,255,255,0.1);
        padding-top: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .footer-copyright {
        color: rgba(255,255,255,0.5);
        font-size: 0.8rem;
    }
    .footer-legal {
        display: flex;
        gap: 1.5rem;
    }
    .footer-legal a {
        color: rgba(255,255,255,0.5);
        font-size: 0.8rem;
        text-decoration: none;
        transition: color 0.2s ease;
    }
    .footer-legal a:hover {
        color: #29B5E8;
    }
    </style>
    """, unsafe_allow_html=True)
    
    # ===== NAVIGATION BAR =====
    st.markdown("""
    <div class="web-navbar">
        <div class="web-logo">
            <div class="web-logo-icon">❄️</div>
            <div class="web-logo-text">Snow<span>Telco</span></div>
        </div>
        <div class="web-nav-links">
            <a href="#" class="web-nav-link">Mobile</a>
            <a href="#" class="web-nav-link">Broadband</a>
            <a href="#" class="web-nav-link">Business</a>
            <a href="#" class="web-nav-link">Devices</a>
            <a href="#" class="web-nav-link">Deals</a>
            <a href="#" class="web-nav-link">Support</a>
        </div>
        <div class="web-nav-cta">
            <button class="web-btn web-btn-outline">Sign In</button>
            <button class="web-btn web-btn-primary">Join Now</button>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== HERO SECTION =====
    st.markdown("""
    <div class="web-hero">
        <div class="network-nodes">
            <div class="network-node"></div>
            <div class="network-node"></div>
            <div class="network-node"></div>
            <div class="network-node"></div>
            <div class="network-node"></div>
            <div class="network-node"></div>
        </div>
        <div class="hero-content">
            <div class="hero-badge">
                <div class="hero-badge-dot"></div>
                UK's Fastest Growing Network
            </div>
            <h1 class="hero-title">Connect to <span>Unlimited</span> Possibilities</h1>
            <p class="hero-subtitle">Experience lightning-fast 5G, award-winning customer service, and plans designed for how you live. Join 30,000+ happy customers today.</p>
            <div class="hero-cta">
                <a href="#" class="hero-btn hero-btn-primary">View Our Plans →</a>
                <a href="#" class="hero-btn hero-btn-secondary">Check Coverage</a>
            </div>
            <div class="hero-stats">
                <div class="hero-stat">
                    <div class="hero-stat-value">99.5%</div>
                    <div class="hero-stat-label">Network Uptime</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value">5G</div>
                    <div class="hero-stat-label">Coverage Expanding</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value">+47</div>
                    <div class="hero-stat-label">NPS Score</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value">24/7</div>
                    <div class="hero-stat-label">UK Support</div>
                </div>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== MOBILE PLANS SECTION =====
    st.markdown("""
    <div class="web-section">
        <div class="web-section-header">
            <div class="web-section-badge">📱 Mobile Plans</div>
            <h2 class="web-section-title">Choose Your Perfect Plan</h2>
            <p class="web-section-subtitle">Unlimited data, calls & texts on the UK's most reliable network. No contracts, no surprises.</p>
        </div>
        <div class="plans-grid">
            <div class="plan-card">
                <div class="plan-icon">🚀</div>
                <div class="plan-name">Essential</div>
                <div class="plan-desc">Perfect for light users and staying connected</div>
                <div class="plan-price">
                    <span class="plan-currency">£</span>
                    <span class="plan-amount">15</span>
                    <span class="plan-period">/month</span>
                </div>
                <ul class="plan-features">
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> 10GB 5G Data</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Unlimited UK Calls</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Unlimited Texts</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> EU Roaming Included</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> 5G Ready</li>
                </ul>
                <button class="plan-cta plan-cta-outline">Get Started</button>
            </div>
            <div class="plan-card featured">
                <div class="plan-icon">⚡</div>
                <div class="plan-name">Unlimited</div>
                <div class="plan-desc">Our most popular plan with unlimited everything</div>
                <div class="plan-price">
                    <span class="plan-currency">£</span>
                    <span class="plan-amount">30</span>
                    <span class="plan-period">/month</span>
                </div>
                <ul class="plan-features">
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Unlimited 5G Data</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Unlimited UK Calls</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Unlimited Texts</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> 50GB EU Roaming</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Priority Support</li>
                </ul>
                <button class="plan-cta plan-cta-primary">Get Started</button>
            </div>
            <div class="plan-card">
                <div class="plan-icon">👑</div>
                <div class="plan-name">Premium</div>
                <div class="plan-desc">Ultimate package with exclusive perks</div>
                <div class="plan-price">
                    <span class="plan-currency">£</span>
                    <span class="plan-amount">45</span>
                    <span class="plan-period">/month</span>
                </div>
                <ul class="plan-features">
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Unlimited 5G+ Data</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> International Calls (50 countries)</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> 100GB Global Roaming</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Streaming Bundle Included</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Dedicated Account Manager</li>
                </ul>
                <button class="plan-cta plan-cta-outline">Get Started</button>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== DEVICES SECTION =====
    st.markdown("""
    <div class="web-section" style="background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%); padding: 3rem 2rem; margin: 0 -1rem; border-radius: 0;">
        <div class="web-section-header">
            <div class="web-section-badge">📱 Latest Devices</div>
            <h2 class="web-section-title">Shop the Newest Phones</h2>
            <p class="web-section-subtitle">Get the latest smartphones with 0% APR financing. Trade in your old device for extra savings.</p>
        </div>
        <div class="devices-grid">
            <div class="device-card">
                <div class="device-image" style="background: transparent; border: none;">
                    <img src="https://fdn2.gsmarena.com/vv/bigpic/apple-iphone-17-pro-max.jpg" alt="iPhone 17 Pro Max" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <div class="device-name">iPhone 17 Pro Max</div>
                <div class="device-specs">256GB • Orange Titanium</div>
                <div class="device-price">From £54.99/mo</div>
                <div class="device-finance">or £1,299 upfront</div>
            </div>
            <div class="device-card new">
                <div class="device-image" style="background: transparent; border: none;">
                    <img src="https://fdn2.gsmarena.com/vv/bigpic/samsung-galaxy-s26-ultra-r2.jpg" alt="Samsung Galaxy S26 Ultra" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <div class="device-name">Samsung Galaxy S26 Ultra</div>
                <div class="device-specs">512GB • Titanium Violet</div>
                <div class="device-price">From £52.99/mo</div>
                <div class="device-finance">or £1,249 upfront</div>
            </div>
            <div class="device-card">
                <div class="device-image" style="background: transparent; border: none;">
                    <img src="https://fdn2.gsmarena.com/vv/bigpic/google-pixel-10-pro-.jpg" alt="Google Pixel 10 Pro" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <div class="device-name">Google Pixel 10 Pro</div>
                <div class="device-specs">256GB • Porcelain</div>
                <div class="device-price">From £44.99/mo</div>
                <div class="device-finance">or £1,049 upfront</div>
            </div>
            <div class="device-card">
                <div class="device-image" style="background: transparent; border: none;">
                    <img src="https://fdn2.gsmarena.com/vv/bigpic/xiaomi-17-pro.jpg" alt="Xiaomi 17 Pro Max" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <div class="device-name">Xiaomi 17 Pro Max</div>
                <div class="device-specs">512GB • Aurora Green</div>
                <div class="device-price">From £39.99/mo</div>
                <div class="device-finance">or £899 upfront</div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 2rem;">
            <button class="web-btn web-btn-primary">View All Devices →</button>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== WHY CHOOSE US =====
    st.markdown("""
    <div class="web-section">
        <div class="web-section-header">
            <div class="web-section-badge">✨ Why SnowTelco</div>
            <h2 class="web-section-title">What Makes Us Different</h2>
            <p class="web-section-subtitle">We're not just another network. We're building the future of connectivity.</p>
        </div>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">🚀</div>
                <div class="feature-title">Lightning Fast 5G</div>
                <div class="feature-desc">Experience speeds up to 1Gbps with our expanding 5G network across the UK.</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">💚</div>
                <div class="feature-title">Carbon Neutral</div>
                <div class="feature-desc">100% renewable energy powers our network. Every plan plants a tree.</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🎯</div>
                <div class="feature-title">No Hidden Fees</div>
                <div class="feature-desc">Transparent pricing with no surprise charges. What you see is what you pay.</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🏆</div>
                <div class="feature-title">Award-Winning Support</div>
                <div class="feature-desc">UK-based customer service available 24/7. Real people, real solutions.</div>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== COVERAGE SECTION =====
    st.markdown("""
    <div class="coverage-section">
        <div class="coverage-content">
            <div class="coverage-text">
                <h3>🗺️ Nationwide Coverage You Can Count On</h3>
                <p>Our network reaches 99% of the UK population with 4G, and our 5G coverage is expanding every day. Check if your area is covered with our interactive coverage map.</p>
                <div class="coverage-stats">
                    <div class="coverage-stat">
                        <div class="coverage-stat-value">99%</div>
                        <div class="coverage-stat-label">4G Population Coverage</div>
                    </div>
                    <div class="coverage-stat">
                        <div class="coverage-stat-value">65%</div>
                        <div class="coverage-stat-label">5G Coverage</div>
                    </div>
                    <div class="coverage-stat">
                        <div class="coverage-stat-value">2,500+</div>
                        <div class="coverage-stat-label">Cell Sites</div>
                    </div>
                </div>
                <div style="margin-top: 1.5rem;">
                    <button class="hero-btn hero-btn-primary">Check Your Coverage →</button>
                </div>
            </div>
            <div class="coverage-map">
                <div class="map-grid">
                    <div class="map-cell"></div><div class="map-cell active"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell active"></div><div class="map-cell"></div><div class="map-cell"></div><div class="map-cell"></div>
                    <div class="map-cell active"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell active"></div><div class="map-cell"></div><div class="map-cell"></div>
                    <div class="map-cell"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell active"></div><div class="map-cell"></div>
                    <div class="map-cell"></div><div class="map-cell active"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell strong"></div><div class="map-cell active"></div><div class="map-cell"></div><div class="map-cell"></div>
                    <div class="map-cell"></div><div class="map-cell"></div><div class="map-cell active"></div><div class="map-cell strong"></div><div class="map-cell active"></div><div class="map-cell"></div><div class="map-cell"></div><div class="map-cell"></div>
                    <div class="map-cell"></div><div class="map-cell"></div><div class="map-cell"></div><div class="map-cell active"></div><div class="map-cell"></div><div class="map-cell"></div><div class="map-cell"></div><div class="map-cell"></div>
                </div>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== BROADBAND SECTION =====
    st.markdown("""
    <div class="web-section">
        <div class="web-section-header">
            <div class="web-section-badge">🌐 Home Broadband</div>
            <h2 class="web-section-title">Superfast Home Internet</h2>
            <p class="web-section-subtitle">Stream, game, and work from home with our reliable fibre broadband.</p>
        </div>
        <div class="plans-grid">
            <div class="plan-card">
                <div class="plan-icon">🏠</div>
                <div class="plan-name">Fibre Essential</div>
                <div class="plan-desc">Perfect for browsing and streaming</div>
                <div class="plan-price">
                    <span class="plan-currency">£</span>
                    <span class="plan-amount">24</span>
                    <span class="plan-period">/month</span>
                </div>
                <ul class="plan-features">
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> 67 Mbps Average Speed</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Unlimited Downloads</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> WiFi Router Included</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> 18 Month Contract</li>
                </ul>
                <button class="plan-cta plan-cta-outline">Get Started</button>
            </div>
            <div class="plan-card featured">
                <div class="plan-icon">⚡</div>
                <div class="plan-name">Fibre Max</div>
                <div class="plan-desc">Great for families and home offices</div>
                <div class="plan-price">
                    <span class="plan-currency">£</span>
                    <span class="plan-amount">35</span>
                    <span class="plan-period">/month</span>
                </div>
                <ul class="plan-features">
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> 150 Mbps Average Speed</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Unlimited Downloads</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> WiFi 6 Router Included</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Mesh Extender Included</li>
                </ul>
                <button class="plan-cta plan-cta-primary">Get Started</button>
            </div>
            <div class="plan-card">
                <div class="plan-icon">🔥</div>
                <div class="plan-name">Fibre Ultra</div>
                <div class="plan-desc">Maximum speed for power users</div>
                <div class="plan-price">
                    <span class="plan-currency">£</span>
                    <span class="plan-amount">49</span>
                    <span class="plan-period">/month</span>
                </div>
                <ul class="plan-features">
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> 500 Mbps Average Speed</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Unlimited Downloads</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> WiFi 6E Router + 2 Extenders</li>
                    <li class="plan-feature"><span class="plan-feature-check">✓</span> Priority Installation</li>
                </ul>
                <button class="plan-cta plan-cta-outline">Get Started</button>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== TESTIMONIALS =====
    st.markdown("""
    <div class="web-section" style="background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%); padding: 3rem 2rem; margin: 0 -1rem; border-radius: 0;">
        <div class="web-section-header">
            <div class="web-section-badge">💬 Customer Stories</div>
            <h2 class="web-section-title">Loved by 30,000+ Customers</h2>
            <p class="web-section-subtitle">Don't just take our word for it. Here's what our customers say.</p>
        </div>
        <div class="testimonials-grid">
            <div class="testimonial-card">
                <div class="testimonial-stars">★★★★★</div>
                <div class="testimonial-text">"Switched from my previous provider and the difference is night and day. Finally have signal everywhere I go, and the customer service is actually helpful!"</div>
                <div class="testimonial-author">
                    <div class="testimonial-avatar">JM</div>
                    <div>
                        <div class="testimonial-name">James Mitchell</div>
                        <div class="testimonial-role">Premium Customer</div>
                    </div>
                </div>
            </div>
            <div class="testimonial-card">
                <div class="testimonial-stars">★★★★★</div>
                <div class="testimonial-text">"The 5G speeds are incredible. I work remotely and can now do video calls from anywhere. The unlimited plan is exactly what I needed."</div>
                <div class="testimonial-author">
                    <div class="testimonial-avatar">SC</div>
                    <div>
                        <div class="testimonial-name">Sarah Chen</div>
                        <div class="testimonial-role">Unlimited Plan</div>
                    </div>
                </div>
            </div>
            <div class="testimonial-card">
                <div class="testimonial-stars">★★★★★</div>
                <div class="testimonial-text">"Best decision for our business. We moved our entire team to SnowTelco and saved 30% while getting better coverage. Highly recommend!"</div>
                <div class="testimonial-author">
                    <div class="testimonial-avatar">RK</div>
                    <div>
                        <div class="testimonial-name">Raj Kumar</div>
                        <div class="testimonial-role">Business Customer</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== BUSINESS SOLUTIONS =====
    st.markdown("""
    <div class="business-section">
        <div class="web-section-header">
            <div class="web-section-badge">🏢 Business Solutions</div>
            <h2 class="web-section-title">Enterprise-Grade Connectivity</h2>
            <p class="web-section-subtitle">Tailored solutions for businesses of all sizes. From startups to enterprises.</p>
        </div>
        <div class="business-grid">
            <div class="business-card">
                <div class="business-icon">📱</div>
                <div class="business-title">Business Mobile</div>
                <div class="business-desc">Flexible mobile plans for your team with shared data pools, device management, and priority support.</div>
            </div>
            <div class="business-card">
                <div class="business-icon">🌐</div>
                <div class="business-title">Business Broadband</div>
                <div class="business-desc">Dedicated business lines with guaranteed uptime SLAs, static IPs, and 4-hour fix guarantee.</div>
            </div>
            <div class="business-card">
                <div class="business-icon">☁️</div>
                <div class="business-title">IoT & M2M</div>
                <div class="business-desc">Connect your devices with our IoT platform. Fleet management, sensors, and smart solutions.</div>
            </div>
            <div class="business-card">
                <div class="business-icon">🔒</div>
                <div class="business-title">Private Networks</div>
                <div class="business-desc">Dedicated 5G private networks for manufacturing, logistics, and enterprise campuses.</div>
            </div>
            <div class="business-card">
                <div class="business-icon">📞</div>
                <div class="business-title">Unified Comms</div>
                <div class="business-desc">Voice, video, and collaboration tools in one platform. Microsoft Teams integration included.</div>
            </div>
            <div class="business-card">
                <div class="business-icon">🛡️</div>
                <div class="business-title">Cyber Security</div>
                <div class="business-desc">Protect your business with our enterprise security suite. Threat detection and response included.</div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 2rem;">
            <button class="web-btn web-btn-primary">Contact Business Sales →</button>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== SUPPORT SECTION =====
    st.markdown("""
    <div class="web-section">
        <div class="web-section-header">
            <div class="web-section-badge">🤝 Help & Support</div>
            <h2 class="web-section-title">We're Here to Help</h2>
            <p class="web-section-subtitle">Get support your way - online, by phone, or in-store.</p>
        </div>
        <div class="support-grid">
            <div class="support-card">
                <div class="support-icon">💬</div>
                <div class="support-title">Live Chat</div>
                <div class="support-desc">Chat with us 24/7</div>
            </div>
            <div class="support-card">
                <div class="support-icon">📞</div>
                <div class="support-title">Call Us</div>
                <div class="support-desc">0800 123 4567</div>
            </div>
            <div class="support-card">
                <div class="support-icon">📍</div>
                <div class="support-title">Find a Store</div>
                <div class="support-desc">150+ locations</div>
            </div>
            <div class="support-card">
                <div class="support-icon">📚</div>
                <div class="support-title">Help Centre</div>
                <div class="support-desc">FAQs & guides</div>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ===== FOOTER =====
    st.markdown("""
    <div class="web-footer">
        <div class="footer-grid">
            <div class="footer-brand">
                <div class="footer-logo">
                    <div class="footer-logo-icon">❄️</div>
                    <div class="footer-logo-text">SnowTelco</div>
                </div>
                <p class="footer-desc">Connecting the UK with lightning-fast 5G and award-winning customer service. Building the network of tomorrow, today.</p>
                <div class="footer-social">
                    <div class="social-icon">f</div>
                    <div class="social-icon">𝕏</div>
                    <div class="social-icon">in</div>
                    <div class="social-icon">📷</div>
                </div>
            </div>
            <div class="footer-column">
                <h4>Mobile</h4>
                <ul class="footer-links">
                    <li><a href="#" class="footer-link">Pay Monthly</a></li>
                    <li><a href="#" class="footer-link">SIM Only</a></li>
                    <li><a href="#" class="footer-link">Pay As You Go</a></li>
                    <li><a href="#" class="footer-link">5G Plans</a></li>
                    <li><a href="#" class="footer-link">International</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Broadband</h4>
                <ul class="footer-links">
                    <li><a href="#" class="footer-link">Fibre Broadband</a></li>
                    <li><a href="#" class="footer-link">Home WiFi</a></li>
                    <li><a href="#" class="footer-link">TV Packages</a></li>
                    <li><a href="#" class="footer-link">Bundles</a></li>
                    <li><a href="#" class="footer-link">Coverage Check</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Company</h4>
                <ul class="footer-links">
                    <li><a href="#" class="footer-link">About Us</a></li>
                    <li><a href="#" class="footer-link">Careers</a></li>
                    <li><a href="#" class="footer-link">Press</a></li>
                    <li><a href="#" class="footer-link">Investors</a></li>
                    <li><a href="#" class="footer-link">Sustainability</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Support</h4>
                <ul class="footer-links">
                    <li><a href="#" class="footer-link">Help Centre</a></li>
                    <li><a href="#" class="footer-link">Contact Us</a></li>
                    <li><a href="#" class="footer-link">Store Finder</a></li>
                    <li><a href="#" class="footer-link">Network Status</a></li>
                    <li><a href="#" class="footer-link">Complaints</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="footer-copyright">© 2026 SnowTelco Ltd. All rights reserved.</div>
            <div class="footer-legal">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Cookie Settings</a>
                <a href="#">Accessibility</a>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)

def render_persona_hub():
    """Render the Persona Hub navigation dashboard"""
    import streamlit.components.v1 as components
    
    # ===== PERSONA HUB CSS STYLES =====
    st.markdown("""
    <style>
    /* Live Ticker Banner */
    @keyframes ticker-scroll {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }
    @keyframes pulse-dot {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.7; transform: scale(1.2); }
    }
    .ticker-container {
        background: linear-gradient(90deg, #1B2A4E 0%, #11567F 50%, #1B2A4E 100%);
        border-radius: 12px;
        padding: 0;
        margin-bottom: 2rem;
        overflow: hidden;
        position: relative;
        box-shadow: 0 4px 15px rgba(27, 42, 78, 0.3);
    }
    .ticker-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(0,0,0,0.2);
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .ticker-live-dot {
        width: 8px;
        height: 8px;
        background: #EF4444;
        border-radius: 50%;
        animation: pulse-dot 1.5s ease-in-out infinite;
        box-shadow: 0 0 8px #EF4444;
    }
    .ticker-live-text {
        color: #EF4444;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .ticker-title {
        color: rgba(255,255,255,0.7);
        font-size: 0.75rem;
        margin-left: auto;
    }
    .ticker-track {
        display: flex;
        overflow: hidden;
        padding: 0.75rem 0;
    }
    .ticker-content {
        display: flex;
        animation: ticker-scroll 40s linear infinite;
        white-space: nowrap;
    }
    .ticker-content:hover {
        animation-play-state: paused;
    }
    .ticker-item {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0 2rem;
        color: white;
        font-size: 0.9rem;
        border-right: 1px solid rgba(255,255,255,0.2);
    }
    .ticker-item:last-child {
        border-right: none;
    }
    .ticker-icon {
        font-size: 1.1rem;
    }
    .ticker-alert {
        color: #FCD34D;
        font-weight: 600;
    }
    .ticker-success {
        color: #34D399;
        font-weight: 600;
    }
    .ticker-info {
        color: #60A5FA;
        font-weight: 600;
    }
    .ticker-metric {
        background: rgba(255,255,255,0.15);
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-weight: 600;
    }
    
    /* Persona Hub Container */
    .persona-hub {
        padding: 2rem 1rem;
        background: linear-gradient(180deg, #F0F9FF 0%, #FFFFFF 100%);
        min-height: 100vh;
    }
    
    /* Section Headers */
    .persona-section-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin: 2.5rem 0 1.5rem 0;
        padding-bottom: 0.75rem;
        border-bottom: 3px solid transparent;
        background: linear-gradient(90deg, #29B5E8, #0EA5E9) padding-box,
                    linear-gradient(90deg, #29B5E8, #0EA5E9) border-box;
        -webkit-background-clip: padding-box, border-box;
        background-clip: padding-box, border-box;
        border-image: linear-gradient(90deg, #29B5E8, transparent) 1;
    }
    .persona-section-badge {
        background: linear-gradient(135deg, #29B5E8 0%, #0EA5E9 100%);
        color: white;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .persona-section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1B2A4E;
        margin: 0;
    }
    
    /* Grid Layout */
    .persona-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    /* Featured Tile (Executive Showcase - Full Width) */
    @keyframes featured-border-rotate {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    @keyframes featured-pulse {
        0%, 100% { box-shadow: 0 8px 30px rgba(41, 181, 232, 0.3); }
        50% { box-shadow: 0 8px 40px rgba(41, 181, 232, 0.5); }
    }
    .persona-tile-featured {
        grid-column: span 4;
        background: white;
        border-radius: 20px;
        padding: 2rem;
        display: flex;
        gap: 2rem;
        align-items: center;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        animation: featured-pulse 3s ease-in-out infinite;
        transition: transform 0.3s ease;
    }
    .persona-tile-featured::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 20px;
        padding: 3px;
        background: linear-gradient(90deg, #29B5E8, #8B5CF6, #EC4899, #29B5E8);
        background-size: 300% 100%;
        animation: featured-border-rotate 4s linear infinite;
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
    }
    .persona-tile-featured:hover {
        transform: scale(1.02);
    }
    .persona-tile-featured .persona-image {
        width: 180px;
        height: 180px;
        flex-shrink: 0;
    }
    .persona-tile-featured .persona-content {
        flex: 1;
    }
    .persona-tile-featured .persona-title {
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
    }
    .persona-tile-featured .persona-focus {
        font-size: 1.1rem;
        line-height: 1.6;
    }
    .featured-badge {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
        color: white;
        padding: 0.3rem 0.6rem;
        border-radius: 12px;
        font-size: 0.65rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);
    }
    
    /* Regular Tiles */
    @keyframes tile-enter {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    .persona-tile {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid #E2E8F0;
        animation: tile-enter 0.5s ease forwards;
        opacity: 0;
        position: relative;
        overflow: hidden;
    }
    .persona-tile:hover {
        transform: translateY(-8px) scale(1.02);
        border-color: #29B5E8;
        box-shadow: 0 12px 30px rgba(41, 181, 232, 0.2);
    }
    .persona-tile::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(41, 181, 232, 0.1), transparent);
        transition: left 0.5s ease;
    }
    .persona-tile:hover::after {
        left: 100%;
    }
    
    /* Animation delays for staggered entrance */
    .persona-tile:nth-child(1) { animation-delay: 0.1s; }
    .persona-tile:nth-child(2) { animation-delay: 0.15s; }
    .persona-tile:nth-child(3) { animation-delay: 0.2s; }
    .persona-tile:nth-child(4) { animation-delay: 0.25s; }
    .persona-tile:nth-child(5) { animation-delay: 0.3s; }
    .persona-tile:nth-child(6) { animation-delay: 0.35s; }
    .persona-tile:nth-child(7) { animation-delay: 0.4s; }
    .persona-tile:nth-child(8) { animation-delay: 0.45s; }
    .persona-tile:nth-child(9) { animation-delay: 0.5s; }
    .persona-tile:nth-child(10) { animation-delay: 0.55s; }
    .persona-tile:nth-child(11) { animation-delay: 0.6s; }
    .persona-tile:nth-child(12) { animation-delay: 0.65s; }
    
    /* Persona Image Placeholder */
    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
    .persona-image {
        width: 100%;
        height: 120px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        position: relative;
        overflow: hidden;
    }
    .persona-image.c-suite {
        background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 50%, #60A5FA 100%);
    }
    .persona-image.vp-level {
        background: linear-gradient(135deg, #0F766E 0%, #14B8A6 50%, #2DD4BF 100%);
    }
    .persona-image::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
        background-size: 200% 100%;
        animation: shimmer 3s infinite linear;
    }
    .persona-icon {
        font-size: 3rem;
        z-index: 1;
    }
    .persona-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 12px;
    }
    
    /* Persona Content */
    .persona-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1B2A4E;
        margin-bottom: 0.5rem;
        line-height: 1.3;
    }
    .persona-role {
        display: inline-block;
        background: linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%);
        color: #0369A1;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }
    .persona-role.vp {
        background: linear-gradient(135deg, #CCFBF1 0%, #99F6E4 100%);
        color: #0F766E;
    }
    .persona-duration {
        display: inline-block;
        background: #F3F4F6;
        color: #6B7280;
        padding: 0.2rem 0.5rem;
        border-radius: 8px;
        font-size: 0.7rem;
        font-weight: 500;
        margin-left: 0.5rem;
    }
    .persona-focus {
        font-size: 0.85rem;
        color: #4B5563;
        line-height: 1.5;
        margin-bottom: 0.75rem;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    .persona-snowflake {
        font-size: 0.8rem;
        color: #29B5E8;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .persona-snowflake::before {
        content: '❄️';
        font-size: 0.9rem;
    }
    
    /* Click indicator */
    .click-indicator {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        color: #9CA3AF;
        font-size: 1.2rem;
        transition: all 0.3s ease;
    }
    .persona-tile:hover .click-indicator {
        color: #29B5E8;
        transform: translateX(5px);
    }
    
    </style>
    """, unsafe_allow_html=True)
    
    # ===== PERSONA DATA =====
    personas = [
        # Featured
        {
            "key": "00_WOW_Executive_Showcase",
            "title": "Executive Showcase",
            "persona": "CEO / Board Member / Executive Sponsor",
            "duration": "10-15 min",
            "focus": "Cross-domain analysis with conversational memory, data and document fusion, and predictive insights powered by Snowflake Cortex AI",
            "snowflake_value": "Unified AI platform enabling natural language analytics across all business domains",
            "icon": "🎯",
            "featured": True,
            "category": "c-suite"
        },
        # C-Suite
        {
            "key": "Executive_Summary",
            "title": "Executive Summary",
            "persona": "All Executives",
            "duration": "5 min",
            "focus": "High-level business overview with key metrics at a glance and strategic priorities",
            "snowflake_value": "Real-time unified view across all business data",
            "icon": "📊",
            "featured": False,
            "category": "c-suite"
        },
        {
            "key": "01_CEO_Strategic",
            "title": "CEO Strategic Overview",
            "persona": "Chief Executive Officer",
            "duration": "10 min",
            "focus": "Overall business performance, market position, strategic KPIs, and competitive landscape analysis",
            "snowflake_value": "AI-powered strategic insights from unified data sources",
            "icon": "👔",
            "featured": True,
            "category": "c-suite"
        },
        {
            "key": "02_CFO_Finance",
            "title": "CFO Financial Performance",
            "persona": "Chief Financial Officer",
            "duration": "10 min",
            "focus": "Revenue trends, ARPU analysis, billing efficiency, cost management, and vendor spend optimization",
            "snowflake_value": "Financial data consolidation with predictive revenue modeling",
            "icon": "💰",
            "featured": False,
            "category": "c-suite"
        },
        {
            "key": "03_CMO_Marketing",
            "title": "CMO Marketing Performance",
            "persona": "Chief Marketing Officer",
            "duration": "10 min",
            "focus": "Campaign performance, customer acquisition costs, brand health, NPS trends, and churn prevention",
            "snowflake_value": "Customer 360 view with ML-driven campaign optimization",
            "icon": "📢",
            "featured": False,
            "category": "c-suite"
        },
        {
            "key": "04_CTO_Technology",
            "title": "CTO Technology & Network",
            "persona": "Chief Technology Officer",
            "duration": "10 min",
            "focus": "Network strategy, 5G rollout progress, IT systems health, and digital transformation initiatives",
            "snowflake_value": "Infrastructure analytics with capacity planning intelligence",
            "icon": "🔧",
            "featured": False,
            "category": "c-suite"
        },
        {
            "key": "05_COO_Operations",
            "title": "COO Operations Excellence",
            "persona": "Chief Operating Officer",
            "duration": "10 min",
            "focus": "Operational efficiency, process performance, service quality metrics, and workforce productivity",
            "snowflake_value": "End-to-end operations visibility with process optimization AI",
            "icon": "⚙️",
            "featured": False,
            "category": "c-suite"
        },
        {
            "key": "06_CCO_Commercial",
            "title": "CCO Commercial Performance",
            "persona": "Chief Commercial Officer",
            "duration": "10 min",
            "focus": "Revenue growth, sales performance, partner channels, pricing strategy, and market expansion",
            "snowflake_value": "Sales analytics with propensity scoring and revenue forecasting",
            "icon": "📈",
            "featured": False,
            "category": "c-suite"
        },
        {
            "key": "07_CXO_Customer_Experience",
            "title": "CXO Customer Experience",
            "persona": "Chief Experience Officer",
            "duration": "10 min",
            "focus": "Customer journey optimization, NPS improvement initiatives, and experience transformation programs",
            "snowflake_value": "Journey analytics with sentiment analysis and churn prediction",
            "icon": "😊",
            "featured": False,
            "category": "c-suite"
        },
        {
            "key": "08_CNO_Network_QoE",
            "title": "CNO Network Quality",
            "persona": "Chief Networks Officer",
            "duration": "10 min",
            "focus": "Network performance metrics, RAN operations, customer experience correlation, and 5G coverage rollout",
            "snowflake_value": "Network data lake with QoE correlation analytics",
            "icon": "📡",
            "featured": True,
            "category": "c-suite"
        },
        {
            "key": "09_CDO_Data_Science",
            "title": "CDO AI/ML Analytics",
            "persona": "Chief Data Officer",
            "duration": "10 min",
            "focus": "Predictive analytics, ML model operations, propensity scoring, and data-driven decision making",
            "snowflake_value": "Cortex ML with automated feature engineering and model ops",
            "icon": "🤖",
            "featured": False,
            "category": "c-suite"
        },
        {
            "key": "10_CSO_Sustainability",
            "title": "CSO Sustainability & ESG",
            "persona": "Chief Sustainability Officer",
            "duration": "10 min",
            "focus": "Carbon reduction tracking, renewable energy adoption, net zero targets, and ESG compliance reporting",
            "snowflake_value": "ESG data platform with carbon footprint analytics",
            "icon": "🌱",
            "featured": False,
            "category": "c-suite"
        },
        # VP Level
        {
            "key": "11_VP_Customer_Service",
            "title": "VP Customer Service",
            "persona": "VP Customer Service",
            "duration": "10 min",
            "focus": "Contact center operations, ticket management, CSAT scores, and complaint handling efficiency",
            "snowflake_value": "Service analytics with AI-powered resolution recommendations",
            "icon": "🎧",
            "featured": True,
            "category": "vp-level"
        },
        {
            "key": "12_VP_Network_Operations",
            "title": "VP Network Operations",
            "persona": "VP Network Operations",
            "duration": "10 min",
            "focus": "Network availability, alarm management, capacity planning, RF optimization, and SLA delivery tracking",
            "snowflake_value": "Real-time network monitoring with anomaly detection",
            "icon": "🖥️",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "Alert_Center",
            "title": "Network Alert Center",
            "persona": "NOC Manager",
            "duration": "10 min",
            "focus": "Real-time alert monitoring, incident management, SLA tracking, and impact analysis",
            "snowflake_value": "Intelligent alerting with correlation and root cause analysis",
            "icon": "🚨",
            "featured": True,
            "category": "vp-level"
        },
        {
            "key": "13_Head_of_Partners",
            "title": "Head of Partners",
            "persona": "Head of Partners",
            "duration": "10 min",
            "focus": "Partner performance, commission management, recruitment pipeline, and partner experience",
            "snowflake_value": "Partner ecosystem analytics with performance benchmarking",
            "icon": "🤝",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "14_VP_Billing_Revenue",
            "title": "VP Billing & Revenue",
            "persona": "VP Billing & Revenue",
            "duration": "10 min",
            "focus": "Billing accuracy, payment collection status, revenue assurance, and dispute management",
            "snowflake_value": "Revenue assurance platform with billing anomaly detection",
            "icon": "💳",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "15_VP_IT_Digital",
            "title": "VP IT & Digital",
            "persona": "VP IT / Director of IT",
            "duration": "10 min",
            "focus": "IT incident management, SLA compliance, application health monitoring, and service delivery",
            "snowflake_value": "IT operations analytics with service desk intelligence",
            "icon": "💻",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "16_VP_Field_Operations",
            "title": "VP Field Operations",
            "persona": "VP Field Operations",
            "duration": "10 min",
            "focus": "Workforce optimization, field SLA compliance, cost management, and first-time fix rates",
            "snowflake_value": "Field service optimization with route and scheduling AI",
            "icon": "🔨",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "17_VP_Strategy",
            "title": "VP Strategy",
            "persona": "VP Strategy",
            "duration": "10 min",
            "focus": "Market positioning, competitive analysis, pricing strategy optimization, and growth opportunities",
            "snowflake_value": "Market intelligence with competitive benchmarking analytics",
            "icon": "🎯",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "18_VP_Communications",
            "title": "VP Communications",
            "persona": "VP Communications",
            "duration": "10 min",
            "focus": "Brand reputation monitoring, social media analytics, crisis management, and voice of customer",
            "snowflake_value": "Social listening with sentiment analysis and trend detection",
            "icon": "📣",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "19_Regulatory_Compliance",
            "title": "Regulatory & Compliance",
            "persona": "Head of Regulatory",
            "duration": "10 min",
            "focus": "Ofcom compliance tracking, SLA management, GDPR requirements, and service quality reporting",
            "snowflake_value": "Compliance automation with regulatory reporting dashboards",
            "icon": "⚖️",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "20_VP_Security",
            "title": "VP Security & Fraud",
            "persona": "VP Security",
            "duration": "10 min",
            "focus": "Fraud detection, loss prevention analytics, security threat monitoring, and risk assessment",
            "snowflake_value": "Fraud analytics with ML-powered anomaly detection",
            "icon": "🔒",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "21_VP_Enterprise_Sales",
            "title": "VP Enterprise Sales",
            "persona": "VP Enterprise Sales",
            "duration": "10 min",
            "focus": "B2B contract renewals, enterprise revenue retention, competitive threats, and deal pipeline",
            "snowflake_value": "Enterprise analytics with account health scoring",
            "icon": "🏢",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "22_VP_Wholesale",
            "title": "VP Wholesale & MVNO",
            "persona": "VP Wholesale",
            "duration": "10 min",
            "focus": "MVNO traffic analysis, wholesale revenue tracking, partner settlements, and capacity planning",
            "snowflake_value": "Wholesale analytics with partner usage reconciliation",
            "icon": "🔄",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "23_VP_Retail",
            "title": "VP Retail Operations",
            "persona": "VP Retail",
            "duration": "10 min",
            "focus": "Store performance, sales conversion rates, footfall analytics, and inventory management",
            "snowflake_value": "Retail analytics with store performance optimization",
            "icon": "🏪",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "24_CHRO_People",
            "title": "CHRO People & Workforce",
            "persona": "CHRO",
            "duration": "10 min",
            "focus": "Workforce analytics, employee engagement, talent management, and organizational effectiveness",
            "snowflake_value": "People analytics with attrition prediction and skills mapping",
            "icon": "👥",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "25_VP_Legal",
            "title": "VP Legal & Counsel",
            "persona": "VP Legal",
            "duration": "10 min",
            "focus": "Contract management, regulatory compliance, dispute tracking, and legal risk assessment",
            "snowflake_value": "Legal analytics with contract intelligence and risk scoring",
            "icon": "📜",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "26_VP_Product",
            "title": "VP Product Management",
            "persona": "VP Product",
            "duration": "10 min",
            "focus": "Product portfolio performance, plan adoption rates, pricing strategy, and feature utilization",
            "snowflake_value": "Product analytics with usage patterns and pricing optimization",
            "icon": "📦",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "27_VP_Procurement",
            "title": "VP Procurement",
            "persona": "VP Procurement",
            "duration": "10 min",
            "focus": "Vendor spend analysis, supplier performance, contract management, and cost optimization",
            "snowflake_value": "Procurement analytics with spend visibility and savings tracking",
            "icon": "🛒",
            "featured": False,
            "category": "vp-level"
        },
        {
            "key": "data_monetization",
            "title": "Data Monetization & Sharing",
            "persona": "CDO / Head of Data Products",
            "duration": "10 min",
            "focus": "Data revenue streams, marketplace listings, clean rooms, partner data ecosystem, and cross-industry use cases",
            "snowflake_value": "Snowflake Marketplace, Data Clean Rooms, and Native App Framework for secure monetization",
            "icon": "💎",
            "featured": True,
            "category": "vp-level"
        }
    ]
    
    # Separate personas by category
    # Get the main featured (Executive Showcase)
    main_featured = next((p for p in personas if p["key"] == "00_WOW_Executive_Showcase"), None)
    csuite_personas = [p for p in personas if p["category"] == "c-suite" and p["key"] != "00_WOW_Executive_Showcase"]
    vp_personas = [p for p in personas if p["category"] == "vp-level"]
    
    # ===== HELPER FUNCTION TO BUILD TILE HTML =====
    def build_tile_html(p, is_full_width=False, has_badge=False, is_vp=False):
        tile_class = "persona-tile-featured" if is_full_width else "persona-tile"
        image_class = "vp-level" if is_vp else "c-suite"
        role_class = "persona-role vp" if is_vp else "persona-role"
        
        html = '<div class="' + tile_class + '" data-key="' + p['key'] + '">'
        
        # Add featured badge if has_badge is True (regardless of full-width)
        if has_badge:
            html += '<div class="featured-badge">⭐ FEATURED</div>'
        
        if is_full_width:
            # Full-width layout (only for Executive Showcase)
            html += '<div class="persona-image ' + image_class + '"><span class="persona-icon">' + p['icon'] + '</span></div>'
            html += '<div class="persona-content">'
            html += '<div class="persona-title">' + p['title'] + '</div>'
            html += '<div><span class="' + role_class + '">' + p['persona'] + '</span>'
            html += '<span class="persona-duration">⏱️ ' + p['duration'] + '</span></div>'
            html += '<div class="persona-focus">' + p['focus'] + '</div>'
            html += '<div class="persona-snowflake">' + p['snowflake_value'] + '</div>'
            html += '</div></div>'
        else:
            # Regular tile layout (same size for all)
            html += '<div class="persona-image ' + image_class + '"><span class="persona-icon">' + p['icon'] + '</span></div>'
            html += '<div class="persona-title">' + p['title'] + '</div>'
            html += '<div><span class="' + role_class + '">' + p['persona'] + '</span>'
            html += '<span class="persona-duration">⏱️ ' + p['duration'] + '</span></div>'
            html += '<div class="persona-focus">' + p['focus'] + '</div>'
            html += '<div class="persona-snowflake">' + p['snowflake_value'] + '</div>'
            html += '</div>'
        return html
    
    # Build main featured tile (Executive Showcase) - FULL WIDTH with badge
    featured_html = ""
    if main_featured:
        featured_html = build_tile_html(main_featured, is_full_width=True, has_badge=True, is_vp=False)
    
    # Build C-Suite tiles - ALL SAME SIZE, but some have featured badge
    csuite_tiles = ""
    for p in csuite_personas:
        csuite_tiles += build_tile_html(p, is_full_width=False, has_badge=p.get('featured', False), is_vp=False)
    
    # Build VP tiles - ALL SAME SIZE, but some have featured badge
    vp_tiles = ""
    for p in vp_personas:
        vp_tiles += build_tile_html(p, is_full_width=False, has_badge=p.get('featured', False), is_vp=True)
    
    # Main Featured Tile (Executive Showcase)
    st.markdown(f"""
    <div class="persona-grid">
        {featured_html}
    </div>
    """, unsafe_allow_html=True)
    
    # C-Suite Section
    st.markdown("""
    <div class="persona-section-header">
        <span class="persona-section-badge">C-Suite</span>
        <h2 class="persona-section-title">Executive Leadership</h2>
    </div>
    """, unsafe_allow_html=True)
    
    st.markdown(f"""
    <div class="persona-grid" id="csuite-grid">
        {csuite_tiles}
    </div>
    """, unsafe_allow_html=True)
    
    # VP Section
    st.markdown("""
    <div class="persona-section-header">
        <span class="persona-section-badge">VP & Directors</span>
        <h2 class="persona-section-title">Functional Leaders</h2>
    </div>
    """, unsafe_allow_html=True)
    
    st.markdown(f"""
    <div class="persona-grid" id="vp-grid">
        {vp_tiles}
    </div>
    """, unsafe_allow_html=True)
    
    
    # ===== JAVASCRIPT FOR CLICK NAVIGATION =====
    # Note: Search filtering is handled inline above
    
    # Check for navigation request from JavaScript
    # Create clickable buttons for each persona using Streamlit native components
    st.markdown("---")
    st.markdown("### Quick Navigation")
    
    # Create columns for navigation buttons
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        if st.button("🎯 Executive Showcase", key="nav_exec_showcase", use_container_width=True):
            st.session_state.selected_page = "00_WOW_Executive_Showcase"
            st.rerun()
        if st.button("👔 CEO Strategic", key="nav_ceo", use_container_width=True):
            st.session_state.selected_page = "01_CEO_Strategic"
            st.rerun()
        if st.button("💰 CFO Finance", key="nav_cfo", use_container_width=True):
            st.session_state.selected_page = "02_CFO_Finance"
            st.rerun()
            
    with col2:
        if st.button("📢 CMO Marketing", key="nav_cmo", use_container_width=True):
            st.session_state.selected_page = "03_CMO_Marketing"
            st.rerun()
        if st.button("🔧 CTO Technology", key="nav_cto", use_container_width=True):
            st.session_state.selected_page = "04_CTO_Technology"
            st.rerun()
        if st.button("⚙️ COO Operations", key="nav_coo", use_container_width=True):
            st.session_state.selected_page = "05_COO_Operations"
            st.rerun()
            
    with col3:
        if st.button("📈 CCO Commercial", key="nav_cco", use_container_width=True):
            st.session_state.selected_page = "06_CCO_Commercial"
            st.rerun()
        if st.button("😊 CXO Experience", key="nav_cxo", use_container_width=True):
            st.session_state.selected_page = "07_CXO_Customer_Experience"
            st.rerun()
        if st.button("📡 CNO Network", key="nav_cno", use_container_width=True):
            st.session_state.selected_page = "08_CNO_Network_QoE"
            st.rerun()
            
    with col4:
        if st.button("🤖 CDO Data Science", key="nav_cdo", use_container_width=True):
            st.session_state.selected_page = "09_CDO_Data_Science"
            st.rerun()
        if st.button("🌱 CSO Sustainability", key="nav_cso", use_container_width=True):
            st.session_state.selected_page = "10_CSO_Sustainability"
            st.rerun()
        if st.button("📊 Executive Summary", key="nav_exec_sum", use_container_width=True):
            st.session_state.selected_page = "Executive_Summary"
            st.rerun()

def render_executive_showcase():
    import pandas as pd
    import numpy as np
    import altair as alt
    
    # Executive Showcase Header with Spotlight Effect
    st.markdown("""
    <style>
    @keyframes showcase-spotlight {
        0% { transform: translateX(-100%) rotate(-30deg); }
        100% { transform: translateX(200%) rotate(-30deg); }
    }
    @keyframes showcase-glow { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.7; } }
    @keyframes showcase-star-twinkle { 0%, 100% { opacity: 0.2; transform: scale(1); } 50% { opacity: 1; transform: scale(1.3); } }
    .showcase-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .showcase-effects { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
    .showcase-spotlight { position: absolute; width: 150px; height: 300%; background: linear-gradient(90deg, transparent, rgba(41,181,232,0.15), transparent); animation: showcase-spotlight 4s ease-in-out infinite; }
    .showcase-glow { position: absolute; width: 200px; height: 200px; border-radius: 50%; background: radial-gradient(circle, rgba(41,181,232,0.3) 0%, transparent 70%); animation: showcase-glow 3s ease-in-out infinite; }
    .showcase-star { position: absolute; color: #29B5E8; font-size: 14px; animation: showcase-star-twinkle 2s ease-in-out infinite; text-shadow: 0 0 10px rgba(41,181,232,0.5); }
    .showcase-glow { position: absolute; width: 200px; height: 200px; border-radius: 50%; background: radial-gradient(circle, rgba(41,181,232,0.2) 0%, transparent 70%); animation: showcase-glow 3s ease-in-out infinite; }
    .showcase-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
        border: 1px solid #BAE6FD;
        padding: 2rem; color: #1B2A4E;
    }
    .showcase-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; color: #1B2A4E; }
    .showcase-header-content p { margin: 0.5rem 0 0 0; color: #64748B; font-size: 1.1rem; }
    </style>
    <div class="showcase-header-wrap">
        <div class="showcase-effects">
            <div class="showcase-spotlight"></div>
            <div class="showcase-glow" style="top: -50px; left: 10%;"></div>
            <div class="showcase-glow" style="top: -30px; right: 15%; animation-delay: 1.5s;"></div>
            <span class="showcase-star" style="top: 20%; left: 10%;">✦</span>
            <span class="showcase-star" style="top: 30%; left: 25%; animation-delay: 0.5s;">✦</span>
            <span class="showcase-star" style="top: 15%; right: 20%; animation-delay: 1s;">✦</span>
            <span class="showcase-star" style="top: 40%; right: 10%; animation-delay: 1.5s;">✦</span>
            <span class="showcase-star" style="bottom: 20%; left: 40%; animation-delay: 0.8s;">✦</span>
        </div>
        <div class="showcase-header-content">
            <h1>Executive Showcase</h1>
            <p>Board-Ready Intelligence Dashboard — Cross-Domain Analytics & Strategic Insights</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    show_sf_highlights = st.session_state.get("sf_highlights", True)
    if show_sf_highlights:
        st.markdown("""
        <style>
        .exec-sf-feature-banner {
            background: linear-gradient(135deg, #F0F9FF 0%, #ECFEFF 100%);
            border: 1px solid #BAE6FD;
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin: 0.5rem 0 1.5rem 0;
        }
        .exec-sf-feature-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1B2A4E;
            margin-bottom: 0.75rem;
        }
        .exec-sf-feature-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .exec-sf-feature-pill {
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 999px;
            padding: 0.35rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #1E40AF;
            box-shadow: 0 1px 4px rgba(15, 23, 42, 0.08);
        }
        </style>
        <div class="exec-sf-feature-banner">
            <div class="exec-sf-feature-title">❄️ Snowflake Features powering this showcase</div>
            <div class="exec-sf-feature-grid">
                <span class="exec-sf-feature-pill">Snowflake Intelligence</span>
                <span class="exec-sf-feature-pill">Cortex AI</span>
                <span class="exec-sf-feature-pill">Cortex Search</span>
                <span class="exec-sf-feature-pill">Semantic Models</span>
                <span class="exec-sf-feature-pill">Dynamic Tables</span>
                <span class="exec-sf-feature-pill">Snowpark</span>
                <span class="exec-sf-feature-pill">Horizon Governance</span>
            </div>
        </div>
        """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_market, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧭 Market & Customers", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        # REAL-TIME BUSINESS PULSE - Business-focused animation
        # CSS for the business pulse
        st.markdown("""
        <style>
        @keyframes pulse-ring {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(0.95); opacity: 1; }
        }
        @keyframes value-count {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes trend-arrow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        @keyframes metric-glow {
            0%, 100% { box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
            50% { box-shadow: 0 4px 20px rgba(41,181,232,0.25); }
        }
        @keyframes metric-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        @keyframes icon-bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-4px) scale(1.1); }
        }
        @keyframes value-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .business-pulse {
            background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #BFDBFE;
            position: relative;
            overflow: hidden;
        }
        .business-pulse::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(41,181,232,0.1), transparent);
            animation: shimmer-sweep 3s ease-in-out infinite;
        }
        @keyframes shimmer-sweep {
            0% { left: -100%; }
            100% { left: 200%; }
        }
        .pulse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
        }
        .pulse-title { color: #1B2A4E; font-size: 1.1rem; font-weight: 600; }
        .pulse-live { display: inline-flex; align-items: center; gap: 0.5rem; }
        @keyframes pulse-dot-ring { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(2.5); opacity: 0; } }
        .pulse-dot { 
            width: 10px; height: 10px; background: #10B981; border-radius: 50%; 
            animation: live-pulse 1.5s ease-in-out infinite; 
            position: relative;
        }
        .pulse-dot::after {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #10B981;
            border-radius: 50%;
            animation: pulse-dot-ring 1.5s ease-out infinite;
        }
        .pulse-period { color: #10B981; font-size: 0.8rem; font-weight: 500; }
        .pulse-metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            position: relative;
            z-index: 1;
        }
        .pulse-metric {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            border: 1px solid #E2E8F0;
            animation: metric-glow 3s ease-in-out infinite;
            transition: all 0.3s ease;
        }
        .pulse-metric:nth-child(1) { animation-delay: 0s; }
        .pulse-metric:nth-child(2) { animation-delay: 0.5s; }
        .pulse-metric:nth-child(3) { animation-delay: 1s; }
        .pulse-metric:nth-child(4) { animation-delay: 1.5s; }
        .pulse-metric:hover { transform: translateY(-4px); box-shadow: 0 8px 25px rgba(41,181,232,0.2); }
        .metric-icon { font-size: 1.5rem; margin-bottom: 0.5rem; animation: icon-bounce 2s ease-in-out infinite; display: inline-block; }
        .pulse-metric:nth-child(1) .metric-icon { animation-delay: 0s; }
        .pulse-metric:nth-child(2) .metric-icon { animation-delay: 0.3s; }
        .pulse-metric:nth-child(3) .metric-icon { animation-delay: 0.6s; }
        .pulse-metric:nth-child(4) .metric-icon { animation-delay: 0.9s; }
        @keyframes metric-number-pop {
            0% { opacity: 0; transform: scale(0.5) translateY(10px); }
            60% { transform: scale(1.1) translateY(-3px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        @keyframes metric-glow {
            0%, 100% { text-shadow: none; }
            50% { text-shadow: 0 0 15px currentColor; }
        }
        .metric-val { 
            font-size: 1.8rem; font-weight: 700; color: #1B2A4E; 
            animation: metric-number-pop 0.6s ease-out forwards, metric-glow 3s ease-in-out 0.6s infinite;
            opacity: 0;
        }
        .pulse-metric:nth-child(1) .metric-val { animation-delay: 0s, 0.6s; }
        .pulse-metric:nth-child(2) .metric-val { animation-delay: 0.15s, 0.75s; }
        .pulse-metric:nth-child(3) .metric-val { animation-delay: 0.3s, 0.9s; }
        .pulse-metric:nth-child(4) .metric-val { animation-delay: 0.45s, 1.05s; }
        .metric-val.revenue { color: #10B981; }
        .metric-val.customers { color: #29B5E8; }
        .metric-val.nps { color: #F59E0B; }
        .metric-val.growth { color: #8B5CF6; }
        .metric-name { font-size: 0.75rem; color: #64748B; text-transform: uppercase; letter-spacing: 0.05em; margin-top: 0.25rem; }
        .metric-trend { font-size: 0.8rem; margin-top: 0.5rem; display: flex; align-items: center; justify-content: center; gap: 0.25rem; }
        .metric-trend.up { color: #10B981; }
        .metric-trend.up span { animation: trend-arrow 1s ease-in-out infinite; display: inline-block; }
        .metric-trend.neutral { color: #64748B; }
        </style>
        """, unsafe_allow_html=True)
        
        # HTML content for the business pulse
        st.markdown("""<div class="business-pulse"><div class="pulse-header"><div class="pulse-live"><div class="pulse-dot"></div><span class="pulse-title">📊 Real-Time Business Pulse</span></div><div class="pulse-period">● Live</div></div><div class="pulse-metrics"><div class="pulse-metric"><div class="metric-icon">💰</div><div class="metric-val revenue">£7.4M</div><div class="metric-name">Monthly Revenue</div><div class="metric-trend up"><span>↑</span> +8.4% vs target</div></div><div class="pulse-metric"><div class="metric-icon">👥</div><div class="metric-val customers">30,247</div><div class="metric-name">Active Subscribers</div><div class="metric-trend up"><span>↑</span> +432 net adds</div></div><div class="pulse-metric"><div class="metric-icon">⭐</div><div class="metric-val nps">+47</div><div class="metric-name">NPS Score</div><div class="metric-trend up"><span>↑</span> +5 pts QoQ</div></div><div class="pulse-metric"><div class="metric-icon">📈</div><div class="metric-val growth">5.2%</div><div class="metric-name">Market Share</div><div class="metric-trend up"><span>↑</span> +0.4% YoY</div></div></div></div>""", unsafe_allow_html=True)
        
        # KPI Dashboard - Premium Card Design
        st.markdown('<div class="section-header">Business Health at a Glance</div>', unsafe_allow_html=True)
        
        # Custom KPI Cards with embedded mini charts
        st.markdown("""
        <style>
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        @keyframes kpi-card-glow {
            0%, 100% { box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
            50% { box-shadow: 0 4px 20px rgba(41,181,232,0.15); }
        }
        @keyframes kpi-accent-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: kpi-card-glow 3s ease-in-out infinite;
        }
        .kpi-card:nth-child(1) { animation-delay: 0s; }
        .kpi-card:nth-child(2) { animation-delay: 0.4s; }
        .kpi-card:nth-child(3) { animation-delay: 0.8s; }
        .kpi-card:nth-child(4) { animation-delay: 1.2s; }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 8px 25px rgba(41, 181, 232, 0.25) !important;
            transform: translateY(-4px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
            animation: kpi-accent-pulse 2s ease-in-out infinite;
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
            animation: kpi-value-pop 0.6s ease-out forwards;
            opacity: 0;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes kpi-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 0.25; } 
            50% { stroke-width: 4; opacity: 0.4; } 
        }
        @keyframes kpi-fill-pulse { 
            0%, 100% { opacity: 0.2; transform: scaleY(1); } 
            50% { opacity: 0.35; transform: scaleY(1.05); } 
        }
        @keyframes kpi-bar-wave { 
            0%, 100% { transform: scaleY(1); opacity: 0.25; } 
            50% { transform: scaleY(0.65); opacity: 0.4; } 
        }
        @keyframes kpi-value-pop { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 45px;
            opacity: 0.25;
        }
        .kpi-chart path[fill="none"] { animation: kpi-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: kpi-fill-pulse 2.5s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: kpi-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-card:nth-child(3) .kpi-chart rect:nth-child(1) { animation-delay: 0s; }
        .kpi-card:nth-child(3) .kpi-chart rect:nth-child(2) { animation-delay: 0.1s; }
        .kpi-card:nth-child(3) .kpi-chart rect:nth-child(3) { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart rect:nth-child(4) { animation-delay: 0.3s; }
        .kpi-card:nth-child(3) .kpi-chart rect:nth-child(5) { animation-delay: 0.4s; }
        .kpi-card:nth-child(3) .kpi-chart rect:nth-child(6) { animation-delay: 0.5s; }
        .kpi-card:nth-child(2) .kpi-value { animation-delay: 0.1s; }
        .kpi-card:nth-child(3) .kpi-value { animation-delay: 0.2s; }
        .kpi-card:nth-child(4) .kpi-value { animation-delay: 0.3s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">Total Subscribers</div>
                <div class="kpi-value">30,247</div>
                <div class="kpi-delta positive">↑ +5.2% QoQ</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,35 L15,32 L30,28 L45,25 L60,20 L75,15 L100,8" fill="none" stroke="#29B5E8" stroke-width="2"/>
                    <path d="M0,35 L15,32 L30,28 L45,25 L60,20 L75,15 L100,8 L100,40 L0,40 Z" fill="#29B5E8"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Quarterly Revenue</div>
                <div class="kpi-value">£13.2M</div>
                <div class="kpi-delta positive">↑ +8.4% YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,32 L15,30 L30,26 L45,28 L60,20 L75,14 L100,8" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,32 L15,30 L30,26 L45,28 L60,20 L75,14 L100,8 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">⭐</div>
                <div class="kpi-label">NPS Score</div>
                <div class="kpi-value">+47</div>
                <div class="kpi-delta positive">↑ +5 pts</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="28" width="10" height="12" fill="#8B5CF6"/>
                    <rect x="20" y="24" width="10" height="16" fill="#8B5CF6"/>
                    <rect x="35" y="26" width="10" height="14" fill="#8B5CF6"/>
                    <rect x="50" y="20" width="10" height="20" fill="#8B5CF6"/>
                    <rect x="65" y="16" width="10" height="24" fill="#8B5CF6"/>
                    <rect x="80" y="12" width="10" height="28" fill="#8B5CF6"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📉</div>
                <div class="kpi-label">Churn Rate</div>
                <div class="kpi-value">2.1%</div>
                <div class="kpi-delta positive">↓ -0.7%</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,8 L15,12 L30,16 L45,18 L60,22 L75,28 L100,32" fill="none" stroke="#F59E0B" stroke-width="2"/>
                    <path d="M0,8 L15,12 L30,16 L45,18 L60,22 L75,28 L100,32 L100,40 L0,40 Z" fill="#F59E0B"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #06B6D4;">
                <div class="kpi-icon">📡</div>
                <div class="kpi-label">Network Availability</div>
                <div class="kpi-value">99.7%</div>
                <div class="kpi-delta positive">↑ +0.2%</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">ARPU (Blended)</div>
                <div class="kpi-value">£43.62</div>
                <div class="kpi-delta positive">↑ +£2.10</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">💬</div>
                <div class="kpi-label">Support CSAT</div>
                <div class="kpi-value">4.2/5</div>
                <div class="kpi-delta positive">↑ +0.3</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">At-Risk Revenue</div>
                <div class="kpi-value">£2.4M</div>
                <div class="kpi-delta neutral">847 customers</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Executive Performance Signals</div>', unsafe_allow_html=True)
        exec_col1, exec_col2 = st.columns(2)
        
        with exec_col1:
            st.markdown("**Revenue Mix by Segment**")
            with st.container(border=True):
                seg_df = pd.DataFrame({
                    'Segment': ['Consumer', 'SMB', 'Enterprise', 'Wholesale'],
                    'Revenue': [4.8, 1.6, 1.2, 0.7]
                })
                seg_bar = alt.Chart(seg_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Revenue:Q', title='Revenue (£M)'),
                    y=alt.Y('Segment:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Segment:N', alt.Tooltip('Revenue:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(seg_bar, use_container_width=True)
        
        with exec_col2:
            st.markdown("**NPS vs Churn Risk**")
            with st.container(border=True):
                churn_df = pd.DataFrame({
                    'Segment': ['Premium', 'Standard', 'Budget', 'Enterprise'],
                    'NPS': [62, 47, 28, 55],
                    'Churn': [1.2, 1.8, 2.9, 1.1]
                })
                churn_scatter = alt.Chart(churn_df).mark_circle(size=120, color='#8B5CF6').encode(
                    x=alt.X('NPS:Q', title='NPS'),
                    y=alt.Y('Churn:Q', title='Churn %'),
                    tooltip=['Segment:N', 'NPS:Q', alt.Tooltip('Churn:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(churn_scatter, use_container_width=True)
        
        st.markdown('<div class="section-header">Revenue Bridge (YoY)</div>', unsafe_allow_html=True)
        with st.container(border=True):
            bridge_df = pd.DataFrame({
                'Driver': ['Base', 'Volume', 'Price', 'Mix', 'Churn', 'Discounts', 'Current'],
                'Impact': [13.2, 1.2, 0.6, 0.4, -0.5, -0.3, 14.6],
                'Type': ['Total', 'Up', 'Up', 'Up', 'Down', 'Down', 'Total']
            })
            bridge_df['Label'] = bridge_df['Impact'].apply(lambda v: f"{v:+.1f}M" if v != 13.2 and v != 14.6 else f"{v:.1f}M")
            bridge_bar = alt.Chart(bridge_df).mark_bar(cornerRadiusTopLeft=4, cornerRadiusTopRight=4).encode(
                x=alt.X('Driver:N', title=None),
                y=alt.Y('Impact:Q', title='£M'),
                color=alt.Color('Type:N', scale=alt.Scale(domain=['Up', 'Down', 'Total'], range=['#10B981', '#EF4444', '#3B82F6']), legend=None),
                tooltip=['Driver:N', alt.Tooltip('Impact:Q', format='.1f')]
            ).properties(height=200)
            bridge_text = alt.Chart(bridge_df).mark_text(dy=-8, fontSize=10, fontWeight='bold').encode(
                x='Driver:N',
                y='Impact:Q',
                text='Label:N',
                color=alt.value('#1B2A4E')
            )
            st.altair_chart(bridge_bar + bridge_text, use_container_width=True)

        st.markdown('<div class="section-header">ARPU & Plan Mix</div>', unsafe_allow_html=True)
        arpu_col, mix_col = st.columns(2)
        with arpu_col:
            st.markdown("**ARPU by Segment**")
            with st.container(border=True):
                arpu_df = pd.DataFrame({
                    'Segment': ['Enterprise', 'Premium', 'Standard', 'Budget'],
                    'ARPU': [142, 58, 38, 24]
                })
                arpu_bar = alt.Chart(arpu_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('ARPU:Q', title='ARPU (£)'),
                    y=alt.Y('Segment:N', sort='-x', title=None),
                    color=alt.value('#14B8A6'),
                    tooltip=['Segment:N', 'ARPU:Q']
                ).properties(height=200)
                st.altair_chart(arpu_bar, use_container_width=True)
        with mix_col:
            st.markdown("**Plan Mix by Type**")
            with st.container(border=True):
                plan_df = pd.DataFrame({
                    'Plan': ['Pay Monthly', 'SIM Only', 'Family', 'PAYG'],
                    'Share': [46, 28, 16, 10]
                })
                plan_bar = alt.Chart(plan_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Share:Q', title='Share %'),
                    y=alt.Y('Plan:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Plan:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=200)
                st.altair_chart(plan_bar, use_container_width=True)

        # Main Dashboard Section - Enhanced Visual Design
        col_left, col_right = st.columns([1.2, 1])
        
        with col_left:
            # Revenue by Customer Segment - Enhanced Donut with Labels
            st.markdown('<div class="section-header">Revenue Mix by Customer Segment</div>', unsafe_allow_html=True)
            
            revenue_data = pd.DataFrame({
                'Segment': ['Consumer', 'SMB', 'Enterprise'],
                'Revenue': [8.2, 3.4, 1.6],
                'Percentage': [62, 26, 12],
                'ARPU': [32, 58, 142],
                'Customers': [21173, 7874, 1200],
                'Growth': ['+4.2%', '+8.7%', '+15.3%']
            })
            
            with st.container(border=True):
                # Enhanced donut with center text
                donut = alt.Chart(revenue_data).mark_arc(innerRadius=70, outerRadius=110, cornerRadius=4).encode(
                    theta=alt.Theta('Revenue:Q', stack=True),
                    color=alt.Color('Segment:N', 
                        scale=alt.Scale(
                            domain=['Consumer', 'SMB', 'Enterprise'],
                            range=['#29B5E8', '#1B2A4E', '#10B981']
                        ),
                        legend=alt.Legend(orient='bottom', title=None, labelFontSize=11)
                    ),
                    tooltip=[
                        alt.Tooltip('Segment:N'),
                        alt.Tooltip('Revenue:Q', title='Revenue (£M)', format='.1f'),
                        alt.Tooltip('Percentage:Q', title='Share', format='d'),
                        alt.Tooltip('ARPU:Q', title='ARPU (£)', format='d'),
                        alt.Tooltip('Customers:Q', format=',')
                    ],
                    order=alt.Order('Revenue:Q', sort='descending')
                ).properties(height=260)
                
                # Center text
                center_text = alt.Chart(pd.DataFrame({'text': ['£13.2M'], 'subtext': ['Total Revenue']})).mark_text(
                    fontSize=24, fontWeight='bold', color='#1B2A4E'
                ).encode(text='text:N')
                
                center_subtext = alt.Chart(pd.DataFrame({'text': ['Total Revenue']})).mark_text(
                    fontSize=12, color='#6B7280', dy=20
                ).encode(text='text:N')
                
                st.altair_chart(donut + center_text + center_subtext, use_container_width=True)
                
                # Segment detail cards
                seg_cols = st.columns(3)
                segments_info = [
                    ('Consumer', '#29B5E8', '£8.2M', '62%', '£32', '+4.2%'),
                    ('SMB', '#1B2A4E', '£3.4M', '26%', '£58', '+8.7%'),
                    ('Enterprise', '#10B981', '£1.6M', '12%', '£142', '+15.3%')
                ]
                for i, (seg, color, rev, share, arpu, growth) in enumerate(segments_info):
                    with seg_cols[i]:
                        st.markdown(f"""
                        <div style="background: linear-gradient(135deg, {color}15 0%, {color}08 100%); border-left: 4px solid {color}; border-radius: 0 8px 8px 0; padding: 0.75rem;">
                            <div style="font-weight: 600; color: {color}; font-size: 0.9rem;">{seg}</div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #1B2A4E;">{rev}</div>
                            <div style="color: #6B7280; font-size: 0.75rem;">ARPU {arpu} · <span style="color: #10B981;">{growth}</span></div>
                        </div>
                        """, unsafe_allow_html=True)
            
        with col_right:
            # Customer Segments at Risk - Enhanced Lollipop Chart
            st.markdown('<div class="section-header">At-Risk Customer Analysis</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                risk_data = pd.DataFrame({
                    'Segment': ['Budget', 'Standard', 'Premium', 'VIP'],
                    'At Risk': [312, 289, 178, 68],
                    'Revenue at Risk': [187, 347, 534, 340],
                    'Avg Propensity': [0.78, 0.65, 0.52, 0.41]
                })
                
                # Lollipop chart - more impactful than basic bars
                lollipop_line = alt.Chart(risk_data).mark_rule(strokeWidth=3).encode(
                    x=alt.X('At Risk:Q', title='Customers at Risk', scale=alt.Scale(domain=[0, 350])),
                    x2=alt.value(0),
                    y=alt.Y('Segment:N', sort=['Budget', 'Standard', 'Premium', 'VIP'], title=None),
                    color=alt.Color('Avg Propensity:Q', scale=alt.Scale(scheme='orangered', domain=[0.4, 0.8]), legend=None)
                )
                
                lollipop_point = alt.Chart(risk_data).mark_circle(size=300).encode(
                    x=alt.X('At Risk:Q'),
                    y=alt.Y('Segment:N', sort=['Budget', 'Standard', 'Premium', 'VIP']),
                    color=alt.Color('Avg Propensity:Q', scale=alt.Scale(scheme='orangered', domain=[0.4, 0.8]), title='Churn Risk'),
                    tooltip=[
                        'Segment',
                        alt.Tooltip('At Risk:Q', title='Customers'),
                        alt.Tooltip('Revenue at Risk:Q', title='Revenue (£K)', format=',.0f'),
                        alt.Tooltip('Avg Propensity:Q', title='Risk Score', format='.0%')
                    ]
                )
                
                # Revenue labels on the right
                rev_labels = alt.Chart(risk_data).mark_text(align='left', dx=15, fontSize=11, fontWeight='bold').encode(
                    x=alt.X('At Risk:Q'),
                    y=alt.Y('Segment:N', sort=['Budget', 'Standard', 'Premium', 'VIP']),
                    text=alt.Text('Revenue at Risk:Q', format='£,.0fK'),
                    color=alt.value('#DC2626')
                )
                
                st.altair_chart((lollipop_line + lollipop_point + rev_labels).properties(height=180), use_container_width=True)
                
                st.markdown("""
                <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 8px; padding: 0.75rem; margin-top: 0.5rem; border-left: 4px solid #F59E0B;">
                    <div style="display: flex; align-items: center;">
                        <span style="font-size: 1.5rem; margin-right: 0.5rem;">⚠️</span>
                        <div>
                            <strong style="color: #92400E;">Urgent: 847 customers at risk</strong>
                            <div style="color: #B45309; font-size: 0.85rem;">£2.4M ARR exposed · Premium segment highest impact</div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            # Network Quality Impact - Enhanced Bubble Chart
            st.markdown('<div class="section-header">Network Quality vs NPS</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                cities = ['London', 'Manchester', 'Birmingham', 'Leeds', 'Glasgow', 'Liverpool', 'Bristol', 'Sheffield']
                network_nps = pd.DataFrame({
                    'City': cities,
                    'Network Score': [94, 91, 88, 86, 92, 85, 93, 84],
                    'NPS': [52, 48, 41, 38, 49, 36, 51, 35],
                    'Subscribers': [8500, 4200, 3800, 2900, 2600, 2400, 2100, 1800],
                    'Status': ['Strong', 'Good', 'At Risk', 'At Risk', 'Good', 'Critical', 'Strong', 'Critical']
                })
                
                scatter = alt.Chart(network_nps).mark_circle(opacity=0.8).encode(
                    x=alt.X('Network Score:Q', scale=alt.Scale(domain=[82, 96]), title='Network Quality', axis=alt.Axis(grid=True)),
                    y=alt.Y('NPS:Q', scale=alt.Scale(domain=[32, 56]), title='NPS Score', axis=alt.Axis(grid=True)),
                    size=alt.Size('Subscribers:Q', scale=alt.Scale(range=[200, 1500]), legend=None),
                    color=alt.Color('Status:N', scale=alt.Scale(
                        domain=['Critical', 'At Risk', 'Good', 'Strong'],
                        range=['#DC2626', '#F59E0B', '#29B5E8', '#10B981']
                    ), legend=alt.Legend(orient='top', title=None)),
                    tooltip=['City', 'Network Score', 'NPS', alt.Tooltip('Subscribers:Q', format=',')]
                )
                
                # City labels
                labels = alt.Chart(network_nps).mark_text(dy=-15, fontSize=10, fontWeight='bold').encode(
                    x='Network Score:Q',
                    y='NPS:Q',
                    text='City:N',
                    color=alt.value('#1B2A4E')
                )
                
                regression = scatter.transform_regression('Network Score', 'NPS').mark_line(
                    color='#1B2A4E', strokeWidth=2, strokeDash=[6, 4], opacity=0.6
                )
                
                st.altair_chart((scatter + labels + regression).properties(height=220), use_container_width=True)
                
                # Insight badges
                st.markdown("""
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <span style="background: #D1FAE5; color: #065F46; padding: 0.25rem 0.6rem; border-radius: 20px; font-size: 0.75rem; font-weight: 500;">R² = 0.89 Strong Correlation</span>
                    <span style="background: #FEE2E2; color: #991B1B; padding: 0.25rem 0.6rem; border-radius: 20px; font-size: 0.75rem; font-weight: 500;">Sheffield, Liverpool need attention</span>
                </div>
                """, unsafe_allow_html=True)
        
        # Churn Risk Correlation - Compact Heatmap
        st.markdown('<div class="section-header">Churn Risk Correlation Matrix</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            factors = ['NPS', 'Support', 'Bill Amt', 'Network', 'Tenure', 'Contract']
            correlation_matrix = pd.DataFrame({
                'Factor': factors * 6,
                'Correlated With': [f for f in factors for _ in range(6)],
                'Correlation': [
                    1.0, -0.72, 0.15, -0.68, 0.45, 0.38,
                    -0.72, 1.0, 0.22, 0.65, -0.31, -0.28,
                    0.15, 0.22, 1.0, 0.08, 0.52, 0.61,
                    -0.68, 0.65, 0.08, 1.0, -0.25, -0.19,
                    0.45, -0.31, 0.52, -0.25, 1.0, 0.72,
                    0.38, -0.28, 0.61, -0.19, 0.72, 1.0
                ]
            })
            
            heatmap = alt.Chart(correlation_matrix).mark_rect(cornerRadius=3).encode(
                x=alt.X('Factor:N', title=None, sort=factors, axis=alt.Axis(labelAngle=-45)),
                y=alt.Y('Correlated With:N', title=None, sort=factors),
                color=alt.Color('Correlation:Q', 
                    scale=alt.Scale(scheme='redblue', domain=[-1, 1]),
                    legend=alt.Legend(orient='right', title='r', gradientLength=100)
                ),
                tooltip=['Factor', 'Correlated With', alt.Tooltip('Correlation:Q', format='.2f')]
            ).properties(height=220)
            
            # Add correlation values as text
            correlation_matrix['TextColor'] = correlation_matrix['Correlation'].apply(
                lambda x: 'white' if abs(x) > 0.5 else '#1B2A4E'
            )
            text = alt.Chart(correlation_matrix).mark_text(fontSize=9, fontWeight='bold').encode(
                x=alt.X('Factor:N', sort=factors),
                y=alt.Y('Correlated With:N', sort=factors),
                text=alt.Text('Correlation:Q', format='.1f'),
                color=alt.Color('TextColor:N', scale=None)
            )
            
            st.altair_chart(heatmap + text, use_container_width=True)
            
            st.markdown("""
            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                <div style="flex: 1; background: #FEE2E2; border-radius: 8px; padding: 0.5rem; text-align: center;">
                    <div style="font-weight: 700; color: #DC2626; font-size: 1.1rem;">-0.72</div>
                    <div style="font-size: 0.7rem; color: #991B1B;">NPS ↔ Support Calls</div>
                </div>
                <div style="flex: 1; background: #FEE2E2; border-radius: 8px; padding: 0.5rem; text-align: center;">
                    <div style="font-weight: 700; color: #DC2626; font-size: 1.1rem;">-0.68</div>
                    <div style="font-size: 0.7rem; color: #991B1B;">NPS ↔ Network Issues</div>
                </div>
                <div style="flex: 1; background: #D1FAE5; border-radius: 8px; padding: 0.5rem; text-align: center;">
                    <div style="font-weight: 700; color: #059669; font-size: 1.1rem;">+0.72</div>
                    <div style="font-size: 0.7rem; color: #065F46;">Tenure ↔ Contract</div>
                </div>
            </div>
            """, unsafe_allow_html=True)
        
        # Competitive & Market Analysis
        st.markdown('<div class="section-header">Competitive Intelligence & Market Position</div>', unsafe_allow_html=True)
        
        col1, col2 = st.columns(2)
        
        with col1:
            with st.container(border=True):
                st.markdown("**Port-In/Port-Out Analysis** <span style='color: #6B7280; font-size: 0.8rem;'>(Last 90 Days)</span>", unsafe_allow_html=True)
                
                porting_data = pd.DataFrame({
                    'Competitor': ['Three', 'Vodafone', 'EE', 'O2', 'Virgin', 'Sky'],
                    'Port-In': [312, 245, 189, 156, 134, 98],
                    'Port-Out': [145, 178, 234, 189, 89, 67],
                    'Net': [167, 67, -45, -33, 45, 31]
                })
                
                # Butterfly/diverging bar chart
                port_in = alt.Chart(porting_data).mark_bar(color='#10B981', cornerRadiusTopRight=4, cornerRadiusBottomRight=4).encode(
                    x=alt.X('Port-In:Q', title='Port-In', scale=alt.Scale(domain=[0, 350])),
                    y=alt.Y('Competitor:N', sort=list(porting_data['Competitor']), title=None, axis=alt.Axis(labels=False)),
                    tooltip=[alt.Tooltip('Competitor'), alt.Tooltip('Port-In:Q', title='Gained')]
                ).properties(height=220, width=240)
                
                port_out = alt.Chart(porting_data).mark_bar(color='#EF4444', cornerRadiusTopLeft=4, cornerRadiusBottomLeft=4).encode(
                    x=alt.X('Port-Out:Q', title='Port-Out', scale=alt.Scale(domain=[0, 350], reverse=True)),
                    y=alt.Y('Competitor:N', sort=list(porting_data['Competitor']), axis=alt.Axis(labels=True, title=None)),
                    tooltip=[alt.Tooltip('Competitor'), alt.Tooltip('Port-Out:Q', title='Lost')]
                ).properties(height=220, width=240)
                
                combined = alt.hconcat(port_out, port_in).resolve_scale(y='shared')
                st.altair_chart(combined)
                
                st.markdown("""
                <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                    <span style="background: #D1FAE5; color: #065F46; padding: 0.3rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">Net: +432 customers</span>
                    <span style="background: #DBEAFE; color: #1E40AF; padding: 0.3rem 0.75rem; border-radius: 20px; font-size: 0.8rem;">Three: +167 | EE: -45</span>
                </div>
                """, unsafe_allow_html=True)
        
        with col2:
            with st.container(border=True):
                st.markdown("**UK Mobile Market Share**", unsafe_allow_html=True)
                
                market_data = pd.DataFrame({
                    'Carrier': ['EE', 'O2', 'Vodafone', 'Three', 'SnowTelco', 'Others'],
                    'Share': [28, 26, 22, 14, 5, 5],
                    'Trend': ['→', '↓', '→', '↓', '↑', '→']
                })
                
                # Stacked bar for market share
                market_bar = alt.Chart(market_data).mark_bar(cornerRadius=4).encode(
                    x=alt.X('Share:Q', stack='normalize', title=None, axis=alt.Axis(format='%', labelAngle=0)),
                    color=alt.Color('Carrier:N', 
                        scale=alt.Scale(
                            domain=['EE', 'O2', 'Vodafone', 'Three', 'SnowTelco', 'Others'],
                            range=['#6366F1', '#3B82F6', '#EF4444', '#F59E0B', '#29B5E8', '#9CA3AF']
                        ),
                        legend=None
                    ),
                    order=alt.Order('Share:Q', sort='descending'),
                    tooltip=['Carrier', alt.Tooltip('Share:Q', title='Market Share', format='d%'), 'Trend']
                ).properties(height=50)
                
                st.altair_chart(market_bar, use_container_width=True)
                
                # Legend with trends
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 0.75rem;">
                    <div style="display: flex; align-items: center; gap: 0.3rem;">
                        <div style="width: 12px; height: 12px; background: #6366F1; border-radius: 2px;"></div>
                        <span style="font-size: 0.8rem; color: #1B2A4E;">EE 28% →</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.3rem;">
                        <div style="width: 12px; height: 12px; background: #3B82F6; border-radius: 2px;"></div>
                        <span style="font-size: 0.8rem; color: #1B2A4E;">O2 26% <span style="color: #DC2626;">↓</span></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.3rem;">
                        <div style="width: 12px; height: 12px; background: #EF4444; border-radius: 2px;"></div>
                        <span style="font-size: 0.8rem; color: #1B2A4E;">Vodafone 22% →</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.3rem;">
                        <div style="width: 12px; height: 12px; background: #F59E0B; border-radius: 2px;"></div>
                        <span style="font-size: 0.8rem; color: #1B2A4E;">Three 14% <span style="color: #DC2626;">↓</span></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.3rem;">
                        <div style="width: 12px; height: 12px; background: #29B5E8; border-radius: 2px;"></div>
                        <span style="font-size: 0.8rem; color: #1B2A4E; font-weight: 600;">SnowTelco 5% <span style="color: #10B981;">↑</span></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.3rem;">
                        <div style="width: 12px; height: 12px; background: #9CA3AF; border-radius: 2px;"></div>
                        <span style="font-size: 0.8rem; color: #1B2A4E;">Others 5%</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
                
                st.markdown("""
                <div style="background: linear-gradient(135deg, #29B5E815 0%, #29B5E805 100%); border-left: 4px solid #29B5E8; border-radius: 0 8px 8px 0; padding: 0.75rem; margin-top: 0.75rem;">
                    <strong style="color: #1B2A4E;">Target: 7% by 2027</strong>
                    <div style="color: #6B7280; font-size: 0.85rem;">+2% growth opportunity • £15M incremental revenue</div>
                </div>
                """, unsafe_allow_html=True)
        
        # Regional Performance Map
        st.markdown('<div class="section-header">Regional Performance Overview</div>', unsafe_allow_html=True)
        
        col_map, col_data = st.columns([1.2, 1])
        
        with col_map:
            with st.container(border=True):
                # UK regions with coordinates and metrics
                uk_locations = pd.DataFrame({
                    'Region': ['London', 'South East', 'Midlands', 'North West', 'Scotland', 'South West', 'Yorkshire', 'Wales', 'North East', 'East'],
                    'lat': [51.5074, 51.2802, 52.4862, 53.4808, 55.9533, 51.4545, 53.8008, 52.1307, 54.9783, 52.2053],
                    'lon': [-0.1278, -0.5217, -1.8904, -2.2426, -3.1883, -2.5879, -1.5491, -3.7837, -1.6178, 0.1218],
                    'Subscribers': [8500, 4800, 4200, 3900, 2600, 2400, 2100, 1800, 1200, 847],
                    'NPS': [52, 48, 41, 46, 49, 51, 38, 44, 42, 45],
                    'Revenue': [3.8, 2.1, 1.9, 1.7, 1.2, 1.1, 0.9, 0.8, 0.5, 0.4],
                    'Network': [94, 92, 88, 91, 92, 93, 86, 89, 87, 90]
                })
                
                # Create color column based on NPS (hex format)
                def nps_to_color(nps):
                    # NPS range 35-55, map to red-green gradient
                    ratio = min(max((nps - 35) / 20, 0), 1)
                    r = int(255 * (1 - ratio))
                    g = int(200 * ratio)
                    return f'#{r:02x}{g:02x}64'
                
                uk_locations['color'] = uk_locations['NPS'].apply(nps_to_color)
                # Make bubbles bigger - multiply by 5 for more visibility
                uk_locations['size'] = uk_locations['Subscribers'] * 5
                
                # Animated legend showing live status
                st.markdown("""
                <style>
                @keyframes legend-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
                .map-legend { display: flex; justify-content: center; gap: 1.5rem; margin-bottom: 0.8rem; }
                .legend-item { display: flex; align-items: center; gap: 0.4rem; font-size: 0.8rem; }
                .legend-dot { width: 14px; height: 14px; border-radius: 50%; }
                .legend-dot.pulse { animation: legend-pulse 1.5s ease-in-out infinite; }
                .legend-dot.red { background: #DC2626; }
                .legend-dot.yellow { background: #F59E0B; }
                .legend-dot.green { background: #10B981; }
                </style>
                <div class="map-legend">
                    <div class="legend-item"><div class="legend-dot red pulse"></div><span>Low NPS (&lt;42)</span></div>
                    <div class="legend-item"><div class="legend-dot yellow pulse" style="animation-delay: 0.3s;"></div><span>Medium (42-48)</span></div>
                    <div class="legend-item"><div class="legend-dot green pulse" style="animation-delay: 0.6s;"></div><span>High NPS (&gt;48)</span></div>
                </div>
                """, unsafe_allow_html=True)
                
                st.map(
                    uk_locations,
                    latitude='lat',
                    longitude='lon',
                    size='size',
                    color='color',
                    zoom=5,
                    use_container_width=True
                )
                st.caption("Bubble size = Subscribers | Color = NPS (green=high, red=low)")
        
        with col_data:
            with st.container(border=True):
                regions = pd.DataFrame({
                    'Region': ['London', 'South East', 'Midlands', 'North West', 'Scotland', 'South West', 'Yorkshire', 'Wales', 'North East', 'East'],
                    'Subscribers': [8500, 4800, 4200, 3900, 2600, 2400, 2100, 1800, 1200, 847],
                    'NPS': [52, 48, 41, 46, 49, 51, 38, 44, 42, 45],
                    'Revenue': [3.8, 2.1, 1.9, 1.7, 1.2, 1.1, 0.9, 0.8, 0.5, 0.4],
                    'Network Score': [94, 92, 88, 91, 92, 93, 86, 89, 87, 90]
                })
                
                st.dataframe(
                    regions,
                    column_config={
                        "Region": st.column_config.TextColumn("Region", pinned=True),
                        "Subscribers": st.column_config.NumberColumn("Subs", format="%d"),
                        "NPS": st.column_config.ProgressColumn("NPS", min_value=0, max_value=70, format="%d"),
                        "Revenue": st.column_config.NumberColumn("Rev (£M)", format="£%.1f"),
                        "Network Score": st.column_config.ProgressColumn("Net", min_value=80, max_value=100, format="%d%%")
                    },
                    hide_index=True,
                    use_container_width=True,
                    height=320
                )
            
            col_perf1, col_perf2 = st.columns(2)
            with col_perf1:
                st.markdown("""
                <div style="background: #D1FAE5; border-radius: 8px; padding: 0.75rem;">
                    <strong style="color: #065F46; font-size: 0.85rem;">Top Performers</strong>
                    <ul style="margin: 0.3rem 0 0 0.8rem; padding: 0; color: #065F46; font-size: 0.8rem;">
                        <li>London: £3.8M rev</li>
                        <li>South West: NPS 51</li>
                        <li>London: 94% network</li>
                    </ul>
                </div>
                """, unsafe_allow_html=True)
            
            with col_perf2:
                st.markdown("""
                <div style="background: #FEE2E2; border-radius: 8px; padding: 0.75rem;">
                    <strong style="color: #991B1B; font-size: 0.85rem;">Needs Attention</strong>
                    <ul style="margin: 0.3rem 0 0 0.8rem; padding: 0; color: #991B1B; font-size: 0.8rem;">
                        <li>Yorkshire: NPS 38</li>
                        <li>Yorkshire: 86% net</li>
                        <li>Wales: Slow growth</li>
                    </ul>
                </div>
                """, unsafe_allow_html=True)
        
        # Board Presentation Summary
        st.markdown('<div class="section-header">Board Presentation Summary</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            st.markdown("""
            <div style="background: #F8FAFC; border-radius: 12px; padding: 1.5rem; border: 1px solid #E2E8F0;">
                <h3 style="color: #1B2A4E; margin-top: 0;">Executive Summary — Q4 2025</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div>
                        <strong style="color: #29B5E8;">1. Business Performance</strong>
                        <p style="margin: 0.25rem 0 0.75rem 0; opacity: 0.9;">Revenue +8.4% YoY (£13.2M), subscriber base grew 5.2% to 30,247. Enterprise ARPU at £142 driving margin expansion.</p>
                    </div>
                    <div>
                        <strong style="color: #29B5E8;">2. Customer Health</strong>
                        <p style="margin: 0.25rem 0 0.75rem 0; opacity: 0.9;">NPS improved to +47 (+5 pts). Churn reduced to 2.1%. 847 customers (£2.4M) remain at-risk requiring intervention.</p>
                    </div>
                    <div>
                        <strong style="color: #29B5E8;">3. Competitive Position</strong>
                        <p style="margin: 0.25rem 0 0.75rem 0; opacity: 0.9;">Net port-in positive (+432). Gaining share from Three. Market share at 5%, on track for 7% target by 2027.</p>
                    </div>
                    <div>
                        <strong style="color: #29B5E8;">4. Network Quality</strong>
                        <p style="margin: 0.25rem 0 0.75rem 0; opacity: 0.9;">99.7% availability. Strong NPS-network correlation (R²=0.89). Yorkshire requires infrastructure investment.</p>
                    </div>
                    <div>
                        <strong style="color: #29B5E8;">5. Strategic Priorities</strong>
                        <p style="margin: 0.25rem 0 0 0; opacity: 0.9;">① Launch retention campaign (save £1.2M) ② Accelerate 5G rollout ③ Scale enterprise sales ④ Target Three defectors</p>
                    </div>
                </div>
            </div>
            """, unsafe_allow_html=True)
        
        # Interactive Agent Section

    with tab_market:
        st.markdown("""
        <style>
        @keyframes exec-market-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 24px rgba(59,130,246,0.4); }
        }
        @keyframes exec-market-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .exec-market-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: exec-market-glow 3s ease-in-out infinite;
        }
        .exec-market-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: exec-market-sweep 3s linear infinite;
        }
        .exec-market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .exec-market-title { font-weight: 700; color: #1E3A8A; }
        .exec-market-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .exec-market-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .exec-market-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .exec-market-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .exec-market-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .exec-market-delta { font-size: 0.75rem; color: #1E40AF; }
        @media (max-width: 900px) { .exec-market-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="exec-market-pulse">
            <div class="exec-market-header">
                <div class="exec-market-title">🧭 Market & Customer Pulse</div>
                <div class="exec-market-tag">LIVE</div>
            </div>
            <div class="exec-market-grid">
                <div class="exec-market-card">
                    <div class="exec-market-label">Net Port-Ins</div>
                    <div class="exec-market-value">+432</div>
                    <div class="exec-market-delta">MTD</div>
                </div>
                <div class="exec-market-card">
                    <div class="exec-market-label">Churn Risk</div>
                    <div class="exec-market-value">2.1%</div>
                    <div class="exec-market-delta">-0.2% QoQ</div>
                </div>
                <div class="exec-market-card">
                    <div class="exec-market-label">5G Adoption</div>
                    <div class="exec-market-value">42%</div>
                    <div class="exec-market-delta">+8% QoQ</div>
                </div>
                <div class="exec-market-card">
                    <div class="exec-market-label">ARPU</div>
                    <div class="exec-market-value">£43.6</div>
                    <div class="exec-market-delta">+£2.1 MoM</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['MOBILE', 'PORTING', 'MARKET_INTELLIGENCE', 'CUSTOMER_EXPERIENCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        
        st.markdown('<div class="section-header">Market Position</div>', unsafe_allow_html=True)
        pos_left, pos_right = st.columns([1.2, 1])
        with pos_left:
            st.markdown('<div class="section-header">UK Regional Performance</div>', unsafe_allow_html=True)
            with st.container(border=True):
                region_data = pd.DataFrame({
                    'Region': ['London', 'South East', 'South West', 'Midlands', 'North West', 'North East', 'Yorkshire', 'Scotland', 'Wales', 'East'],
                    'Market Share': [6.2, 5.8, 5.5, 4.8, 5.1, 4.2, 3.9, 4.5, 4.1, 5.3],
                    'Subscribers': [6240, 4820, 3150, 4100, 3890, 2340, 2180, 1520, 980, 3027],
                    'NPS': [52, 48, 51, 45, 44, 41, 38, 46, 43, 47],
                    'Growth': ['+8.2%', '+6.1%', '+7.3%', '+5.2%', '+4.8%', '+3.1%', '+2.4%', '+5.5%', '+4.2%', '+6.8%']
                })
                bars = alt.Chart(region_data).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Market Share:Q', title='Market Share (%)', scale=alt.Scale(domain=[0, 8])),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.Color('Market Share:Q', scale=alt.Scale(scheme='blues'), legend=None),
                    tooltip=[
                        alt.Tooltip('Region:N'),
                        alt.Tooltip('Market Share:Q', title='Share', format='.1f'),
                        alt.Tooltip('Subscribers:Q', title='Subscribers', format=','),
                        alt.Tooltip('NPS:Q', title='NPS'),
                        alt.Tooltip('Growth:N', title='YoY Growth')
                    ]
                ).properties(height=260)
                text = alt.Chart(region_data).mark_text(align='left', dx=5, fontSize=11, fontWeight='bold').encode(
                    x=alt.X('Market Share:Q'),
                    y=alt.Y('Region:N', sort='-x'),
                    text=alt.Text('Market Share:Q', format='.1f'),
                    color=alt.value('#1B2A4E')
                )
                st.altair_chart(bars + text, use_container_width=True)
        
        with pos_right:
            st.markdown('<div class="section-header">Competitive Share</div>', unsafe_allow_html=True)
            with st.container(border=True):
                competitor_data = pd.DataFrame({
                    'Competitor': ['EE', 'O2', 'Vodafone', 'Three', 'SnowTelco', 'Others'],
                    'Market Share': [28, 26, 22, 14, 5, 5]
                })
                donut = alt.Chart(competitor_data).mark_arc(innerRadius=55, outerRadius=95, cornerRadius=3).encode(
                    theta=alt.Theta('Market Share:Q', stack=True),
                    color=alt.Color('Competitor:N',
                        scale=alt.Scale(
                            domain=['EE', 'O2', 'Vodafone', 'Three', 'SnowTelco', 'Others'],
                            range=['#8B5CF6', '#3B82F6', '#EF4444', '#F59E0B', '#29B5E8', '#9CA3AF']
                        ),
                        legend=None
                    ),
                    tooltip=[alt.Tooltip('Competitor:N'), alt.Tooltip('Market Share:Q', format='d', title='Share %')]
                ).properties(height=220)
                st.altair_chart(donut, use_container_width=True)
                st.markdown("""
                <div style="font-size: 0.8rem; color: #6B7280; text-align: center;">
                    SnowTelco gaining share vs Three and O2
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Competitive Dynamics</div>', unsafe_allow_html=True)
        with st.container(border=True):
            st.markdown("""
            <style>
            @keyframes benchmark-fill {
                0% { width: 0%; }
                100% { width: var(--fill-width); }
            }
            .benchmark-row { display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid #F3F4F6; }
            .benchmark-row:last-child { border-bottom: none; }
            .benchmark-label { width: 100px; font-size: 0.8rem; color: #6B7280; font-weight: 500; }
            .benchmark-bars { flex: 1; display: flex; flex-direction: column; gap: 4px; }
            .benchmark-bar-container { display: flex; align-items: center; gap: 8px; }
            .benchmark-bar-bg { flex: 1; height: 12px; background: #F3F4F6; border-radius: 6px; overflow: hidden; }
            .benchmark-bar { height: 100%; border-radius: 6px; animation: benchmark-fill 1.5s ease-out forwards; }
            .benchmark-bar.snowtelco { background: linear-gradient(90deg, #29B5E8, #1A8BC4); }
            .benchmark-bar.industry { background: #D1D5DB; }
            .benchmark-value { font-size: 0.75rem; font-weight: 600; min-width: 45px; text-align: right; }
            .benchmark-legend { display: flex; gap: 1.5rem; margin-bottom: 0.75rem; font-size: 0.75rem; }
            .legend-item { display: flex; align-items: center; gap: 6px; }
            .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
            .better-badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 10px; background: #D1FAE5; color: #059669; font-weight: 600; margin-left: 4px; }
            </style>
            <div class="benchmark-legend">
                <div class="legend-item"><div class="legend-dot" style="background: linear-gradient(90deg, #29B5E8, #1A8BC4);"></div><span style="font-weight: 600; color: #1B2A4E;">SnowTelco</span></div>
                <div class="legend-item"><div class="legend-dot" style="background: #D1D5DB;"></div><span style="color: #6B7280;">Industry Avg</span></div>
            </div>
            <div class="benchmark-row">
                <div class="benchmark-label">NPS Score</div>
                <div class="benchmark-bars">
                    <div class="benchmark-bar-container">
                        <div class="benchmark-bar-bg"><div class="benchmark-bar snowtelco" style="--fill-width: 72%;"></div></div>
                        <div class="benchmark-value" style="color: #29B5E8;">72<span class="better-badge">+17</span></div>
                    </div>
                    <div class="benchmark-bar-container">
                        <div class="benchmark-bar-bg"><div class="benchmark-bar industry" style="--fill-width: 55%;"></div></div>
                        <div class="benchmark-value" style="color: #9CA3AF;">55</div>
                    </div>
                </div>
            </div>
            <div class="benchmark-row">
                <div class="benchmark-label">Churn Rate</div>
                <div class="benchmark-bars">
                    <div class="benchmark-bar-container">
                        <div class="benchmark-bar-bg"><div class="benchmark-bar snowtelco" style="--fill-width: 21%;"></div></div>
                        <div class="benchmark-value" style="color: #29B5E8;">2.1%<span class="better-badge">Better</span></div>
                    </div>
                    <div class="benchmark-bar-container">
                        <div class="benchmark-bar-bg"><div class="benchmark-bar industry" style="--fill-width: 28%;"></div></div>
                        <div class="benchmark-value" style="color: #9CA3AF;">2.8%</div>
                    </div>
                </div>
            </div>
            <div class="benchmark-row">
                <div class="benchmark-label">ARPU</div>
                <div class="benchmark-bars">
                    <div class="benchmark-bar-container">
                        <div class="benchmark-bar-bg"><div class="benchmark-bar snowtelco" style="--fill-width: 78%;"></div></div>
                        <div class="benchmark-value" style="color: #29B5E8;">£38<span class="better-badge">+£6</span></div>
                    </div>
                    <div class="benchmark-bar-container">
                        <div class="benchmark-bar-bg"><div class="benchmark-bar industry" style="--fill-width: 64%;"></div></div>
                        <div class="benchmark-value" style="color: #9CA3AF;">£32</div>
                    </div>
                </div>
            </div>
            """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Regional Performance Heatmap</div>', unsafe_allow_html=True)
        with st.container(border=True):
            heat_df = pd.DataFrame({
                'Region': ['London', 'South East', 'South West', 'Midlands', 'North West', 'North East', 'Yorkshire', 'Scotland', 'Wales', 'East'],
                'Market Share': [6.2, 5.8, 5.5, 4.8, 5.1, 4.2, 3.9, 4.5, 4.1, 5.3],
                'NPS': [52, 48, 51, 45, 44, 41, 38, 46, 43, 47],
                'Growth': [8.2, 6.1, 7.3, 5.2, 4.8, 3.1, 2.4, 5.5, 4.2, 6.8]
            })
            heat_long = heat_df.melt('Region', var_name='Metric', value_name='Value')
            heat = alt.Chart(heat_long).mark_rect().encode(
                x=alt.X('Metric:N', title=None),
                y=alt.Y('Region:N', sort='-x', title=None),
                color=alt.Color('Value:Q', scale=alt.Scale(scheme='blues')),
                tooltip=['Region:N', 'Metric:N', alt.Tooltip('Value:Q', format='.1f')]
            ).properties(height=260)
            st.altair_chart(heat, use_container_width=True)

        st.markdown('<div class="section-header">Competitive Porting Analysis</div>', unsafe_allow_html=True)
        with st.container(border=True):
            porting_data = pd.DataFrame({
                'Competitor': ['Three', 'Vodafone', 'EE', 'O2', 'Virgin', 'Sky'],
                'Port-In': [245, 156, 98, 112, 67, 45],
                'Port-Out': [78, 123, 143, 87, 42, 38]
            })
            porting_long = porting_data.melt('Competitor', var_name='Flow', value_name='Count')
            porting_long['Count'] = porting_long.apply(
                lambda row: row['Count'] if row['Flow'] == 'Port-In' else -row['Count'], axis=1
            )
            porting_long['Abs'] = porting_long['Count'].abs()
            porting_chart = alt.Chart(porting_long).mark_bar(cornerRadius=4).encode(
                x=alt.X('Count:Q', title='Net Porting', scale=alt.Scale(domain=[-260, 260])),
                y=alt.Y('Competitor:N', sort=list(porting_data['Competitor']), title=None),
                color=alt.Color('Flow:N', scale=alt.Scale(range=['#10B981', '#EF4444']), legend=alt.Legend(orient='bottom', title=None)),
                tooltip=['Competitor:N', 'Flow:N', alt.Tooltip('Abs:Q', title='Customers')]
            ).properties(height=240)
            zero_rule = alt.Chart(pd.DataFrame({'x': [0]})).mark_rule(color='#CBD5F5').encode(x='x:Q')
            st.altair_chart(porting_chart + zero_rule, use_container_width=True)
            col_p1, col_p2 = st.columns(2)
            with col_p1:
                st.markdown("""
                <div style="background: #D1FAE5; border-radius: 20px; padding: 0.5rem 1rem; text-align: center;">
                    <span style="color: #065F46; font-weight: 600;">Net: +432 customers</span>
                </div>
                """, unsafe_allow_html=True)
            with col_p2:
                st.markdown("""
                <div style="background: #E0F2FE; border-radius: 20px; padding: 0.5rem 1rem; text-align: center;">
                    <span style="color: #0369A1; font-weight: 600;">Three: +167 | EE: -45</span>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Customer Health & Value</div>', unsafe_allow_html=True)
        cust_left, cust_right = st.columns(2)
        with cust_left:
            st.markdown('<div class="section-header">NPS by Segment</div>', unsafe_allow_html=True)
            with st.container(border=True):
                nps_data = pd.DataFrame({
                    'Segment': ['Enterprise', 'SMB', 'Premium', 'Standard', 'Budget'],
                    'NPS': [62, 51, 48, 42, 35]
                })
                nps_bars = alt.Chart(nps_data).mark_bar(cornerRadiusEnd=6, color='#29B5E8').encode(
                    y=alt.Y('Segment:N', sort='-x', title=None),
                    x=alt.X('NPS:Q', title='NPS Score', scale=alt.Scale(domain=[0, 70])),
                    tooltip=['Segment:N', 'NPS:Q']
                ).properties(height=220)
                st.altair_chart(nps_bars, use_container_width=True)
        
        with cust_right:
            st.markdown('<div class="section-header">Churn Risk by Segment</div>', unsafe_allow_html=True)
            with st.container(border=True):
                churn_data = pd.DataFrame({
                    'Segment': ['Enterprise', 'SMB', 'Premium', 'Standard', 'Budget'],
                    'Churn Rate': [0.8, 1.4, 1.6, 2.1, 3.2],
                    'At Risk': [10, 110, 83, 220, 175],
                    'Revenue Impact': [14.2, 63.8, 37.4, 70.4, 38.5]
                })
                churn_bars = alt.Chart(churn_data).mark_bar(
                    cornerRadiusTopRight=6, cornerRadiusBottomRight=6
                ).encode(
                    x=alt.X('Churn Rate:Q', title='Churn Rate (%)', scale=alt.Scale(domain=[0, 4])),
                    y=alt.Y('Segment:N', sort='-x', title=None),
                    color=alt.Color('Churn Rate:Q', scale=alt.Scale(domain=[0, 4], range=['#10B981', '#F59E0B', '#EF4444']), legend=None),
                    tooltip=[
                        alt.Tooltip('Segment:N'),
                        alt.Tooltip('Churn Rate:Q', title='Churn %', format='.1f'),
                        alt.Tooltip('At Risk:Q', title='At Risk Customers'),
                        alt.Tooltip('Revenue Impact:Q', title='Revenue at Risk (£K)', format='.1f')
                    ]
                ).properties(height=220)
                st.altair_chart(churn_bars, use_container_width=True)
        
        st.markdown('<div class="section-header">Experience vs NPS</div>', unsafe_allow_html=True)
        with st.container(border=True):
            exp_df = pd.DataFrame({
                'Region': ['London', 'South East', 'Midlands', 'North West', 'North East', 'Scotland', 'Wales', 'East'],
                'Experience Score': [84, 81, 78, 76, 74, 79, 75, 80],
                'NPS': [56, 49, 44, 42, 39, 46, 41, 47]
            })
            exp_scatter = alt.Chart(exp_df).mark_circle(size=180, opacity=0.75).encode(
                x=alt.X('Experience Score:Q', title='Network Experience Score'),
                y=alt.Y('NPS:Q', title='NPS'),
                color=alt.Color('Region:N', legend=alt.Legend(orient='bottom', title=None)),
                tooltip=['Region:N', 'Experience Score:Q', 'NPS:Q']
            ).properties(height=260)
            st.altair_chart(exp_scatter, use_container_width=True)

        st.markdown('<div class="section-header">Churn Cohort Waterfall</div>', unsafe_allow_html=True)
        with st.container(border=True):
            waterfall_df = pd.DataFrame({
                'Stage': ['Base', 'New Adds', 'Save Offers', 'Churn', 'Migrations', 'End'],
                'Start': [0.0, 30.2, 31.0, 31.6, 30.8, 0.0],
                'End': [30.2, 31.0, 31.6, 30.8, 31.1, 31.1],
                'Type': ['Total', 'Increase', 'Increase', 'Decrease', 'Increase', 'Total']
            })
            waterfall_df['Label'] = waterfall_df.apply(
                lambda row: f"{row['End']:.1f}M" if row['Type'] == 'Total' else f"{(row['End'] - row['Start']):+.1f}M",
                axis=1
            )
            waterfall = alt.Chart(waterfall_df).mark_bar(cornerRadiusTopLeft=4, cornerRadiusTopRight=4).encode(
                x=alt.X('Stage:N', title=None),
                y=alt.Y('Start:Q', title='Subscribers (M)'),
                y2='End:Q',
                color=alt.Color('Type:N', scale=alt.Scale(domain=['Increase', 'Decrease', 'Total'], range=['#10B981', '#EF4444', '#3B82F6']), legend=None),
                tooltip=['Stage:N', 'Type:N', alt.Tooltip('Start:Q', format='.1f'), alt.Tooltip('End:Q', format='.1f')]
            ).properties(height=220)
            waterfall_text = alt.Chart(waterfall_df).mark_text(dy=-8, fontSize=10, fontWeight='bold').encode(
                x='Stage:N',
                y='End:Q',
                text='Label:N',
                color=alt.value('#1B2A4E')
            )
            st.altair_chart(waterfall + waterfall_text, use_container_width=True)

        st.markdown('<div class="section-header">Growth & Mix</div>', unsafe_allow_html=True)
        st.markdown("**Customer Base Trend (12 Months)**")
        with st.container(border=True):
            trend_months = pd.DataFrame({
                'Month': ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                'Customers': [101.0, 101.3, 101.6, 101.9, 102.2, 102.5, 102.8, 103.0, 103.2, 103.3, 103.4, 103.5]
            })
            trend_months['Net_Adds_K'] = (trend_months['Customers'] - trend_months['Customers'].iloc[0]).round(2)
            area_chart = alt.Chart(trend_months).mark_area(
                color='#29B5E8', opacity=0.3, line={'color': '#29B5E8', 'strokeWidth': 2}
            ).encode(
                x=alt.X('Month:N', sort=list(trend_months['Month']), title=None, axis=alt.Axis(labelAngle=0)),
                y=alt.Y('Net_Adds_K:Q', title=None, scale=alt.Scale(domain=[0, 3], zero=True), axis=alt.Axis(format='.1f', tickCount=4)),
                tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Net_Adds_K:Q', title='Net Adds (K)', format='.2f')]
            ).properties(height=180)
            points = alt.Chart(trend_months).mark_circle(color='#29B5E8', size=40).encode(
                x=alt.X('Month:N', sort=list(trend_months['Month'])),
                y=alt.Y('Net_Adds_K:Q', scale=alt.Scale(domain=[0, 3], zero=True))
            )
            st.altair_chart(area_chart + points, use_container_width=True)
            st.caption("Net Adds (K) vs Feb baseline")
        
        st.markdown('<div class="section-header">Revenue & Subscriber Trend</div>', unsafe_allow_html=True)
        with st.container(border=True):
            trend_data = pd.DataFrame({
                'Month': ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                'Revenue': [4.2, 4.35, 4.48, 4.52, 4.61, 4.78, 4.85, 4.92, 5.05, 5.18, 5.32, 5.48],
                'Subscribers': [28.5, 28.9, 29.2, 29.6, 30.1, 30.4, 30.8, 31.1, 31.5, 31.9, 32.2, 32.4]
            })
            base = alt.Chart(trend_data).encode(
                x=alt.X('Month:N', sort=list(trend_data['Month']), title=None, axis=alt.Axis(labelAngle=0))
            )
            revenue_line = base.mark_line(color='#10B981', strokeWidth=2).encode(
                y=alt.Y('Revenue:Q', title='Revenue (£M)', scale=alt.Scale(domain=[4, 6])),
                tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Revenue:Q', title='Revenue (£M)', format='.2f')]
            )
            subs_line = base.mark_line(color='#29B5E8', strokeWidth=2, strokeDash=[4, 3]).encode(
                y=alt.Y('Subscribers:Q', title='Subscribers (K)', scale=alt.Scale(domain=[28, 34])),
                tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Subscribers:Q', title='Subscribers (K)', format='.1f')]
            )
            st.altair_chart(alt.layer(revenue_line, subs_line).resolve_scale(y='independent').properties(height=220), use_container_width=True)

        st.markdown('<div class="section-header">Customer Value & Competitive Signals</div>', unsafe_allow_html=True)
        value_col1, value_col2 = st.columns(2)
        
        with value_col1:
            st.markdown("**ARPU by Segment**")
            with st.container(border=True):
                arpu_df = pd.DataFrame({
                    'Segment': ['Enterprise', 'Premium', 'Standard', 'Budget'],
                    'ARPU': [142, 58, 38, 24]
                })
                arpu_bar = alt.Chart(arpu_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('ARPU:Q', title='ARPU (£)'),
                    y=alt.Y('Segment:N', sort='-x', title=None),
                    color=alt.value('#14B8A6'),
                    tooltip=['Segment:N', 'ARPU:Q']
                ).properties(height=180)
                st.altair_chart(arpu_bar, use_container_width=True)
        
        with value_col2:
            st.markdown("**Competitive Win/Loss Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                win_df = pd.DataFrame({
                    'Month': months,
                    'Wins': [48, 52, 50, 55, 57, 60],
                    'Losses': [34, 33, 35, 30, 28, 26]
                })
                win_long = win_df.melt('Month', var_name='Outcome', value_name='Count')
                win_line = alt.Chart(win_long).mark_line(point=True).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Count:Q', title='Deals'),
                    color=alt.Color('Outcome:N', scale=alt.Scale(range=['#22C55E', '#EF4444'])),
                    tooltip=['Month:N', 'Outcome:N', 'Count:Q']
                ).properties(height=180)
                st.altair_chart(win_line, use_container_width=True)

    with tab_strategy:
        st.markdown("""
        <style>
        .sf-pulse {
            background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
            border-radius: 16px;
            border: 1px solid #BAE6FD;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .sf-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(41,181,232,0.18), transparent);
            animation: sf-pulse-sweep 4s ease-in-out infinite;
        }
        @keyframes sf-pulse-sweep {
            0% { left: -120%; }
            100% { left: 220%; }
        }
        .sf-pulse-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .sf-pulse-title { font-weight: 700; color: #1B2A4E; font-size: 1.05rem; }
        .sf-pulse-tag {
            background: #0EA5E9;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
        }
        .sf-pulse-metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            position: relative;
            z-index: 1;
        }
        .sf-pulse-card {
            background: white;
            border-radius: 12px;
            border: 1px solid #E2E8F0;
            padding: 0.9rem 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            animation: sf-card-rise 0.6s ease-out forwards;
            opacity: 0;
        }
        .sf-pulse-card:nth-child(1) { animation-delay: 0.05s; }
        .sf-pulse-card:nth-child(2) { animation-delay: 0.2s; }
        .sf-pulse-card:nth-child(3) { animation-delay: 0.35s; }
        .sf-pulse-card:nth-child(4) { animation-delay: 0.5s; }
        @keyframes sf-card-rise {
            0% { transform: translateY(8px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .sf-pulse-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(41,181,232,0.2); }
        .sf-pulse-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #64748B; }
        .sf-pulse-value { font-size: 1.4rem; font-weight: 700; color: #0F172A; }
        .sf-pulse-sub { font-size: 0.8rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) {
            .sf-pulse-metrics { grid-template-columns: 1fr; }
        }
        </style>
        <div class="sf-pulse">
            <div class="sf-pulse-header">
                <div class="sf-pulse-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-pulse-tag">AI LIVE</div>
            </div>
            <div class="sf-pulse-metrics">
                <div class="sf-pulse-card">
                    <div class="sf-pulse-label">Revenue Momentum</div>
                    <div class="sf-pulse-value">+8.4%</div>
                    <div class="sf-pulse-sub">YoY growth</div>
                </div>
                <div class="sf-pulse-card">
                    <div class="sf-pulse-label">Churn Risk</div>
                    <div class="sf-pulse-value">2.1%</div>
                    <div class="sf-pulse-sub">Improving</div>
                </div>
                <div class="sf-pulse-card">
                    <div class="sf-pulse-label">5G Adoption</div>
                    <div class="sf-pulse-value">42%</div>
                    <div class="sf-pulse-sub">+8% QoQ</div>
                </div>
                <div class="sf-pulse-card">
                    <div class="sf-pulse-label">Enterprise ARPU</div>
                    <div class="sf-pulse-value">£142</div>
                    <div class="sf-pulse-sub">4.4x Consumer</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Executive summary synthesized from revenue, churn, market share, and network quality data.")
        
        with st.container(border=True):
            st.markdown("""
            **Executive Summary (Q1 2026):**
            - Revenue growth remains strong at **+8.4% YoY**, supported by enterprise ARPU and port-in momentum.
            - Churn risk improved to **2.1%**, though prepaid segments need targeted retention.
            - Market share reached **5.2%**, with 5G adoption accelerating in priority regions.
            """)

        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Enterprise ARPU** £142 driving margin expansion
                - **Net port-ins** +432 MTD from Three
                - **Revenue mix** steady with SMB uplift
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Prepaid churn** still above target
                - **Yorkshire NPS** trailing by 9 points
                - **Competitive pressure** vs EE in East
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Growth Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **5G adoption** +12% YoY
                - **Enterprise pipeline** £1.8M active
                - **Digital conversion** +7% QoQ
                """)

        # AI-Powered Strategic Recommendations
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                - **Target churn hotspots** with win-back bundles
                - Focus on prepaid segments in the North
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                - **Accelerate 5G rollout** in Yorkshire & Midlands
                - Prioritize high NPS impact zones
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                - **Scale enterprise sales** in top 3 verticals
                - Goal: +£2.8M ARR in H1
                """)

        st.markdown('<div class="section-header">Executive Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                **1) Retention Focus**
                - Target prepaid churn hotspots
                - Offer tiered win-back bundles
                - Goal: reduce churn by 0.4%
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                **2) Competitive Capture**
                - Double down on Three defectors
                - Geo-target Manchester/Leeds
                - Goal: +500 net adds
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                **3) Enterprise Acceleration**
                - Expand sales pods in London
                - Prioritize high-ARPU verticals
                - Goal: +£2.8M ARR
                """)

        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        suggested_questions = [
            "I'm preparing for a board meeting tomorrow. Give me a complete health check of SnowTelco.",
            "Tell me more about our churn situation. Which segments are most at risk?",
            "Show me the profile of our highest-risk customers. What do they have in common?",
            "What retention offers can we make? Check our retention policy.",
            "Is network quality contributing to our churn? Show me the correlation.",
            "Based on everything, create a prioritized action plan for reducing churn."
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(suggested_questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1.5rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none;">
                <p style="margin: 0; font-weight: 600; font-size: 1rem;">
                    ❄️ Ask these questions in Snowflake Intelligence →
                </p>
            </a>
        </div>
        """, unsafe_allow_html=True)
        


def render_ceo_strategic():
    import pandas as pd
    import altair as alt
    
    # CEO Header with Rising Stars Effect
    st.markdown("""
    <style>
    @keyframes ceo-star-rise {
        0% { transform: translateY(100%) scale(0); opacity: 0; }
        50% { opacity: 1; }
        100% { transform: translateY(-100%) scale(1); opacity: 0; }
    }
    @keyframes ceo-sparkle {
        0%, 100% { opacity: 0.2; transform: scale(0.8) rotate(0deg); }
        50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
    }
    .ceo-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .ceo-stars-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
    .ceo-star { position: absolute; color: #F59E0B; font-size: 18px; animation: ceo-star-rise 4s ease-out infinite; text-shadow: 0 0 10px rgba(245,158,11,0.5); }
    .ceo-sparkle { position: absolute; color: #29B5E8; font-size: 14px; animation: ceo-sparkle 2s ease-in-out infinite; text-shadow: 0 0 8px rgba(41,181,232,0.5); }
    .ceo-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
        border: 1px solid #BAE6FD;
        padding: 2rem; color: #1B2A4E;
    }
    .ceo-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; color: #1B2A4E; }
    .ceo-header-content p { margin: 0.5rem 0 0 0; color: #64748B; font-size: 1.1rem; }
    </style>
    <div class="ceo-header-wrap">
        <div class="ceo-stars-bg">
            <span class="ceo-star" style="left: 8%; bottom: 10%; animation-delay: 0s;">★</span>
            <span class="ceo-star" style="left: 18%; bottom: 5%; animation-delay: 0.7s;">★</span>
            <span class="ceo-star" style="left: 28%; bottom: 15%; animation-delay: 1.4s;">★</span>
            <span class="ceo-star" style="left: 42%; bottom: 8%; animation-delay: 2.1s;">★</span>
            <span class="ceo-star" style="left: 55%; bottom: 12%; animation-delay: 2.8s;">★</span>
            <span class="ceo-star" style="left: 68%; bottom: 6%; animation-delay: 0.4s;">★</span>
            <span class="ceo-star" style="left: 78%; bottom: 18%; animation-delay: 1.1s;">★</span>
            <span class="ceo-star" style="left: 88%; bottom: 10%; animation-delay: 1.8s;">★</span>
            <span class="ceo-sparkle" style="left: 15%; top: 25%; animation-delay: 0s;">✦</span>
            <span class="ceo-sparkle" style="left: 50%; top: 20%; animation-delay: 0.8s;">✦</span>
            <span class="ceo-sparkle" style="left: 85%; top: 30%; animation-delay: 1.6s;">✦</span>
        </div>
        <div class="ceo-header-content">
            <h1>CEO Strategic Overview</h1>
            <p>Overall Business Performance, Market Position & Strategic KPIs</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_performance, tab_market, tab_strategy = st.tabs(["📈 Performance", "🧭 Market & Customers", "🎯 Strategy & AI"])

    with tab_performance:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['MOBILE', 'PORTING', 'NETWORK_OPS', 'MARKET_INTELLIGENCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # STRATEGIC MOMENTUM TRACKER - Animated gauges showing progress toward targets
        # CSS for the momentum tracker
        st.markdown("""
        <style>
        @keyframes gauge-rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        /* Looping fill animations - from 0% to target value and back */
        @keyframes gauge-fill-1 {
            0%, 100% { stroke-dashoffset: 251; }
            50% { stroke-dashoffset: 46; }
        }
        @keyframes gauge-fill-2 {
            0%, 100% { stroke-dashoffset: 251; }
            50% { stroke-dashoffset: 63; }
        }
        @keyframes gauge-fill-3 {
            0%, 100% { stroke-dashoffset: 251; }
            50% { stroke-dashoffset: 88; }
        }
        @keyframes gauge-fill-4 {
            0%, 100% { stroke-dashoffset: 251; }
            50% { stroke-dashoffset: 25; }
        }
        .momentum-tracker {
            background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            border: 1px solid #BFDBFE;
        }
        .tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .tracker-title { color: #1B2A4E; font-size: 1.1rem; font-weight: 600; }
        .tracker-period {
            color: #64748B;
            font-size: 0.8rem;
            background: #E2E8F0;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
        }
        .gauges-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }
        .gauge-item { text-align: center; }
        .gauge-svg { width: 100px; height: 100px; transform: rotate(-90deg); }
        .gauge-bg { fill: none; stroke: #E2E8F0; stroke-width: 8; }
        .gauge-fill { fill: none; stroke-width: 8; stroke-linecap: round; stroke-dasharray: 251; }
        .gauge-1 .gauge-fill { stroke: #29B5E8; animation: gauge-fill-1 3s ease-in-out infinite; }
        .gauge-2 .gauge-fill { stroke: #10B981; animation: gauge-fill-2 3s ease-in-out infinite 0.3s; }
        .gauge-3 .gauge-fill { stroke: #8B5CF6; animation: gauge-fill-3 3s ease-in-out infinite 0.6s; }
        .gauge-4 .gauge-fill { stroke: #F59E0B; animation: gauge-fill-4 3s ease-in-out infinite 0.9s; }
        .gauge-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .gauge-wrapper { position: relative; display: inline-block; }
        .gauge-value { font-size: 1.3rem; font-weight: 700; color: #1B2A4E; }
        .gauge-label { color: #64748B; font-size: 0.75rem; margin-top: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .gauge-target { color: #94A3B8; font-size: 0.7rem; margin-top: 0.2rem; }
        </style>
        """, unsafe_allow_html=True)
        
        # HTML content for the momentum tracker
        st.markdown("""<div class="momentum-tracker"><div class="tracker-header"><div class="tracker-title">📈 Strategic Momentum Tracker</div><div class="tracker-period">FY 2025-26 Progress</div></div><div class="gauges-container"><div class="gauge-item gauge-1"><div class="gauge-wrapper"><svg class="gauge-svg" viewBox="0 0 100 100"><circle class="gauge-bg" cx="50" cy="50" r="40"></circle><circle class="gauge-fill" cx="50" cy="50" r="40"></circle></svg><div class="gauge-center"><div class="gauge-value">82%</div></div></div><div class="gauge-label">Market Share</div><div class="gauge-target">Target: 7% → Current: 5.2%</div></div><div class="gauge-item gauge-2"><div class="gauge-wrapper"><svg class="gauge-svg" viewBox="0 0 100 100"><circle class="gauge-bg" cx="50" cy="50" r="40"></circle><circle class="gauge-fill" cx="50" cy="50" r="40"></circle></svg><div class="gauge-center"><div class="gauge-value">75%</div></div></div><div class="gauge-label">Revenue Target</div><div class="gauge-target">£89M of £120M goal</div></div><div class="gauge-item gauge-3"><div class="gauge-wrapper"><svg class="gauge-svg" viewBox="0 0 100 100"><circle class="gauge-bg" cx="50" cy="50" r="40"></circle><circle class="gauge-fill" cx="50" cy="50" r="40"></circle></svg><div class="gauge-center"><div class="gauge-value">65%</div></div></div><div class="gauge-label">5G Rollout</div><div class="gauge-target">325 of 500 sites</div></div><div class="gauge-item gauge-4"><div class="gauge-wrapper"><svg class="gauge-svg" viewBox="0 0 100 100"><circle class="gauge-bg" cx="50" cy="50" r="40"></circle><circle class="gauge-fill" cx="50" cy="50" r="40"></circle></svg><div class="gauge-center"><div class="gauge-value">90%</div></div></div><div class="gauge-label">NPS Goal</div><div class="gauge-target">+47 of +52 target</div></div></div></div>""", unsafe_allow_html=True)

        st.markdown("""
        <style>
        @keyframes pulse-line {
            0% { stroke-dashoffset: 420; opacity: 0.2; }
            35% { opacity: 1; }
            60% { stroke-dashoffset: 0; opacity: 1; }
            100% { stroke-dashoffset: 0; opacity: 0.85; }
        }
        @keyframes kpi-pop {
            0% { transform: translateY(6px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes rotate-fade {
            0% { opacity: 0; transform: translateY(6px); }
            10% { opacity: 1; transform: translateY(0); }
            35% { opacity: 1; }
            45% { opacity: 0; transform: translateY(-6px); }
            100% { opacity: 0; }
        }
        .exec-pulse {
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
            border-radius: 16px;
            padding: 1.5rem;
            color: white;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        .exec-pulse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .exec-pulse-title { font-size: 1.05rem; font-weight: 600; }
        .exec-pulse-badge {
            background: rgba(56, 189, 248, 0.2);
            color: #38BDF8;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .exec-pulse-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 0.5rem;
        }
        .exec-metric {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 0.8rem;
            animation: kpi-pop 0.8s ease-out forwards;
        }
        .exec-metric:nth-child(2) { animation-delay: 0.1s; }
        .exec-metric:nth-child(3) { animation-delay: 0.2s; }
        .exec-metric:nth-child(4) { animation-delay: 0.3s; }
        .exec-metric-label { font-size: 0.7rem; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 0.05em; }
        .exec-metric-value { font-size: 1.4rem; font-weight: 700; margin-top: 0.2rem; }
        .exec-metric-delta { font-size: 0.75rem; color: #34D399; margin-top: 0.2rem; }
        .exec-pulse-line {
            margin-top: 0.75rem;
            height: 80px;
        }
        .exec-pulse-line svg { width: 100%; height: 80px; }
        .pulse-line {
            fill: none;
            stroke: #38BDF8;
            stroke-width: 2.4;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 420;
            stroke-dashoffset: 420;
            animation: pulse-line 3.2s ease-in-out infinite;
        }
        .pulse-area {
            fill: rgba(56, 189, 248, 0.15);
        }
        .exec-rotator {
            margin-top: 0.75rem;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 0.6rem 0.8rem;
            position: relative;
            height: 34px;
            overflow: hidden;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.85);
        }
        .rotator-item {
            position: absolute;
            left: 0.8rem;
            right: 0.8rem;
            opacity: 0;
            animation: rotate-fade 9s ease-in-out infinite;
        }
        .rotator-item:nth-child(2) { animation-delay: 3s; }
        .rotator-item:nth-child(3) { animation-delay: 6s; }
        .rotator-badge {
            display: inline-block;
            margin-right: 0.4rem;
            padding: 0.1rem 0.4rem;
            border-radius: 999px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            background: rgba(56, 189, 248, 0.2);
            color: #38BDF8;
        }
        </style>
        """, unsafe_allow_html=True)

        st.markdown("""
        <div class="exec-pulse">
            <div class="exec-pulse-header">
                <div class="exec-pulse-title">⚡ Executive Performance Pulse</div>
                <div class="exec-pulse-badge">Real-time composite index</div>
            </div>
            <div class="exec-pulse-line">
                <svg viewBox="0 0 520 80" preserveAspectRatio="none">
                    <path class="pulse-line" d="M0,60 L60,58 L120,52 L180,48 L240,44 L300,38 L360,42 L420,30 L480,28 L520,24"></path>
                    <path class="pulse-area" d="M0,60 L60,58 L120,52 L180,48 L240,44 L300,38 L360,42 L420,30 L480,28 L520,24 L520,80 L0,80 Z"></path>
                </svg>
            </div>
            <div class="exec-pulse-grid">
                <div class="exec-metric">
                    <div class="exec-metric-label">Composite Score</div>
                    <div class="exec-metric-value">86</div>
                    <div class="exec-metric-delta">▲ +4 vs last month</div>
                </div>
                <div class="exec-metric">
                    <div class="exec-metric-label">Revenue Momentum</div>
                    <div class="exec-metric-value">+5.6%</div>
                    <div class="exec-metric-delta">▲ +0.8% QoQ</div>
                </div>
                <div class="exec-metric">
                    <div class="exec-metric-label">Net Adds</div>
                    <div class="exec-metric-value">+142K</div>
                    <div class="exec-metric-delta">▲ +12K QoQ</div>
                </div>
                <div class="exec-metric">
                    <div class="exec-metric-label">Network QoE</div>
                    <div class="exec-metric-value">4.2/5</div>
                    <div class="exec-metric-delta">▲ +0.1 QoQ</div>
                </div>
            </div>
            <div class="exec-rotator">
                <div class="rotator-item"><span class="rotator-badge">Focus</span>5G expansion pacing ahead of plan — +12 sites this month</div>
                <div class="rotator-item"><span class="rotator-badge">Risk</span>Prepaid churn up 0.3% in Yorkshire — target retention action</div>
                <div class="rotator-item"><span class="rotator-badge">Upside</span>Enterprise pipeline conversion trending +6% QoQ</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # KPI CSS styles
        st.markdown("""
        <style>
        .ceo-kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .ceo-kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .ceo-kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .ceo-kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        @keyframes ceo-count-up { 0% { opacity: 0; transform: translateY(10px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes ceo-draw-line { 0% { stroke-dashoffset: 200; } 100% { stroke-dashoffset: 0; } }
        @keyframes ceo-fill-area { 0% { opacity: 0; } 100% { opacity: 0.15; } }
        @keyframes ceo-delta-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        .ceo-kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .ceo-kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
            animation: ceo-count-up 0.8s ease-out forwards;
        }
        .ceo-kpi-card:nth-child(2) .ceo-kpi-value { animation-delay: 0.1s; }
        .ceo-kpi-card:nth-child(3) .ceo-kpi-value { animation-delay: 0.2s; }
        .ceo-kpi-card:nth-child(4) .ceo-kpi-value { animation-delay: 0.3s; }
        .ceo-kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
            animation: ceo-delta-bounce 2s ease-in-out infinite;
        }
        .ceo-kpi-card:nth-child(2) .ceo-kpi-delta { animation-delay: 0.5s; }
        .ceo-kpi-card:nth-child(3) .ceo-kpi-delta { animation-delay: 1s; }
        .ceo-kpi-card:nth-child(4) .ceo-kpi-delta { animation-delay: 1.5s; }
        .ceo-kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .ceo-kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .ceo-kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        .ceo-kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0;
            animation: ceo-fill-area 1s ease-out 0.5s forwards;
        }
        .ceo-kpi-chart path[fill="none"] { stroke-dasharray: 200; animation: ceo-draw-line 1.5s ease-out forwards; }
        .ceo-kpi-card:nth-child(2) .ceo-kpi-chart path[fill="none"] { animation-delay: 0.2s; }
        .ceo-kpi-card:nth-child(3) .ceo-kpi-chart path[fill="none"] { animation-delay: 0.4s; }
        .ceo-kpi-card:nth-child(4) .ceo-kpi-chart path[fill="none"] { animation-delay: 0.6s; }
        .ceo-kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .ceo-kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        # Strategic KPI Cards Row 1
        st.markdown('<div class="section-header">Strategic Performance Dashboard</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="ceo-kpi-grid">
            <div class="ceo-kpi-card" style="--accent: #29B5E8;">
                <div class="ceo-kpi-icon">📊</div>
                <div class="ceo-kpi-label">Market Share</div>
                <div class="ceo-kpi-value">5.2%</div>
                <div class="ceo-kpi-delta positive">↑ +0.4% YoY</div>
                <svg class="ceo-kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,35 L20,33 L40,30 L60,26 L80,22 L100,18" fill="none" stroke="#29B5E8" stroke-width="2"/>
                    <path d="M0,35 L20,33 L40,30 L60,26 L80,22 L100,18 L100,40 L0,40 Z" fill="#29B5E8"/>
                </svg>
            </div>
            <div class="ceo-kpi-card" style="--accent: #10B981;">
                <div class="ceo-kpi-icon">🎯</div>
                <div class="ceo-kpi-label">Strategic NPS</div>
                <div class="ceo-kpi-value">+47</div>
                <div class="ceo-kpi-delta positive">↑ +5 pts QoQ</div>
                <svg class="ceo-kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="30" width="12" height="10" fill="#10B981"/>
                    <rect x="22" y="26" width="12" height="14" fill="#10B981"/>
                    <rect x="39" y="24" width="12" height="16" fill="#10B981"/>
                    <rect x="56" y="20" width="12" height="20" fill="#10B981"/>
                    <rect x="73" y="14" width="12" height="26" fill="#10B981"/>
                </svg>
            </div>
            <div class="ceo-kpi-card" style="--accent: #8B5CF6;">
                <div class="ceo-kpi-icon">⚔️</div>
                <div class="ceo-kpi-label">Net Port-Ins</div>
                <div class="ceo-kpi-value">+432</div>
                <div class="ceo-kpi-delta positive">↑ vs -89 last Q</div>
                <svg class="ceo-kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,28 L20,32 L40,25 L60,20 L80,15 L100,8" fill="none" stroke="#8B5CF6" stroke-width="2"/>
                    <path d="M0,28 L20,32 L40,25 L60,20 L80,15 L100,8 L100,40 L0,40 Z" fill="#8B5CF6"/>
                </svg>
            </div>
            <div class="ceo-kpi-card" style="--accent: #F59E0B;">
                <div class="ceo-kpi-icon">📈</div>
                <div class="ceo-kpi-label">Revenue Growth</div>
                <div class="ceo-kpi-value">+8.4%</div>
                <div class="ceo-kpi-delta positive">↑ vs 6.2% target</div>
                <svg class="ceo-kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,32 L20,30 L40,26 L60,22 L80,16 L100,10" fill="none" stroke="#F59E0B" stroke-width="2"/>
                    <path d="M0,32 L20,30 L40,26 L60,22 L80,16 L100,10 L100,40 L0,40 Z" fill="#F59E0B"/>
                </svg>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Executive Growth & Margin Signals</div>', unsafe_allow_html=True)
        perf_col1, perf_col2 = st.columns(2)
        
        with perf_col1:
            st.markdown("**Revenue & EBITDA Margin Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                margin_df = pd.DataFrame({
                    'Month': months,
                    'Revenue': [4.6, 4.7, 4.8, 5.0, 5.2, 5.4],
                    'Margin': [20.8, 21.2, 21.6, 22.1, 22.4, 22.8]
                })
                base = alt.Chart(margin_df).encode(
                    x=alt.X('Month:N', sort=months, title=None)
                )
                rev_line = base.mark_line(color='#10B981', strokeWidth=2).encode(
                    y=alt.Y('Revenue:Q', title='Revenue (£M)'),
                    tooltip=['Month:N', alt.Tooltip('Revenue:Q', format='.2f')]
                )
                margin_line = base.mark_line(color='#3B82F6', strokeWidth=2, strokeDash=[4, 3]).encode(
                    y=alt.Y('Margin:Q', title='EBITDA Margin %'),
                    tooltip=['Month:N', alt.Tooltip('Margin:Q', format='.1f')]
                )
                st.altair_chart(
                    alt.layer(rev_line, margin_line).resolve_scale(y='independent').properties(height=200),
                    use_container_width=True
                )
        
        with perf_col2:
            st.markdown("**Cash Flow vs Capex**")
            with st.container(border=True):
                cash_df = pd.DataFrame({
                    'Month': months,
                    'Cash Flow': [0.9, 1.0, 1.1, 1.2, 1.3, 1.35],
                    'Capex': [0.62, 0.65, 0.7, 0.74, 0.78, 0.82]
                })
                cash_long = cash_df.melt('Month', var_name='Type', value_name='Value')
                cash_area = alt.Chart(cash_long).mark_area(opacity=0.5).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Value:Q', title='£M'),
                    color=alt.Color('Type:N', scale=alt.Scale(range=['#22C55E', '#F59E0B'])),
                    tooltip=['Month:N', 'Type:N', alt.Tooltip('Value:Q', format='.2f')]
                ).properties(height=200)
                st.altair_chart(cash_area, use_container_width=True)

        st.markdown('<div class="section-header">Product Mix Momentum</div>', unsafe_allow_html=True)
        with st.container(border=True):
            mix_df = pd.DataFrame({
                'Month': months * 3,
                'Product': ['Mobile'] * 6 + ['Broadband'] * 6 + ['Enterprise'] * 6,
                'Share': [52, 52, 51, 50, 49, 48, 28, 27, 27, 26, 26, 25, 20, 21, 22, 24, 25, 27]
            })
            mix_area = alt.Chart(mix_df).mark_area(opacity=0.6).encode(
                x=alt.X('Month:N', sort=months, title=None),
                y=alt.Y('Share:Q', stack='normalize', title='Mix %'),
                color=alt.Color('Product:N', scale=alt.Scale(range=['#29B5E8', '#10B981', '#8B5CF6'])),
                tooltip=['Month:N', 'Product:N', alt.Tooltip('Share:Q', format='.0f')]
            ).properties(height=200)
            st.altair_chart(mix_area, use_container_width=True)

    with tab_market:
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['MOBILE', 'PORTING', 'NETWORK_OPS', 'MARKET_INTELLIGENCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)

        st.markdown("""
        <style>
        @keyframes market-pulse {
            0% { transform: translateX(-30%); opacity: 0.2; }
            50% { opacity: 0.7; }
            100% { transform: translateX(130%); opacity: 0.2; }
        }
        .market-pulse {
            position: relative;
            background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
            border: 1px solid #BAE6FD;
            border-radius: 14px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        .market-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -40%;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(41,181,232,0.35), transparent);
            animation: market-pulse 4.5s ease-in-out infinite;
        }
        .market-pulse-title {
            font-weight: 700;
            color: #0F172A;
            font-size: 1rem;
        }
        .market-pulse-sub {
            color: #64748B;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }
        .market-pulse-metrics {
            display: flex;
            gap: 1.5rem;
            margin-top: 0.6rem;
            font-size: 0.8rem;
            color: #0F172A;
        }
        .market-pulse-metrics span {
            background: rgba(255,255,255,0.7);
            border: 1px solid #E2E8F0;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
        }
        </style>
        <div class="market-pulse">
            <div class="market-pulse-title">📊 Market Pulse — FY 2025-26</div>
            <div class="market-pulse-sub">Share momentum, competitor movement, and customer sentiment in one view</div>
            <div class="market-pulse-metrics">
                <span>Market Share: 5.2% ▲</span>
                <span>Net Port-Ins: +432</span>
                <span>Overall NPS: +45</span>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Market Position</div>', unsafe_allow_html=True)

        # Main dashboard layout
        col_left, col_right = st.columns([1.2, 1])
        
        with col_left:
            # UK Regional Market Share Map
            st.markdown('<div class="section-header">UK Regional Performance</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                region_data = pd.DataFrame({
                    'Region': ['London', 'South East', 'South West', 'Midlands', 'North West', 'North East', 'Yorkshire', 'Scotland', 'Wales', 'East'],
                    'Market Share': [6.2, 5.8, 5.5, 4.8, 5.1, 4.2, 3.9, 4.5, 4.1, 5.3],
                    'Subscribers': [6240, 4820, 3150, 4100, 3890, 2340, 2180, 1520, 980, 3027],
                    'NPS': [52, 48, 51, 45, 44, 41, 38, 46, 43, 47],
                    'Growth': ['+8.2%', '+6.1%', '+7.3%', '+5.2%', '+4.8%', '+3.1%', '+2.4%', '+5.5%', '+4.2%', '+6.8%'],
                    'Latitude': [51.5, 51.3, 50.7, 52.5, 53.5, 54.9, 53.8, 56.0, 52.1, 52.2],
                    'Longitude': [-0.1, 0.5, -3.5, -1.5, -2.5, -1.6, -1.5, -4.0, -3.8, 0.9]
                })
                
                # Interactive horizontal bar chart with tooltips
                bars = alt.Chart(region_data).mark_bar(
                    cornerRadiusTopRight=6,
                    cornerRadiusBottomRight=6
                ).encode(
                    x=alt.X('Market Share:Q', title='Market Share (%)', scale=alt.Scale(domain=[0, 8])),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.Color('Market Share:Q', 
                        scale=alt.Scale(scheme='blues'),
                        legend=None
                    ),
                    tooltip=[
                        alt.Tooltip('Region:N'),
                        alt.Tooltip('Market Share:Q', title='Share', format='.1f'),
                        alt.Tooltip('Subscribers:Q', title='Subscribers', format=','),
                        alt.Tooltip('NPS:Q', title='NPS'),
                        alt.Tooltip('Growth:N', title='YoY Growth')
                    ]
                ).properties(height=320)
                
                # Add text labels
                text = alt.Chart(region_data).mark_text(
                    align='left',
                    dx=5,
                    fontSize=11,
                    fontWeight='bold'
                ).encode(
                    x=alt.X('Market Share:Q'),
                    y=alt.Y('Region:N', sort='-x'),
                    text=alt.Text('Market Share:Q', format='.1f'),
                    color=alt.value('#1B2A4E')
                )
                
                st.altair_chart(bars + text, use_container_width=True)
                
                # Regional insights
                col_r1, col_r2 = st.columns(2)
                with col_r1:
                    st.markdown("""
                    <div style="background: #D1FAE5; border-radius: 8px; padding: 0.75rem;">
                        <strong style="color: #065F46; font-size: 0.85rem;">🏆 Top Regions</strong>
                        <div style="color: #065F46; font-size: 0.8rem; margin-top: 0.3rem;">
                            London: 6.2% share<br>
                            South East: 5.8% share<br>
                            South West: 5.5% share
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
                with col_r2:
                    st.markdown("""
                    <div style="background: #FEE2E2; border-radius: 8px; padding: 0.75rem;">
                        <strong style="color: #991B1B; font-size: 0.85rem;">⚠️ Focus Areas</strong>
                        <div style="color: #991B1B; font-size: 0.8rem; margin-top: 0.3rem;">
                            Yorkshire: 3.9% (NPS 38)<br>
                            Wales: 4.1% (low subs)<br>
                            North East: 4.2% share
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
        
        with col_right:
            # Competitive Position - Market Intelligence
            st.markdown('<div class="section-header">Competitive Landscape</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                competitor_data = pd.DataFrame({
                    'Competitor': ['EE', 'O2', 'Vodafone', 'Three', 'SnowTelco', 'Others'],
                    'Market Share': [28, 26, 22, 14, 5, 5],
                    'YoY Change': [0.2, -1.1, 0.5, -0.8, 0.4, 0.8],
                    'Trend': ['→', '↓', '→', '↓', '↑', '→']
                })
                
                # Donut chart for market share
                donut = alt.Chart(competitor_data).mark_arc(innerRadius=60, outerRadius=100, cornerRadius=3).encode(
                    theta=alt.Theta('Market Share:Q', stack=True),
                    color=alt.Color('Competitor:N',
                        scale=alt.Scale(
                            domain=['EE', 'O2', 'Vodafone', 'Three', 'SnowTelco', 'Others'],
                            range=['#8B5CF6', '#3B82F6', '#EF4444', '#F59E0B', '#29B5E8', '#9CA3AF']
                        ),
                        legend=None
                    ),
                    tooltip=[
                        alt.Tooltip('Competitor:N'),
                        alt.Tooltip('Market Share:Q', title='Share (%)', format='d'),
                        alt.Tooltip('YoY Change:Q', title='YoY Change', format='+.1f')
                    ],
                    order=alt.Order('Market Share:Q', sort='descending')
                ).properties(height=200)
                
                st.altair_chart(donut, use_container_width=True)
                
                # Legend with trends
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="width: 12px; height: 12px; background: #8B5CF6; border-radius: 2px;"></span>
                        <span>EE 28% →</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="width: 12px; height: 12px; background: #3B82F6; border-radius: 2px;"></span>
                        <span style="color: #DC2626;">O2 26% ↓</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="width: 12px; height: 12px; background: #EF4444; border-radius: 2px;"></span>
                        <span>Vodafone 22% →</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="width: 12px; height: 12px; background: #F59E0B; border-radius: 2px;"></span>
                        <span style="color: #DC2626;">Three 14% ↓</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="width: 12px; height: 12px; background: #29B5E8; border-radius: 2px;"></span>
                        <span style="color: #10B981; font-weight: 600;">SnowTelco 5% ↑</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="width: 12px; height: 12px; background: #9CA3AF; border-radius: 2px;"></span>
                        <span>Others 5%</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
                
                st.markdown("""
                <div style="background: linear-gradient(135deg, #E0F2FE 0%, #F0F9FF 100%); border-radius: 8px; padding: 0.75rem; margin-top: 1rem; border-left: 4px solid #29B5E8;">
                    <strong style="color: #0369A1; font-size: 0.85rem;">🎯 Target: 7% by 2027</strong>
                    <div style="color: #0369A1; font-size: 0.8rem; margin-top: 0.25rem;">+2% growth opportunity • £15M incremental revenue</div>
                </div>
                """, unsafe_allow_html=True)
            
            # Industry Benchmark Comparison
            st.markdown('<div class="section-header">Industry Benchmark</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <style>
                @keyframes benchmark-fill {
                    0% { width: 0%; }
                    100% { width: var(--fill-width); }
                }
                .benchmark-row {
                    display: flex;
                    align-items: center;
                    padding: 0.6rem 0;
                    border-bottom: 1px solid #F3F4F6;
                }
                .benchmark-row:last-child { border-bottom: none; }
                .benchmark-label {
                    width: 100px;
                    font-size: 0.8rem;
                    color: #6B7280;
                    font-weight: 500;
                }
                .benchmark-bars {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    gap: 4px;
                }
                .benchmark-bar-container {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }
                .benchmark-bar-bg {
                    flex: 1;
                    height: 12px;
                    background: #F3F4F6;
                    border-radius: 6px;
                    overflow: hidden;
                }
                .benchmark-bar {
                    height: 100%;
                    border-radius: 6px;
                    animation: benchmark-fill 1.5s ease-out forwards;
                }
                .benchmark-bar.snowtelco { background: linear-gradient(90deg, #29B5E8, #1A8BC4); }
                .benchmark-bar.industry { background: #D1D5DB; }
                .benchmark-value {
                    font-size: 0.75rem;
                    font-weight: 600;
                    min-width: 45px;
                    text-align: right;
                }
                .benchmark-legend {
                    display: flex;
                    gap: 1.5rem;
                    margin-bottom: 0.75rem;
                    font-size: 0.75rem;
                }
                .legend-item {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                }
                .legend-dot {
                    width: 10px;
                    height: 10px;
                    border-radius: 50%;
                }
                .better-badge {
                    font-size: 0.65rem;
                    padding: 2px 6px;
                    border-radius: 10px;
                    background: #D1FAE5;
                    color: #059669;
                    font-weight: 600;
                    margin-left: 4px;
                }
                </style>
                <div class="benchmark-legend">
                    <div class="legend-item"><div class="legend-dot" style="background: linear-gradient(90deg, #29B5E8, #1A8BC4);"></div><span style="font-weight: 600; color: #1B2A4E;">SnowTelco</span></div>
                    <div class="legend-item"><div class="legend-dot" style="background: #D1D5DB;"></div><span style="color: #6B7280;">Industry Avg</span></div>
                </div>
                
                <div class="benchmark-row">
                    <div class="benchmark-label">NPS Score</div>
                    <div class="benchmark-bars">
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar snowtelco" style="--fill-width: 72%;"></div></div>
                            <div class="benchmark-value" style="color: #29B5E8;">72<span class="better-badge">+17</span></div>
                        </div>
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar industry" style="--fill-width: 55%;"></div></div>
                            <div class="benchmark-value" style="color: #9CA3AF;">55</div>
                        </div>
                    </div>
                </div>
                
                <div class="benchmark-row">
                    <div class="benchmark-label">Churn Rate</div>
                    <div class="benchmark-bars">
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar snowtelco" style="--fill-width: 21%;"></div></div>
                            <div class="benchmark-value" style="color: #29B5E8;">2.1%<span class="better-badge">Better</span></div>
                        </div>
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar industry" style="--fill-width: 28%;"></div></div>
                            <div class="benchmark-value" style="color: #9CA3AF;">2.8%</div>
                        </div>
                    </div>
                </div>
                
                <div class="benchmark-row">
                    <div class="benchmark-label">ARPU</div>
                    <div class="benchmark-bars">
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar snowtelco" style="--fill-width: 78%;"></div></div>
                            <div class="benchmark-value" style="color: #29B5E8;">£38<span class="better-badge">+£6</span></div>
                        </div>
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar industry" style="--fill-width: 64%;"></div></div>
                            <div class="benchmark-value" style="color: #9CA3AF;">£32</div>
                        </div>
                    </div>
                </div>
                
                <div class="benchmark-row">
                    <div class="benchmark-label">5G Coverage</div>
                    <div class="benchmark-bars">
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar snowtelco" style="--fill-width: 67%;"></div></div>
                            <div class="benchmark-value" style="color: #29B5E8;">67%</div>
                        </div>
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar industry" style="--fill-width: 72%;"></div></div>
                            <div class="benchmark-value" style="color: #9CA3AF;">72%</div>
                        </div>
                    </div>
                </div>
                
                <div class="benchmark-row">
                    <div class="benchmark-label">Digital Sales</div>
                    <div class="benchmark-bars">
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar snowtelco" style="--fill-width: 45%;"></div></div>
                            <div class="benchmark-value" style="color: #29B5E8;">45%<span class="better-badge">+7%</span></div>
                        </div>
                        <div class="benchmark-bar-container">
                            <div class="benchmark-bar-bg"><div class="benchmark-bar industry" style="--fill-width: 38%;"></div></div>
                            <div class="benchmark-value" style="color: #9CA3AF;">38%</div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
        
        st.markdown('<div class="section-header">Competitive Porting Analysis</div>', unsafe_allow_html=True)
        with st.container(border=True):
            porting_data = pd.DataFrame({
                'Competitor': ['Three', 'Vodafone', 'EE', 'O2', 'Virgin', 'Sky'],
                'Port-In': [245, 156, 98, 112, 67, 45],
                'Port-Out': [78, 123, 143, 87, 42, 38]
            })
            porting_long = porting_data.melt('Competitor', var_name='Flow', value_name='Count')
            porting_long['Count'] = porting_long.apply(
                lambda row: row['Count'] if row['Flow'] == 'Port-In' else -row['Count'], axis=1
            )
            porting_long['Abs'] = porting_long['Count'].abs()
            porting_chart = alt.Chart(porting_long).mark_bar(cornerRadius=4).encode(
                x=alt.X('Count:Q', title='Net Porting', scale=alt.Scale(domain=[-260, 260])),
                y=alt.Y('Competitor:N', sort=list(porting_data['Competitor']), title=None),
                color=alt.Color('Flow:N', scale=alt.Scale(range=['#10B981', '#EF4444']), legend=alt.Legend(orient='bottom', title=None)),
                tooltip=['Competitor:N', 'Flow:N', alt.Tooltip('Abs:Q', title='Customers')]
            ).properties(height=240)
            zero_rule = alt.Chart(pd.DataFrame({'x': [0]})).mark_rule(color='#CBD5F5').encode(x='x:Q')
            st.altair_chart(porting_chart + zero_rule, use_container_width=True)
            col_p1, col_p2 = st.columns(2)
            with col_p1:
                st.markdown("""
                <div style="background: #D1FAE5; border-radius: 20px; padding: 0.5rem 1rem; text-align: center;">
                    <span style="color: #065F46; font-weight: 600;">Net: +432 customers</span>
                </div>
                """, unsafe_allow_html=True)
            with col_p2:
                st.markdown("""
                <div style="background: #E0F2FE; border-radius: 20px; padding: 0.5rem 1rem; text-align: center;">
                    <span style="color: #0369A1; font-weight: 600;">Three: +167 | EE: -45</span>
                </div>
                """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Customer Health & Value</div>', unsafe_allow_html=True)

        cust_left, cust_right = st.columns(2)
        with cust_left:
            st.markdown('<div class="section-header">NPS by Customer Segment</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                nps_data = pd.DataFrame({
                    'Segment': ['Enterprise', 'SMB', 'Consumer Premium', 'Consumer Standard', 'Consumer Budget'],
                    'NPS': [62, 51, 48, 42, 35],
                    'Subscribers': [1200, 7874, 5200, 10500, 5473],
                    'ARPU': [142, 58, 45, 32, 22],
                    'Target': [65, 55, 50, 45, 40]
                })
                
                # Lollipop chart for NPS
                nps_line = alt.Chart(nps_data).mark_rule(strokeWidth=3).encode(
                    y=alt.Y('Segment:N', sort='-x', title=None),
                    x=alt.X('NPS:Q', title='NPS Score', scale=alt.Scale(domain=[0, 70])),
                    color=alt.value('#E5E7EB')
                )
                
                nps_point = alt.Chart(nps_data).mark_circle(size=200).encode(
                    y=alt.Y('Segment:N', sort='-x'),
                    x='NPS:Q',
                    color=alt.Color('NPS:Q', scale=alt.Scale(
                        domain=[30, 65],
                        range=['#F59E0B', '#10B981']
                    ), legend=None),
                    tooltip=[
                        alt.Tooltip('Segment:N'),
                        alt.Tooltip('NPS:Q', title='NPS Score'),
                        alt.Tooltip('Subscribers:Q', format=','),
                        alt.Tooltip('ARPU:Q', title='ARPU (£)', format='d'),
                        alt.Tooltip('Target:Q', title='Target NPS')
                    ]
                )
                
                # Target markers
                target_mark = alt.Chart(nps_data).mark_tick(
                    thickness=3,
                    size=20,
                    color='#DC2626'
                ).encode(
                    y=alt.Y('Segment:N', sort='-x'),
                    x='Target:Q'
                )
                
                st.altair_chart(nps_line + nps_point + target_mark, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; gap: 1rem; font-size: 0.8rem; color: #6B7280;">
                    <span>● NPS Score</span>
                    <span style="color: #DC2626;">| Target</span>
                </div>
                """, unsafe_allow_html=True)

        with cust_right:
            st.markdown('<div class="section-header">Churn Risk by Segment</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                churn_data = pd.DataFrame({
                    'Segment': ['Enterprise', 'SMB', 'Consumer Premium', 'Consumer Standard', 'Consumer Budget'],
                    'Churn Rate': [0.8, 1.4, 1.6, 2.1, 3.2],
                    'At Risk': [10, 110, 83, 220, 175],
                    'Revenue Impact': [14.2, 63.8, 37.4, 70.4, 38.5]
                })
                
                churn_bars = alt.Chart(churn_data).mark_bar(
                    cornerRadiusTopRight=6, cornerRadiusBottomRight=6
                ).encode(
                    x=alt.X('Churn Rate:Q', title='Churn Rate (%)', scale=alt.Scale(domain=[0, 4])),
                    y=alt.Y('Segment:N', sort='-x', title=None),
                    color=alt.Color('Churn Rate:Q', scale=alt.Scale(domain=[0, 4], range=['#10B981', '#F59E0B', '#EF4444']), legend=None),
                    tooltip=[
                        alt.Tooltip('Segment:N'),
                        alt.Tooltip('Churn Rate:Q', title='Churn %', format='.1f'),
                        alt.Tooltip('At Risk:Q', title='At Risk Customers'),
                        alt.Tooltip('Revenue Impact:Q', title='Revenue at Risk (£K)', format='.1f')
                    ]
                ).properties(height=180)
                
                churn_text = alt.Chart(churn_data).mark_text(
                    align='left', dx=5, fontSize=11, fontWeight='bold'
                ).encode(
                    x='Churn Rate:Q',
                    y=alt.Y('Segment:N', sort='-x'),
                    text=alt.Text('Churn Rate:Q', format='.1f'),
                    color=alt.value('#1B2A4E')
                )
                
                st.altair_chart(churn_bars + churn_text, use_container_width=True)
                
                col_churn1, col_churn2 = st.columns(2)
                with col_churn1:
                    st.markdown("""
                    <div style="background: #FEE2E2; border-radius: 8px; padding: 0.6rem; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: 700; color: #DC2626;">598</div>
                        <div style="font-size: 0.7rem; color: #991B1B;">At-Risk Customers</div>
                    </div>
                    """, unsafe_allow_html=True)
                with col_churn2:
                    st.markdown("""
                    <div style="background: #FEF3C7; border-radius: 8px; padding: 0.6rem; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: 700; color: #92400E;">£224K</div>
                        <div style="font-size: 0.7rem; color: #92400E;">Monthly Revenue at Risk</div>
                    </div>
                    """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Acquisition & Engagement Signals</div>', unsafe_allow_html=True)
        acq_col1, acq_col2 = st.columns(2)
        
        with acq_col1:
            st.markdown("**Acquisition Channel Mix**")
            with st.container(border=True):
                channel_df = pd.DataFrame({
                    'Channel': ['Digital', 'Retail', 'Partner', 'Referral'],
                    'Share': [44, 22, 18, 16]
                })
                channel_arc = alt.Chart(channel_df).mark_arc(innerRadius=50).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Channel:N', legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Channel:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=200)
                st.altair_chart(channel_arc, use_container_width=True)
        
        with acq_col2:
            st.markdown("**Cohort Retention Curve**")
            with st.container(border=True):
                cohort_df = pd.DataFrame({
                    'Month': ['M0', 'M1', 'M2', 'M3', 'M4', 'M5', 'M6'],
                    'Retention': [100, 94, 90, 87, 84, 82, 80]
                })
                cohort_line = alt.Chart(cohort_df).mark_line(point=True, color='#6366F1', strokeWidth=2).encode(
                    x=alt.X('Month:N', title=None),
                    y=alt.Y('Retention:Q', title='Retention %'),
                    tooltip=['Month:N', alt.Tooltip('Retention:Q', format='.0f')]
                ).properties(height=200)
                st.altair_chart(cohort_line, use_container_width=True)

        st.markdown('<div class="section-header">Sentiment & Brand Momentum</div>', unsafe_allow_html=True)
        sent_col1, sent_col2 = st.columns(2)
        
        with sent_col1:
            st.markdown("**Brand Sentiment Split**")
            with st.container(border=True):
                sent_df = pd.DataFrame({
                    'Sentiment': ['Positive', 'Neutral', 'Negative'],
                    'Share': [62, 26, 12]
                })
                sent_bar = alt.Chart(sent_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Share:Q', title='Share %'),
                    y=alt.Y('Sentiment:N', sort='-x', title=None),
                    color=alt.value('#10B981'),
                    tooltip=['Sentiment:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=200)
                st.altair_chart(sent_bar, use_container_width=True)
        
        with sent_col2:
            st.markdown("**Brand Awareness Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                awareness_df = pd.DataFrame({
                    'Month': months,
                    'Awareness': [61, 62, 63, 65, 66, 68]
                })
                aware_line = alt.Chart(awareness_df).mark_line(point=True, color='#F59E0B', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Awareness:Q', title='Awareness %'),
                    tooltip=['Month:N', alt.Tooltip('Awareness:Q', format='.0f')]
                ).properties(height=200)
                st.altair_chart(aware_line, use_container_width=True)

        # Revenue & Subscriber Trends
        st.markdown('<div class="section-header">Revenue & Subscriber Performance — 12 Month Trend</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            trend_data = pd.DataFrame({
                'Month': ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                'Month_Num': list(range(1, 13)),
                'Revenue': [4.2, 4.35, 4.48, 4.52, 4.61, 4.78, 4.85, 4.92, 5.05, 5.18, 5.32, 5.48],
                'Subscribers': [28.5, 28.9, 29.2, 29.6, 30.1, 30.4, 30.8, 31.1, 31.5, 31.9, 32.2, 32.4],
                'ARPU': [38.2, 38.5, 39.1, 39.4, 39.8, 40.2, 40.5, 40.8, 41.2, 41.6, 42.0, 42.3]
            })
            
            col_t1, col_t2 = st.columns([2, 1])
            
            with col_t1:
                base = alt.Chart(trend_data).encode(
                    x=alt.X('Month:N', sort=list(trend_data['Month']), title=None,
                           axis=alt.Axis(labelAngle=0))
                )
                
                revenue_line = base.mark_line(
                    color='#29B5E8', strokeWidth=3, point=alt.OverlayMarkDef(filled=True, size=60)
                ).encode(
                    y=alt.Y('Revenue:Q', title='Revenue (£M)', scale=alt.Scale(domain=[4, 6])),
                    tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Revenue:Q', title='Revenue (£M)', format='.2f')]
                )
                
                revenue_area = base.mark_area(
                    color='#29B5E8', opacity=0.1
                ).encode(y='Revenue:Q')
                
                subscriber_line = base.mark_line(
                    color='#10B981', strokeWidth=3, strokeDash=[5,3], point=alt.OverlayMarkDef(filled=True, size=60)
                ).encode(
                    y=alt.Y('Subscribers:Q', title='Subscribers (K)', scale=alt.Scale(domain=[28, 34])),
                    tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Subscribers:Q', title='Subscribers (K)', format='.1f')]
                )
                
                chart = alt.layer(revenue_area, revenue_line).resolve_scale(y='independent').properties(height=250)
                chart2 = subscriber_line.properties(height=250)
                
                final_chart = alt.layer(
                    revenue_area, revenue_line, subscriber_line
                ).resolve_scale(y='independent').properties(height=250)
                
                st.altair_chart(final_chart, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; gap: 2rem; font-size: 0.85rem; justify-content: center;">
                    <span><span style="color: #29B5E8;">━━</span> Revenue (£M)</span>
                    <span><span style="color: #10B981;">╌╌</span> Subscribers (K)</span>
                </div>
                """, unsafe_allow_html=True)
            
            with col_t2:
                st.markdown("""
                <div style="background: linear-gradient(135deg, #E0F2FE 0%, #F0F9FF 100%); border-radius: 12px; padding: 1rem; margin-bottom: 0.75rem;">
                    <div style="font-size: 0.75rem; color: #6B7280; text-transform: uppercase;">Revenue YTD</div>
                    <div style="font-size: 1.75rem; font-weight: 700; color: #0369A1;">£5.48M</div>
                    <div style="color: #10B981; font-size: 0.85rem; font-weight: 600;">↑ +30.5% YoY</div>
                </div>
                <div style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-radius: 12px; padding: 1rem; margin-bottom: 0.75rem;">
                    <div style="font-size: 0.75rem; color: #6B7280; text-transform: uppercase;">Subscriber Base</div>
                    <div style="font-size: 1.75rem; font-weight: 700; color: #065F46;">32.4K</div>
                    <div style="color: #10B981; font-size: 0.85rem; font-weight: 600;">↑ +13.7% YoY</div>
                </div>
                <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FFFBEB 100%); border-radius: 12px; padding: 1rem;">
                    <div style="font-size: 0.75rem; color: #6B7280; text-transform: uppercase;">Avg ARPU</div>
                    <div style="font-size: 1.75rem; font-weight: 700; color: #92400E;">£42.30</div>
                    <div style="color: #10B981; font-size: 0.85rem; font-weight: 600;">↑ +10.7% YoY</div>
                </div>
                """, unsafe_allow_html=True)
        
        # Network Health & Customer Journey
        col_net, col_funnel = st.columns(2)
        
        with col_net:
            st.markdown('<div class="section-header">Network Performance Health</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                network_metrics = pd.DataFrame({
                    'Metric': ['Network Uptime', '5G Coverage', 'Avg Latency', 'Call Quality', 'Data Speed'],
                    'Value': [99.7, 78, 92, 96, 85],
                    'Target': [99.9, 85, 95, 98, 90],
                    'Status': ['On Track', 'Below', 'On Track', 'On Track', 'Below']
                })
                
                bars = alt.Chart(network_metrics).mark_bar(
                    cornerRadiusTopRight=6, cornerRadiusBottomRight=6
                ).encode(
                    x=alt.X('Value:Q', title='Score (%)', scale=alt.Scale(domain=[0, 100])),
                    y=alt.Y('Metric:N', sort='-x', title=None),
                    color=alt.condition(
                        alt.datum.Value >= alt.datum.Target,
                        alt.value('#10B981'),
                        alt.value('#F59E0B')
                    ),
                    tooltip=[
                        alt.Tooltip('Metric:N'),
                        alt.Tooltip('Value:Q', title='Current'),
                        alt.Tooltip('Target:Q', title='Target'),
                        alt.Tooltip('Status:N')
                    ]
                ).properties(height=200)
                
                target_rule = alt.Chart(network_metrics).mark_tick(
                    color='#DC2626', thickness=3, size=20
                ).encode(
                    x='Target:Q',
                    y=alt.Y('Metric:N', sort='-x')
                )
                
                st.altair_chart(bars + target_rule, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; gap: 1rem; font-size: 0.8rem; color: #6B7280;">
                    <span style="color: #10B981;">● On Target</span>
                    <span style="color: #F59E0B;">● Below Target</span>
                    <span style="color: #DC2626;">| Target Line</span>
                </div>
                """, unsafe_allow_html=True)
        
        with col_funnel:
            st.markdown('<div class="section-header">Customer Journey Funnel</div>', unsafe_allow_html=True)
            
            # Funnel animation styles
            st.markdown("""
            <style>
            @keyframes funnel-stage-slide {
                0% { opacity: 0; transform: translateX(-30px); }
                100% { opacity: 1; transform: translateX(0); }
            }
            @keyframes funnel-bar-grow {
                0% { transform: scaleX(0); transform-origin: left; }
                100% { transform: scaleX(1); }
            }
            @keyframes opportunity-pulse {
                0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
                50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }
            }
            @keyframes opportunity-slide {
                0% { opacity: 0; transform: translateY(10px); }
                100% { opacity: 1; transform: translateY(0); }
            }
            @keyframes value-highlight {
                0% { color: #92400E; }
                50% { color: #F59E0B; }
                100% { color: #92400E; }
            }
            .funnel-opportunity {
                background: #FEF3C7;
                border-radius: 8px;
                padding: 0.75rem;
                border-left: 4px solid #F59E0B;
                animation: opportunity-slide 0.6s ease-out forwards, opportunity-pulse 2s ease-in-out 1s infinite;
            }
            .funnel-opportunity .highlight-value {
                animation: value-highlight 3s ease-in-out infinite;
                font-weight: 700;
            }
            </style>
            """, unsafe_allow_html=True)
            
            with st.container(border=True):
                funnel_data = pd.DataFrame({
                    'Stage': ['Website Visits', 'Plan Views', 'Sim Selection', 'Checkout', 'Activated'],
                    'Count': [45000, 18500, 8200, 3100, 2480],
                    'Rate': ['100%', '41%', '18%', '7%', '5.5%'],
                    'Order': [1, 2, 3, 4, 5]
                })
                
                funnel = alt.Chart(funnel_data).mark_bar(
                    cornerRadius=4
                ).encode(
                    y=alt.Y('Stage:N', sort=alt.EncodingSortField(field='Order', order='ascending'), title=None),
                    x=alt.X('Count:Q', title='Users', scale=alt.Scale(type='log')),
                    color=alt.Color('Order:Q', scale=alt.Scale(scheme='blues', reverse=True), legend=None),
                    tooltip=[
                        alt.Tooltip('Stage:N'),
                        alt.Tooltip('Count:Q', format=','),
                        alt.Tooltip('Rate:N', title='Conversion')
                    ]
                ).properties(height=200)
                
                text = alt.Chart(funnel_data).mark_text(
                    align='left', dx=5, fontSize=11, fontWeight='bold'
                ).encode(
                    y=alt.Y('Stage:N', sort=alt.EncodingSortField(field='Order', order='ascending')),
                    x='Count:Q',
                    text='Rate:N',
                    color=alt.value('#1B2A4E')
                )
                
                st.altair_chart(funnel + text, use_container_width=True)
                
                st.markdown("""
                <div class="funnel-opportunity">
                    <strong style="color: #92400E; font-size: 0.85rem;">🎯 Opportunity</strong>
                    <div style="color: #92400E; font-size: 0.8rem; margin-top: 0.25rem;">
                        Checkout drop-off: <span class="highlight-value">62%</span> | <span class="highlight-value">£1.2M</span> potential if improved to 50%
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        # Customer Overview Section
        st.markdown('<div class="section-header">Customer Overview</div>', unsafe_allow_html=True)
        
        cust_kpi_cols = st.columns(4)
        
        with cust_kpi_cols[0]:
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 0.75rem; color: #6B7280; margin-bottom: 0.25rem;">Total Customers</div>
                    <div style="font-size: 1.6rem; font-weight: 700; color: #1B2A4E;">103,504</div>
                    <div style="font-size: 0.8rem; margin-top: 0.25rem;">
                        <span style="color: #29B5E8;">B2C: 100,800</span> • <span style="color: #10B981;">B2B: 2,704</span>
                    </div>
                    <div style="font-size: 0.7rem; color: #10B981; margin-top: 0.25rem;">▲ 2.4% YoY</div>
                </div>
                """, unsafe_allow_html=True)
        
        with cust_kpi_cols[1]:
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 0.75rem; color: #6B7280; margin-bottom: 0.25rem;">Net Customer Growth</div>
                    <div style="font-size: 1.6rem; font-weight: 700; color: #10B981;">+1,842</div>
                    <div style="font-size: 0.8rem; margin-top: 0.25rem;">
                        <span style="color: #10B981;">Adds: 3,240</span> • <span style="color: #DC2626;">Churn: 1,398</span>
                    </div>
                    <div style="font-size: 0.7rem; color: #10B981; margin-top: 0.25rem;">▲ 18% vs target</div>
                </div>
                """, unsafe_allow_html=True)
        
        with cust_kpi_cols[2]:
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 0.75rem; color: #6B7280; margin-bottom: 0.25rem;">Overall NPS</div>
                    <div style="font-size: 1.6rem; font-weight: 700; color: #29B5E8;">+45</div>
                    <div style="font-size: 0.8rem; margin-top: 0.25rem;">
                        <span style="color: #29B5E8;">B2C: +42</span> • <span style="color: #10B981;">B2B: +58</span>
                    </div>
                    <div style="font-size: 0.7rem; color: #10B981; margin-top: 0.25rem;">▲ 3 pts vs Q4</div>
                </div>
                """, unsafe_allow_html=True)
        
        with cust_kpi_cols[3]:
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 0.75rem; color: #6B7280; margin-bottom: 0.25rem;">Revenue per Customer</div>
                    <div style="font-size: 1.6rem; font-weight: 700; color: #1B2A4E;">£42.80</div>
                    <div style="font-size: 0.8rem; margin-top: 0.25rem;">
                        <span style="color: #29B5E8;">B2C: £38</span> • <span style="color: #10B981;">B2B: £142</span>
                    </div>
                    <div style="font-size: 0.7rem; color: #10B981; margin-top: 0.25rem;">▲ 1.8% YoY</div>
                </div>
                """, unsafe_allow_html=True)
        
        # Customer Growth Trend and Segment Split
        growth_col, split_col = st.columns(2)
        
        with growth_col:
            st.markdown("**Customer Base Trend (12 Months)**")
            with st.container(border=True):
                # Customer growth trend data (net adds to show movement clearly)
                trend_months = pd.DataFrame({
                    'Month': ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Month_Num': list(range(1, 13)),
                    'Customers': [101.0, 101.3, 101.6, 101.9, 102.2, 102.5, 102.8, 103.0, 103.2, 103.3, 103.4, 103.5]
                })
                trend_months['Net_Adds_K'] = (trend_months['Customers'] - trend_months['Customers'].iloc[0]).round(2)
                
                area_chart = alt.Chart(trend_months).mark_area(
                    color='#29B5E8',
                    opacity=0.3,
                    line={'color': '#29B5E8', 'strokeWidth': 2}
                ).encode(
                    x=alt.X('Month:N', sort=list(trend_months['Month']), title=None, axis=alt.Axis(labelAngle=0)),
                    y=alt.Y(
                        'Net_Adds_K:Q',
                        title=None,
                        scale=alt.Scale(domain=[0, 3], zero=True),
                        axis=alt.Axis(format='.1f', tickCount=4)
                    ),
                    tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Net_Adds_K:Q', title='Net Adds (K)', format='.2f')]
                ).properties(height=180)
                
                points = alt.Chart(trend_months).mark_circle(color='#29B5E8', size=40).encode(
                    x=alt.X('Month:N', sort=list(trend_months['Month'])),
                    y=alt.Y('Net_Adds_K:Q', scale=alt.Scale(domain=[0, 3], zero=True))
                )
                
                st.altair_chart(area_chart + points, use_container_width=True)
                st.caption("Net Adds (K) vs Feb baseline")
                st.markdown('<div style="text-align: center; font-size: 0.75rem; color: #10B981;">Steady growth trajectory • +2,504 net adds in 12 months</div>', unsafe_allow_html=True)
        
        with split_col:
            st.markdown("**Revenue by Customer Segment**")
            with st.container(border=True):
                # Revenue split data
                revenue_split = pd.DataFrame({
                    'Segment': ['B2C', 'B2B'],
                    'Revenue': [38.4, 14.8],
                    'Percentage': ['72%', '28%']
                })
                
                donut = alt.Chart(revenue_split).mark_arc(innerRadius=35, outerRadius=55).encode(
                    theta=alt.Theta('Revenue:Q', stack=True),
                    color=alt.Color('Segment:N', scale=alt.Scale(domain=['B2C', 'B2B'], range=['#29B5E8', '#10B981']), legend=None),
                    tooltip=[alt.Tooltip('Segment:N'), alt.Tooltip('Revenue:Q', title='Revenue (£M)', format='.1f'), alt.Tooltip('Percentage:N')]
                ).properties(height=130)
                
                col_chart, col_legend = st.columns([1, 1])
                with col_chart:
                    st.altair_chart(donut, use_container_width=True)
                with col_legend:
                    st.markdown("""
                    <div style="font-size: 0.85rem; padding-top: 1rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <span style="display: inline-block; width: 12px; height: 12px; background: #29B5E8; border-radius: 2px; margin-right: 0.5rem;"></span>
                            <strong>B2C:</strong> £38.4M (72%)
                        </div>
                        <div>
                            <span style="display: inline-block; width: 12px; height: 12px; background: #10B981; border-radius: 2px; margin-right: 0.5rem;"></span>
                            <strong>B2B:</strong> £14.8M (28%)
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.75rem; color: #6B7280;">
                            Total: £53.2M monthly
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
        
    with tab_strategy:
        st.markdown('<div class="section-header">🤖 AI-Generated Executive Briefing</div>', unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — This summary is generated using CORTEX.COMPLETE() analyzing real-time data across all business units")
        
        with st.container(border=True):
            summary_cols = st.columns([2, 1])
            
            with summary_cols[0]:
                st.markdown("""
                ### 📋 Today's Key Insights
                
                **Financial Performance:** Revenue grew 4.2% YoY to £4.24B, with EBITDA margin improving 
                to 33.5%. Mobile services remain the primary growth driver (+5.8%), while fixed-line 
                continues gradual decline (-2.1%).
                
                **Customer Health:** Net subscriber growth of +142K this quarter, but churn increased 
                slightly to 1.2%. High-value segment shows strongest retention (0.8% churn), while 
                prepaid segment needs attention (2.4% churn).
                
                **Network Performance:** 5G coverage expanded to 68% of population. Network quality 
                scores improved with 99.2% availability. Customer experience scores at 4.2/5.0 for 
                network satisfaction.
                
                **Risks & Opportunities:**
                - ⚠️ **Watch:** Competitive pressure in business segment from new market entrants
                - ✅ **Opportunity:** Data monetisation revenue up 22% — accelerate partner ecosystem
                - 📈 **Trending:** 5G enterprise adoption growing faster than consumer
                """)
            
            with summary_cols[1]:
                st.markdown("**Quick Actions**")
                
                with st.container(border=True):
                    st.markdown("🔴 **Urgent**")
                    st.caption("Review Q1 churn spike in prepaid segment")
                    st.button("Open Analysis →", key="action1", use_container_width=True)
                
                with st.container(border=True):
                    st.markdown("🟡 **This Week**")
                    st.caption("Approve 5G expansion business case for Phase 3")
                    st.button("View Document →", key="action2", use_container_width=True)
                
                with st.container(border=True):
                    st.markdown("🟢 **FYI**")
                    st.caption("NPS score reached all-time high of +42")
                    st.button("See Details →", key="action3", use_container_width=True)

        st.markdown('<div class="section-header">CEO Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Accelerate Yorkshire Recovery</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Lowest NPS (38) and market share (3.9%)
                - Network investment: £2.5M approved
                - Target: +10 NPS points by Q3
                - Expected subscriber growth: +800
                """)
        
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Capitalize on Three Weakness</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - +167 net port-ins from Three
                - Their network issues are persistent
                - Launch targeted win-back campaign
                - Target: 500 additional converts
                """)
        
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Enterprise Segment Growth</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Highest NPS (62) & ARPU (£142)
                - Only 4% of base, 12% of revenue
                - Expand enterprise sales team
                - Target: +200 accounts, £2.8M revenue
                """)
        
        # Ask Intelligence Section
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "Give me an executive summary of SnowTelco's current performance - subscribers, ARPU, and NPS by segment.",
            "Show me our port-in versus port-out analysis - which competitors are we winning/losing customers?",
            "What are our top network quality issues affecting customer satisfaction?",
            "Compare our performance against main competitors - market share, satisfaction, quality.",
            "Based on all data, what are the 3 most critical strategic priorities this quarter?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_cfo_financial():
    import pandas as pd
    import altair as alt
    
    # CFO Header with Floating Coins Effect
    st.markdown("""
    <style>
    @keyframes cfo-coin-fall {
        0% { transform: translateY(-20px) rotateY(0deg); opacity: 0; }
        20% { opacity: 1; }
        80% { opacity: 1; }
        100% { transform: translateY(100px) rotateY(720deg); opacity: 0; }
    }
    @keyframes cfo-shine { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.8; } }
    .cfo-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .cfo-coins-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
    .cfo-coin { position: absolute; font-size: 18px; animation: cfo-coin-fall 5s ease-in-out infinite; }
    .cfo-shine { position: absolute; width: 30px; height: 2px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent); animation: cfo-shine 2s ease-in-out infinite; transform: rotate(-45deg); }
    .cfo-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%);
        border: 1px solid #A7F3D0;
        padding: 2rem; color: #065F46;
    }
    .cfo-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; color: #065F46; }
    .cfo-header-content p { margin: 0.5rem 0 0 0; color: #047857; font-size: 1.1rem; }
    </style>
    <div class="cfo-header-wrap">
        <div class="cfo-coins-bg">
            <span class="cfo-coin" style="left: 5%; top: -10%; animation-delay: 0s;">💰</span>
            <span class="cfo-coin" style="left: 15%; top: -15%; animation-delay: 0.8s;">💵</span>
            <span class="cfo-coin" style="left: 28%; top: -5%; animation-delay: 1.6s;">💰</span>
            <span class="cfo-coin" style="left: 40%; top: -20%; animation-delay: 2.4s;">💷</span>
            <span class="cfo-coin" style="left: 55%; top: -8%; animation-delay: 3.2s;">💰</span>
            <span class="cfo-coin" style="left: 68%; top: -12%; animation-delay: 0.4s;">💵</span>
            <span class="cfo-coin" style="left: 80%; top: -18%; animation-delay: 1.2s;">💰</span>
            <span class="cfo-coin" style="left: 92%; top: -6%; animation-delay: 2s;">💷</span>
            <div class="cfo-shine" style="left: 20%; top: 30%;"></div>
            <div class="cfo-shine" style="left: 60%; top: 50%; animation-delay: 0.7s;"></div>
            <div class="cfo-shine" style="left: 80%; top: 25%; animation-delay: 1.4s;"></div>
        </div>
        <div class="cfo-header-content">
            <h1>CFO Financial Dashboard</h1>
            <p>Revenue, Profitability, Cash Flow & Financial Performance</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "💼 Financial Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['FINANCE', 'BILLING', 'MOBILE', 'SALES']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # CFO REVENUE FLOW ANIMATION
        st.markdown("""
        <style>
        @keyframes flow-right { 0% { transform: translateX(-100%); opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        @keyframes pulse-green { 0%, 100% { box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15); } 50% { box-shadow: 0 4px 20px rgba(16, 185, 129, 0.35); } }
        @keyframes flow-shimmer { 0% { left: -100%; } 100% { left: 200%; } }
        .cfo-flow { background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #A7F3D0; position: relative; overflow: hidden; }
        .cfo-flow::before { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(16,185,129,0.1), transparent); animation: flow-shimmer 3s ease-in-out infinite; }
        .cfo-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; position: relative; z-index: 1; }
        .cfo-title { color: #065F46; font-size: 1.1rem; font-weight: 600; }
        .cfo-status { color: #059669; font-size: 0.8rem; background: #A7F3D0; padding: 0.3rem 0.8rem; border-radius: 20px; font-weight: 500; }
        .revenue-streams { display: flex; gap: 0.5rem; margin-bottom: 1rem; position: relative; z-index: 1; }
        .stream-pipe { flex: 1; height: 10px; background: #A7F3D0; border-radius: 5px; position: relative; overflow: hidden; }
        .stream-flow { position: absolute; height: 100%; width: 60px; background: linear-gradient(90deg, transparent, #10B981, #059669, #10B981, transparent); animation: flow-right 2s linear infinite; }
        .cfo-metrics { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; position: relative; z-index: 1; }
        .cfo-metric { background: white; border-radius: 10px; padding: 1rem; text-align: center; animation: pulse-green 3s ease-in-out infinite; border: 1px solid #A7F3D0; }
        .cfo-metric:nth-child(2) { animation-delay: 0.5s; }
        .cfo-metric:nth-child(3) { animation-delay: 1s; }
        .cfo-metric:nth-child(4) { animation-delay: 1.5s; }
        .cfo-val { font-size: 1.4rem; font-weight: 700; color: #059669; }
        .cfo-label { font-size: 0.7rem; color: #047857; text-transform: uppercase; margin-top: 0.25rem; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="cfo-flow"><div class="cfo-header"><div class="cfo-title">💰 Revenue Flow Monitor</div><div class="cfo-status">● Healthy Cash Flow</div></div><div class="revenue-streams"><div class="stream-pipe"><div class="stream-flow"></div></div><div class="stream-pipe"><div class="stream-flow" style="animation-delay:0.3s"></div></div><div class="stream-pipe"><div class="stream-flow" style="animation-delay:0.6s"></div></div><div class="stream-pipe"><div class="stream-flow" style="animation-delay:0.9s"></div></div></div><div class="cfo-metrics"><div class="cfo-metric"><div class="cfo-val">£7.4M</div><div class="cfo-label">Monthly Revenue</div></div><div class="cfo-metric"><div class="cfo-val">23.1%</div><div class="cfo-label">Gross Margin</div></div><div class="cfo-metric"><div class="cfo-val">£2.1M</div><div class="cfo-label">Operating Cash</div></div><div class="cfo-metric"><div class="cfo-val">98.2%</div><div class="cfo-label">Collection Rate</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        @keyframes cfo-kpi-rise { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes cfo-bar-fill { 0% { transform: scaleY(0); } 100% { transform: scaleY(1); } }
        @keyframes cfo-delta-glow { 0%, 100% { box-shadow: 0 0 0 rgba(16,185,129,0); } 50% { box-shadow: 0 0 8px rgba(16,185,129,0.4); } }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
            animation: cfo-kpi-rise 0.6s ease-out forwards;
        }
        .kpi-card:nth-child(2) { animation-delay: 0.1s; }
        .kpi-card:nth-child(3) { animation-delay: 0.2s; }
        .kpi-card:nth-child(4) { animation-delay: 0.3s; }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: cfo-delta-glow 2s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes cfo-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 1; } 
            50% { stroke-width: 3.5; opacity: 0.8; } 
        }
        @keyframes cfo-fill-pulse { 
            0%, 100% { opacity: 0.15; transform: scaleY(1); } 
            50% { opacity: 0.25; transform: scaleY(1.02); } 
        }
        @keyframes cfo-bar-wave { 
            0%, 100% { transform: scaleY(1); } 
            50% { transform: scaleY(0.7); } 
        }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.15;
        }
        .kpi-chart path[fill="none"] { animation: cfo-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: cfo-fill-pulse 3s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: cfo-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-card:nth-child(2) .kpi-chart rect:nth-child(1) { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart rect:nth-child(2) { animation-delay: 0.1s; }
        .kpi-card:nth-child(2) .kpi-chart rect:nth-child(3) { animation-delay: 0.15s; }
        .kpi-card:nth-child(2) .kpi-chart rect:nth-child(4) { animation-delay: 0.2s; }
        .kpi-card:nth-child(2) .kpi-chart rect:nth-child(5) { animation-delay: 0.25s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Financial Performance Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Total Revenue</div>
                <div class="kpi-value">£65.8M</div>
                <div class="kpi-delta positive">↑ +12.4% YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">EBITDA</div>
                <div class="kpi-value">£18.2M</div>
                <div class="kpi-delta positive">↑ 27.6% margin</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="32" width="12" height="8" fill="#8B5CF6"/>
                    <rect x="22" y="28" width="12" height="12" fill="#8B5CF6"/>
                    <rect x="39" y="24" width="12" height="16" fill="#8B5CF6"/>
                    <rect x="56" y="20" width="12" height="20" fill="#8B5CF6"/>
                    <rect x="73" y="14" width="12" height="26" fill="#8B5CF6"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">💵</div>
                <div class="kpi-label">Free Cash Flow</div>
                <div class="kpi-value">£8.4M</div>
                <div class="kpi-delta positive">↑ +18.2% QoQ</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,30 L20,28 L40,32 L60,24 L80,20 L100,14" fill="none" stroke="#29B5E8" stroke-width="2"/>
                    <path d="M0,30 L20,28 L40,32 L60,24 L80,20 L100,14 L100,40 L0,40 Z" fill="#29B5E8"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">Billing Efficiency</div>
                <div class="kpi-value">98.2%</div>
                <div class="kpi-delta positive">↑ +1.1% vs target</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16" fill="none" stroke="#F59E0B" stroke-width="2"/>
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16 L100,40 L0,40 Z" fill="#F59E0B"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">ARPU (Consumer)</div>
                <div class="kpi-value">£32.40</div>
                <div class="kpi-delta positive">↑ +£2.10 YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🏢</div>
                <div class="kpi-label">ARPU (Enterprise)</div>
                <div class="kpi-value">£142.00</div>
                <div class="kpi-delta positive">↑ +£8.50 YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">📑</div>
                <div class="kpi-label">DSO (Days)</div>
                <div class="kpi-value">32</div>
                <div class="kpi-delta neutral">Target: 28</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">Overdue (£)</div>
                <div class="kpi-value">£0.30M</div>
                <div class="kpi-delta negative">4.6% of billing</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Revenue by Customer Type & Segment</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                revenue_data = pd.DataFrame({
                    'Customer Type': ['Consumer', 'Consumer', 'Consumer', 'Consumer', 'SMB', 'SMB', 'Enterprise', 'Enterprise'],
                    'Segment': ['Budget', 'Standard', 'Premium', 'VIP', 'Small', 'Medium', 'Corporate', 'Strategic'],
                    'Revenue': [4.2, 12.8, 8.5, 3.2, 5.8, 8.4, 12.2, 10.7],
                    'ARPU': [22, 32, 45, 68, 52, 65, 128, 185],
                    'Subscribers': [5473, 10500, 3800, 1400, 2800, 3200, 950, 450]
                })
                
                bars = alt.Chart(revenue_data).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Revenue:Q', title='Revenue (£M)', scale=alt.Scale(domain=[0, 15])),
                    y=alt.Y('Segment:N', sort=alt.EncodingSortField(field='Revenue', order='descending'), title=None),
                    color=alt.Color('Customer Type:N',
                        scale=alt.Scale(
                            domain=['Consumer', 'SMB', 'Enterprise'],
                            range=['#29B5E8', '#10B981', '#8B5CF6']
                        ),
                        legend=alt.Legend(orient='top', title=None)
                    ),
                    tooltip=[
                        alt.Tooltip('Customer Type:N'),
                        alt.Tooltip('Segment:N'),
                        alt.Tooltip('Revenue:Q', title='Revenue (£M)', format='.1f'),
                        alt.Tooltip('ARPU:Q', title='ARPU (£)', format='d'),
                        alt.Tooltip('Subscribers:Q', format=',')
                    ]
                ).properties(height=280)
                
                text = alt.Chart(revenue_data).mark_text(
                    align='left', dx=5, fontSize=11, fontWeight='bold'
                ).encode(
                    x=alt.X('Revenue:Q'),
                    y=alt.Y('Segment:N', sort=alt.EncodingSortField(field='Revenue', order='descending')),
                    text=alt.Text('Revenue:Q', format='.1f'),
                    color=alt.value('#1B2A4E')
                )
                
                st.altair_chart(bars + text, use_container_width=True)
                
                seg_cols = st.columns(3)
                with seg_cols[0]:
                    st.markdown("""
                    <div style="background: linear-gradient(135deg, #E0F2FE 0%, #F0F9FF 100%); border-left: 4px solid #29B5E8; border-radius: 0 8px 8px 0; padding: 0.75rem;">
                        <div style="font-weight: 600; color: #29B5E8; font-size: 0.85rem;">Consumer</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #1B2A4E;">£28.7M</div>
                        <div style="color: #6B7280; font-size: 0.75rem;">44% of revenue</div>
                    </div>
                    """, unsafe_allow_html=True)
                with seg_cols[1]:
                    st.markdown("""
                    <div style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-left: 4px solid #10B981; border-radius: 0 8px 8px 0; padding: 0.75rem;">
                        <div style="font-weight: 600; color: #10B981; font-size: 0.85rem;">SMB</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #1B2A4E;">£14.2M</div>
                        <div style="color: #6B7280; font-size: 0.75rem;">22% of revenue</div>
                    </div>
                    """, unsafe_allow_html=True)
                with seg_cols[2]:
                    st.markdown("""
                    <div style="background: linear-gradient(135deg, #EDE9FE 0%, #F5F3FF 100%); border-left: 4px solid #8B5CF6; border-radius: 0 8px 8px 0; padding: 0.75rem;">
                        <div style="font-weight: 600; color: #8B5CF6; font-size: 0.85rem;">Enterprise</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #1B2A4E;">£22.9M</div>
                        <div style="color: #6B7280; font-size: 0.75rem;">34% of revenue</div>
                    </div>
                    """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Monthly Revenue & ARPU Trend</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                monthly_data = pd.DataFrame({
                    'Month': months,
                    'Revenue': [5.12, 5.28, 5.41, 5.52, 5.68, 5.85],
                    'Target': [5.0, 5.15, 5.30, 5.45, 5.60, 5.75]
                })
                
                # Revenue bars
                revenue_bars = alt.Chart(monthly_data).mark_bar(
                    color='#29B5E8', 
                    cornerRadiusTopLeft=6, 
                    cornerRadiusTopRight=6, 
                    opacity=0.8
                ).encode(
                    x=alt.X('Month:N', sort=months, title=None, axis=alt.Axis(labelAngle=0)),
                    y=alt.Y('Revenue:Q', title='Revenue (£M)', scale=alt.Scale(domain=[0, 7])),
                    tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Revenue:Q', title='Revenue (£M)', format='.2f')]
                )
                
                # Target line
                target_line = alt.Chart(monthly_data).mark_line(
                    color='#DC2626', 
                    strokeWidth=2, 
                    strokeDash=[5, 3]
                ).encode(
                    x=alt.X('Month:N', sort=months),
                    y=alt.Y('Target:Q', scale=alt.Scale(domain=[0, 7])),
                    tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Target:Q', title='Target (£M)', format='.2f')]
                )
                
                # Combine layers
                combined = alt.layer(revenue_bars, target_line).properties(height=220)
                st.altair_chart(combined, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; gap: 1.5rem; font-size: 0.8rem; justify-content: center; margin-top: 0.5rem;">
                    <span><span style="color: #29B5E8;">█</span> Revenue (£M)</span>
                    <span><span style="color: #DC2626;">╌╌</span> Target</span>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Billing Status Distribution</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                billing_status = pd.DataFrame({
                    'Status': ['Paid', 'Pending', 'Overdue 1-30d', 'Overdue 31-60d', 'Overdue 60d+'],
                    'Amount': [5.82, 0.42, 0.18, 0.08, 0.04],
                    'Count': [28450, 2100, 890, 320, 180],
                    'Percentage': [89.0, 6.4, 2.8, 1.2, 0.6]
                })
                
                donut = alt.Chart(billing_status).mark_arc(innerRadius=60, outerRadius=100, cornerRadius=4).encode(
                    theta=alt.Theta('Amount:Q', stack=True),
                    color=alt.Color('Status:N',
                        scale=alt.Scale(
                            domain=['Paid', 'Pending', 'Overdue 1-30d', 'Overdue 31-60d', 'Overdue 60d+'],
                            range=['#10B981', '#29B5E8', '#F59E0B', '#F97316', '#DC2626']
                        ),
                        legend=None
                    ),
                    tooltip=[
                        alt.Tooltip('Status:N'),
                        alt.Tooltip('Amount:Q', title='Amount (£M)', format='.2f'),
                        alt.Tooltip('Count:Q', title='Invoices', format=','),
                        alt.Tooltip('Percentage:Q', title='Share (%)', format='.1f')
                    ],
                    order=alt.Order('Amount:Q', sort='descending')
                ).properties(height=220)
                
                center_text = alt.Chart(pd.DataFrame({'text': ['£6.54M']})).mark_text(
                    fontSize=22, fontWeight='bold', color='#1B2A4E'
                ).encode(text='text:N')
                
                center_sub = alt.Chart(pd.DataFrame({'text': ['Total Billed']})).mark_text(
                    fontSize=11, color='#6B7280', dy=18
                ).encode(text='text:N')
                
                st.altair_chart(donut + center_text + center_sub, use_container_width=True)
                
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #10B981; border-radius: 2px; margin-right: 6px;"></span>Paid</span>
                        <span style="font-weight: 600;">£5.82M (89%)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #29B5E8; border-radius: 2px; margin-right: 6px;"></span>Pending</span>
                        <span style="font-weight: 600;">£0.42M (6.4%)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #F59E0B; border-radius: 2px; margin-right: 6px;"></span>Overdue 1-30d</span>
                        <span style="font-weight: 600; color: #F59E0B;">£0.18M</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #F97316; border-radius: 2px; margin-right: 6px;"></span>Overdue 31-60d</span>
                        <span style="font-weight: 600; color: #F97316;">£0.08M</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #DC2626; border-radius: 2px; margin-right: 6px;"></span>Overdue 60d+</span>
                        <span style="font-weight: 600; color: #DC2626;">£0.04M</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
                
                st.markdown("""
                <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 8px; padding: 0.75rem; margin-top: 0.75rem; border-left: 4px solid #F59E0B;">
                    <div style="display: flex; align-items: center;">
                        <span style="font-size: 1.25rem; margin-right: 0.5rem;">⚠️</span>
                        <div>
                            <strong style="color: #92400E; font-size: 0.85rem;">Action Required</strong>
                            <div style="color: #B45309; font-size: 0.8rem;">£0.30M overdue · 1,390 invoices need follow-up</div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Payment Method Mix</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                payment_data = pd.DataFrame({
                    'Method': ['Direct Debit', 'Card', 'Bank Transfer', 'PayPal', 'Other'],
                    'Percentage': [62, 21, 10, 5, 2],
                    'Amount': [4.06, 1.37, 0.65, 0.33, 0.13]
                })
                
                bars = alt.Chart(payment_data).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Percentage:Q', title='Share (%)', scale=alt.Scale(domain=[0, 70])),
                    y=alt.Y('Method:N', sort='-x', title=None),
                    color=alt.Color('Method:N',
                        scale=alt.Scale(
                            domain=['Direct Debit', 'Card', 'Bank Transfer', 'PayPal', 'Other'],
                            range=['#29B5E8', '#10B981', '#8B5CF6', '#F59E0B', '#6B7280']
                        ),
                        legend=None
                    ),
                    tooltip=[
                        alt.Tooltip('Method:N'),
                        alt.Tooltip('Percentage:Q', title='Share (%)', format='d'),
                        alt.Tooltip('Amount:Q', title='Amount (£M)', format='.2f')
                    ]
                ).properties(height=160)
                
                st.altair_chart(bars, use_container_width=True)
        
        st.markdown('<div class="section-header">ARPU Analysis by Customer Type & Segment</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            col_arpu1, col_arpu2 = st.columns([1.2, 1])
            
            with col_arpu1:
                arpu_trend = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'] * 3,
                    'Type': ['Consumer'] * 6 + ['SMB'] * 6 + ['Enterprise'] * 6,
                    'ARPU': [30.2, 30.8, 31.4, 31.9, 32.2, 32.4,
                            54.5, 55.8, 56.2, 57.1, 57.8, 58.2,
                            135, 138, 140, 141, 142, 142]
                })
                
                arpu_chart = alt.Chart(arpu_trend).mark_line(strokeWidth=3, point=alt.OverlayMarkDef(filled=True, size=50)).encode(
                    x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None, axis=alt.Axis(labelAngle=0)),
                    y=alt.Y('ARPU:Q', title='ARPU (£)', scale=alt.Scale(domain=[25, 150])),
                    color=alt.Color('Type:N',
                        scale=alt.Scale(
                            domain=['Consumer', 'SMB', 'Enterprise'],
                            range=['#29B5E8', '#10B981', '#8B5CF6']
                        ),
                        legend=alt.Legend(orient='top', title=None)
                    ),
                    tooltip=[
                        alt.Tooltip('Month:N'),
                        alt.Tooltip('Type:N'),
                        alt.Tooltip('ARPU:Q', title='ARPU (£)', format='.1f')
                    ]
                ).properties(height=220)
                
                st.altair_chart(arpu_chart, use_container_width=True)
            
            with col_arpu2:
                arpu_segment = pd.DataFrame({
                    'Segment': ['Budget', 'Standard', 'Premium', 'VIP', 'Small', 'Medium', 'Corporate', 'Strategic'],
                    'ARPU': [22, 32, 45, 68, 52, 65, 128, 185],
                    'Type': ['Consumer', 'Consumer', 'Consumer', 'Consumer', 'SMB', 'SMB', 'Enterprise', 'Enterprise'],
                    'YoY_Change': ['+8%', '+7%', '+9%', '+12%', '+6%', '+8%', '+11%', '+15%']
                })
                
                lollipop_line = alt.Chart(arpu_segment).mark_rule(strokeWidth=3).encode(
                    x=alt.X('ARPU:Q', title='ARPU (£)', scale=alt.Scale(domain=[0, 200])),
                    x2=alt.value(0),
                    y=alt.Y('Segment:N', sort=list(arpu_segment['Segment']), title=None),
                    color=alt.Color('Type:N',
                        scale=alt.Scale(
                            domain=['Consumer', 'SMB', 'Enterprise'],
                            range=['#29B5E8', '#10B981', '#8B5CF6']
                        ),
                        legend=None
                    )
                )
                
                lollipop_point = alt.Chart(arpu_segment).mark_circle(size=200).encode(
                    x='ARPU:Q',
                    y=alt.Y('Segment:N', sort=list(arpu_segment['Segment'])),
                    color=alt.Color('Type:N',
                        scale=alt.Scale(
                            domain=['Consumer', 'SMB', 'Enterprise'],
                            range=['#29B5E8', '#10B981', '#8B5CF6']
                        )
                    ),
                    tooltip=[
                        alt.Tooltip('Segment:N'),
                        alt.Tooltip('ARPU:Q', title='ARPU (£)', format='d'),
                        alt.Tooltip('YoY_Change:N', title='YoY Growth')
                    ]
                )
                
                text_labels = alt.Chart(arpu_segment).mark_text(align='left', dx=12, fontSize=10, fontWeight='bold').encode(
                    x='ARPU:Q',
                    y=alt.Y('Segment:N', sort=list(arpu_segment['Segment'])),
                    text='YoY_Change:N',
                    color=alt.value('#10B981')
                )
                
                st.altair_chart((lollipop_line + lollipop_point + text_labels).properties(height=220), use_container_width=True)
        
        col_profit, col_vendor = st.columns(2)
        
        with col_profit:
            st.markdown('<div class="section-header">Profitability Waterfall</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                waterfall_data = pd.DataFrame({
                    'Category': ['Revenue', 'COGS', 'Gross Profit', 'OpEx', 'EBITDA', 'D&A', 'EBIT', 'Interest', 'Net Income'],
                    'Amount': [65.8, -20.7, 45.1, -26.9, 18.2, -4.2, 14.0, -2.1, 11.9],
                    'Type': ['total', 'negative', 'subtotal', 'negative', 'subtotal', 'negative', 'subtotal', 'negative', 'total'],
                    'Display': [65.8, 20.7, 45.1, 26.9, 18.2, 4.2, 14.0, 2.1, 11.9]
                })
                
                margin_data = pd.DataFrame({
                    'Metric': ['Gross Margin', 'EBITDA Margin', 'Net Margin'],
                    'Value': [68.5, 27.6, 18.1],
                    'Target': [70, 30, 20]
                })
                
                bars = alt.Chart(margin_data).mark_bar(cornerRadiusTopRight=8, cornerRadiusBottomRight=8).encode(
                    x=alt.X('Value:Q', title='Margin (%)', scale=alt.Scale(domain=[0, 80])),
                    y=alt.Y('Metric:N', sort=list(margin_data['Metric']), title=None),
                    color=alt.condition(
                        alt.datum.Value >= alt.datum.Target,
                        alt.value('#10B981'),
                        alt.value('#F59E0B')
                    ),
                    tooltip=[
                        alt.Tooltip('Metric:N'),
                        alt.Tooltip('Value:Q', title='Current %', format='.1f'),
                        alt.Tooltip('Target:Q', title='Target %', format='.1f')
                    ]
                ).properties(height=140)
                
                target_tick = alt.Chart(margin_data).mark_tick(color='#DC2626', thickness=3, size=25).encode(
                    x='Target:Q',
                    y=alt.Y('Metric:N', sort=list(margin_data['Metric']))
                )
                
                value_text = alt.Chart(margin_data).mark_text(align='left', dx=5, fontSize=12, fontWeight='bold').encode(
                    x='Value:Q',
                    y=alt.Y('Metric:N', sort=list(margin_data['Metric'])),
                    text=alt.Text('Value:Q', format='.1f'),
                    color=alt.value('#1B2A4E')
                )
                
                st.altair_chart(bars + target_tick + value_text, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; gap: 1rem; font-size: 0.8rem; color: #6B7280; margin-top: 0.5rem;">
                    <span><span style="color: #10B981;">█</span> On Target</span>
                    <span><span style="color: #F59E0B;">█</span> Below Target</span>
                    <span><span style="color: #DC2626;">|</span> Target</span>
                </div>
                """, unsafe_allow_html=True)
                
                st.markdown("""
                <div style="background: #F8FAFC; border-radius: 8px; padding: 1rem; margin-top: 0.75rem; border: 1px solid #E2E8F0;">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; text-align: center;">
                        <div>
                            <div style="font-size: 0.7rem; color: #64748B;">Revenue</div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #1B2A4E;">£65.8M</div>
                        </div>
                        <div>
                            <div style="font-size: 0.7rem; opacity: 0.8;">EBITDA</div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #10B981;">£18.2M</div>
                        </div>
                        <div>
                            <div style="font-size: 0.7rem; opacity: 0.8;">Net Income</div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #29B5E8;">£11.9M</div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_vendor:
            st.markdown('<div class="section-header">Vendor Spend by Department</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                vendor_data = pd.DataFrame({
                    'Department': ['Network Ops', 'IT Systems', 'Marketing', 'Customer Service', 'Facilities', 'HR & Admin'],
                    'Spend': [12.4, 8.2, 4.5, 3.8, 2.1, 1.5],
                    'Budget': [13.0, 8.5, 5.0, 4.0, 2.5, 1.8],
                    'Variance': ['-4.6%', '-3.5%', '-10%', '-5%', '-16%', '-16.7%']
                })
                
                vendor_data['Utilization'] = (vendor_data['Spend'] / vendor_data['Budget'] * 100).round(0)
                
                bars = alt.Chart(vendor_data).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Spend:Q', title='Spend (£M)', scale=alt.Scale(domain=[0, 15])),
                    y=alt.Y('Department:N', sort='-x', title=None),
                    color=alt.Color('Utilization:Q',
                        scale=alt.Scale(scheme='blues', domain=[80, 100]),
                        legend=None
                    ),
                    tooltip=[
                        alt.Tooltip('Department:N'),
                        alt.Tooltip('Spend:Q', title='Spend (£M)', format='.1f'),
                        alt.Tooltip('Budget:Q', title='Budget (£M)', format='.1f'),
                        alt.Tooltip('Variance:N', title='vs Budget')
                    ]
                ).properties(height=200)
                
                budget_tick = alt.Chart(vendor_data).mark_tick(color='#DC2626', thickness=3, size=20).encode(
                    x='Budget:Q',
                    y=alt.Y('Department:N', sort='-x')
                )
                
                st.altair_chart(bars + budget_tick, use_container_width=True)
                
                col_v1, col_v2 = st.columns(2)
                with col_v1:
                    st.markdown("""
                    <div style="background: #D1FAE5; border-radius: 8px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #065F46;">Total Spend</div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: #065F46;">£32.5M</div>
                    </div>
                    """, unsafe_allow_html=True)
                with col_v2:
                    st.markdown("""
                    <div style="background: #E0F2FE; border-radius: 8px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #0369A1;">Under Budget</div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: #0369A1;">£2.3M</div>
                    </div>
                    """, unsafe_allow_html=True)
        
        # What-If Analysis Section
        st.markdown('<div class="section-header">📊 What-If Scenario Analysis</div>', unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake** — Real-time financial modeling using Snowpark Python UDFs and Dynamic Tables for instant scenario calculations")
        
        scenario_col1, scenario_col2 = st.columns([1, 2])
        
        with scenario_col1:
            with st.container(border=True):
                st.markdown("**Adjust Scenarios**")
                
                churn_change = st.slider("Churn Rate Change", -3.0, 3.0, 0.0, 0.1, format="%.1f%%", help="Impact of churn reduction initiatives")
                arpu_change = st.slider("ARPU Change", -5.0, 10.0, 0.0, 0.5, format="£%.1f", help="Average Revenue Per User change")
                opex_change = st.slider("OpEx Reduction", -10.0, 5.0, 0.0, 0.5, format="%.1f%%", help="Operating expense change")
                
                st.markdown("---")
                if st.button("🔄 Reset to Baseline", use_container_width=True):
                    st.rerun()
        
        with scenario_col2:
            with st.container(border=True):
                st.markdown("**Projected Impact on Annual Financials**")
                
                # Base values
                base_revenue = 4240  # £M
                base_ebitda = 1420   # £M
                base_customers = 12.4  # M
                base_churn = 1.2  # %
                
                # Calculate impacts
                churn_impact = (churn_change / 100) * base_customers * 420 * -1  # £420 avg annual revenue per customer
                arpu_impact = arpu_change * 12 * base_customers  # annual impact
                opex_impact = (opex_change / 100) * 2820 * -1  # £2.82B OpEx base
                
                total_revenue_impact = churn_impact + arpu_impact
                total_ebitda_impact = total_revenue_impact + opex_impact
                
                impact_cols = st.columns(4)
                
                with impact_cols[0]:
                    delta_color = "normal" if total_revenue_impact >= 0 else "inverse"
                    st.metric("Revenue Impact", f"£{abs(total_revenue_impact):.1f}M", 
                             f"{'↑' if total_revenue_impact >= 0 else '↓'} from baseline",
                             delta_color=delta_color)
                
                with impact_cols[1]:
                    delta_color = "normal" if total_ebitda_impact >= 0 else "inverse"
                    st.metric("EBITDA Impact", f"£{abs(total_ebitda_impact):.1f}M",
                             f"{'↑' if total_ebitda_impact >= 0 else '↓'} from baseline",
                             delta_color=delta_color)
                
                with impact_cols[2]:
                    new_margin = ((base_ebitda + total_ebitda_impact) / (base_revenue + total_revenue_impact)) * 100
                    margin_change = new_margin - 33.5
                    st.metric("New EBITDA Margin", f"{new_margin:.1f}%", f"{margin_change:+.1f}pp")
                
                with impact_cols[3]:
                    retained_customers = (churn_change / 100) * base_customers * -1000
                    st.metric("Customers Retained", f"{retained_customers:+,.0f}K" if churn_change != 0 else "—",
                             "from churn reduction" if churn_change < 0 else "")
                
                # Scenario summary
                if total_ebitda_impact > 50:
                    st.success(f"✅ **Positive Scenario:** This combination could add £{total_ebitda_impact:.0f}M to annual EBITDA")
                elif total_ebitda_impact < -50:
                    st.error(f"⚠️ **Risk Scenario:** This combination could reduce annual EBITDA by £{abs(total_ebitda_impact):.0f}M")
                else:
                    st.info("📊 **Neutral Scenario:** Minimal impact on financials with current parameters")
                
                # Visual Impact Chart
                st.markdown("""
                <style>
                @keyframes impact-bar-fill { 0% { width: 0; } 100% { width: var(--bar-width); } }
                .impact-visual { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #E5E7EB; }
                .impact-bar-container {
                    display: flex;
                    align-items: center;
                    margin-bottom: 0.75rem;
                }
                .impact-bar-label {
                    width: 100px;
                    font-size: 0.8rem;
                    color: #6B7280;
                }
                .impact-bar-track {
                    flex: 1;
                    height: 24px;
                    background: #F3F4F6;
                    border-radius: 12px;
                    position: relative;
                    overflow: hidden;
                }
                .impact-bar-center {
                    position: absolute;
                    left: 50%;
                    top: 0;
                    bottom: 0;
                    width: 2px;
                    background: #9CA3AF;
                }
                .impact-bar-fill {
                    position: absolute;
                    top: 2px;
                    bottom: 2px;
                    border-radius: 10px;
                    animation: impact-bar-fill 1s ease-out forwards;
                }
                .impact-bar-fill.positive { background: linear-gradient(90deg, #10B981, #059669); left: 50%; }
                .impact-bar-fill.negative { background: linear-gradient(90deg, #DC2626, #EF4444); right: 50%; }
                .impact-bar-value {
                    width: 80px;
                    text-align: right;
                    font-weight: 600;
                    font-size: 0.85rem;
                }
                </style>
                """, unsafe_allow_html=True)
                
                # Calculate bar widths (max 50% of track)
                max_impact = 200  # £M for scaling
                revenue_bar_width = min(abs(total_revenue_impact) / max_impact * 50, 50)
                ebitda_bar_width = min(abs(total_ebitda_impact) / max_impact * 50, 50)
                opex_bar_width = min(abs(opex_impact) / max_impact * 50, 50)
                
                revenue_class = "positive" if total_revenue_impact >= 0 else "negative"
                ebitda_class = "positive" if total_ebitda_impact >= 0 else "negative"
                opex_class = "positive" if opex_impact >= 0 else "negative"
                
                st.markdown(f"""
                <div class="impact-visual">
                    <div class="impact-bar-container">
                        <div class="impact-bar-label">Revenue</div>
                        <div class="impact-bar-track">
                            <div class="impact-bar-center"></div>
                            <div class="impact-bar-fill {revenue_class}" style="--bar-width: {revenue_bar_width}%;"></div>
                        </div>
                        <div class="impact-bar-value" style="color: {'#10B981' if total_revenue_impact >= 0 else '#DC2626'};">
                            {'+'if total_revenue_impact >= 0 else '-'}£{abs(total_revenue_impact):.0f}M
                        </div>
                    </div>
                    <div class="impact-bar-container">
                        <div class="impact-bar-label">OpEx Savings</div>
                        <div class="impact-bar-track">
                            <div class="impact-bar-center"></div>
                            <div class="impact-bar-fill {opex_class}" style="--bar-width: {opex_bar_width}%;"></div>
                        </div>
                        <div class="impact-bar-value" style="color: {'#10B981' if opex_impact >= 0 else '#DC2626'};">
                            {'+'if opex_impact >= 0 else '-'}£{abs(opex_impact):.0f}M
                        </div>
                    </div>
                    <div class="impact-bar-container">
                        <div class="impact-bar-label">EBITDA</div>
                        <div class="impact-bar-track">
                            <div class="impact-bar-center"></div>
                            <div class="impact-bar-fill {ebitda_class}" style="--bar-width: {ebitda_bar_width}%;"></div>
                        </div>
                        <div class="impact-bar-value" style="color: {'#10B981' if total_ebitda_impact >= 0 else '#DC2626'};">
                            {'+'if total_ebitda_impact >= 0 else '-'}£{abs(total_ebitda_impact):.0f}M
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
    with tab_ops:
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['FINANCE', 'BILLING', 'REVENUE_ASSURANCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)

        st.markdown("""
        <style>
        @keyframes fin-pulse {
            0% { transform: translateX(-30%); opacity: 0.2; }
            50% { opacity: 0.7; }
            100% { transform: translateX(130%); opacity: 0.2; }
        }
        .fin-pulse {
            position: relative;
            background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%);
            border: 1px solid #A7F3D0;
            border-radius: 14px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        .fin-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -40%;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(16,185,129,0.35), transparent);
            animation: fin-pulse 4.5s ease-in-out infinite;
        }
        .fin-pulse-title { font-weight: 700; color: #065F46; font-size: 1rem; }
        .fin-pulse-sub { color: #047857; font-size: 0.8rem; margin-top: 0.25rem; }
        .fin-pulse-metrics {
            display: flex; gap: 1.2rem; margin-top: 0.6rem; font-size: 0.8rem; color: #065F46;
        }
        .fin-pulse-metrics span {
            background: rgba(255,255,255,0.7);
            border: 1px solid #D1FAE5;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
        }
        </style>
        <div class="fin-pulse">
            <div class="fin-pulse-title">💼 Financial Operations Pulse</div>
            <div class="fin-pulse-sub">Working capital, spend efficiency, and cash posture at a glance</div>
            <div class="fin-pulse-metrics">
                <span>DSO: 32 days</span>
                <span>Overdue: £0.30M</span>
                <span>Cash Runway: 9.3 months</span>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Working Capital</div>', unsafe_allow_html=True)
        wc_left, wc_right = st.columns(2)

        with wc_left:
            st.markdown('<div class="section-header">Accounts Receivable Aging</div>', unsafe_allow_html=True)
            with st.container(border=True):
                ar_data = pd.DataFrame({
                    'Bucket': ['0-30', '31-60', '61-90', '90+'],
                    'Amount': [2.1, 0.9, 0.4, 0.3]
                })
                ar_chart = alt.Chart(ar_data).mark_bar(color='#29B5E8', cornerRadiusEnd=6).encode(
                    y=alt.Y('Bucket:N', sort=None, title=None),
                    x=alt.X('Amount:Q', title='£M', scale=alt.Scale(domain=[0, 2.5])),
                    tooltip=['Bucket:N', alt.Tooltip('Amount:Q', title='£M', format='.1f')]
                ).properties(height=180)
                st.altair_chart(ar_chart, use_container_width=True)

        with wc_right:
            st.markdown('<div class="section-header">Accounts Payable Aging</div>', unsafe_allow_html=True)
            with st.container(border=True):
                ap_data = pd.DataFrame({
                    'Bucket': ['0-30', '31-60', '61-90', '90+'],
                    'Amount': [1.6, 0.7, 0.3, 0.1]
                })
                ap_chart = alt.Chart(ap_data).mark_bar(color='#10B981', cornerRadiusEnd=6).encode(
                    y=alt.Y('Bucket:N', sort=None, title=None),
                    x=alt.X('Amount:Q', title='£M', scale=alt.Scale(domain=[0, 2.0])),
                    tooltip=['Bucket:N', alt.Tooltip('Amount:Q', title='£M', format='.1f')]
                ).properties(height=180)
                st.altair_chart(ap_chart, use_container_width=True)

        st.markdown('<div class="section-header">Cost Structure</div>', unsafe_allow_html=True)
        cost_cols = st.columns([1.2, 1])
        with cost_cols[0]:
            with st.container(border=True):
                opex = pd.DataFrame({
                    'Category': ['Network', 'IT', 'Support', 'Sales', 'Admin'],
                    'Spend': [2.8, 1.9, 1.2, 0.9, 0.6]
                })
                donut = alt.Chart(opex).mark_arc(innerRadius=45, outerRadius=80).encode(
                    theta=alt.Theta('Spend:Q'),
                    color=alt.Color('Category:N', legend=None),
                    tooltip=['Category:N', alt.Tooltip('Spend:Q', title='£M', format='.1f')]
                ).properties(height=200)
                st.altair_chart(donut, use_container_width=True)
        with cost_cols[1]:
            with st.container(border=True):
                st.markdown("""
                **Top Cost Drivers**
                - Network Ops: **£2.8M**
                - IT & Cloud: **£1.9M**
                - Support: **£1.2M**
                - Sales: **£0.9M**
                """)

        st.markdown('<div class="section-header">Cash Runway & Forecast</div>', unsafe_allow_html=True)
        with st.container(border=True):
            st.markdown("""
            <style>
            @keyframes cash-fill { 0% { width: 0%; } 100% { width: 78%; } }
            .cash-bar { background: #F3F4F6; border-radius: 999px; height: 14px; overflow: hidden; }
            .cash-fill { height: 100%; background: linear-gradient(90deg, #10B981, #34D399); animation: cash-fill 1.8s ease-out forwards; }
            .cash-row { display: flex; justify-content: space-between; font-size: 0.8rem; color: #6B7280; margin-top: 0.4rem; }
            </style>
            <div style="font-weight: 600; margin-bottom: 0.4rem;">Runway Coverage: 9.3 months</div>
            <div class="cash-bar"><div class="cash-fill"></div></div>
            <div class="cash-row"><span>Low: 6 months</span><span>Target: 12 months</span></div>
            """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Top Vendor Spend</div>', unsafe_allow_html=True)
        vendor_cols = st.columns([1.2, 1])
        with vendor_cols[0]:
            with st.container(border=True):
                vendor_data = pd.DataFrame({
                    'Vendor': ['Ericsson', 'AWS', 'Nokia', 'Accenture', 'Microsoft'],
                    'Spend': [1.8, 1.2, 0.9, 0.7, 0.6]
                })
                vendor_chart = alt.Chart(vendor_data).mark_bar(color='#10B981', cornerRadiusEnd=6).encode(
                    y=alt.Y('Vendor:N', sort='-x', title=None),
                    x=alt.X('Spend:Q', title='£M'),
                    tooltip=['Vendor:N', alt.Tooltip('Spend:Q', title='£M', format='.1f')]
                ).properties(height=200)
                st.altair_chart(vendor_chart, use_container_width=True)
        with vendor_cols[1]:
            with st.container(border=True):
                st.markdown("""
                **Spend Notes**
                - Cloud costs trending down **-6% QoQ**
                - Network vendor savings **£0.4M** via consolidation
                - Professional services under budget
                """)

        st.markdown('<div class="section-header">Budget vs Actual (YTD)</div>', unsafe_allow_html=True)
        with st.container(border=True):
            budget_data = pd.DataFrame({
                'Category': ['Network', 'IT', 'Support', 'Sales', 'Admin'],
                'Budget': [3.0, 2.1, 1.4, 1.0, 0.7],
                'Actual': [2.8, 1.9, 1.2, 0.9, 0.6]
            })
            budget = alt.Chart(budget_data).mark_bar(color='#94A3B8').encode(
                y=alt.Y('Category:N', sort='-x', title=None),
                x=alt.X('Budget:Q', title='£M'),
                tooltip=['Category:N', alt.Tooltip('Budget:Q', title='Budget (£M)', format='.1f')]
            )
            actual = alt.Chart(budget_data).mark_bar(color='#29B5E8').encode(
                y=alt.Y('Category:N', sort='-x'),
                x=alt.X('Actual:Q'),
                tooltip=['Category:N', alt.Tooltip('Actual:Q', title='Actual (£M)', format='.1f')]
            )
            st.altair_chart(alt.layer(budget, actual).properties(height=220), use_container_width=True)

    with tab_strategy:
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Finance insights synthesized from billing, payments, and revenue data.")
        
        with st.container(border=True):
            st.markdown("""
            **Finance Summary (Q1 2026):**
            - Revenue +12.4% YoY with EBITDA margin at **27.6%**.
            - Collection rate remains strong at **98.2%**, but DSO sits above target (32 vs 28).
            - OpEx trending below budget in IT and Support, supporting margin expansion.
            """)

        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Revenue growth**: +£7.4M MTD
                - **Enterprise ARPU**: £142 (+15% YoY)
                - **Billing accuracy**: 98.2%
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **DSO** above target by 4 days
                - **Overdue** balance at £0.30M
                - **Credit exposure** rising in SMB
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Efficiency Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **OpEx savings** £1.5M identified
                - **Cloud spend** down 6% QoQ
                - **Cash runway** 9.3 months
                """)

        st.markdown('<div class="section-header">Recommended Actions</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                **1) DSO Reduction**
                - Automate reminders & escalations
                - Tighten credit checks
                - Target: **28 days**
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                **2) Margin Expansion**
                - Vendor consolidation
                - Reduce low-ROI spend
                - Target: **30% EBITDA**
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                **3) Cash Discipline**
                - Prioritize collections
                - Defer non-critical CapEx
                - Maintain **12-month runway**
                """)

        st.markdown('<div class="section-header">CFO Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Reduce DSO to 28 Days</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current DSO: **32 days** (target: 28)
                - **£0.30M** overdue requiring action
                - Implement automated reminders
                - Expected cash improvement: **£0.8M**
                """)
        
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Grow Enterprise ARPU</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Enterprise ARPU: **£142** (+15% YoY)
                - Strategic accounts: **£185** ARPU
                - Upsell pipeline: **£3.2M** qualified
                - Target: **£155** ARPU by Q4
                """)
        
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">EBITDA Margin to 30%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current margin: **27.6%** (target: 30%)
                - OpEx savings identified: **£1.5M**
                - Vendor consolidation: **£0.4M**
                - Automation savings: **£0.3M**
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "Show me our revenue breakdown by customer type - Consumer, SMB, and Enterprise - with average bill amounts.",
            "What's our ARPU by customer type and segment? Show me Consumer vs SMB vs Enterprise, and break down by value tier.",
            "What's our payment status distribution? Show me Paid vs Pending vs Overdue by customer type.",
            "What are our top vendor expenses by department and what's the approval status?",
            "What revenue is at risk from churned customers? Show me lifetime value lost by customer type."
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_cmo_marketing():
    import pandas as pd
    import altair as alt
    
    # CMO Header with Radar Scan Effect
    st.markdown("""
    <style>
    @keyframes cmo-radar-sweep {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    @keyframes cmo-ping { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }
    @keyframes cmo-target-blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
    .cmo-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .cmo-radar-bg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; pointer-events: none; opacity: 0.3; }
    .cmo-radar-ring { position: absolute; border: 1px solid rgba(236,72,153,0.5); border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    .cmo-radar-sweep { position: absolute; top: 50%; left: 50%; width: 100px; height: 2px; background: linear-gradient(90deg, transparent, #EC4899); transform-origin: left center; animation: cmo-radar-sweep 3s linear infinite; }
    .cmo-ping { position: absolute; width: 10px; height: 10px; background: #EC4899; border-radius: 50%; animation: cmo-ping 2s ease-out infinite; }
    .cmo-target { position: absolute; width: 8px; height: 8px; background: #EC4899; border-radius: 50%; animation: cmo-target-blink 1.5s ease-in-out infinite; }
    .cmo-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(135deg, #FDF2F8 0%, #FCE7F3 100%);
        border: 1px solid #FBCFE8;
        padding: 2rem; color: #9D174D;
    }
    .cmo-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; color: #9D174D; }
    .cmo-header-content p { margin: 0.5rem 0 0 0; color: #BE185D; font-size: 1.1rem; }
    </style>
    <div class="cmo-header-wrap">
        <div class="cmo-radar-bg">
            <div class="cmo-radar-ring" style="width: 60px; height: 60px;"></div>
            <div class="cmo-radar-ring" style="width: 120px; height: 120px;"></div>
            <div class="cmo-radar-ring" style="width: 180px; height: 180px;"></div>
            <div class="cmo-radar-sweep"></div>
            <div class="cmo-ping" style="top: 30%; left: 60%; animation-delay: 0s;"></div>
            <div class="cmo-ping" style="top: 60%; left: 75%; animation-delay: 1s;"></div>
            <div class="cmo-target" style="top: 25%; left: 70%; animation-delay: 0.3s;"></div>
            <div class="cmo-target" style="top: 70%; left: 30%; animation-delay: 0.8s;"></div>
            <div class="cmo-target" style="top: 40%; left: 80%; animation-delay: 1.3s;"></div>
        </div>
        <div class="cmo-header-content">
            <h1>CMO Marketing Dashboard</h1>
            <p>Customer Acquisition, Campaign Performance & Brand Health</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_campaigns, tab_strategy = st.tabs(["📊 Overview & Analysis", "📣 Campaigns & Growth", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['MARKETING', 'SALES', 'MOBILE', 'CUSTOMER_EXPERIENCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # CMO CAMPAIGN RADAR ANIMATION
        st.markdown("""
        <style>
        @keyframes radar-scan { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes radar-ping { 0% { transform: scale(0.8); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
        @keyframes dot-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }
        @keyframes cmo-channel-slide { 0% { opacity: 0; transform: translateX(-20px); } 100% { opacity: 1; transform: translateX(0); } }
        @keyframes cmo-val-count { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cmo-trend-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-2px); } }
        @keyframes cmo-shimmer { 0% { left: -100%; } 100% { left: 200%; } }
        .cmo-radar { background: linear-gradient(135deg, #F5F3FF 0%, #EDE9FE 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 2rem; border: 1px solid #DDD6FE; position: relative; overflow: hidden; }
        .cmo-radar::before { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(124,58,237,0.08), transparent); animation: cmo-shimmer 4s ease-in-out infinite; }
        .radar-container { width: 140px; height: 140px; position: relative; flex-shrink: 0; }
        .radar-circle { position: absolute; border: 2px solid rgba(124,58,237,0.3); border-radius: 50%; }
        .radar-c1 { width: 100%; height: 100%; top: 0; left: 0; }
        .radar-c2 { width: 70%; height: 70%; top: 15%; left: 15%; }
        .radar-c3 { width: 40%; height: 40%; top: 30%; left: 30%; }
        .radar-sweep { position: absolute; width: 50%; height: 2px; top: 50%; left: 50%; background: linear-gradient(90deg, #7C3AED, transparent); transform-origin: left center; animation: radar-scan 3s linear infinite; }
        .radar-dot { position: absolute; width: 10px; height: 10px; background: #10B981; border-radius: 50%; animation: dot-pulse 2s ease-in-out infinite; box-shadow: 0 0 10px rgba(16,185,129,0.5); }
        .radar-dot::after { content: ''; position: absolute; width: 100%; height: 100%; background: #10B981; border-radius: 50%; animation: radar-ping 2s ease-out infinite; }
        .cmo-channels { flex: 1; display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; position: relative; z-index: 1; }
        .channel-item { background: white; border-radius: 10px; padding: 0.8rem 1rem; animation: cmo-channel-slide 0.5s ease-out forwards; border: 1px solid #DDD6FE; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .channel-item:nth-child(2) { animation-delay: 0.1s; }
        .channel-item:nth-child(3) { animation-delay: 0.2s; }
        .channel-item:nth-child(4) { animation-delay: 0.3s; }
        .channel-name { color: #6B7280; font-size: 0.75rem; }
        .channel-val { color: #7C3AED; font-size: 1.2rem; font-weight: 700; animation: cmo-val-count 0.6s ease-out 0.3s forwards; opacity: 0; }
        .channel-item:nth-child(2) .channel-val { animation-delay: 0.4s; }
        .channel-item:nth-child(3) .channel-val { animation-delay: 0.5s; }
        .channel-item:nth-child(4) .channel-val { animation-delay: 0.6s; }
        .channel-trend { color: #10B981; font-size: 0.75rem; font-weight: 500; animation: cmo-trend-bounce 2s ease-in-out infinite; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="cmo-radar"><div class="radar-container"><div class="radar-circle radar-c1"></div><div class="radar-circle radar-c2"></div><div class="radar-circle radar-c3"></div><div class="radar-sweep"></div><div class="radar-dot" style="top:20%;left:60%"></div><div class="radar-dot" style="top:65%;left:25%;animation-delay:0.5s"></div><div class="radar-dot" style="top:40%;left:75%;animation-delay:1s"></div><div class="radar-dot" style="top:70%;left:70%;animation-delay:1.5s"></div></div><div class="cmo-channels"><div class="channel-item"><div class="channel-name">📱 Digital Campaigns</div><div class="channel-val">847K</div><div class="channel-trend">↑ 23% reach</div></div><div class="channel-item"><div class="channel-name">📧 Email Marketing</div><div class="channel-val">34.2%</div><div class="channel-trend">↑ Open rate</div></div><div class="channel-item"><div class="channel-name">🎯 Conversion Rate</div><div class="channel-val">12.8%</div><div class="channel-trend">↑ +2.1 pts</div></div><div class="channel-item"><div class="channel-name">💰 Campaign ROI</div><div class="channel-val">4.2x</div><div class="channel-trend">↑ vs 3.5x target</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
            animation: cmo-kpi-pop 0.6s ease-out forwards;
            opacity: 0;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes cmo-kpi-pop { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cmo-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 1; } 
            50% { stroke-width: 3.5; opacity: 0.8; } 
        }
        @keyframes cmo-fill-pulse { 
            0%, 100% { opacity: 0.15; transform: scaleY(1); } 
            50% { opacity: 0.25; transform: scaleY(1.02); } 
        }
        @keyframes cmo-bar-wave { 
            0%, 100% { transform: scaleY(1); } 
            50% { transform: scaleY(0.7); } 
        }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.15;
        }
        .kpi-chart path[fill="none"] { animation: cmo-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: cmo-fill-pulse 3s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: cmo-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-card:nth-child(2) .kpi-value { animation-delay: 0.1s; }
        .kpi-card:nth-child(3) .kpi-value { animation-delay: 0.2s; }
        .kpi-card:nth-child(4) .kpi-value { animation-delay: 0.3s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Marketing Performance Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">🎯</div>
                <div class="kpi-label">New Customers (MTD)</div>
                <div class="kpi-value">2,847</div>
                <div class="kpi-delta positive">↑ +18.3% vs target</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,35 L20,30 L40,32 L60,25 L80,20 L100,12" fill="none" stroke="#EC4899" stroke-width="2"/>
                    <path d="M0,35 L20,30 L40,32 L60,25 L80,20 L100,12 L100,40 L0,40 Z" fill="#EC4899"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Campaign ROI</div>
                <div class="kpi-value">4.2x</div>
                <div class="kpi-delta positive">↑ +0.8x vs Q3</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="30" width="12" height="10" fill="#8B5CF6"/>
                    <rect x="22" y="26" width="12" height="14" fill="#8B5CF6"/>
                    <rect x="39" y="22" width="12" height="18" fill="#8B5CF6"/>
                    <rect x="56" y="18" width="12" height="22" fill="#8B5CF6"/>
                    <rect x="73" y="12" width="12" height="28" fill="#8B5CF6"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Marketing Spend</div>
                <div class="kpi-value">£1.8M</div>
                <div class="kpi-delta neutral">92% of budget</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,28 L20,26 L40,28 L60,24 L80,22 L100,20" fill="none" stroke="#29B5E8" stroke-width="2"/>
                    <path d="M0,28 L20,26 L40,28 L60,24 L80,22 L100,20 L100,40 L0,40 Z" fill="#29B5E8"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">⭐</div>
                <div class="kpi-label">NPS Score</div>
                <div class="kpi-value">+42</div>
                <div class="kpi-delta positive">↑ +8 pts YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,32 L20,30 L40,26 L60,22 L80,18 L100,14" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,32 L20,30 L40,26 L60,22 L80,18 L100,14 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📱</div>
                <div class="kpi-label">CAC (Consumer)</div>
                <div class="kpi-value">£48</div>
                <div class="kpi-delta positive">↓ -£6 vs Q3</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🏢</div>
                <div class="kpi-label">CAC (Enterprise)</div>
                <div class="kpi-value">£320</div>
                <div class="kpi-delta positive">↓ -£45 vs Q3</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">Churn Rate</div>
                <div class="kpi-value">1.8%</div>
                <div class="kpi-delta positive">↓ -0.4% YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">Brand Awareness</div>
                <div class="kpi-value">68%</div>
                <div class="kpi-delta positive">↑ +5% YoY</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Campaign Performance by Channel</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem; color: #6B7280;">Channel</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Spend</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Leads</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Conv.</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">ROI</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.6rem 0.5rem;"><span style="display: inline-block; width: 8px; height: 8px; background: #29B5E8; border-radius: 50%; margin-right: 8px;"></span>Digital Paid</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem; font-weight: 600;">£420K</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">4,200</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">840</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;"><span style="background: #D1FAE5; color: #059669; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600;">5.2x</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.6rem 0.5rem;"><span style="display: inline-block; width: 8px; height: 8px; background: #8B5CF6; border-radius: 50%; margin-right: 8px;"></span>TV/Radio</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem; font-weight: 600;">£350K</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">1,800</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">270</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;"><span style="background: #FEF3C7; color: #D97706; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600;">2.1x</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.6rem 0.5rem;"><span style="display: inline-block; width: 8px; height: 8px; background: #EC4899; border-radius: 50%; margin-right: 8px;"></span>Social Media</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem; font-weight: 600;">£280K</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">3,100</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">620</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;"><span style="background: #D1FAE5; color: #059669; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600;">4.8x</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.6rem 0.5rem;"><span style="display: inline-block; width: 8px; height: 8px; background: #F59E0B; border-radius: 50%; margin-right: 8px;"></span>Partnerships</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem; font-weight: 600;">£180K</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">1,200</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">240</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;"><span style="background: #D1FAE5; color: #059669; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600;">3.6x</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.6rem 0.5rem;"><span style="display: inline-block; width: 8px; height: 8px; background: #10B981; border-radius: 50%; margin-right: 8px;"></span>SEO/Organic</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem; font-weight: 600;">£120K</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">2,400</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">480</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;"><span style="background: #DCFCE7; color: #15803D; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600;">12.4x</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.6rem 0.5rem;"><span style="display: inline-block; width: 8px; height: 8px; background: #6366F1; border-radius: 50%; margin-right: 8px;"></span>Events</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem; font-weight: 600;">£95K</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">450</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">90</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;"><span style="background: #FEF3C7; color: #D97706; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600;">2.4x</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.6rem 0.5rem;"><span style="display: inline-block; width: 8px; height: 8px; background: #14B8A6; border-radius: 50%; margin-right: 8px;"></span>Email</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem; font-weight: 600;">£85K</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">2,800</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">560</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;"><span style="background: #DCFCE7; color: #15803D; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600;">8.2x</span></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.6rem 0.5rem;"><span style="display: inline-block; width: 8px; height: 8px; background: #EF4444; border-radius: 50%; margin-right: 8px;"></span>Referral</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem; font-weight: 600;">£70K</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">1,100</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;">330</td>
                            <td style="text-align: right; padding: 0.6rem 0.5rem;"><span style="background: #DCFCE7; color: #15803D; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600;">9.8x</span></td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
                
                ch_cols = st.columns(3)
                with ch_cols[0]:
                    st.markdown("""
                    <div style="background: linear-gradient(135deg, #FDF4FF 0%, #FAE8FF 100%); border-left: 4px solid #EC4899; border-radius: 0 8px 8px 0; padding: 0.75rem;">
                        <div style="font-weight: 600; color: #EC4899; font-size: 0.85rem;">Total Spend</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #1B2A4E;">£1.6M</div>
                    </div>
                    """, unsafe_allow_html=True)
                with ch_cols[1]:
                    st.markdown("""
                    <div style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-left: 4px solid #10B981; border-radius: 0 8px 8px 0; padding: 0.75rem;">
                        <div style="font-weight: 600; color: #10B981; font-size: 0.85rem;">Total Leads</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #1B2A4E;">17,050</div>
                    </div>
                    """, unsafe_allow_html=True)
                with ch_cols[2]:
                    st.markdown("""
                    <div style="background: linear-gradient(135deg, #EDE9FE 0%, #F5F3FF 100%); border-left: 4px solid #8B5CF6; border-radius: 0 8px 8px 0; padding: 0.75rem;">
                        <div style="font-weight: 600; color: #8B5CF6; font-size: 0.85rem;">Avg ROI</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #1B2A4E;">4.2x</div>
                    </div>
                    """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Customer Acquisition Funnel</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="position: relative; margin: 0.5rem auto;">
                        <div style="background: linear-gradient(90deg, #8B5CF6 0%, #A78BFA 100%); color: white; padding: 0.75rem; border-radius: 8px 8px 0 0; font-weight: 600; width: 100%;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Impressions</span>
                                <span style="font-size: 1.1rem;">2.45M</span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(90deg, #A855F7 0%, #C084FC 100%); color: white; padding: 0.65rem; font-weight: 600; width: 85%; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Clicks</span>
                                <span>98K <span style="font-size: 0.7rem; opacity: 0.8;">4.0%</span></span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(90deg, #C084FC 0%, #D8B4FE 100%); color: white; padding: 0.6rem; font-weight: 600; width: 65%; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Leads</span>
                                <span>17K <span style="font-size: 0.7rem; opacity: 0.8;">17.4%</span></span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(90deg, #D8B4FE 0%, #E9D5FF 100%); color: #5B21B6; padding: 0.55rem; font-weight: 600; width: 45%; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Qualified</span>
                                <span>6.8K <span style="font-size: 0.7rem; opacity: 0.7;">40%</span></span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(90deg, #10B981 0%, #34D399 100%); color: white; padding: 0.5rem; border-radius: 0 0 8px 8px; font-weight: 600; width: 30%; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Converted</span>
                                <span>2.8K</span>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 0.75rem; background: #F0FDF4; border-radius: 8px; border: 1px solid #BBF7D0;">
                        <div style="font-size: 0.8rem; color: #166534;">Overall Conversion Rate</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #15803D;">0.12%</div>
                        <div style="font-size: 0.75rem; color: #22C55E;">↑ +0.02% vs last quarter</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Brand Sentiment</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                sentiment_data = pd.DataFrame({
                    'Sentiment': ['Positive', 'Neutral', 'Negative'],
                    'Percentage': [62, 28, 10],
                    'Count': [18600, 8400, 3000]
                })
                
                donut = alt.Chart(sentiment_data).mark_arc(innerRadius=50, outerRadius=85, cornerRadius=4).encode(
                    theta=alt.Theta('Percentage:Q', stack=True),
                    color=alt.Color('Sentiment:N',
                        scale=alt.Scale(
                            domain=['Positive', 'Neutral', 'Negative'],
                            range=['#10B981', '#6B7280', '#EF4444']
                        ),
                        legend=None
                    ),
                    tooltip=[
                        alt.Tooltip('Sentiment:N'),
                        alt.Tooltip('Percentage:Q', format='d'),
                        alt.Tooltip('Count:Q', title='Mentions', format=',')
                    ]
                ).properties(height=160)
                
                center_text = alt.Chart(pd.DataFrame({'text': ['62%']})).mark_text(
                    fontSize=24, fontWeight='bold', color='#10B981'
                ).encode(text='text:N')
                
                st.altair_chart(donut + center_text, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; justify-content: space-around; font-size: 0.8rem; text-align: center;">
                    <div><span style="color: #10B981;">●</span> Positive 62%</div>
                    <div><span style="color: #6B7280;">●</span> Neutral 28%</div>
                    <div><span style="color: #EF4444;">●</span> Negative 10%</div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Monthly Acquisition & Churn Trends</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            col_acq, col_churn = st.columns(2)
            
            with col_acq:
                acq_data = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Consumer': [1850, 1920, 2100, 2280, 2450, 2520],
                    'SMB': [180, 195, 210, 225, 240, 252],
                    'Enterprise': [45, 52, 58, 62, 68, 75]
                })
                
                acq_melted = acq_data.melt('Month', var_name='Segment', value_name='New Customers')
                
                acq_chart = alt.Chart(acq_melted).mark_area(opacity=0.7).encode(
                    x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None),
                    y=alt.Y('New Customers:Q', stack='zero', title='New Customers'),
                    color=alt.Color('Segment:N',
                        scale=alt.Scale(
                            domain=['Consumer', 'SMB', 'Enterprise'],
                            range=['#29B5E8', '#10B981', '#8B5CF6']
                        ),
                        legend=alt.Legend(orient='top', title=None)
                    ),
                    tooltip=[
                        alt.Tooltip('Month:N'),
                        alt.Tooltip('Segment:N'),
                        alt.Tooltip('New Customers:Q', format=',')
                    ]
                ).properties(height=220, title='New Customer Acquisition')
                
                st.altair_chart(acq_chart, use_container_width=True)
            
            with col_churn:
                churn_data = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Churn Rate': [2.4, 2.2, 2.1, 1.9, 1.8, 1.8],
                    'Target': [2.0, 2.0, 2.0, 2.0, 2.0, 2.0],
                    'Churned': [720, 660, 630, 570, 540, 540]
                })
                
                base = alt.Chart(churn_data).encode(
                    x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None)
                )
                
                bars = base.mark_bar(color='#EF4444', opacity=0.7, cornerRadiusTopLeft=4, cornerRadiusTopRight=4).encode(
                    y=alt.Y('Churn Rate:Q', title='Churn Rate (%)', scale=alt.Scale(domain=[0, 3])),
                    tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Churn Rate:Q', format='.1f'), alt.Tooltip('Churned:Q', format=',')]
                )
                
                target_line = base.mark_line(color='#10B981', strokeWidth=2, strokeDash=[5, 3]).encode(
                    y='Target:Q'
                )
                
                st.altair_chart((bars + target_line).properties(height=220, title='Churn Rate Trend'), use_container_width=True)
        
        col_ltv, col_segment = st.columns(2)
        
        with col_ltv:
            st.markdown('<div class="section-header">Customer LTV by Segment</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                ltv_data = pd.DataFrame({
                    'Segment': ['Budget', 'Standard', 'Premium', 'VIP', 'SMB Small', 'SMB Medium', 'Enterprise'],
                    'LTV': [180, 420, 840, 1680, 1200, 2400, 8500],
                    'CAC': [35, 45, 65, 120, 180, 280, 420],
                    'Type': ['Consumer', 'Consumer', 'Consumer', 'Consumer', 'SMB', 'SMB', 'Enterprise']
                })
                
                ltv_data['Ratio'] = (ltv_data['LTV'] / ltv_data['CAC']).round(1)
                
                lollipop_line = alt.Chart(ltv_data).mark_rule(strokeWidth=3).encode(
                    x=alt.X('LTV:Q', title='Lifetime Value (£)', scale=alt.Scale(domain=[0, 9000])),
                    x2=alt.value(0),
                    y=alt.Y('Segment:N', sort=alt.EncodingSortField(field='LTV', order='descending'), title=None),
                    color=alt.Color('Type:N',
                        scale=alt.Scale(
                            domain=['Consumer', 'SMB', 'Enterprise'],
                            range=['#29B5E8', '#10B981', '#8B5CF6']
                        ),
                        legend=alt.Legend(orient='top', title=None)
                    )
                )
                
                lollipop_point = alt.Chart(ltv_data).mark_circle(size=200).encode(
                    x='LTV:Q',
                    y=alt.Y('Segment:N', sort=alt.EncodingSortField(field='LTV', order='descending')),
                    color='Type:N',
                    tooltip=[
                        alt.Tooltip('Segment:N'),
                        alt.Tooltip('LTV:Q', title='LTV (£)', format=','),
                        alt.Tooltip('CAC:Q', title='CAC (£)', format=','),
                        alt.Tooltip('Ratio:Q', title='LTV:CAC Ratio', format='.1f')
                    ]
                )
                
                text_labels = alt.Chart(ltv_data).mark_text(align='left', dx=12, fontSize=10, fontWeight='bold').encode(
                    x='LTV:Q',
                    y=alt.Y('Segment:N', sort=alt.EncodingSortField(field='LTV', order='descending')),
                    text=alt.Text('Ratio:Q', format='.0fx'),
                    color=alt.value('#10B981')
                )
                
                st.altair_chart((lollipop_line + lollipop_point + text_labels).properties(height=240), use_container_width=True)
        
        with col_segment:
            st.markdown('<div class="section-header">Campaign Calendar — Q1 2026</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; padding: 0.6rem; background: #FDF4FF; border-radius: 8px; margin-bottom: 0.5rem;">
                        <span style="background: #EC4899; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin-right: 0.75rem;">LIVE</span>
                        <div>
                            <div style="font-weight: 600; color: #1B2A4E;">5G Launch Campaign</div>
                            <div style="color: #6B7280; font-size: 0.75rem;">Jan 15 - Mar 31 · £450K budget</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem; background: #E0F2FE; border-radius: 8px; margin-bottom: 0.5rem;">
                        <span style="background: #29B5E8; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin-right: 0.75rem;">LIVE</span>
                        <div>
                            <div style="font-weight: 600; color: #1B2A4E;">Valentine's Promo</div>
                            <div style="color: #6B7280; font-size: 0.75rem;">Feb 1 - Feb 14 · £80K budget</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem; background: #F3F4F6; border-radius: 8px; margin-bottom: 0.5rem;">
                        <span style="background: #6B7280; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin-right: 0.75rem;">PLANNED</span>
                        <div>
                            <div style="font-weight: 600; color: #1B2A4E;">Spring Switch Campaign</div>
                            <div style="color: #6B7280; font-size: 0.75rem;">Mar 1 - Mar 31 · £200K budget</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem; background: #D1FAE5; border-radius: 8px;">
                        <span style="background: #10B981; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin-right: 0.75rem;">COMPLETE</span>
                        <div>
                            <div style="font-weight: 600; color: #1B2A4E;">New Year Offer</div>
                            <div style="color: #6B7280; font-size: 0.75rem;">Dec 26 - Jan 7 · 4.8x ROI achieved</div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
    with tab_campaigns:
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['MARKETING', 'CUSTOMER_EXPERIENCE', 'DIGITAL', 'SALES']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        st.markdown("""
        <style>
        .cmo-campaign-pulse {
            background: linear-gradient(135deg, #FDF4FF 0%, #EDE9FE 100%);
            border-radius: 16px;
            border: 1px solid #DDD6FE;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .cmo-campaign-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(124,58,237,0.18), transparent);
            animation: cmo-campaign-sweep 4s ease-in-out infinite;
        }
        @keyframes cmo-campaign-sweep {
            0% { left: -120%; }
            100% { left: 220%; }
        }
        .cmo-campaign-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .cmo-campaign-title { font-weight: 700; color: #4C1D95; font-size: 1.05rem; }
        .cmo-campaign-tag {
            background: #7C3AED;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
        }
        .cmo-campaign-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            position: relative;
            z-index: 1;
        }
        .cmo-campaign-card {
            background: white;
            border-radius: 12px;
            border: 1px solid #EDE9FE;
            padding: 0.85rem 1rem;
        }
        .cmo-campaign-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9CA3AF; }
        .cmo-campaign-value { font-size: 1.25rem; font-weight: 700; color: #4C1D95; }
        .cmo-campaign-sub { font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) { .cmo-campaign-grid { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 640px) { .cmo-campaign-grid { grid-template-columns: 1fr; } }
        </style>
        <div class="cmo-campaign-pulse">
            <div class="cmo-campaign-header">
                <div class="cmo-campaign-title">📣 Campaign Pulse</div>
                <div class="cmo-campaign-tag">LIVE</div>
            </div>
            <div class="cmo-campaign-grid">
                <div class="cmo-campaign-card">
                    <div class="cmo-campaign-label">Active Campaigns</div>
                    <div class="cmo-campaign-value">6</div>
                    <div class="cmo-campaign-sub">2 launches this month</div>
                </div>
                <div class="cmo-campaign-card">
                    <div class="cmo-campaign-label">Conversion Rate</div>
                    <div class="cmo-campaign-value">12.8%</div>
                    <div class="cmo-campaign-sub">+2.1 pts QoQ</div>
                </div>
                <div class="cmo-campaign-card">
                    <div class="cmo-campaign-label">Top Channel ROI</div>
                    <div class="cmo-campaign-value">12.4x</div>
                    <div class="cmo-campaign-sub">SEO/Organic</div>
                </div>
                <div class="cmo-campaign-card">
                    <div class="cmo-campaign-label">Net New Adds</div>
                    <div class="cmo-campaign-value">+2,847</div>
                    <div class="cmo-campaign-sub">MTD performance</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        st.markdown('<div class="section-header">Campaigns & Growth</div>', unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Monthly Acquisition & Churn Trends</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            col_acq, col_churn = st.columns(2)
            
            with col_acq:
                acq_data = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Consumer': [1850, 1920, 2100, 2280, 2450, 2520],
                    'SMB': [180, 195, 210, 225, 240, 252],
                    'Enterprise': [45, 52, 58, 62, 68, 75]
                })
                
                acq_melted = acq_data.melt('Month', var_name='Segment', value_name='New Customers')
                
                acq_chart = alt.Chart(acq_melted).mark_area(opacity=0.7).encode(
                    x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None),
                    y=alt.Y('New Customers:Q', stack='zero', title='New Customers'),
                    color=alt.Color('Segment:N',
                        scale=alt.Scale(
                            domain=['Consumer', 'SMB', 'Enterprise'],
                            range=['#29B5E8', '#10B981', '#8B5CF6']
                        ),
                        legend=alt.Legend(orient='top', title=None)
                    ),
                    tooltip=[
                        alt.Tooltip('Month:N'),
                        alt.Tooltip('Segment:N'),
                        alt.Tooltip('New Customers:Q', format=',')
                    ]
                ).properties(height=220, title='New Customer Acquisition')
                
                st.altair_chart(acq_chart, use_container_width=True)
            
            with col_churn:
                churn_data = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Churn Rate': [2.4, 2.2, 2.1, 1.9, 1.8, 1.8],
                    'Target': [2.0, 2.0, 2.0, 2.0, 2.0, 2.0],
                    'Churned': [720, 660, 630, 570, 540, 540]
                })
                
                base = alt.Chart(churn_data).encode(
                    x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None)
                )
                
                bars = base.mark_bar(color='#EF4444', opacity=0.7, cornerRadiusTopLeft=4, cornerRadiusTopRight=4).encode(
                    y=alt.Y('Churn Rate:Q', title='Churn Rate (%)', scale=alt.Scale(domain=[0, 3])),
                    tooltip=[alt.Tooltip('Month:N'), alt.Tooltip('Churn Rate:Q', format='.1f'), alt.Tooltip('Churned:Q', format=',')]
                )
                
                target_line = base.mark_line(color='#10B981', strokeWidth=2, strokeDash=[5, 3]).encode(
                    y='Target:Q'
                )
                
                st.altair_chart((bars + target_line).properties(height=220, title='Churn Rate Trend'), use_container_width=True)
        
        st.markdown('<div class="section-header">Campaign Calendar — Q1 2026</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            st.markdown("""
            <div style="font-size: 0.85rem;">
                <div style="display: flex; align-items: center; padding: 0.6rem; background: #FDF4FF; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="background: #EC4899; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin-right: 0.75rem;">LIVE</span>
                    <div>
                        <div style="font-weight: 600; color: #1B2A4E;">5G Launch Campaign</div>
                        <div style="color: #6B7280; font-size: 0.75rem;">Jan 15 - Mar 31 · £450K budget</div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; padding: 0.6rem; background: #E0F2FE; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="background: #29B5E8; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin-right: 0.75rem;">LIVE</span>
                    <div>
                        <div style="font-weight: 600; color: #1B2A4E;">Valentine's Promo</div>
                        <div style="color: #6B7280; font-size: 0.75rem;">Feb 1 - Feb 14 · £80K budget</div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; padding: 0.6rem; background: #F3F4F6; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="background: #6B7280; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin-right: 0.75rem;">PLANNED</span>
                    <div>
                        <div style="font-weight: 600; color: #1B2A4E;">Spring Switch Campaign</div>
                        <div style="color: #6B7280; font-size: 0.75rem;">Mar 1 - Mar 31 · £200K budget</div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; padding: 0.6rem; background: #D1FAE5; border-radius: 8px;">
                    <span style="background: #10B981; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin-right: 0.75rem;">COMPLETE</span>
                    <div>
                        <div style="font-weight: 600; color: #1B2A4E;">New Year Offer</div>
                        <div style="color: #6B7280; font-size: 0.75rem;">Dec 26 - Jan 7 · 4.8x ROI achieved</div>
                    </div>
                </div>
            </div>
            """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Customer Insights & Retention</div>', unsafe_allow_html=True)
        
        seg_col, demo_col, acq_col = st.columns(3)
        
        with seg_col:
            st.markdown("**Customer Segmentation by Value**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>🥇 Platinum</span><span style="font-weight: 600;">12,450 <span style="color: #10B981;">£85 ARPU</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: linear-gradient(90deg, #6366F1, #8B5CF6); width: 15%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>🥈 Gold</span><span style="font-weight: 600;">28,320 <span style="color: #10B981;">£52 ARPU</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 35%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>🥉 Silver</span><span style="font-weight: 600;">42,180 <span style="color: #6B7280;">£32 ARPU</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #9CA3AF; width: 52%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Bronze</span><span style="font-weight: 600;">18,250 <span style="color: #6B7280;">£18 ARPU</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #D1D5DB; width: 22%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #6B7280;">Total: 101,200 B2C Customers</div>
                """, unsafe_allow_html=True)
        
        with demo_col:
            st.markdown("**Age Demographics**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>18-24</span><span style="font-weight: 600;">14%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #8B5CF6; width: 14%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>25-34</span><span style="font-weight: 600;">28%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #6366F1; width: 28%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>35-44</span><span style="font-weight: 600;">24%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #3B82F6; width: 24%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>45-54</span><span style="font-weight: 600;">18%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #29B5E8; width: 18%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>55+</span><span style="font-weight: 600;">16%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #10B981; width: 16%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #6B7280;">Median Age: 38</div>
                """, unsafe_allow_html=True)
        
        with acq_col:
            st.markdown("**Acquisition Channels**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Digital (Web/App)</span><span style="font-weight: 600; color: #10B981;">42%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #10B981; width: 42%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Retail Store</span><span style="font-weight: 600;">28%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #29B5E8; width: 28%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Telesales</span><span style="font-weight: 600;">15%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #F59E0B; width: 15%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Partner/Reseller</span><span style="font-weight: 600;">10%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #8B5CF6; width: 10%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Referral</span><span style="font-weight: 600;">5%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #EC4899; width: 5%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #10B981;">Digital +8% YoY</div>
                """, unsafe_allow_html=True)
        
        ret_col, engage_col = st.columns(2)
        
        with ret_col:
            st.markdown("**Retention Cohorts (12 Month)**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>0-12 months</span>
                        <span><strong>92%</strong> retained</span>
                        <span style="color: #10B981;">▲ 2%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>12-24 months</span>
                        <span><strong>88%</strong> retained</span>
                        <span style="color: #10B981;">▲ 1%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>24-36 months</span>
                        <span><strong>81%</strong> retained</span>
                        <span style="color: #DC2626;">▼ 3%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>36-48 months</span>
                        <span><strong>85%</strong> retained</span>
                        <span style="color: #10B981;">▲ 1%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>48+ months</span>
                        <span><strong>94%</strong> retained</span>
                        <span style="color: #10B981;">▲ 3%</span>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #DC2626;">⚠️ 24-36 mo cohort needs attention</div>
                """, unsafe_allow_html=True)
        
        with engage_col:
            st.markdown("**Digital Engagement**")
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; justify-content: space-around; text-align: center; padding: 0.5rem 0;">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #29B5E8;">68%</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">App Active</div>
                        <div style="font-size: 0.7rem; color: #10B981;">▲ 5%</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #10B981;">4.2M</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">Monthly Logins</div>
                        <div style="font-size: 0.7rem; color: #10B981;">▲ 12%</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #8B5CF6;">72%</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">Self-Service</div>
                        <div style="font-size: 0.7rem; color: #10B981;">▲ 8%</div>
                    </div>
                </div>
                <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #E5E7EB;">
                    <div style="font-size: 0.8rem; text-align: center;">
                        <span style="color: #1B2A4E; font-weight: 600;">Top Actions:</span> Bill Pay (34%) • Usage Check (28%) • Support (18%)
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        
    with tab_strategy:
        st.markdown('<div class="section-header">CMO Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Drive 5G Adoption</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Target: **15,000** 5G upgrades Q1
                - Current pace: **12,400** (83%)
                - £450K campaign budget allocated
                - Focus on Premium/VIP segments
                """)
        
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Reduce CAC by 15%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Consumer CAC: **£48** → £41 target
                - Optimize digital spend allocation
                - Increase referral program ROI
                - Current progress: **-12.5%**
                """)
        
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">NPS to +50</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current NPS: **+42** (target: +50)
                - Focus on detractor recovery
                - Enhance onboarding experience
                - Launch loyalty program Q2
                """)
        
        # B2C Customer Insights Section
        st.markdown('<div class="section-header">B2C Customer Insights</div>', unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake** — Customer segmentation using Cortex ML Classification and Sentiment Analysis on social data with CORTEX.SENTIMENT()")
        
        seg_col, demo_col, acq_col = st.columns(3)
        
        with seg_col:
            st.markdown("**Customer Segmentation by Value**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>🥇 Platinum</span><span style="font-weight: 600;">12,450 <span style="color: #10B981;">£85 ARPU</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: linear-gradient(90deg, #6366F1, #8B5CF6); width: 15%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>🥈 Gold</span><span style="font-weight: 600;">28,320 <span style="color: #10B981;">£52 ARPU</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 35%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>🥉 Silver</span><span style="font-weight: 600;">42,180 <span style="color: #6B7280;">£32 ARPU</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #9CA3AF; width: 52%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Bronze</span><span style="font-weight: 600;">18,250 <span style="color: #6B7280;">£18 ARPU</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #D1D5DB; width: 22%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #6B7280;">Total: 101,200 B2C Customers</div>
                """, unsafe_allow_html=True)
        
        with demo_col:
            st.markdown("**Age Demographics**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>18-24</span><span style="font-weight: 600;">14%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #8B5CF6; width: 14%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>25-34</span><span style="font-weight: 600;">28%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #6366F1; width: 28%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>35-44</span><span style="font-weight: 600;">24%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #3B82F6; width: 24%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>45-54</span><span style="font-weight: 600;">18%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #29B5E8; width: 18%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>55+</span><span style="font-weight: 600;">16%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #10B981; width: 16%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #6B7280;">Median Age: 38</div>
                """, unsafe_allow_html=True)
        
        with acq_col:
            st.markdown("**Acquisition Channels**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Digital (Web/App)</span><span style="font-weight: 600; color: #10B981;">42%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #10B981; width: 42%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Retail Store</span><span style="font-weight: 600;">28%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #29B5E8; width: 28%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Telesales</span><span style="font-weight: 600;">15%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #F59E0B; width: 15%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Partner/Reseller</span><span style="font-weight: 600;">10%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #8B5CF6; width: 10%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Referral</span><span style="font-weight: 600;">5%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #EC4899; width: 5%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #10B981;">Digital +8% YoY</div>
                """, unsafe_allow_html=True)
        
        # Customer Retention Insights
        ret_col, engage_col = st.columns(2)
        
        with ret_col:
            st.markdown("**Retention Cohorts (12 Month)**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>0-12 months</span>
                        <span><strong>92%</strong> retained</span>
                        <span style="color: #10B981;">▲ 2%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>12-24 months</span>
                        <span><strong>88%</strong> retained</span>
                        <span style="color: #10B981;">▲ 1%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>24-36 months</span>
                        <span><strong>85%</strong> retained</span>
                        <span style="color: #6B7280;">—</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>36+ months</span>
                        <span><strong>94%</strong> retained</span>
                        <span style="color: #10B981;">▲ 3%</span>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #DC2626;">⚠️ 24-36 mo cohort needs attention</div>
                """, unsafe_allow_html=True)
        
        with engage_col:
            st.markdown("**Digital Engagement**")
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; justify-content: space-around; text-align: center; padding: 0.5rem 0;">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #29B5E8;">68%</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">App Active</div>
                        <div style="font-size: 0.7rem; color: #10B981;">▲ 5%</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #10B981;">4.2M</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">Monthly Logins</div>
                        <div style="font-size: 0.7rem; color: #10B981;">▲ 12%</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #8B5CF6;">72%</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">Self-Service</div>
                        <div style="font-size: 0.7rem; color: #10B981;">▲ 8%</div>
                    </div>
                </div>
                <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #E5E7EB;">
                    <div style="font-size: 0.8rem; text-align: center;">
                        <span style="color: #1B2A4E; font-weight: 600;">Top Actions:</span> Bill Pay (34%) • Usage Check (28%) • Support (18%)
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "What's our customer acquisition cost by channel and how does ROI compare across campaigns?",
            "Show me churn risk by customer segment - which segments need retention focus?",
            "What's the sentiment analysis from our social media mentions this month?",
            "Which marketing campaigns are driving the highest quality leads?",
            "What's the lifetime value distribution by customer segment and acquisition channel?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_cto_technology():
    import pandas as pd
    import altair as alt
    
    # Matrix Rain Header for CTO
    st.markdown("""
    <style>
    @keyframes cto-matrix-fall {
        0% { transform: translateY(-100%); }
        100% { transform: translateY(100%); }
    }
    .cto-header-wrapper {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        margin-bottom: 2rem;
    }
    .cto-matrix-bg {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        opacity: 0.15;
        pointer-events: none;
    }
    .cto-matrix-col {
        position: absolute;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        color: #10B981;
        writing-mode: vertical-rl;
        animation: cto-matrix-fall linear infinite;
        text-shadow: 0 0 8px #10B981;
    }
    .cto-header-content {
        position: relative;
        z-index: 1;
        background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
        border: 1px solid #BAE6FD;
        padding: 2rem;
        color: #0C4A6E;
    }
    .cto-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; }
    .cto-header-content p { margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 1.1rem; }
    </style>
    <div class="cto-header-wrapper">
        <div class="cto-matrix-bg">
            <div class="cto-matrix-col" style="left: 5%; animation-duration: 8s;">01001011</div>
            <div class="cto-matrix-col" style="left: 15%; animation-duration: 6s; animation-delay: -2s;">10110100</div>
            <div class="cto-matrix-col" style="left: 25%; animation-duration: 9s; animation-delay: -4s;">01100101</div>
            <div class="cto-matrix-col" style="left: 35%; animation-duration: 7s; animation-delay: -1s;">11010011</div>
            <div class="cto-matrix-col" style="left: 45%; animation-duration: 10s; animation-delay: -3s;">00101110</div>
            <div class="cto-matrix-col" style="left: 55%; animation-duration: 6s; animation-delay: -5s;">10011010</div>
            <div class="cto-matrix-col" style="left: 65%; animation-duration: 8s; animation-delay: -2s;">01110101</div>
            <div class="cto-matrix-col" style="left: 75%; animation-duration: 7s; animation-delay: -4s;">11001100</div>
            <div class="cto-matrix-col" style="left: 85%; animation-duration: 9s; animation-delay: -1s;">00110011</div>
            <div class="cto-matrix-col" style="left: 95%; animation-duration: 6s; animation-delay: -3s;">10101010</div>
        </div>
        <div class="cto-header-content">
            <h1>CTO Technology Dashboard</h1>
            <p>Network Performance, Infrastructure & Digital Transformation</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_platforms, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧩 Platforms & Security", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['NETWORK_OPS', 'IT_OPS', 'RAN', 'SLA']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # CTO TECH STACK ANIMATION
        st.markdown("""
        <style>
        @keyframes stack-pulse { 0%, 100% { transform: scaleX(1); } 50% { transform: scaleX(1.02); } }
        @keyframes data-up { 0% { transform: translateY(100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-100%); opacity: 0; } }
        @keyframes cto-layer-slide { 0% { opacity: 0; transform: translateX(-30px); } 100% { opacity: 1; transform: translateX(0); } }
        @keyframes cto-metric-fade { 0% { opacity: 0; } 100% { opacity: 1; } }
        @keyframes cto-status-pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(16,185,129,0.4); } 50% { box-shadow: 0 0 0 4px rgba(16,185,129,0.2); } }
        @keyframes cto-yellow-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .cto-stack { background: #F8FAFC; border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #E2E8F0; }
        .stack-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .stack-title { color: #1B2A4E; font-size: 1.1rem; font-weight: 600; }
        .stack-status { display: flex; gap: 1rem; }
        .status-item { display: flex; align-items: center; gap: 0.3rem; font-size: 0.75rem; color: rgba(255,255,255,0.7); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .status-dot.green { background: #10B981; animation: cto-status-pulse 2s ease-in-out infinite; }
        .status-dot.yellow { background: #F59E0B; animation: cto-yellow-blink 1s ease-in-out infinite; }
        .stack-layers { display: flex; flex-direction: column; gap: 0.5rem; }
        .stack-layer { display: flex; align-items: center; gap: 1rem; animation: cto-layer-slide 0.6s ease-out forwards; opacity: 0; }
        .stack-layer:nth-child(2) { animation-delay: 0.1s; }
        .stack-layer:nth-child(3) { animation-delay: 0.2s; }
        .stack-layer:nth-child(4) { animation-delay: 0.3s; }
        .layer-label { width: 100px; color: #64748B; font-size: 0.75rem; text-align: right; }
        .layer-bar { flex: 1; height: 32px; border-radius: 6px; position: relative; overflow: hidden; animation: stack-pulse 3s ease-in-out infinite; display: flex; align-items: center; padding: 0 1rem; }
        .layer-metric { margin-left: auto; color: rgba(255,255,255,0.9); font-size: 0.85rem; font-weight: 600; animation: cto-metric-fade 0.8s ease-out 0.5s forwards; opacity: 0; }
        .layer-bar.apps { background: linear-gradient(90deg, #3B82F6, #1D4ED8); }
        .layer-bar.platform { background: linear-gradient(90deg, #8B5CF6, #6D28D9); }
        .layer-bar.data { background: linear-gradient(90deg, #06B6D4, #0891B2); animation-delay: 0.5s; }
        .layer-bar.infra { background: linear-gradient(90deg, #10B981, #059669); animation-delay: 1s; }
        .layer-text { color: white; font-size: 0.8rem; font-weight: 500; }
        .layer-metric { margin-left: auto; color: rgba(255,255,255,0.9); font-size: 0.85rem; font-weight: 600; }
        .data-particles { position: absolute; right: 10px; width: 30px; height: 100%; overflow: hidden; }
        .particle { position: absolute; width: 4px; height: 4px; background: rgba(255,255,255,0.6); border-radius: 50%; animation: data-up 1.5s linear infinite; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="cto-stack"><div class="stack-header"><div class="stack-title">🏗️ Technology Stack Health</div><div class="stack-status"><div class="status-item"><div class="status-dot green"></div>492 Services Online</div><div class="status-item"><div class="status-dot yellow"></div>3 Degraded</div></div></div><div class="stack-layers"><div class="stack-layer"><div class="layer-label">Applications</div><div class="layer-bar apps"><span class="layer-text">32 Apps • 12 APIs</span><span class="layer-metric">99.9% Uptime</span><div class="data-particles"><div class="particle" style="left:5px;animation-delay:0s"></div><div class="particle" style="left:15px;animation-delay:0.5s"></div><div class="particle" style="left:25px;animation-delay:1s"></div></div></div></div><div class="stack-layer"><div class="layer-label">Platform</div><div class="layer-bar platform"><span class="layer-text">Snowflake • K8s • Cloud</span><span class="layer-metric">99.99% SLA</span><div class="data-particles"><div class="particle" style="left:5px;animation-delay:0.2s"></div><div class="particle" style="left:15px;animation-delay:0.7s"></div></div></div></div><div class="stack-layer"><div class="layer-label">Data Layer</div><div class="layer-bar data"><span class="layer-text">2.4PB Data • 34 Domains</span><span class="layer-metric">847 Queries/s</span><div class="data-particles"><div class="particle" style="left:5px;animation-delay:0.4s"></div><div class="particle" style="left:15px;animation-delay:0.9s"></div></div></div></div><div class="stack-layer"><div class="layer-label">Infrastructure</div><div class="layer-bar infra"><span class="layer-text">500 Sites • 3 DCs</span><span class="layer-metric">12ms Latency</span><div class="data-particles"><div class="particle" style="left:5px;animation-delay:0.6s"></div><div class="particle" style="left:15px;animation-delay:1.1s"></div></div></div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
            animation: cto-kpi-pop 0.6s ease-out forwards;
            opacity: 0;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes cto-kpi-pop { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cto-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 1; } 
            50% { stroke-width: 3.5; opacity: 0.8; } 
        }
        @keyframes cto-fill-pulse { 
            0%, 100% { opacity: 0.15; transform: scaleY(1); } 
            50% { opacity: 0.25; transform: scaleY(1.02); } 
        }
        @keyframes cto-bar-wave { 
            0%, 100% { transform: scaleY(1); } 
            50% { transform: scaleY(0.7); } 
        }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.15;
        }
        .kpi-chart path[fill="none"] { animation: cto-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: cto-fill-pulse 3s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: cto-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-card:nth-child(2) .kpi-value { animation-delay: 0.1s; }
        .kpi-card:nth-child(3) .kpi-value { animation-delay: 0.2s; }
        .kpi-card:nth-child(4) .kpi-value { animation-delay: 0.3s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.45s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Network & Infrastructure Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">📶</div>
                <div class="kpi-label">Network Uptime</div>
                <div class="kpi-value">99.97%</div>
                <div class="kpi-delta positive">↑ SLA: 99.9%</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,15 L20,14 L40,16 L60,13 L80,12 L100,12" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,15 L20,14 L40,16 L60,13 L80,12 L100,12 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">🏗️</div>
                <div class="kpi-label">5G Coverage</div>
                <div class="kpi-value">78%</div>
                <div class="kpi-delta positive">↑ +12% YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="32" width="12" height="8" fill="#29B5E8"/>
                    <rect x="22" y="28" width="12" height="12" fill="#29B5E8"/>
                    <rect x="39" y="22" width="12" height="18" fill="#29B5E8"/>
                    <rect x="56" y="18" width="12" height="22" fill="#29B5E8"/>
                    <rect x="73" y="12" width="12" height="28" fill="#29B5E8"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">⚡</div>
                <div class="kpi-label">Avg Latency</div>
                <div class="kpi-value">12ms</div>
                <div class="kpi-delta positive">↓ -3ms MoM</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,12 L20,14 L40,13 L60,15 L80,18 L100,20" fill="none" stroke="#8B5CF6" stroke-width="2"/>
                    <path d="M0,12 L20,14 L40,13 L60,15 L80,18 L100,20 L100,40 L0,40 Z" fill="#8B5CF6"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">🚨</div>
                <div class="kpi-label">Active Incidents</div>
                <div class="kpi-value">3</div>
                <div class="kpi-delta positive">↓ -5 vs avg</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="20" width="12" height="20" fill="#F59E0B"/>
                    <rect x="22" y="24" width="12" height="16" fill="#F59E0B"/>
                    <rect x="39" y="28" width="12" height="12" fill="#F59E0B"/>
                    <rect x="56" y="30" width="12" height="10" fill="#F59E0B"/>
                    <rect x="73" y="34" width="12" height="6" fill="#F59E0B"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Throughput (Peak)</div>
                <div class="kpi-value">142 Gbps</div>
                <div class="kpi-delta positive">↑ +18% capacity</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🖥️</div>
                <div class="kpi-label">Cloud Migration</div>
                <div class="kpi-value">72%</div>
                <div class="kpi-delta neutral">Target: 85% by Q4</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">🔒</div>
                <div class="kpi-label">Security Score</div>
                <div class="kpi-value">94/100</div>
                <div class="kpi-delta positive">↑ +6 pts YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">💾</div>
                <div class="kpi-label">Tech Debt Ratio</div>
                <div class="kpi-value">18%</div>
                <div class="kpi-delta positive">↓ -4% YoY</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake** — Infrastructure monitoring with Snowpipe Streaming for real-time telemetry and Cortex Anomaly Detection for predictive maintenance")
        
        # Animated Circular Progress Section
        st.markdown("""
        <style>
        /* Looping fill animations for CTO gauges */
        @keyframes cto-fill-blue { 0%, 100% { stroke-dashoffset: 283; } 50% { stroke-dashoffset: 62; } }
        @keyframes cto-fill-green { 0%, 100% { stroke-dashoffset: 283; } 50% { stroke-dashoffset: 0.85; } }
        @keyframes cto-fill-purple { 0%, 100% { stroke-dashoffset: 283; } 50% { stroke-dashoffset: 17; } }
        @keyframes cto-fill-orange { 0%, 100% { stroke-dashoffset: 283; } 50% { stroke-dashoffset: 79; } }
        .cto-progress-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        .cto-progress-item { text-align: center; }
        .cto-progress-ring { width: 100px; height: 100px; margin: 0 auto 0.75rem; }
        .cto-progress-ring svg { transform: rotate(-90deg); }
        .cto-progress-ring .bg { fill: none; stroke: #E5E7EB; stroke-width: 8; }
        .cto-progress-ring .progress { fill: none; stroke-width: 8; stroke-linecap: round; stroke-dasharray: 283; }
        .cto-progress-ring .progress.blue { stroke: #29B5E8; animation: cto-fill-blue 3s ease-in-out infinite; }
        .cto-progress-ring .progress.green { stroke: #10B981; animation: cto-fill-green 3s ease-in-out infinite 0.3s; }
        .cto-progress-ring .progress.purple { stroke: #8B5CF6; animation: cto-fill-purple 3s ease-in-out infinite 0.6s; }
        .cto-progress-ring .progress.orange { stroke: #F59E0B; animation: cto-fill-orange 3s ease-in-out infinite 0.9s; }
        .cto-progress-value { font-size: 1.5rem; font-weight: 700; color: #1B2A4E; }
        .cto-progress-label { font-size: 0.8rem; color: #6B7280; margin-top: 0.25rem; }
        .cto-progress-target { font-size: 0.7rem; color: #9CA3AF; margin-top: 0.25rem; }
        </style>
        <div class="cto-progress-grid">
            <div class="cto-progress-item">
                <div class="cto-progress-ring">
                    <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="45"/>
                        <circle class="progress blue" cx="50" cy="50" r="45"/>
                    </svg>
                </div>
                <div class="cto-progress-value">78%</div>
                <div class="cto-progress-label">5G Coverage</div>
                <div class="cto-progress-target">Target: 85%</div>
            </div>
            <div class="cto-progress-item">
                <div class="cto-progress-ring">
                    <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="45"/>
                        <circle class="progress green" cx="50" cy="50" r="45"/>
                    </svg>
                </div>
                <div class="cto-progress-value">99.97%</div>
                <div class="cto-progress-label">Network Uptime</div>
                <div class="cto-progress-target">SLA: 99.9%</div>
            </div>
            <div class="cto-progress-item">
                <div class="cto-progress-ring">
                    <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="45"/>
                        <circle class="progress purple" cx="50" cy="50" r="45"/>
                    </svg>
                </div>
                <div class="cto-progress-value">94%</div>
                <div class="cto-progress-label">Security Score</div>
                <div class="cto-progress-target">Target: 95%</div>
            </div>
            <div class="cto-progress-item">
                <div class="cto-progress-ring">
                    <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="45"/>
                        <circle class="progress orange" cx="50" cy="50" r="45"/>
                    </svg>
                </div>
                <div class="cto-progress-value">72%</div>
                <div class="cto-progress-label">Cloud Migration</div>
                <div class="cto-progress-target">Target: 85%</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Network Performance by Region</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            region_data = pd.DataFrame({
                'Region': ['London', 'South East', 'Midlands', 'North West', 'Scotland', 'Wales', 'North East', 'South West'],
                'Uptime': [99.98, 99.97, 99.96, 99.95, 99.94, 99.93, 99.92, 99.91],
                'Latency': [8, 10, 12, 14, 16, 15, 18, 13],
                'Cells': [1250, 890, 720, 680, 420, 280, 350, 410],
                '5G_Coverage': [92, 85, 78, 72, 65, 58, 62, 68]
            })
            
            bars = alt.Chart(region_data).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                x=alt.X('5G_Coverage:Q', title='5G Coverage (%)', scale=alt.Scale(domain=[0, 100])),
                y=alt.Y('Region:N', sort=alt.EncodingSortField(field='5G_Coverage', order='descending'), title=None),
                color=alt.Color('5G_Coverage:Q',
                    scale=alt.Scale(scheme='blues', domain=[50, 100]),
                    legend=None
                ),
                tooltip=[
                    alt.Tooltip('Region:N'),
                    alt.Tooltip('Uptime:Q', title='Uptime (%)', format='.2f'),
                    alt.Tooltip('Latency:Q', title='Latency (ms)'),
                    alt.Tooltip('Cells:Q', title='Cell Sites', format=','),
                    alt.Tooltip('5G_Coverage:Q', title='5G Coverage (%)')
                ]
            ).properties(height=280)
            
            text = alt.Chart(region_data).mark_text(align='left', dx=5, fontSize=10, fontWeight='bold').encode(
                x='5G_Coverage:Q',
                y=alt.Y('Region:N', sort=alt.EncodingSortField(field='5G_Coverage', order='descending')),
                text=alt.Text('5G_Coverage:Q', format='.0f'),
                color=alt.value('#1B2A4E')
            )
            
            st.altair_chart(bars + text, use_container_width=True)
            
            reg_cols = st.columns(4)
            with reg_cols[0]:
                st.markdown("""
                <div style="text-align: center; padding: 0.5rem;">
                    <div style="font-size: 0.7rem; color: #6B7280;">Total Cells</div>
                    <div style="font-size: 1.1rem; font-weight: 700; color: #1B2A4E;">5,000</div>
                </div>
                """, unsafe_allow_html=True)
            with reg_cols[1]:
                st.markdown("""
                <div style="text-align: center; padding: 0.5rem;">
                    <div style="font-size: 0.7rem; color: #6B7280;">5G Cells</div>
                    <div style="font-size: 1.1rem; font-weight: 700; color: #29B5E8;">3,900</div>
                </div>
                """, unsafe_allow_html=True)
            with reg_cols[2]:
                st.markdown("""
                <div style="text-align: center; padding: 0.5rem;">
                    <div style="font-size: 0.7rem; color: #6B7280;">Avg Uptime</div>
                    <div style="font-size: 1.1rem; font-weight: 700; color: #10B981;">99.95%</div>
                </div>
                """, unsafe_allow_html=True)
            with reg_cols[3]:
                st.markdown("""
                <div style="text-align: center; padding: 0.5rem;">
                    <div style="font-size: 0.7rem; color: #6B7280;">Avg Latency</div>
                    <div style="font-size: 1.1rem; font-weight: 700; color: #8B5CF6;">12ms</div>
                </div>
                """, unsafe_allow_html=True)
    
    with tab_platforms:
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['IT_OPS', 'SECURITY', 'CLOUD', 'DIGITAL_TRANSFORMATION']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Incident Status</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            incident_data = pd.DataFrame({
                'Severity': ['P1 Critical', 'P2 High', 'P3 Medium', 'P4 Low'],
                'Open': [0, 1, 2, 8],
                'MTTR': [15, 45, 120, 480],
                'Target_MTTR': [30, 60, 180, 720]
            })
            
            st.markdown("""
            <div style="font-size: 0.85rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #D1FAE5; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;"><span style="color: #DC2626;">●</span> P1 Critical</span>
                    <span style="background: #10B981; color: white; padding: 0.2rem 0.6rem; border-radius: 20px; font-size: 0.75rem;">0 Open</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #FEF3C7; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;"><span style="color: #F97316;">●</span> P2 High</span>
                    <span style="background: #F59E0B; color: white; padding: 0.2rem 0.6rem; border-radius: 20px; font-size: 0.75rem;">1 Open</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #E0F2FE; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;"><span style="color: #29B5E8;">●</span> P3 Medium</span>
                    <span style="background: #29B5E8; color: white; padding: 0.2rem 0.6rem; border-radius: 20px; font-size: 0.75rem;">2 Open</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #F3F4F6; border-radius: 8px;">
                    <span style="font-weight: 600;"><span style="color: #6B7280;">●</span> P4 Low</span>
                    <span style="background: #6B7280; color: white; padding: 0.2rem 0.6rem; border-radius: 20px; font-size: 0.75rem;">8 Open</span>
                </div>
            </div>
            """, unsafe_allow_html=True)
            
            st.markdown("""
            <div style="margin-top: 1rem; background: linear-gradient(135deg, #1B2A4E 0%, #2D3F6B 100%); border-radius: 8px; padding: 0.75rem; color: white;">
                <div style="font-size: 0.75rem; opacity: 0.8; margin-bottom: 0.25rem;">Mean Time to Resolution</div>
                <div style="display: flex; justify-content: space-between;">
                    <div style="text-align: center;">
                        <div style="font-size: 1.1rem; font-weight: 700; color: #10B981;">15m</div>
                        <div style="font-size: 0.65rem;">P1 (Target: 30m)</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.1rem; font-weight: 700; color: #10B981;">45m</div>
                        <div style="font-size: 0.65rem;">P2 (Target: 60m)</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.1rem; font-weight: 700; color: #10B981;">2h</div>
                        <div style="font-size: 0.65rem;">P3 (Target: 3h)</div>
                    </div>
                </div>
            </div>
            """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">System Health</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            st.markdown("""
            <div style="font-size: 0.85rem;">
                <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                    <span style="width: 100px;">Core Network</span>
                    <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                        <div style="background: #10B981; width: 98%; height: 100%; border-radius: 4px;"></div>
                    </div>
                    <span style="font-weight: 700; color: #10B981; width: 40px;">98%</span>
                </div>
                <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                    <span style="width: 100px;">RAN</span>
                    <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                        <div style="background: #10B981; width: 96%; height: 100%; border-radius: 4px;"></div>
                    </div>
                    <span style="font-weight: 700; color: #10B981; width: 40px;">96%</span>
                </div>
                <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                    <span style="width: 100px;">BSS/OSS</span>
                    <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                        <div style="background: #F59E0B; width: 94%; height: 100%; border-radius: 4px;"></div>
                    </div>
                    <span style="font-weight: 700; color: #F59E0B; width: 40px;">94%</span>
                </div>
                <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                    <span style="width: 100px;">Security</span>
                    <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                        <div style="background: #F59E0B; width: 94%; height: 100%; border-radius: 4px;"></div>
                    </div>
                    <span style="font-weight: 700; color: #F59E0B; width: 40px;">94%</span>
                </div>
                <div style="display: flex; align-items: center; padding: 0.5rem 0;">
                    <span style="width: 100px;">Cloud Infra</span>
                    <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                        <div style="background: #F59E0B; width: 92%; height: 100%; border-radius: 4px;"></div>
                    </div>
                    <span style="font-weight: 700; color: #F59E0B; width: 40px;">92%</span>
                </div>
            </div>
            """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Infrastructure Capacity & Utilization</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            col_cap1, col_cap2 = st.columns(2)
            
            with col_cap1:
                st.markdown("""
                <div style="font-size: 0.8rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; padding-bottom: 0.25rem; border-bottom: 1px dashed #DC2626;">
                        <span style="color: #DC2626; font-weight: 600;">Threshold: 80%</span>
                    </div>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="color: #6B7280; font-size: 0.7rem;">
                                <th style="text-align: left; padding: 0.25rem;">Resource</th>
                                <th style="text-align: center; padding: 0.25rem;">Aug</th>
                                <th style="text-align: center; padding: 0.25rem;">Sep</th>
                                <th style="text-align: center; padding: 0.25rem;">Oct</th>
                                <th style="text-align: center; padding: 0.25rem;">Nov</th>
                                <th style="text-align: center; padding: 0.25rem;">Dec</th>
                                <th style="text-align: center; padding: 0.25rem; font-weight: 700;">Jan</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 0.4rem 0.25rem;"><span style="display: inline-block; width: 10px; height: 10px; background: #8B5CF6; border-radius: 2px; margin-right: 0.5rem;"></span>Compute</td>
                                <td style="text-align: center; padding: 0.4rem;">62%</td>
                                <td style="text-align: center; padding: 0.4rem;">65%</td>
                                <td style="text-align: center; padding: 0.4rem;">68%</td>
                                <td style="text-align: center; padding: 0.4rem;">71%</td>
                                <td style="text-align: center; padding: 0.4rem;">74%</td>
                                <td style="text-align: center; padding: 0.4rem; font-weight: 700; color: #8B5CF6;">76%</td>
                            </tr>
                            <tr style="background: #F9FAFB;">
                                <td style="padding: 0.4rem 0.25rem;"><span style="display: inline-block; width: 10px; height: 10px; background: #29B5E8; border-radius: 2px; margin-right: 0.5rem;"></span>Storage</td>
                                <td style="text-align: center; padding: 0.4rem;">58%</td>
                                <td style="text-align: center; padding: 0.4rem;">61%</td>
                                <td style="text-align: center; padding: 0.4rem;">63%</td>
                                <td style="text-align: center; padding: 0.4rem;">66%</td>
                                <td style="text-align: center; padding: 0.4rem;">69%</td>
                                <td style="text-align: center; padding: 0.4rem; font-weight: 700; color: #29B5E8;">72%</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.4rem 0.25rem;"><span style="display: inline-block; width: 10px; height: 10px; background: #10B981; border-radius: 2px; margin-right: 0.5rem;"></span>Network</td>
                                <td style="text-align: center; padding: 0.4rem;">45%</td>
                                <td style="text-align: center; padding: 0.4rem;">48%</td>
                                <td style="text-align: center; padding: 0.4rem;">52%</td>
                                <td style="text-align: center; padding: 0.4rem;">55%</td>
                                <td style="text-align: center; padding: 0.4rem;">58%</td>
                                <td style="text-align: center; padding: 0.4rem; font-weight: 700; color: #10B981;">62%</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 0.75rem; padding: 0.5rem; background: #FEF3C7; border-radius: 6px; text-align: center;">
                        <span style="color: #92400E; font-size: 0.75rem;">📈 All resources trending up — Compute approaching threshold</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            with col_cap2:
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
                    <div style="background: linear-gradient(135deg, #EDE9FE 0%, #F5F3FF 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #5B21B6;">Compute (vCPUs)</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #5B21B6;">76%</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">12,400 / 16,384</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #E0F2FE 0%, #F0F9FF 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #0369A1;">Storage (PB)</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #0369A1;">72%</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">14.4 / 20 PB</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #065F46;">Network (Gbps)</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #065F46;">62%</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">142 / 230 Gbps</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #92400E;">Expansion Due</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #92400E;">Q3</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">+30% capacity</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        col_projects, col_security = st.columns(2)
        
        with col_projects:
            st.markdown('<div class="section-header">Digital Transformation Projects</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.6rem; border-left: 4px solid #10B981; background: #D1FAE5; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #065F46;">5G Core Modernization</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Phase 2 of 3 · Due Q2</div>
                            </div>
                            <span style="font-weight: 700; color: #10B981;">78%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.5rem;">
                            <div style="background: #10B981; width: 78%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #29B5E8; background: #E0F2FE; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #0369A1;">Cloud Migration</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Target 85% · Due Q4</div>
                            </div>
                            <span style="font-weight: 700; color: #29B5E8;">72%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.5rem;">
                            <div style="background: #29B5E8; width: 72%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #8B5CF6; background: #EDE9FE; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #5B21B6;">AI/ML Platform</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">POC Complete · Due Q3</div>
                            </div>
                            <span style="font-weight: 700; color: #8B5CF6;">45%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.5rem;">
                            <div style="background: #8B5CF6; width: 45%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">Legacy Decommission</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">18% tech debt · Due Q4</div>
                            </div>
                            <span style="font-weight: 700; color: #F59E0B;">35%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.5rem;">
                            <div style="background: #F59E0B; width: 35%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_security:
            st.markdown('<div class="section-header">Security & Compliance</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 130px;">Compliance</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                            <div style="background: #10B981; width: 98%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #10B981; width: 40px;">98%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 130px;">Vulnerability Mgmt</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                            <div style="background: #10B981; width: 96%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #10B981; width: 40px;">96%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 130px;">Access Control</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                            <div style="background: #F59E0B; width: 94%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #F59E0B; width: 40px;">94%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 130px;">Data Protection</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                            <div style="background: #F59E0B; width: 92%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #F59E0B; width: 40px;">92%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0;">
                        <span style="width: 130px;">Threat Detection</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 12px; margin: 0 1rem;">
                            <div style="background: #F59E0B; width: 90%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #F59E0B; width: 40px;">90%</span>
                    </div>
                </div>
                <div style="display: flex; gap: 0.75rem; font-size: 0.8rem; justify-content: center; margin-top: 1rem;">
                    <span style="background: #D1FAE5; color: #065F46; padding: 0.3rem 0.6rem; border-radius: 20px;">ISO 27001 ✓</span>
                    <span style="background: #D1FAE5; color: #065F46; padding: 0.3rem 0.6rem; border-radius: 20px;">SOC 2 ✓</span>
                    <span style="background: #D1FAE5; color: #065F46; padding: 0.3rem 0.6rem; border-radius: 20px;">GDPR ✓</span>
                </div>
                """, unsafe_allow_html=True)
        
    with tab_strategy:
        st.markdown("""
        <style>
        .cso-ai-pulse {
            background: linear-gradient(135deg, #ECFEFF 0%, #CFFAFE 100%);
            border-radius: 16px;
            border: 1px solid #A5F3FC;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .cso-ai-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(14,116,144,0.18), transparent);
            animation: cso-ai-sweep 4s ease-in-out infinite;
        }
        @keyframes cso-ai-sweep { 0% { left: -120%; } 100% { left: 220%; } }
        .cso-ai-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .cso-ai-title { font-weight: 700; color: #0E7490; font-size: 1.05rem; }
        .cso-ai-tag { background: #0284C7; color: white; font-size: 0.75rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 999px; }
        .cso-ai-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.9rem; position: relative; z-index: 1; }
        .cso-ai-card { background: white; border-radius: 12px; border: 1px solid #A5F3FC; padding: 0.85rem 0.95rem; }
        .cso-ai-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9CA3AF; }
        .cso-ai-value { font-size: 1.3rem; font-weight: 700; color: #0E7490; }
        .cso-ai-sub { font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) { .cso-ai-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="cso-ai-pulse">
            <div class="cso-ai-header">
                <div class="cso-ai-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="cso-ai-tag">AI LIVE</div>
            </div>
            <div class="cso-ai-grid">
                <div class="cso-ai-card">
                    <div class="cso-ai-label">Renewables</div>
                    <div class="cso-ai-value">65%</div>
                    <div class="cso-ai-sub">Target 70%</div>
                </div>
                <div class="cso-ai-card">
                    <div class="cso-ai-label">Carbon Reduction</div>
                    <div class="cso-ai-value">-42%</div>
                    <div class="cso-ai-sub">vs 2019 baseline</div>
                </div>
                <div class="cso-ai-card">
                    <div class="cso-ai-label">PUE Average</div>
                    <div class="cso-ai-value">1.42</div>
                    <div class="cso-ai-sub">Target 1.30</div>
                </div>
                <div class="cso-ai-card">
                    <div class="cso-ai-label">Supplier ESG</div>
                    <div class="cso-ai-value">84%</div>
                    <div class="cso-ai-sub">Tier 2 focus</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Summary synthesized from energy, emissions, and ESG compliance data.")
        
        with st.container(border=True):
            st.markdown("""
            **Executive Summary (Q1 2026):**
            - Renewable energy reached **65%**, on track to hit 70% target.
            - Emissions are **down 15% YoY** with data center efficiency gains.
            - Supply chain compliance improved to **84%**, with Tier 2 remediation planned.
            """)
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Macro sites** drive 52% of energy load
                - **Wind + solar** deliver 50% of renewables
                - **Water intensity** down in London and North
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Network features** closest to SLA thresholds
                - **Tier 2 suppliers** below 85% compliance
                - **PUE** above target in Manchester DC
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Growth Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Solar expansion** adds +5% renewables
                - **Fleet EV** rollout to 50% by 2025
                - **Energy efficiency** saves £180K/year
                """)
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                - **Accelerate renewables** via PPAs in top 3 regions
                - Prioritize sites with >1.5 PUE
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                - **Reduce water intensity** with closed-loop cooling
                - Target 10% reduction by Q4
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                - **Improve supplier ESG** with quarterly audits
                - Enforce Tier 2 remediation milestones
                """)
        st.markdown("""
        <style>
        .cto-ai-pulse {
            background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
            border-radius: 16px;
            border: 1px solid #BAE6FD;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .cto-ai-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(41,181,232,0.18), transparent);
            animation: cto-ai-sweep 4s ease-in-out infinite;
        }
        @keyframes cto-ai-sweep {
            0% { left: -120%; }
            100% { left: 220%; }
        }
        .cto-ai-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .cto-ai-title { font-weight: 700; color: #0C4A6E; font-size: 1.05rem; }
        .cto-ai-tag { background: #0EA5E9; color: white; font-size: 0.75rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 999px; }
        .cto-ai-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; position: relative; z-index: 1; }
        .cto-ai-card { background: white; border-radius: 12px; border: 1px solid #E2E8F0; padding: 0.9rem 1rem; }
        .cto-ai-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9CA3AF; }
        .cto-ai-value { font-size: 1.4rem; font-weight: 700; color: #0C4A6E; }
        .cto-ai-sub { font-size: 0.8rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) { .cto-ai-grid { grid-template-columns: 1fr; } }
        </style>
        <div class="cto-ai-pulse">
            <div class="cto-ai-header">
                <div class="cto-ai-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="cto-ai-tag">AI LIVE</div>
            </div>
            <div class="cto-ai-grid">
                <div class="cto-ai-card">
                    <div class="cto-ai-label">Service Resilience</div>
                    <div class="cto-ai-value">99.97%</div>
                    <div class="cto-ai-sub">SLA above target</div>
                </div>
                <div class="cto-ai-card">
                    <div class="cto-ai-label">Cloud Migration</div>
                    <div class="cto-ai-value">72%</div>
                    <div class="cto-ai-sub">On track for 85%</div>
                </div>
                <div class="cto-ai-card">
                    <div class="cto-ai-label">Security Posture</div>
                    <div class="cto-ai-value">94/100</div>
                    <div class="cto-ai-sub">Patch compliance 98%</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Executive summary synthesized from network, infra, and security telemetry.")
        
        with st.container(border=True):
            st.markdown("""
            **Executive Summary (Q1 2026):**
            - Network performance remains strong (99.97% uptime) with latency improvements in all regions.
            - Cloud migration is progressing (72%) but compute capacity is nearing the 80% threshold.
            - Security posture is stable (94/100); access control and data protection are the top focus areas.
            """)
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **5G coverage** at **78%**
                - **Latency** down to **12ms**
                - **Compute** at **76%** utilization
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Compute capacity** nearing threshold
                - **Access control** at **94%**
                - **Tech debt** still **18%**
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Growth Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **5G expansion** +12% YoY
                - **SLA** above 99.9%
                - **AI/ML platform** 45% complete
                """)
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                **1) Accelerate 5G Rollout**
                - Add 350 sites in Q1
                - Focus Midlands & North
                - Expected impact: +7% coverage
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                **2) De-risk Capacity**
                - Scale compute +30% by Q3
                - Optimize storage tiers
                - Expected impact: +12% headroom
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                **3) Reduce Tech Debt**
                - Retire 3 legacy systems
                - Complete API modernization
                - Expected impact: -3% debt
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "What's our network uptime and latency performance by region over the last 30 days?",
            "Show me the incident trend - how many P1/P2 incidents and what's our MTTR?",
            "What's our 5G coverage by region and where should we prioritize new cell sites?",
            "What's the capacity utilization trend and when do we need to expand?",
            "Show me our digital transformation project status and any blockers."
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_coo_operations():
    import pandas as pd
    import altair as alt
    
    # COO Header with Rotating Gears Effect
    st.markdown("""
    <style>
    @keyframes coo-gear-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes coo-gear-spin-rev { 0% { transform: rotate(360deg); } 100% { transform: rotate(0deg); } }
    .coo-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .coo-gears-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; opacity: 0.15; }
    .coo-gear { position: absolute; font-size: 40px; color: white; }
    .coo-gear.spin { animation: coo-gear-spin 8s linear infinite; }
    .coo-gear.spin-rev { animation: coo-gear-spin-rev 6s linear infinite; }
    .coo-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 100%);
        border: 1px solid #FDE68A;
        padding: 2rem; color: #92400E;
    }
    .coo-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; color: #92400E; }
    .coo-header-content p { margin: 0.5rem 0 0 0; color: #B45309; font-size: 1.1rem; }
    </style>
    <div class="coo-header-wrap">
        <div class="coo-gears-bg">
            <span class="coo-gear spin" style="left: 5%; top: 10%; font-size: 50px;">⚙️</span>
            <span class="coo-gear spin-rev" style="left: 12%; top: 40%; font-size: 35px;">⚙️</span>
            <span class="coo-gear spin" style="right: 8%; top: 5%; font-size: 45px;">⚙️</span>
            <span class="coo-gear spin-rev" style="right: 15%; top: 50%; font-size: 30px;">⚙️</span>
            <span class="coo-gear spin" style="left: 40%; bottom: 5%; font-size: 25px;">⚙️</span>
            <span class="coo-gear spin-rev" style="right: 40%; top: 15%; font-size: 28px;">⚙️</span>
        </div>
        <div class="coo-header-content">
            <h1>COO Operations Dashboard</h1>
            <p>Service Delivery, Workforce & Operational Excellence</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_mlops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧪 Model Ops & Strategy", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['SUPPORT', 'WORKFORCE', 'FIELD_OPERATIONS', 'ORDER']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # COO OPERATIONS COMMAND CENTER ANIMATION
        st.markdown("""
        <style>
        @keyframes ops-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes gear-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes status-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes ops-metric-enter { 0% { opacity: 0; transform: translateY(20px) scale(0.9); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes ops-val-count { 0% { opacity: 0; transform: scale(0.5); } 50% { transform: scale(1.1); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes ops-status-ring { 0% { box-shadow: 0 0 0 0 rgba(16,185,129,0.6); } 70% { box-shadow: 0 0 0 8px rgba(16,185,129,0); } 100% { box-shadow: 0 0 0 0 rgba(16,185,129,0); } }
        .ops-command { background: #F8FAFC; border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #E2E8F0; }
        .ops-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .ops-title { color: #1B2A4E; font-size: 1.1rem; font-weight: 600; }
        .ops-status { display: flex; align-items: center; gap: 0.5rem; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; animation: status-blink 1s ease-in-out infinite, ops-status-ring 2s ease-out infinite; }
        .status-dot.green { background: #10B981; }
        .status-text { color: #10B981; font-size: 0.8rem; }
        .ops-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; }
        .ops-metric { background: white; border: 1px solid #E2E8F0; border-radius: 10px; padding: 1rem; text-align: center; animation: ops-metric-enter 0.5s ease-out forwards, ops-pulse 3s ease-in-out 0.5s infinite; opacity: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .ops-metric:nth-child(2) { animation-delay: 0.1s, 0.6s; }
        .ops-metric:nth-child(3) { animation-delay: 0.2s, 0.7s; }
        .ops-metric:nth-child(4) { animation-delay: 0.3s, 0.8s; }
        .ops-metric:nth-child(5) { animation-delay: 0.4s, 0.9s; }
        .ops-icon { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .ops-icon.spin { animation: gear-spin 4s linear infinite; display: inline-block; }
        .ops-val { color: #1B2A4E; font-size: 1.4rem; font-weight: 700; animation: ops-val-count 0.6s ease-out 0.3s forwards; opacity: 0; }
        .ops-metric:nth-child(2) .ops-val { animation-delay: 0.4s; }
        .ops-metric:nth-child(3) .ops-val { animation-delay: 0.5s; }
        .ops-metric:nth-child(4) .ops-val { animation-delay: 0.6s; }
        .ops-metric:nth-child(5) .ops-val { animation-delay: 0.7s; }
        .ops-label { color: #6B7280; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="ops-command"><div class="ops-header"><div class="ops-title">⚙️ Operations Command Center</div><div class="ops-status"><div class="status-dot green"></div><span class="status-text">All Systems Operational</span></div></div><div class="ops-grid"><div class="ops-metric"><div class="ops-icon spin">⚙️</div><div class="ops-val">99.2%</div><div class="ops-label">Service Uptime</div></div><div class="ops-metric"><div class="ops-icon">📋</div><div class="ops-val">847</div><div class="ops-label">Orders Today</div></div><div class="ops-metric"><div class="ops-icon">🔧</div><div class="ops-val">142</div><div class="ops-label">Field Jobs Active</div></div><div class="ops-metric"><div class="ops-icon">⏱️</div><div class="ops-val">4.2h</div><div class="ops-label">Avg Resolution</div></div><div class="ops-metric"><div class="ops-icon">✅</div><div class="ops-val">94%</div><div class="ops-label">SLA Compliance</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
            animation: coo-kpi-pop 0.6s ease-out forwards;
            opacity: 0;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes coo-kpi-pop { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes coo-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 1; } 
            50% { stroke-width: 3.5; opacity: 0.8; } 
        }
        @keyframes coo-fill-pulse { 
            0%, 100% { opacity: 0.15; transform: scaleY(1); } 
            50% { opacity: 0.25; transform: scaleY(1.02); } 
        }
        @keyframes coo-bar-wave { 
            0%, 100% { transform: scaleY(1); } 
            50% { transform: scaleY(0.7); } 
        }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.15;
        }
        .kpi-chart path[fill="none"] { animation: coo-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: coo-fill-pulse 3s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: coo-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-card:nth-child(2) .kpi-value { animation-delay: 0.1s; }
        .kpi-card:nth-child(3) .kpi-value { animation-delay: 0.2s; }
        .kpi-card:nth-child(4) .kpi-value { animation-delay: 0.3s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.15s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.3s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.45s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Operations Performance Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">📞</div>
                <div class="kpi-label">First Call Resolution</div>
                <div class="kpi-value">78%</div>
                <div class="kpi-delta positive">↑ +4% vs Q3</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,30 L20,28 L40,25 L60,22 L80,18 L100,16" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,30 L20,28 L40,25 L60,22 L80,18 L100,16 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">Avg Handle Time</div>
                <div class="kpi-value">4.2m</div>
                <div class="kpi-delta positive">↓ -0.8m vs target</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,15 L20,18 L40,16 L60,20 L80,22 L100,24" fill="none" stroke="#29B5E8" stroke-width="2"/>
                    <path d="M0,15 L20,18 L40,16 L60,20 L80,22 L100,24 L100,40 L0,40 Z" fill="#29B5E8"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">⭐</div>
                <div class="kpi-label">CSAT Score</div>
                <div class="kpi-value">4.3/5</div>
                <div class="kpi-delta positive">↑ +0.2 YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="28" width="12" height="12" fill="#8B5CF6"/>
                    <rect x="22" y="24" width="12" height="16" fill="#8B5CF6"/>
                    <rect x="39" y="20" width="12" height="20" fill="#8B5CF6"/>
                    <rect x="56" y="16" width="12" height="24" fill="#8B5CF6"/>
                    <rect x="73" y="14" width="12" height="26" fill="#8B5CF6"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📋</div>
                <div class="kpi-label">Order Fulfillment</div>
                <div class="kpi-value">96.8%</div>
                <div class="kpi-delta positive">↑ On-time delivery</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,22 L20,20 L40,18 L60,16 L80,14 L100,12" fill="none" stroke="#F59E0B" stroke-width="2"/>
                    <path d="M0,22 L20,20 L40,18 L60,16 L80,14 L100,12 L100,40 L0,40 Z" fill="#F59E0B"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">Agent Utilization</div>
                <div class="kpi-value">82%</div>
                <div class="kpi-delta neutral">Target: 80-85%</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🔧</div>
                <div class="kpi-label">Field Jobs (MTD)</div>
                <div class="kpi-value">4,280</div>
                <div class="kpi-delta positive">↑ 94% completion</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">📉</div>
                <div class="kpi-label">SLA Compliance</div>
                <div class="kpi-value">97.2%</div>
                <div class="kpi-delta positive">↑ vs 95% target</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">🎫</div>
                <div class="kpi-label">Open Tickets</div>
                <div class="kpi-value">1,240</div>
                <div class="kpi-delta negative">↑ +8% vs avg</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Support Ticket Volume & Resolution</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; gap: 1.5rem; font-size: 0.8rem; justify-content: center; margin-bottom: 0.75rem;">
                        <span><span style="color: #EF4444;">█</span> Opened</span>
                        <span><span style="color: #10B981;">█</span> Resolved</span>
                    </div>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="color: #6B7280; font-size: 0.75rem;">
                                <th style="text-align: center; padding: 0.4rem;">Mon</th>
                                <th style="text-align: center; padding: 0.4rem;">Tue</th>
                                <th style="text-align: center; padding: 0.4rem;">Wed</th>
                                <th style="text-align: center; padding: 0.4rem;">Thu</th>
                                <th style="text-align: center; padding: 0.4rem;">Fri</th>
                                <th style="text-align: center; padding: 0.4rem;">Sat</th>
                                <th style="text-align: center; padding: 0.4rem;">Sun</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #FEE2E2;">
                                <td style="text-align: center; padding: 0.5rem; color: #DC2626; font-weight: 600;">420</td>
                                <td style="text-align: center; padding: 0.5rem; color: #DC2626; font-weight: 600;">385</td>
                                <td style="text-align: center; padding: 0.5rem; color: #DC2626; font-weight: 600;">410</td>
                                <td style="text-align: center; padding: 0.5rem; color: #DC2626; font-weight: 600;">395</td>
                                <td style="text-align: center; padding: 0.5rem; color: #DC2626; font-weight: 600;">380</td>
                                <td style="text-align: center; padding: 0.5rem; color: #DC2626;">180</td>
                                <td style="text-align: center; padding: 0.5rem; color: #DC2626;">145</td>
                            </tr>
                            <tr style="background: #D1FAE5;">
                                <td style="text-align: center; padding: 0.5rem; color: #065F46; font-weight: 600;">390</td>
                                <td style="text-align: center; padding: 0.5rem; color: #065F46; font-weight: 600;">410</td>
                                <td style="text-align: center; padding: 0.5rem; color: #065F46; font-weight: 600;">385</td>
                                <td style="text-align: center; padding: 0.5rem; color: #065F46; font-weight: 600;">420</td>
                                <td style="text-align: center; padding: 0.5rem; color: #065F46; font-weight: 600;">395</td>
                                <td style="text-align: center; padding: 0.5rem; color: #065F46;">170</td>
                                <td style="text-align: center; padding: 0.5rem; color: #065F46;">140</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                """, unsafe_allow_html=True)
                
                tkt_cols = st.columns(4)
                with tkt_cols[0]:
                    st.markdown("""
                    <div style="text-align: center; padding: 0.5rem; background: #FEE2E2; border-radius: 8px;">
                        <div style="font-size: 0.7rem; color: #DC2626;">Weekly Opened</div>
                        <div style="font-size: 1.2rem; font-weight: 700; color: #DC2626;">2,315</div>
                    </div>
                    """, unsafe_allow_html=True)
                with tkt_cols[1]:
                    st.markdown("""
                    <div style="text-align: center; padding: 0.5rem; background: #D1FAE5; border-radius: 8px;">
                        <div style="font-size: 0.7rem; color: #065F46;">Weekly Resolved</div>
                        <div style="font-size: 1.2rem; font-weight: 700; color: #065F46;">2,310</div>
                    </div>
                    """, unsafe_allow_html=True)
                with tkt_cols[2]:
                    st.markdown("""
                    <div style="text-align: center; padding: 0.5rem; background: #E0F2FE; border-radius: 8px;">
                        <div style="font-size: 0.7rem; color: #0369A1;">Avg Resolution</div>
                        <div style="font-size: 1.2rem; font-weight: 700; color: #0369A1;">4.2h</div>
                    </div>
                    """, unsafe_allow_html=True)
                with tkt_cols[3]:
                    st.markdown("""
                    <div style="text-align: center; padding: 0.5rem; background: #FEF3C7; border-radius: 8px;">
                        <div style="font-size: 0.7rem; color: #92400E;">Backlog</div>
                        <div style="font-size: 1.2rem; font-weight: 700; color: #92400E;">1,240</div>
                    </div>
                    """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Ticket Categories</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                category_data = pd.DataFrame({
                    'Category': ['Billing', 'Technical', 'Service', 'Sales', 'Other'],
                    'Count': [420, 380, 240, 120, 80],
                    'Percentage': [34, 31, 19, 10, 6]
                })
                
                donut = alt.Chart(category_data).mark_arc(innerRadius=50, outerRadius=85, cornerRadius=4).encode(
                    theta=alt.Theta('Count:Q', stack=True),
                    color=alt.Color('Category:N',
                        scale=alt.Scale(
                            domain=['Billing', 'Technical', 'Service', 'Sales', 'Other'],
                            range=['#29B5E8', '#8B5CF6', '#10B981', '#F59E0B', '#6B7280']
                        ),
                        legend=None
                    ),
                    tooltip=[
                        alt.Tooltip('Category:N'),
                        alt.Tooltip('Count:Q'),
                        alt.Tooltip('Percentage:Q', format='d')
                    ]
                ).properties(height=180)
                
                center_text = alt.Chart(pd.DataFrame({'text': ['1,240']})).mark_text(
                    fontSize=20, fontWeight='bold', color='#1B2A4E'
                ).encode(text='text:N')
                
                st.altair_chart(donut + center_text, use_container_width=True)
                
                st.markdown("""
                <div style="font-size: 0.8rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><span style="color: #29B5E8;">●</span> Billing</span><span style="font-weight: 600;">34%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><span style="color: #8B5CF6;">●</span> Technical</span><span style="font-weight: 600;">31%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><span style="color: #10B981;">●</span> Service</span><span style="font-weight: 600;">19%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><span style="color: #F59E0B;">●</span> Sales</span><span style="font-weight: 600;">10%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0;">
                        <span><span style="color: #6B7280;">●</span> Other</span><span style="font-weight: 600;">6%</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Workforce Performance</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            col_wf1, col_wf2 = st.columns(2)
            
            with col_wf1:
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 120px;">Field Services</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #F59E0B; width: 88%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #F59E0B; width: 45px;">88%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 120px;">Contact Centre</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #10B981; width: 82%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #10B981; width: 45px;">82%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 120px;">Technical Support</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #10B981; width: 76%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #10B981; width: 45px;">76%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 120px;">Retail</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #F59E0B; width: 72%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #F59E0B; width: 45px;">72%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0;">
                        <span style="width: 120px;">Back Office</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #F59E0B; width: 68%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 700; color: #F59E0B; width: 45px;">68%</span>
                    </div>
                    <div style="text-align: center; font-size: 0.75rem; color: #6B7280; margin-top: 0.5rem;"><span style="color: #10B981;">█</span> Optimal (75-85%) <span style="color: #F59E0B; margin-left: 1rem;">█</span> Outside Range</div>
                </div>
                """, unsafe_allow_html=True)
            
            with col_wf2:
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
                    <div style="background: linear-gradient(135deg, #E0F2FE 0%, #F0F9FF 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #0369A1;">Total Headcount</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #0369A1;">695</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">+12 vs budget</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #065F46;">Avg Utilization</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #065F46;">77%</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">Target: 75-85%</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #EDE9FE 0%, #F5F3FF 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #5B21B6;">Avg CSAT</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #5B21B6;">4.24</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">Target: 4.0</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #92400E;">Attrition Rate</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #92400E;">12%</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">Industry: 18%</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        col_field, col_order = st.columns(2)
        
        with col_field:
            st.markdown('<div class="section-header">Field Operations</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                field_data = pd.DataFrame({
                    'Type': ['Installation', 'Repair', 'Maintenance', 'Upgrade', 'Survey'],
                    'Completed': [1820, 1240, 680, 420, 120],
                    'Target': [1900, 1200, 700, 400, 150],
                    'SLA_Met': [94, 96, 92, 98, 88]
                })
                
                bars = alt.Chart(field_data).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Completed:Q', title='Jobs Completed', scale=alt.Scale(domain=[0, 2000])),
                    y=alt.Y('Type:N', sort=alt.EncodingSortField(field='Completed', order='descending'), title=None),
                    color=alt.Color('SLA_Met:Q',
                        scale=alt.Scale(scheme='greens', domain=[85, 100]),
                        legend=None
                    ),
                    tooltip=[
                        alt.Tooltip('Type:N'),
                        alt.Tooltip('Completed:Q', format=','),
                        alt.Tooltip('Target:Q', format=','),
                        alt.Tooltip('SLA_Met:Q', title='SLA Met %')
                    ]
                ).properties(height=180)
                
                target_tick = alt.Chart(field_data).mark_tick(color='#DC2626', thickness=3, size=20).encode(
                    x='Target:Q',
                    y=alt.Y('Type:N', sort=alt.EncodingSortField(field='Completed', order='descending'))
                )
                
                st.altair_chart(bars + target_tick, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; gap: 0.75rem; justify-content: center;">
                    <div style="background: #D1FAE5; padding: 0.5rem 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.7rem; color: #065F46;">Total MTD</div>
                        <div style="font-weight: 700; color: #065F46;">4,280</div>
                    </div>
                    <div style="background: #E0F2FE; padding: 0.5rem 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.7rem; color: #0369A1;">Completion</div>
                        <div style="font-weight: 700; color: #0369A1;">94%</div>
                    </div>
                    <div style="background: #EDE9FE; padding: 0.5rem 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.7rem; color: #5B21B6;">Avg per Tech</div>
                        <div style="font-weight: 700; color: #5B21B6;">24/wk</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_order:
            st.markdown('<div class="section-header">Order Fulfillment Pipeline</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                order_data = pd.DataFrame({
                    'Status': ['Received', 'Processing', 'Provisioning', 'Completed', 'Delayed'],
                    'Count': [450, 320, 180, 2840, 45],
                    'Percentage': [11.7, 8.3, 4.7, 74.1, 1.2]
                })
                
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #E0F2FE; border-radius: 8px; margin-bottom: 0.5rem;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #29B5E8; border-radius: 2px; margin-right: 6px;"></span>Received</span>
                        <span style="font-weight: 600;">450</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #FEF3C7; border-radius: 8px; margin-bottom: 0.5rem;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #F59E0B; border-radius: 2px; margin-right: 6px;"></span>Processing</span>
                        <span style="font-weight: 600;">320</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #EDE9FE; border-radius: 8px; margin-bottom: 0.5rem;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #8B5CF6; border-radius: 2px; margin-right: 6px;"></span>Provisioning</span>
                        <span style="font-weight: 600;">180</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #D1FAE5; border-radius: 8px; margin-bottom: 0.5rem;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #10B981; border-radius: 2px; margin-right: 6px;"></span>Completed (MTD)</span>
                        <span style="font-weight: 600;">2,840</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #FEE2E2; border-radius: 8px;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: #EF4444; border-radius: 2px; margin-right: 6px;"></span>Delayed</span>
                        <span style="font-weight: 600; color: #DC2626;">45</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
                
                st.markdown("""
                <div style="margin-top: 0.75rem; background: linear-gradient(135deg, #1B2A4E 0%, #2D3F6B 100%); border-radius: 8px; padding: 0.75rem; color: white; text-align: center;">
                    <div style="font-size: 0.75rem; opacity: 0.8;">On-Time Delivery Rate</div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #10B981;">96.8%</div>
                </div>
                """, unsafe_allow_html=True)
        

    with tab_strategy:
        st.markdown('<div class="section-header">COO Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">FCR to 82%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current FCR: **78%** (target: 82%)
                - Deploy AI-assisted resolution
                - Knowledge base enhancement
                - Agent training program: 85% complete
                """)
        
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Reduce Ticket Backlog</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current backlog: **1,240** (target: <1,000)
                - Add 15 FTE to contact centre
                - Automate 20% of billing tickets
                - Expected resolution: Q1 end
                """)
        
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Field Efficiency +10%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **24 jobs/tech/week**
                - Route optimization: pilot complete
                - Mobile app upgrade: deployed
                - Target: **26.4 jobs/tech/week**
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "What's our ticket volume trend and which categories are growing fastest?",
            "Show me agent performance metrics - utilization, FCR, and CSAT by team.",
            "What's our order fulfillment rate and where are the bottlenecks?",
            "Which field service types have the highest completion rates and SLA compliance?",
            "What's the correlation between staffing levels and customer satisfaction scores?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_cco_commercial():
    import pandas as pd
    import altair as alt
    
    # CCO Header with Pipeline Flow Effect
    st.markdown("""
    <style>
    @keyframes cco-flow { 0% { transform: translateX(-100%); } 100% { transform: translateX(200%); } }
    @keyframes cco-pulse { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 1; transform: scale(1.1); } }
    .cco-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .cco-pipeline-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; opacity: 0.2; }
    .cco-pipe { position: absolute; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; }
    .cco-flow-dot { position: absolute; width: 12px; height: 12px; background: #8B5CF6; border-radius: 50%; animation: cco-flow 3s linear infinite; box-shadow: 0 0 10px #8B5CF6; }
    .cco-node { position: absolute; width: 16px; height: 16px; background: white; border-radius: 50%; animation: cco-pulse 2s ease-in-out infinite; }
    .cco-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(135deg, #FAF5FF 0%, #F3E8FF 100%);
        border: 1px solid #E9D5FF;
        padding: 2rem; color: #5B21B6;
    }
    .cco-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; color: #5B21B6; }
    .cco-header-content p { margin: 0.5rem 0 0 0; color: #7C3AED; font-size: 1.1rem; }
    </style>
    <div class="cco-header-wrap">
        <div class="cco-pipeline-bg">
            <div class="cco-pipe" style="top: 30%; left: 5%; width: 90%;"><div class="cco-flow-dot" style="animation-delay: 0s;"></div></div>
            <div class="cco-pipe" style="top: 50%; left: 10%; width: 80%;"><div class="cco-flow-dot" style="animation-delay: 1s;"></div></div>
            <div class="cco-pipe" style="top: 70%; left: 5%; width: 90%;"><div class="cco-flow-dot" style="animation-delay: 2s;"></div></div>
            <div class="cco-node" style="top: 28%; left: 5%;"></div>
            <div class="cco-node" style="top: 28%; left: 50%; animation-delay: 0.5s;"></div>
            <div class="cco-node" style="top: 28%; right: 5%; animation-delay: 1s;"></div>
        </div>
        <div class="cco-header-content">
            <h1>CCO Commercial Dashboard</h1>
            <p>Revenue Growth, Sales Performance & Partner Channel</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_mlops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧪 Model Ops & Strategy", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['SALES_PIPELINE', 'PARTNER', 'MOBILE', 'PORTING', 'MARKET_INTELLIGENCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # CCO COMMERCIAL - REVENUE ENGINE ANIMATION
        st.markdown("""
        <style>
        @keyframes engine-pulse { 0%, 100% { box-shadow: 0 0 10px rgba(16,185,129,0.3); } 50% { box-shadow: 0 0 30px rgba(16,185,129,0.6); } }
        @keyframes channel-flow { 0% { transform: translateX(-10px); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(10px); opacity: 0; } }
        @keyframes counter-tick { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes cco-card-pop { 0% { opacity: 0; transform: scale(0.8) translateY(20px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes cco-rev-grow { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cco-pct-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        @keyframes engine-shimmer { 0% { left: -100%; } 100% { left: 200%; } }
        .revenue-engine { background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #A7F3D0; position: relative; overflow: hidden; }
        .revenue-engine::before { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(16,185,129,0.1), transparent); animation: engine-shimmer 4s ease-in-out infinite; }
        .engine-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; position: relative; z-index: 1; }
        .engine-title { color: #065F46; font-size: 1.1rem; font-weight: 600; }
        .engine-total { text-align: right; }
        .total-label { color: #047857; font-size: 0.75rem; }
        .total-val { color: #059669; font-size: 1.8rem; font-weight: 700; animation: counter-tick 2s ease-in-out infinite; }
        .channels-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; position: relative; z-index: 1; }
        .channel-card { background: white; border-radius: 10px; padding: 1rem; text-align: center; position: relative; overflow: hidden; animation: cco-card-pop 0.5s ease-out forwards, engine-pulse 3s ease-in-out 0.5s infinite; opacity: 0; border: 1px solid #A7F3D0; }
        .channel-card:nth-child(2) { animation-delay: 0.1s, 0.6s; }
        .channel-card:nth-child(3) { animation-delay: 0.2s, 0.7s; }
        .channel-card:nth-child(4) { animation-delay: 0.3s, 0.8s; }
        .channel-icon { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .channel-name { color: #6B7280; font-size: 0.75rem; margin-bottom: 0.3rem; }
        .channel-rev { color: #059669; font-size: 1.3rem; font-weight: 700; animation: cco-rev-grow 0.6s ease-out 0.4s forwards; opacity: 0; }
        .channel-card:nth-child(2) .channel-rev { animation-delay: 0.5s; }
        .channel-card:nth-child(3) .channel-rev { animation-delay: 0.6s; }
        .channel-card:nth-child(4) .channel-rev { animation-delay: 0.7s; }
        .channel-pct { color: #10B981; font-size: 0.75rem; font-weight: 500; animation: cco-pct-bounce 2s ease-in-out infinite; }
        .channel-flow { position: absolute; bottom: 5px; left: 0; right: 0; display: flex; justify-content: center; gap: 3px; }
        .flow-dot { width: 4px; height: 4px; background: #10B981; border-radius: 50%; animation: channel-flow 1.5s ease-in-out infinite; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="revenue-engine"><div class="engine-header"><div class="engine-title">💰 Revenue Engine</div><div class="engine-total"><div class="total-label">Total Revenue MTD</div><div class="total-val">£7.4M</div></div></div><div class="channels-grid"><div class="channel-card"><div class="channel-icon">📱</div><div class="channel-name">Direct Sales</div><div class="channel-rev">£3.2M</div><div class="channel-pct">↑ +12%</div><div class="channel-flow"><span class="flow-dot"></span><span class="flow-dot" style="animation-delay:0.2s"></span><span class="flow-dot" style="animation-delay:0.4s"></span></div></div><div class="channel-card"><div class="channel-icon">🤝</div><div class="channel-name">Partner Channel</div><div class="channel-rev">£2.1M</div><div class="channel-pct">↑ +8%</div><div class="channel-flow"><span class="flow-dot"></span><span class="flow-dot" style="animation-delay:0.2s"></span><span class="flow-dot" style="animation-delay:0.4s"></span></div></div><div class="channel-card"><div class="channel-icon">🏪</div><div class="channel-name">Retail Stores</div><div class="channel-rev">£1.4M</div><div class="channel-pct">↑ +5%</div><div class="channel-flow"><span class="flow-dot"></span><span class="flow-dot" style="animation-delay:0.2s"></span><span class="flow-dot" style="animation-delay:0.4s"></span></div></div><div class="channel-card"><div class="channel-icon">🌐</div><div class="channel-name">Digital</div><div class="channel-rev">£0.7M</div><div class="channel-pct">↑ +23%</div><div class="channel-flow"><span class="flow-dot"></span><span class="flow-dot" style="animation-delay:0.2s"></span><span class="flow-dot" style="animation-delay:0.4s"></span></div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
            animation: cco-kpi-pop 0.6s ease-out forwards;
            opacity: 0;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes cco-kpi-pop { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cco-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 1; } 
            50% { stroke-width: 3.5; opacity: 0.8; } 
        }
        @keyframes cco-fill-pulse { 
            0%, 100% { opacity: 0.15; transform: scaleY(1); } 
            50% { opacity: 0.25; transform: scaleY(1.02); } 
        }
        @keyframes cco-bar-wave { 
            0%, 100% { transform: scaleY(1); } 
            50% { transform: scaleY(0.7); } 
        }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.15;
        }
        .kpi-chart path[fill="none"] { animation: cco-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: cco-fill-pulse 3s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: cco-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-card:nth-child(2) .kpi-value { animation-delay: 0.1s; }
        .kpi-card:nth-child(3) .kpi-value { animation-delay: 0.2s; }
        .kpi-card:nth-child(4) .kpi-value { animation-delay: 0.3s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.15s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.3s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.45s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Commercial Performance Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Total Revenue</div>
                <div class="kpi-value">£68.2M</div>
                <div class="kpi-delta positive">↑ +14.2% YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">B2B Pipeline</div>
                <div class="kpi-value">£24.8M</div>
                <div class="kpi-delta positive">↑ 142 opportunities</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="32" width="12" height="8" fill="#8B5CF6"/>
                    <rect x="22" y="28" width="12" height="12" fill="#8B5CF6"/>
                    <rect x="39" y="24" width="12" height="16" fill="#8B5CF6"/>
                    <rect x="56" y="20" width="12" height="20" fill="#8B5CF6"/>
                    <rect x="73" y="14" width="12" height="26" fill="#8B5CF6"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">🤝</div>
                <div class="kpi-label">Partner Revenue</div>
                <div class="kpi-value">£12.4M</div>
                <div class="kpi-delta positive">↑ +22.1% YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,30 L20,28 L40,32 L60,24 L80,20 L100,14" fill="none" stroke="#29B5E8" stroke-width="2"/>
                    <path d="M0,30 L20,28 L40,32 L60,24 L80,20 L100,14 L100,40 L0,40 Z" fill="#29B5E8"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📱</div>
                <div class="kpi-label">5G Subscribers</div>
                <div class="kpi-value">42%</div>
                <div class="kpi-delta positive">↑ +8% vs Q3</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16" fill="none" stroke="#F59E0B" stroke-width="2"/>
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16 L100,40 L0,40 Z" fill="#F59E0B"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">ARPU (Blended)</div>
                <div class="kpi-value">£38.40</div>
                <div class="kpi-delta positive">↑ +£3.20 YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">Port-In Rate</div>
                <div class="kpi-value">1.8:1</div>
                <div class="kpi-delta positive">↑ Net positive</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">🏆</div>
                <div class="kpi-label">Win Rate</div>
                <div class="kpi-value">34%</div>
                <div class="kpi-delta positive">↑ +4% vs avg</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">At-Risk Revenue</div>
                <div class="kpi-value">£2.1M</div>
                <div class="kpi-delta negative">3.1% of base</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">B2B Sales Pipeline by Stage</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="position: relative; margin: 0.5rem auto;">
                        <div style="background: linear-gradient(90deg, #8B5CF6 0%, #A78BFA 100%); color: white; padding: 0.75rem; border-radius: 8px 8px 0 0; font-weight: 600; width: 100%;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Lead Qualification</span>
                                <span>£8.2M (42 opps)</span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(90deg, #29B5E8 0%, #5BC0EB 100%); color: white; padding: 0.75rem; font-weight: 600; width: 85%; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Proposal</span>
                                <span>£6.8M (35 opps)</span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(90deg, #10B981 0%, #34D399 100%); color: white; padding: 0.75rem; font-weight: 600; width: 65%; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Negotiation</span>
                                <span>£5.4M (28 opps)</span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(90deg, #F59E0B 0%, #FBBF24 100%); color: white; padding: 0.75rem; font-weight: 600; width: 45%; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Contract</span>
                                <span>£2.8M (22 opps)</span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(90deg, #EF4444 0%, #F87171 100%); color: white; padding: 0.75rem; border-radius: 0 0 8px 8px; font-weight: 600; width: 30%; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Closed Won</span>
                                <span>£1.6M (15 opps)</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-around; margin-top: 1rem; font-size: 0.85rem;">
                    <div style="text-align: center; padding: 0.5rem; background: #F3F4F6; border-radius: 8px; flex: 1; margin: 0 0.25rem;">
                        <div style="color: #6B7280;">Avg Deal Size</div>
                        <div style="font-weight: 700; color: #1B2A4E;">£175K</div>
                    </div>
                    <div style="text-align: center; padding: 0.5rem; background: #F3F4F6; border-radius: 8px; flex: 1; margin: 0 0.25rem;">
                        <div style="color: #6B7280;">Avg Sales Cycle</div>
                        <div style="font-weight: 700; color: #1B2A4E;">68 days</div>
                    </div>
                    <div style="text-align: center; padding: 0.5rem; background: #F3F4F6; border-radius: 8px; flex: 1; margin: 0 0.25rem;">
                        <div style="color: #6B7280;">Q1 Target</div>
                        <div style="font-weight: 700; color: #10B981;">82% on track</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Revenue by Customer Type</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem; color: #6B7280;">Segment</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Revenue</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">ARPU</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Subs</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">YoY</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #29B5E8;">●</span> Consumer</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">£32.8M</td>
                            <td style="text-align: right; padding: 0.5rem;">£32.40</td>
                            <td style="text-align: right; padding: 0.5rem;">21,200</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="color: #10B981;">+11%</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #10B981;">●</span> SMB</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">£16.2M</td>
                            <td style="text-align: right; padding: 0.5rem;">£58.50</td>
                            <td style="text-align: right; padding: 0.5rem;">6,400</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="color: #10B981;">+18%</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #8B5CF6;">●</span> Enterprise</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">£19.2M</td>
                            <td style="text-align: right; padding: 0.5rem;">£142.00</td>
                            <td style="text-align: right; padding: 0.5rem;">1,400</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="color: #10B981;">+16%</span></td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Partner Performance</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">Gold Partners (8)</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Revenue: £6.2M · Commission: £620K</div>
                            </div>
                            <span style="font-weight: 700; color: #F59E0B;">50%</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #9CA3AF; background: #F3F4F6; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #4B5563;">Silver Partners (24)</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Revenue: £4.1M · Commission: £328K</div>
                            </div>
                            <span style="font-weight: 700; color: #6B7280;">33%</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #CD7F32; background: #FDF4E8; border-radius: 0 8px 8px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #8B4513;">Bronze Partners (52)</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Revenue: £2.1M · Commission: £126K</div>
                            </div>
                            <span style="font-weight: 700; color: #CD7F32;">17%</span>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: linear-gradient(135deg, #E0F2FE 0%, #F0F9FF 100%); border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.75rem; color: #0369A1;">Total Partners: 84 · Active This Month: 72</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: #0369A1;">£1.07M commissions paid MTD</div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Porting Activity</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
                    <div style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #065F46;">Port-Ins (MTD)</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #065F46;">1,840</div>
                        <div style="font-size: 0.7rem; color: #10B981;">↑ +12% vs last month</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FEE2E2 0%, #FEF2F2 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: #DC2626;">Port-Outs (MTD)</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #DC2626;">1,020</div>
                        <div style="font-size: 0.7rem; color: #DC2626;">↓ -8% vs last month</div>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; font-size: 0.8rem;">
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Top Port-In Sources:</div>
                    <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Competitor A</span><span style="font-weight: 600;">42%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Competitor B</span><span style="font-weight: 600;">28%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.25rem 0;">
                        <span>Others</span><span style="font-weight: 600;">30%</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            st.markdown('<div class="section-header">5G Adoption</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; font-weight: 700; color: #8B5CF6;">42%</div>
                    <div style="font-size: 0.85rem; color: #6B7280;">5G Subscriber Share</div>
                    <div style="background: #E5E7EB; border-radius: 4px; height: 12px; margin: 1rem 0;">
                        <div style="background: linear-gradient(90deg, #8B5CF6, #29B5E8); width: 42%; height: 100%; border-radius: 4px;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #6B7280;">
                        <span>Target: 50%</span>
                        <span>+8% vs Q3</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col2:
            st.markdown('<div class="section-header">Market Position</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Market Share</span><span style="font-weight: 700; color: #10B981;">18.4%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Market Rank</span><span style="font-weight: 700; color: #29B5E8;">#3</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>NPS vs Market</span><span style="font-weight: 700; color: #10B981;">+8</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>Price Index</span><span style="font-weight: 700; color: #F59E0B;">98</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col3:
            st.markdown('<div class="section-header">Q1 Targets</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Revenue</span><span style="font-weight: 700;">82%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.25rem;">
                            <div style="background: #10B981; width: 82%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Net Adds</span><span style="font-weight: 700;">78%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.25rem;">
                            <div style="background: #29B5E8; width: 78%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="padding: 0.4rem 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>B2B Wins</span><span style="font-weight: 700;">65%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.25rem;">
                            <div style="background: #F59E0B; width: 65%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        # Looping bar animation for Revenue Trend
        st.markdown("""
        <style>
        @keyframes rev-bar-pulse {
            0%, 100% { transform: scaleY(1); filter: brightness(1); }
            50% { transform: scaleY(0.92); filter: brightness(1.1); }
        }
        .rev-bar { 
            border-radius: 4px 4px 0 0; 
            margin: 0 auto; 
            transform-origin: bottom; 
            animation: rev-bar-pulse 2s ease-in-out infinite;
        }
        .rev-bar:nth-child(1) { animation-delay: 0s; }
        .rev-bars > div:nth-child(1) .rev-bar { animation-delay: 0s; }
        .rev-bars > div:nth-child(2) .rev-bar { animation-delay: 0.15s; }
        .rev-bars > div:nth-child(3) .rev-bar { animation-delay: 0.3s; }
        .rev-bars > div:nth-child(4) .rev-bar { animation-delay: 0.45s; }
        .rev-bars > div:nth-child(5) .rev-bar { animation-delay: 0.6s; }
        .rev-bars > div:nth-child(6) .rev-bar { animation-delay: 0.75s; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Monthly Revenue Trend & ARPU</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            st.markdown("""
            <div style="display: flex; gap: 2rem;">
                <div style="flex: 2;">
                    <div class="rev-bars" style="display: flex; align-items: flex-end; justify-content: space-between; height: 180px; padding: 0 0.5rem;">
                        <div style="text-align: center; flex: 1;">
                            <div class="rev-bar" style="background: linear-gradient(180deg, #29B5E8 0%, #0EA5E9 100%); width: 100%; height: 95px;"></div>
                            <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">Aug</div>
                            <div style="font-size: 0.75rem; font-weight: 600;">£10.2M</div>
                        </div>
                        <div style="text-align: center; flex: 1;">
                            <div class="rev-bar" style="background: linear-gradient(180deg, #29B5E8 0%, #0EA5E9 100%); width: 100%; height: 102px;"></div>
                            <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">Sep</div>
                            <div style="font-size: 0.75rem; font-weight: 600;">£10.8M</div>
                        </div>
                        <div style="text-align: center; flex: 1;">
                            <div class="rev-bar" style="background: linear-gradient(180deg, #29B5E8 0%, #0EA5E9 100%); width: 100%; height: 110px;"></div>
                            <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">Oct</div>
                            <div style="font-size: 0.75rem; font-weight: 600;">£11.2M</div>
                        </div>
                        <div style="text-align: center; flex: 1;">
                            <div class="rev-bar" style="background: linear-gradient(180deg, #29B5E8 0%, #0EA5E9 100%); width: 100%; height: 118px;"></div>
                            <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">Nov</div>
                            <div style="font-size: 0.75rem; font-weight: 600;">£11.6M</div>
                        </div>
                        <div style="text-align: center; flex: 1;">
                            <div class="rev-bar" style="background: linear-gradient(180deg, #29B5E8 0%, #0EA5E9 100%); width: 100%; height: 130px;"></div>
                            <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">Dec</div>
                            <div style="font-size: 0.75rem; font-weight: 600;">£12.2M</div>
                        </div>
                        <div style="text-align: center; flex: 1;">
                            <div class="rev-bar" style="background: linear-gradient(180deg, #10B981 0%, #059669 100%); width: 100%; height: 145px;"></div>
                            <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">Jan</div>
                            <div style="font-size: 0.75rem; font-weight: 600; color: #10B981;">£12.8M</div>
                        </div>
                    </div>
                </div>
                <div style="flex: 1; border-left: 1px solid #E5E7EB; padding-left: 1.5rem;">
                    <div style="font-size: 0.8rem; color: #6B7280; margin-bottom: 0.5rem;">ARPU Trend</div>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.75rem;">Consumer</span>
                            <span style="font-weight: 700; color: #29B5E8;">£32.40 <span style="color: #10B981; font-size: 0.7rem;">↑2.10</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.75rem;">SMB</span>
                            <span style="font-weight: 700; color: #10B981;">£58.50 <span style="color: #10B981; font-size: 0.7rem;">↑4.20</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.75rem;">Enterprise</span>
                            <span style="font-weight: 700; color: #8B5CF6;">£142.00 <span style="color: #10B981; font-size: 0.7rem;">↑8.50</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #E5E7EB; padding-top: 0.5rem; margin-top: 0.25rem;">
                            <span style="font-size: 0.75rem; font-weight: 600;">Blended</span>
                            <span style="font-weight: 700; color: #1B2A4E;">£38.40</span>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 0.5rem; background: #D1FAE5; border-radius: 6px; text-align: center;">
                        <div style="font-size: 0.7rem; color: #065F46;">6-Month Growth</div>
                        <div style="font-size: 1.2rem; font-weight: 700; color: #065F46;">+25.5%</div>
                    </div>
                </div>
            </div>
            """, unsafe_allow_html=True)
        
        col_comp, col_sales = st.columns(2)
        
        with col_comp:
            st.markdown('<div class="section-header">Competitive Market Share</div>', unsafe_allow_html=True)
            # Add looping animation for market share bars
            st.markdown("""
            <style>
            @keyframes share-bar-pulse {
                0%, 100% { filter: brightness(1); transform: scaleX(1); }
                50% { filter: brightness(1.15); transform: scaleX(1.02); }
            }
            .share-bar { animation: share-bar-pulse 2.5s ease-in-out infinite; transform-origin: left; }
            .share-bar.highlight { animation: share-bar-pulse 1.8s ease-in-out infinite; }
            .share-rows > div:nth-child(1) .share-bar { animation-delay: 0s; }
            .share-rows > div:nth-child(2) .share-bar { animation-delay: 0.2s; }
            .share-rows > div:nth-child(3) .share-bar { animation-delay: 0.4s; }
            .share-rows > div:nth-child(4) .share-bar { animation-delay: 0.6s; }
            .share-rows > div:nth-child(5) .share-bar { animation-delay: 0.8s; }
            </style>
            """, unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div class="share-rows" style="font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                        <div style="width: 90px;">Competitor A</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.5rem;">
                            <div class="share-bar" style="background: #6B7280; width: 32%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.7rem; font-weight: 600;">32%</span>
                            </div>
                        </div>
                        <span style="width: 50px; font-size: 0.75rem; color: #EF4444;">-0.8%</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                        <div style="width: 90px;">Competitor B</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.5rem;">
                            <div class="share-bar" style="background: #6B7280; width: 28%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.7rem; font-weight: 600;">28%</span>
                            </div>
                        </div>
                        <span style="width: 50px; font-size: 0.75rem; color: #EF4444;">-0.4%</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                        <div style="width: 90px; font-weight: 600; color: #29B5E8;">SnowTelco</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.5rem;">
                            <div class="share-bar highlight" style="background: linear-gradient(90deg, #29B5E8, #8B5CF6); width: 18.4%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.7rem; font-weight: 600;">18.4%</span>
                            </div>
                        </div>
                        <span style="width: 50px; font-size: 0.75rem; color: #10B981; font-weight: 600;">+1.2%</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                        <div style="width: 90px;">Competitor C</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.5rem;">
                            <div class="share-bar" style="background: #6B7280; width: 14%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.7rem; font-weight: 600;">14%</span>
                            </div>
                        </div>
                        <span style="width: 50px; font-size: 0.75rem; color: #6B7280;">+0.2%</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div style="width: 90px;">Others</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.5rem;">
                            <div class="share-bar" style="background: #9CA3AF; width: 7.6%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="width: 50px; font-size: 0.75rem; color: #EF4444;">-0.2%</span>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 0.5rem; background: #F0F9FF; border-radius: 6px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #0369A1;">📈 SnowTelco fastest growing — gaining share from top 2 competitors</span>
                </div>
                """, unsafe_allow_html=True)
        
        with col_sales:
            st.markdown('<div class="section-header">Sales Team Leaderboard</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.4rem; color: #6B7280;">#</th>
                            <th style="text-align: left; padding: 0.4rem; color: #6B7280;">Rep</th>
                            <th style="text-align: right; padding: 0.4rem; color: #6B7280;">Quota</th>
                            <th style="text-align: right; padding: 0.4rem; color: #6B7280;">Closed</th>
                            <th style="text-align: right; padding: 0.4rem; color: #6B7280;">%</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6; background: linear-gradient(90deg, #FEF3C7 0%, white 30%);">
                            <td style="padding: 0.4rem;">🥇</td>
                            <td style="padding: 0.4rem; font-weight: 600;">Sarah M.</td>
                            <td style="text-align: right; padding: 0.4rem;">£420K</td>
                            <td style="text-align: right; padding: 0.4rem;">£512K</td>
                            <td style="text-align: right; padding: 0.4rem; color: #10B981; font-weight: 700;">122%</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.4rem;">🥈</td>
                            <td style="padding: 0.4rem; font-weight: 600;">James T.</td>
                            <td style="text-align: right; padding: 0.4rem;">£380K</td>
                            <td style="text-align: right; padding: 0.4rem;">£425K</td>
                            <td style="text-align: right; padding: 0.4rem; color: #10B981; font-weight: 700;">112%</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.4rem;">🥉</td>
                            <td style="padding: 0.4rem; font-weight: 600;">Emily R.</td>
                            <td style="text-align: right; padding: 0.4rem;">£350K</td>
                            <td style="text-align: right; padding: 0.4rem;">£378K</td>
                            <td style="text-align: right; padding: 0.4rem; color: #10B981; font-weight: 700;">108%</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.4rem;">4</td>
                            <td style="padding: 0.4rem;">Michael K.</td>
                            <td style="text-align: right; padding: 0.4rem;">£320K</td>
                            <td style="text-align: right; padding: 0.4rem;">£298K</td>
                            <td style="text-align: right; padding: 0.4rem; color: #F59E0B;">93%</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.4rem;">5</td>
                            <td style="padding: 0.4rem;">Lisa W.</td>
                            <td style="text-align: right; padding: 0.4rem;">£300K</td>
                            <td style="text-align: right; padding: 0.4rem;">£245K</td>
                            <td style="text-align: right; padding: 0.4rem; color: #F59E0B;">82%</td>
                        </tr>
                    </tbody>
                </table>
                <div style="margin-top: 0.75rem; display: flex; justify-content: space-around; font-size: 0.75rem;">
                    <div style="text-align: center; padding: 0.4rem; background: #D1FAE5; border-radius: 6px; flex: 1; margin-right: 0.5rem;">
                        <div style="color: #065F46;">Above Quota</div>
                        <div style="font-weight: 700; color: #065F46;">12 reps</div>
                    </div>
                    <div style="text-align: center; padding: 0.4rem; background: #FEF3C7; border-radius: 6px; flex: 1; margin-right: 0.5rem;">
                        <div style="color: #92400E;">80-100%</div>
                        <div style="font-weight: 700; color: #92400E;">8 reps</div>
                    </div>
                    <div style="text-align: center; padding: 0.4rem; background: #FEE2E2; border-radius: 6px; flex: 1;">
                        <div style="color: #DC2626;">Below 80%</div>
                        <div style="font-weight: 700; color: #DC2626;">4 reps</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        # Animated Bar Charts CSS
        st.markdown("""
        <style>
        @keyframes bar-wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.6); }
        }
        @keyframes bar-pulse {
            0%, 100% { opacity: 0.7; transform: scaleY(0.85); }
            50% { opacity: 1; transform: scaleY(1); }
        }
        .animated-bars { display: flex; justify-content: center; align-items: flex-end; gap: 0.25rem; margin: 0.5rem 0; height: 45px; }
        .animated-bars .bar { width: 8px; border-radius: 2px; animation: bar-wave 1.5s ease-in-out infinite; transform-origin: bottom; }
        .animated-bars .bar:nth-child(1) { animation-delay: 0s; }
        .animated-bars .bar:nth-child(2) { animation-delay: 0.15s; }
        .animated-bars .bar:nth-child(3) { animation-delay: 0.3s; }
        .animated-bars .bar:nth-child(4) { animation-delay: 0.45s; }
        .animated-bars .bar:nth-child(5) { animation-delay: 0.6s; }
        .insight-card { text-align: center; }
        .insight-label { font-size: 0.75rem; color: #6B7280; }
        .insight-value { font-size: 1.8rem; font-weight: 700; }
        .insight-delta { font-size: 0.7rem; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Key Commercial Insights</div>', unsafe_allow_html=True)
        
        col_ins1, col_ins2, col_ins3, col_ins4 = st.columns(4)
        
        with col_ins1:
            with st.container(border=True):
                st.markdown("""
                <div class="insight-card">
                    <div class="insight-label">Win Rate Trend</div>
                    <div class="insight-value" style="color: #10B981;">34%</div>
                    <div class="animated-bars">
                        <div class="bar" style="height: 20px; background: #D1FAE5;"></div>
                        <div class="bar" style="height: 25px; background: #A7F3D0;"></div>
                        <div class="bar" style="height: 28px; background: #6EE7B7;"></div>
                        <div class="bar" style="height: 32px; background: #34D399;"></div>
                        <div class="bar" style="height: 38px; background: #10B981;"></div>
                    </div>
                    <div class="insight-delta" style="color: #10B981;">↑ +4% vs last quarter</div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_ins2:
            with st.container(border=True):
                st.markdown("""
                <div class="insight-card">
                    <div class="insight-label">Avg Deal Size</div>
                    <div class="insight-value" style="color: #8B5CF6;">£175K</div>
                    <div class="animated-bars">
                        <div class="bar" style="height: 22px; background: #EDE9FE;"></div>
                        <div class="bar" style="height: 26px; background: #DDD6FE;"></div>
                        <div class="bar" style="height: 30px; background: #C4B5FD;"></div>
                        <div class="bar" style="height: 35px; background: #A78BFA;"></div>
                        <div class="bar" style="height: 40px; background: #8B5CF6;"></div>
                    </div>
                    <div class="insight-delta" style="color: #8B5CF6;">↑ +£22K vs last year</div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_ins3:
            with st.container(border=True):
                st.markdown("""
                <div class="insight-card">
                    <div class="insight-label">Sales Cycle</div>
                    <div class="insight-value" style="color: #29B5E8;">68d</div>
                    <div class="animated-bars">
                        <div class="bar" style="height: 40px; background: #0EA5E9;"></div>
                        <div class="bar" style="height: 36px; background: #38BDF8;"></div>
                        <div class="bar" style="height: 32px; background: #7DD3FC;"></div>
                        <div class="bar" style="height: 28px; background: #BAE6FD;"></div>
                        <div class="bar" style="height: 25px; background: #E0F2FE;"></div>
                    </div>
                    <div class="insight-delta" style="color: #29B5E8;">↓ -12 days improved</div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_ins4:
            with st.container(border=True):
                st.markdown("""
                <div class="insight-card">
                    <div class="insight-label">Pipeline Coverage</div>
                    <div class="insight-value" style="color: #F59E0B;">3.2x</div>
                    <div class="animated-bars">
                        <div class="bar" style="height: 25px; background: #FEF3C7;"></div>
                        <div class="bar" style="height: 30px; background: #FDE68A;"></div>
                        <div class="bar" style="height: 35px; background: #FCD34D;"></div>
                        <div class="bar" style="height: 38px; background: #FBBF24;"></div>
                        <div class="bar" style="height: 42px; background: #F59E0B;"></div>
                    </div>
                    <div class="insight-delta" style="color: #F59E0B;">Target: 3.0x minimum</div>
                </div>
                """, unsafe_allow_html=True)
        

    with tab_strategy:
        st.markdown('<div class="section-header">CCO Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Revenue Growth +15%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **+14.2%** YoY (target: 15%)
                - B2B pipeline: **£24.8M** qualified
                - Enterprise wins: 15 deals Q4
                - Focus: **SMB expansion**
                """)
        
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">5G Migration 50%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **42%** (target: 50% by Q2)
                - Trade-in program launched
                - 5G ARPU premium: **+£8.20**
                - Churn reduction: **-0.6%**
                """)
        
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Partner Channel +25%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **+22.1%** YoY (target: 25%)
                - 12 new Gold partners onboarding
                - Commission optimization: live
                - Portal upgrade: **March launch**
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "Show me our revenue performance by customer type and ARPU trends.",
            "What does our B2B sales pipeline look like by stage and expected close dates?",
            "How are our partner channels performing? Show me by tier and commission status.",
            "What's our 5G vs 4G subscriber mix and ARPU comparison?",
            "How do we compare to competitors on port-in vs port-out ratios?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_cxo_customer_experience():
    import pandas as pd
    import altair as alt
    
    # CXO Header with Heartbeat Pulse Effect
    st.markdown("""
    <style>
    @keyframes cxo-heartbeat { 0%, 100% { transform: scale(1); } 14% { transform: scale(1.1); } 28% { transform: scale(1); } 42% { transform: scale(1.15); } 70% { transform: scale(1); } }
    @keyframes cxo-wave { 0% { transform: scaleX(0); opacity: 1; } 100% { transform: scaleX(1); opacity: 0; } }
    @keyframes cxo-smile { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.8; } }
    .cxo-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .cxo-heart-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; display: flex; align-items: center; justify-content: center; }
    .cxo-heart { font-size: 80px; opacity: 0.15; animation: cxo-heartbeat 1.5s ease-in-out infinite; }
    .cxo-wave { position: absolute; width: 100%; height: 2px; background: rgba(255,255,255,0.3); transform-origin: left; animation: cxo-wave 2s ease-out infinite; }
    .cxo-smile { position: absolute; font-size: 24px; opacity: 0.3; animation: cxo-smile 3s ease-in-out infinite; }
    .cxo-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(135deg, #F0FDFA 0%, #CCFBF1 100%);
        border: 1px solid #99F6E4;
        padding: 2rem; color: #115E59;
    }
    .cxo-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; color: #115E59; }
    .cxo-header-content p { margin: 0.5rem 0 0 0; color: #0F766E; font-size: 1.1rem; }
    </style>
    <div class="cxo-header-wrap">
        <div class="cxo-heart-bg">
            <span class="cxo-heart">❤️</span>
            <div class="cxo-wave" style="top: 40%; animation-delay: 0s;"></div>
            <div class="cxo-wave" style="top: 50%; animation-delay: 0.5s;"></div>
            <div class="cxo-wave" style="top: 60%; animation-delay: 1s;"></div>
            <span class="cxo-smile" style="left: 10%; top: 20%; animation-delay: 0s;">😊</span>
            <span class="cxo-smile" style="right: 15%; top: 25%; animation-delay: 1s;">⭐</span>
            <span class="cxo-smile" style="left: 15%; bottom: 20%; animation-delay: 2s;">👍</span>
        </div>
        <div class="cxo-header-content">
            <h1>CXO Customer Experience Dashboard</h1>
            <p>Customer Journey, NPS & Experience Transformation</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_mlops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧪 Model Ops & Strategy", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['CUSTOMER_EXPERIENCE', 'MOBILE', 'SUPPORT']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # CXO CUSTOMER JOURNEY ANIMATION
        st.markdown("""
        <style>
        @keyframes journey-flow { 0% { transform: translateX(-20px); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(20px); opacity: 0; } }
        @keyframes heart-beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        @keyframes nps-glow { 0%, 100% { box-shadow: 0 0 10px rgba(245,158,11,0.3); } 50% { box-shadow: 0 0 25px rgba(245,158,11,0.6); } }
        @keyframes cxo-step-enter { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes cxo-score-pop { 0% { opacity: 0; transform: scale(0); } 50% { transform: scale(1.2); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cxo-stat-rise { 0% { opacity: 0; transform: translateY(15px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes cxo-nps-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .cx-journey { background: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .cx-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .cx-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .cx-nps { background: rgba(245,158,11,0.2); border: 2px solid #F59E0B; border-radius: 12px; padding: 0.5rem 1rem; animation: nps-glow 2s ease-in-out infinite, cxo-nps-bounce 3s ease-in-out infinite; }
        .nps-label { color: rgba(255,255,255,0.7); font-size: 0.65rem; text-transform: uppercase; }
        .nps-val { color: #F59E0B; font-size: 1.5rem; font-weight: 700; }
        .journey-path { display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 1rem; }
        .journey-step { text-align: center; flex: 1; animation: cxo-step-enter 0.5s ease-out forwards; opacity: 0; }
        .journey-step:nth-child(3) { animation-delay: 0.1s; }
        .journey-step:nth-child(5) { animation-delay: 0.2s; }
        .journey-step:nth-child(7) { animation-delay: 0.3s; }
        .journey-step:nth-child(9) { animation-delay: 0.4s; }
        .step-icon { font-size: 1.5rem; margin-bottom: 0.3rem; }
        .step-icon.heart { animation: heart-beat 1s ease-in-out infinite; display: inline-block; }
        .step-name { color: rgba(255,255,255,0.8); font-size: 0.7rem; }
        .step-score { color: white; font-size: 1rem; font-weight: 700; animation: cxo-score-pop 0.6s ease-out 0.5s forwards; opacity: 0; }
        .journey-arrow { color: rgba(255,255,255,0.4); font-size: 1.2rem; animation: journey-flow 1.5s ease-in-out infinite; }
        .cx-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; }
        .cx-stat { background: rgba(255,255,255,0.1); border-radius: 8px; padding: 0.6rem; text-align: center; animation: cxo-stat-rise 0.5s ease-out forwards; opacity: 0; }
        .cx-stat:nth-child(2) { animation-delay: 0.1s; }
        .cx-stat:nth-child(3) { animation-delay: 0.2s; }
        .cx-stat:nth-child(4) { animation-delay: 0.3s; }
        .cx-stat-val { color: white; font-size: 1.1rem; font-weight: 700; }
        .cx-stat-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="cx-journey"><div class="cx-header"><div class="cx-title">💜 Customer Experience Journey</div><div class="cx-nps"><div class="nps-label">NPS Score</div><div class="nps-val">+47</div></div></div><div class="journey-path"><div class="journey-step"><div class="step-icon">🔍</div><div class="step-name">Awareness</div><div class="step-score">8.2</div></div><span class="journey-arrow">→</span><div class="journey-step"><div class="step-icon">🛒</div><div class="step-name">Purchase</div><div class="step-score">7.8</div></div><span class="journey-arrow">→</span><div class="journey-step"><div class="step-icon">📱</div><div class="step-name">Onboarding</div><div class="step-score">8.5</div></div><span class="journey-arrow">→</span><div class="journey-step"><div class="step-icon">🎧</div><div class="step-name">Support</div><div class="step-score">7.4</div></div><span class="journey-arrow">→</span><div class="journey-step"><div class="step-icon heart">❤️</div><div class="step-name">Loyalty</div><div class="step-score">8.1</div></div></div><div class="cx-stats"><div class="cx-stat"><div class="cx-stat-val">4.6/5</div><div class="cx-stat-label">CSAT Score</div></div><div class="cx-stat"><div class="cx-stat-val">87%</div><div class="cx-stat-label">First Contact</div></div><div class="cx-stat"><div class="cx-stat-val">2.1%</div><div class="cx-stat-label">Churn Rate</div></div><div class="cx-stat"><div class="cx-stat-val">£847</div><div class="cx-stat-label">Avg CLV</div></div></div></div>""", unsafe_allow_html=True)
        
        # Animated Customer Flow Sankey
        st.markdown('<div class="section-header">Customer Flow Analysis</div>', unsafe_allow_html=True)
        
        components.html("""
        <!DOCTYPE html>
        <html>
        <head>
        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        @keyframes sankey-flow {
            0% { stroke-dashoffset: 200; }
            100% { stroke-dashoffset: 0; }
        }
        @keyframes sankey-flow-reverse {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -200; }
        }
        @keyframes sankey-node-pulse {
            0%, 100% { filter: drop-shadow(0 0 3px rgba(41, 181, 232, 0.3)); }
            50% { filter: drop-shadow(0 0 10px rgba(41, 181, 232, 0.6)); }
        }
        @keyframes flow-particle {
            0% { offset-distance: 0%; opacity: 0; }
            5% { opacity: 1; }
            95% { opacity: 1; }
            100% { offset-distance: 100%; opacity: 0; }
        }
        .sankey-container {
            background: linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 100%);
            border-radius: 16px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .sankey-svg {
            width: 100%;
            height: 280px;
        }
        .sankey-node {
            animation: sankey-node-pulse 3s ease-in-out infinite;
        }
        .sankey-path {
            fill: none;
            stroke-dasharray: 20 10;
            animation: sankey-flow-reverse 2s linear infinite;
        }
        .sankey-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .sankey-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: #6B7280;
        }
        .sankey-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        </style>
        </head>
        <body>
        <div class="sankey-container">
            <svg class="sankey-svg" viewBox="0 0 800 280">
                <rect class="sankey-node" x="20" y="20" width="100" height="50" rx="8" fill="#3B82F6"/>
                <text x="70" y="42" text-anchor="middle" fill="white" font-size="11" font-weight="600">Digital</text>
                <text x="70" y="58" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">45%</text>
                
                <rect class="sankey-node" x="20" y="90" width="100" height="40" rx="8" fill="#8B5CF6"/>
                <text x="70" y="108" text-anchor="middle" fill="white" font-size="11" font-weight="600">Retail</text>
                <text x="70" y="122" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">30%</text>
                
                <rect class="sankey-node" x="20" y="150" width="100" height="35" rx="8" fill="#EC4899"/>
                <text x="70" y="166" text-anchor="middle" fill="white" font-size="11" font-weight="600">Partner</text>
                <text x="70" y="180" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">15%</text>
                
                <rect class="sankey-node" x="20" y="205" width="100" height="30" rx="8" fill="#F59E0B"/>
                <text x="70" y="218" text-anchor="middle" fill="white" font-size="11" font-weight="600">Referral</text>
                <text x="70" y="232" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">10%</text>
                
                <rect class="sankey-node" x="300" y="30" width="110" height="70" rx="8" fill="#10B981" style="animation-delay: 0.3s;"/>
                <text x="355" y="58" text-anchor="middle" fill="white" font-size="11" font-weight="600">Consumer</text>
                <text x="355" y="78" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">62% - 18.6K</text>
                
                <rect class="sankey-node" x="300" y="120" width="110" height="50" rx="8" fill="#06B6D4" style="animation-delay: 0.5s;"/>
                <text x="355" y="142" text-anchor="middle" fill="white" font-size="11" font-weight="600">SMB</text>
                <text x="355" y="158" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">26% - 7.8K</text>
                
                <rect class="sankey-node" x="300" y="190" width="110" height="45" rx="8" fill="#6366F1" style="animation-delay: 0.7s;"/>
                <text x="355" y="210" text-anchor="middle" fill="white" font-size="11" font-weight="600">Enterprise</text>
                <text x="355" y="226" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">12% - 3.6K</text>
                
                <rect class="sankey-node" x="580" y="40" width="100" height="90" rx="8" fill="#10B981" style="animation-delay: 0.9s;"/>
                <text x="630" y="75" text-anchor="middle" fill="white" font-size="11" font-weight="600">Retained</text>
                <text x="630" y="95" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">97.9%</text>
                <text x="630" y="115" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="9">29.4K customers</text>
                
                <rect class="sankey-node" x="580" y="150" width="100" height="45" rx="8" fill="#F59E0B" style="animation-delay: 1.1s;"/>
                <text x="630" y="170" text-anchor="middle" fill="white" font-size="11" font-weight="600">At Risk</text>
                <text x="630" y="186" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">1.5% - 450</text>
                
                <rect class="sankey-node" x="580" y="210" width="100" height="35" rx="8" fill="#EF4444" style="animation-delay: 1.3s;"/>
                <text x="630" y="226" text-anchor="middle" fill="white" font-size="11" font-weight="600">Churned</text>
                <text x="630" y="240" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">0.6% - 180</text>
                
                <path class="sankey-path" d="M120,45 C200,45 200,65 300,65" stroke="#3B82F6" stroke-width="20" opacity="0.4" style="animation-delay: 0.2s;"/>
                <path class="sankey-path" d="M120,45 C200,45 200,145 300,145" stroke="#3B82F6" stroke-width="8" opacity="0.3" style="animation-delay: 0.3s;"/>
                <path class="sankey-path" d="M120,110 C200,110 200,65 300,65" stroke="#8B5CF6" stroke-width="12" opacity="0.4" style="animation-delay: 0.4s;"/>
                <path class="sankey-path" d="M120,110 C200,110 200,145 300,145" stroke="#8B5CF6" stroke-width="8" opacity="0.3" style="animation-delay: 0.5s;"/>
                <path class="sankey-path" d="M120,167 C200,167 200,212 300,212" stroke="#EC4899" stroke-width="10" opacity="0.4" style="animation-delay: 0.6s;"/>
                <path class="sankey-path" d="M120,220 C200,220 200,145 300,145" stroke="#F59E0B" stroke-width="6" opacity="0.4" style="animation-delay: 0.7s;"/>
                
                <path class="sankey-path" d="M410,65 C490,65 490,85 580,85" stroke="#10B981" stroke-width="28" opacity="0.5" style="animation-delay: 0.8s;"/>
                <path class="sankey-path" d="M410,145 C490,145 490,85 580,85" stroke="#06B6D4" stroke-width="18" opacity="0.5" style="animation-delay: 0.9s;"/>
                <path class="sankey-path" d="M410,212 C490,212 490,85 580,85" stroke="#6366F1" stroke-width="12" opacity="0.5" style="animation-delay: 1.0s;"/>
                <path class="sankey-path" d="M410,65 C490,65 490,172 580,172" stroke="#F59E0B" stroke-width="4" opacity="0.5" style="animation-delay: 1.1s;"/>
                <path class="sankey-path" d="M410,145 C490,145 490,172 580,172" stroke="#F59E0B" stroke-width="3" opacity="0.5" style="animation-delay: 1.2s;"/>
                <path class="sankey-path" d="M410,65 C490,65 490,227 580,227" stroke="#EF4444" stroke-width="2" opacity="0.5" style="animation-delay: 1.3s;"/>
            </svg>
            <div class="sankey-legend">
                <div class="sankey-legend-item"><div class="sankey-legend-dot" style="background: #3B82F6;"></div>Digital Channel</div>
                <div class="sankey-legend-item"><div class="sankey-legend-dot" style="background: #8B5CF6;"></div>Retail Store</div>
                <div class="sankey-legend-item"><div class="sankey-legend-dot" style="background: #EC4899;"></div>Partner</div>
                <div class="sankey-legend-item"><div class="sankey-legend-dot" style="background: #10B981;"></div>Retained</div>
                <div class="sankey-legend-item"><div class="sankey-legend-dot" style="background: #F59E0B;"></div>At Risk</div>
                <div class="sankey-legend-item"><div class="sankey-legend-dot" style="background: #EF4444;"></div>Churned</div>
            </div>
        </div>
        </body>
        </html>
        """, height=380, scrolling=False)
        
        st.markdown("""
        <style>
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
            animation: cxo-kpi-pop 0.6s ease-out forwards;
            opacity: 0;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes cxo-kpi-pop { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cxo-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 1; } 
            50% { stroke-width: 3.5; opacity: 0.8; } 
        }
        @keyframes cxo-fill-pulse { 
            0%, 100% { opacity: 0.15; transform: scaleY(1); } 
            50% { opacity: 0.25; transform: scaleY(1.02); } 
        }
        @keyframes cxo-bar-wave { 
            0%, 100% { transform: scaleY(1); } 
            50% { transform: scaleY(0.7); } 
        }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.15;
        }
        .kpi-chart path[fill="none"] { animation: cxo-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: cxo-fill-pulse 3s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: cxo-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-card:nth-child(2) .kpi-value { animation-delay: 0.1s; }
        .kpi-card:nth-child(3) .kpi-value { animation-delay: 0.2s; }
        .kpi-card:nth-child(4) .kpi-value { animation-delay: 0.3s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.15s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.3s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.45s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Customer Experience Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">⭐</div>
                <div class="kpi-label">NPS Score</div>
                <div class="kpi-value">+42</div>
                <div class="kpi-delta positive">↑ +8 vs Q3</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">😊</div>
                <div class="kpi-label">CSAT Score</div>
                <div class="kpi-value">4.3/5</div>
                <div class="kpi-delta positive">↑ +0.3 YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="32" width="12" height="8" fill="#8B5CF6"/>
                    <rect x="22" y="28" width="12" height="12" fill="#8B5CF6"/>
                    <rect x="39" y="24" width="12" height="16" fill="#8B5CF6"/>
                    <rect x="56" y="20" width="12" height="20" fill="#8B5CF6"/>
                    <rect x="73" y="14" width="12" height="26" fill="#8B5CF6"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">💪</div>
                <div class="kpi-label">Customer Effort</div>
                <div class="kpi-value">2.1</div>
                <div class="kpi-delta positive">↓ Lower is better</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,15 L20,18 L40,20 L60,24 L80,28 L100,32" fill="none" stroke="#29B5E8" stroke-width="2"/>
                    <path d="M0,15 L20,18 L40,20 L60,24 L80,28 L100,32 L100,40 L0,40 Z" fill="#29B5E8"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">First Contact Resolution</div>
                <div class="kpi-value">78%</div>
                <div class="kpi-delta positive">↑ +5% vs target</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16" fill="none" stroke="#F59E0B" stroke-width="2"/>
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16 L100,40 L0,40 Z" fill="#F59E0B"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">📱</div>
                <div class="kpi-label">Digital Adoption</div>
                <div class="kpi-value">68%</div>
                <div class="kpi-delta positive">↑ +12% YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">Avg Response Time</div>
                <div class="kpi-value">42s</div>
                <div class="kpi-delta positive">↓ -18s vs Q3</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">✅</div>
                <div class="kpi-label">Resolution Rate</div>
                <div class="kpi-value">92%</div>
                <div class="kpi-delta positive">↑ +3% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">😤</div>
                <div class="kpi-label">Detractors</div>
                <div class="kpi-value">8%</div>
                <div class="kpi-delta positive">↓ -2% vs Q3</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Customer Journey Stages</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid #F3F4F6;">
                        <div style="width: 110px; font-weight: 600;">Awareness</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem; position: relative;">
                            <div style="background: linear-gradient(90deg, #8B5CF6, #A78BFA); width: 85%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.75rem; font-weight: 600;">12,400</span>
                            </div>
                        </div>
                        <span style="width: 60px; text-align: right; color: #10B981; font-weight: 600;">+4.2</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid #F3F4F6;">
                        <div style="width: 110px; font-weight: 600;">Consideration</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem; position: relative;">
                            <div style="background: linear-gradient(90deg, #29B5E8, #5BC0EB); width: 72%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.75rem; font-weight: 600;">8,900</span>
                            </div>
                        </div>
                        <span style="width: 60px; text-align: right; color: #10B981; font-weight: 600;">+4.0</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid #F3F4F6;">
                        <div style="width: 110px; font-weight: 600;">Purchase</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem; position: relative;">
                            <div style="background: linear-gradient(90deg, #10B981, #34D399); width: 58%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.75rem; font-weight: 600;">6,200</span>
                            </div>
                        </div>
                        <span style="width: 60px; text-align: right; color: #10B981; font-weight: 600;">+4.5</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid #F3F4F6;">
                        <div style="width: 110px; font-weight: 600;">Support</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem; position: relative;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 45%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.75rem; font-weight: 600;">4,800</span>
                            </div>
                        </div>
                        <span style="width: 60px; text-align: right; color: #F59E0B; font-weight: 600;">+3.8</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid #F3F4F6;">
                        <div style="width: 110px; font-weight: 600;">Usage</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem; position: relative;">
                            <div style="background: linear-gradient(90deg, #EC4899, #F472B6); width: 92%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.75rem; font-weight: 600;">28,500</span>
                            </div>
                        </div>
                        <span style="width: 60px; text-align: right; color: #10B981; font-weight: 600;">+4.4</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem 0;">
                        <div style="width: 110px; font-weight: 600;">Renewal</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem; position: relative;">
                            <div style="background: linear-gradient(90deg, #6366F1, #818CF8); width: 35%; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem;">
                                <span style="color: white; font-size: 0.75rem; font-weight: 600;">2,400</span>
                            </div>
                        </div>
                        <span style="width: 60px; text-align: right; color: #10B981; font-weight: 600;">+4.6</span>
                    </div>
                </div>
                <div style="display: flex; justify-content: flex-end; font-size: 0.75rem; color: #6B7280; margin-top: 0.5rem;">
                    <span>Interactions | Sentiment Score (1-5)</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Channel Performance</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem; color: #6B7280;">Channel</th>
                            <th style="text-align: center; padding: 0.5rem; color: #6B7280;">Sentiment</th>
                            <th style="text-align: center; padding: 0.5rem; color: #6B7280;">Effort</th>
                            <th style="text-align: center; padding: 0.5rem; color: #6B7280;">Resolution</th>
                            <th style="text-align: center; padding: 0.5rem; color: #6B7280;">Conv Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">📱 Mobile App</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">4.5</span></td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">1.8</span></td>
                            <td style="text-align: center; padding: 0.5rem;">94%</td>
                            <td style="text-align: center; padding: 0.5rem; font-weight: 600; color: #10B981;">12%</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">💬 Live Chat</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">4.2</span></td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">2.0</span></td>
                            <td style="text-align: center; padding: 0.5rem;">88%</td>
                            <td style="text-align: center; padding: 0.5rem; font-weight: 600; color: #10B981;">8%</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">📞 Call Centre</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">3.8</span></td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">2.8</span></td>
                            <td style="text-align: center; padding: 0.5rem;">82%</td>
                            <td style="text-align: center; padding: 0.5rem; font-weight: 600;">5%</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">🏪 Retail Store</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">4.4</span></td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">2.5</span></td>
                            <td style="text-align: center; padding: 0.5rem;">91%</td>
                            <td style="text-align: center; padding: 0.5rem; font-weight: 600; color: #10B981;">18%</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">🌐 Website</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">3.9</span></td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">2.2</span></td>
                            <td style="text-align: center; padding: 0.5rem;">75%</td>
                            <td style="text-align: center; padding: 0.5rem; font-weight: 600;">6%</td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">NPS by Segment</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.6rem; border-left: 4px solid #10B981; background: #D1FAE5; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #065F46;">Premium</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">3,200 customers</div>
                            </div>
                            <span style="font-size: 1.5rem; font-weight: 700; color: #10B981;">+58</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #29B5E8; background: #E0F2FE; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #0369A1;">5G Subscribers</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">12,600 customers</div>
                            </div>
                            <span style="font-size: 1.5rem; font-weight: 700; color: #29B5E8;">+52</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #8B5CF6; background: #EDE9FE; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #5B21B6;">Standard</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">10,500 customers</div>
                            </div>
                            <span style="font-size: 1.5rem; font-weight: 700; color: #8B5CF6;">+38</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">Budget</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">5,400 customers</div>
                            </div>
                            <span style="font-size: 1.5rem; font-weight: 700; color: #F59E0B;">+24</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Experience Initiatives</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.5rem; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">AI Chatbot Rollout</span>
                            <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.75rem;">Live</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.5rem;">
                            <div style="background: #10B981; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="padding: 0.5rem; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">App Personalization</span>
                            <span style="background: #E0F2FE; color: #0369A1; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.75rem;">78%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.5rem;">
                            <div style="background: #29B5E8; width: 78%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="padding: 0.5rem; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">Proactive Outreach</span>
                            <span style="background: #EDE9FE; color: #5B21B6; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.75rem;">52%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.5rem;">
                            <div style="background: #8B5CF6; width: 52%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="padding: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">Journey Redesign</span>
                            <span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.75rem;">35%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 6px; margin-top: 0.5rem;">
                            <div style="background: #F59E0B; width: 35%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Voice of Customer</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.8rem; color: #6B7280;">
                    <div style="padding: 0.5rem; background: #F9FAFB; border-radius: 8px; margin-bottom: 0.5rem;">
                        <div style="color: #10B981; font-weight: 600;">🟢 Promoter Themes</div>
                        <div style="margin-top: 0.25rem;">Network quality, app experience, staff helpfulness</div>
                    </div>
                    <div style="padding: 0.5rem; background: #F9FAFB; border-radius: 8px;">
                        <div style="color: #EF4444; font-weight: 600;">🔴 Detractor Themes</div>
                        <div style="margin-top: 0.25rem;">Wait times, billing clarity, coverage gaps</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">NPS Trend (6 Months)</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            col_nps_chart, col_nps_breakdown = st.columns([2, 1])
            
            with col_nps_chart:
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb']
                nps_trend_data = pd.DataFrame({
                    'Month': months,
                    'NPS': [38, 40, 43, 45, 48, 50, 52]
                })
                
                nps_line = alt.Chart(nps_trend_data).mark_area(
                    line={'color': '#10B981', 'strokeWidth': 3},
                    color=alt.Gradient(
                        gradient='linear',
                        stops=[alt.GradientStop(color='rgba(16, 185, 129, 0.3)', offset=0),
                               alt.GradientStop(color='rgba(16, 185, 129, 0)', offset=1)],
                        x1=1, x2=1, y1=1, y2=0
                    )
                ).encode(
                    x=alt.X('Month:N', sort=months, axis=alt.Axis(labelAngle=0, title=None)),
                    y=alt.Y('NPS:Q', scale=alt.Scale(domain=[0, 60]), axis=alt.Axis(title='NPS Score'))
                )
                
                nps_points = alt.Chart(nps_trend_data).mark_circle(size=80, color='#10B981').encode(
                    x=alt.X('Month:N', sort=months),
                    y=alt.Y('NPS:Q'),
                    tooltip=['Month:N', alt.Tooltip('NPS:Q', title='NPS', format='+d')]
                )
                
                target_line = alt.Chart(pd.DataFrame({'y': [45]})).mark_rule(
                    color='#9CA3AF', strokeDash=[4, 4]
                ).encode(y='y:Q')
                
                nps_labels = alt.Chart(nps_trend_data.tail(1)).mark_text(
                    dy=-15, fontSize=12, fontWeight='bold', color='#10B981'
                ).encode(
                    x=alt.X('Month:N', sort=months),
                    y=alt.Y('NPS:Q'),
                    text=alt.Text('NPS:Q', format='+d')
                )
                
                st.altair_chart((nps_line + nps_points + target_line + nps_labels).properties(height=160), use_container_width=True)
            
            with col_nps_breakdown:
                st.markdown("""
                <div style="font-size: 0.75rem; color: #6B7280; margin-bottom: 0.75rem;">NPS Breakdown</div>
                <div style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                        <span style="color: #10B981;">Promoters</span>
                        <span style="font-weight: 700; color: #10B981;">62%</span>
                    </div>
                    <div style="background: #E5E7EB; border-radius: 4px; height: 8px; margin-top: 0.25rem;">
                        <div style="background: #10B981; width: 62%; height: 100%; border-radius: 4px;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                        <span style="color: #F59E0B;">Passives</span>
                        <span style="font-weight: 700; color: #F59E0B;">28%</span>
                    </div>
                    <div style="background: #E5E7EB; border-radius: 4px; height: 8px; margin-top: 0.25rem;">
                        <div style="background: #F59E0B; width: 28%; height: 100%; border-radius: 4px;"></div>
                    </div>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                        <span style="color: #EF4444;">Detractors</span>
                        <span style="font-weight: 700; color: #EF4444;">10%</span>
                    </div>
                    <div style="background: #E5E7EB; border-radius: 4px; height: 8px; margin-top: 0.25rem;">
                        <div style="background: #EF4444; width: 10%; height: 100%; border-radius: 4px;"></div>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #D1FAE5; border-radius: 6px; text-align: center; font-size: 0.75rem;">
                    <span style="color: #065F46;">↑ +14 pts in 6 months</span>
                </div>
                """, unsafe_allow_html=True)
        
        col_sent, col_drop = st.columns(2)
        
        with col_sent:
            st.markdown('<div class="section-header">Sentiment Analysis by Topic</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; margin-bottom: 0.6rem; padding-bottom: 0.6rem; border-bottom: 1px solid #F3F4F6;">
                        <div style="width: 100px;">Network</div>
                        <div style="flex: 1; display: flex; gap: 2px; margin: 0 0.5rem;">
                            <div style="background: #10B981; height: 16px; width: 72%; border-radius: 2px 0 0 2px;"></div>
                            <div style="background: #F59E0B; height: 16px; width: 18%;"></div>
                            <div style="background: #EF4444; height: 16px; width: 10%; border-radius: 0 2px 2px 0;"></div>
                        </div>
                        <span style="width: 50px; color: #10B981; font-weight: 700; font-size: 0.8rem;">+62</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 0.6rem; padding-bottom: 0.6rem; border-bottom: 1px solid #F3F4F6;">
                        <div style="width: 100px;">App/Digital</div>
                        <div style="flex: 1; display: flex; gap: 2px; margin: 0 0.5rem;">
                            <div style="background: #10B981; height: 16px; width: 68%; border-radius: 2px 0 0 2px;"></div>
                            <div style="background: #F59E0B; height: 16px; width: 20%;"></div>
                            <div style="background: #EF4444; height: 16px; width: 12%; border-radius: 0 2px 2px 0;"></div>
                        </div>
                        <span style="width: 50px; color: #10B981; font-weight: 700; font-size: 0.8rem;">+56</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 0.6rem; padding-bottom: 0.6rem; border-bottom: 1px solid #F3F4F6;">
                        <div style="width: 100px;">Pricing</div>
                        <div style="flex: 1; display: flex; gap: 2px; margin: 0 0.5rem;">
                            <div style="background: #10B981; height: 16px; width: 45%; border-radius: 2px 0 0 2px;"></div>
                            <div style="background: #F59E0B; height: 16px; width: 35%;"></div>
                            <div style="background: #EF4444; height: 16px; width: 20%; border-radius: 0 2px 2px 0;"></div>
                        </div>
                        <span style="width: 50px; color: #F59E0B; font-weight: 700; font-size: 0.8rem;">+25</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 0.6rem; padding-bottom: 0.6rem; border-bottom: 1px solid #F3F4F6;">
                        <div style="width: 100px;">Support</div>
                        <div style="flex: 1; display: flex; gap: 2px; margin: 0 0.5rem;">
                            <div style="background: #10B981; height: 16px; width: 55%; border-radius: 2px 0 0 2px;"></div>
                            <div style="background: #F59E0B; height: 16px; width: 28%;"></div>
                            <div style="background: #EF4444; height: 16px; width: 17%; border-radius: 0 2px 2px 0;"></div>
                        </div>
                        <span style="width: 50px; color: #10B981; font-weight: 700; font-size: 0.8rem;">+38</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div style="width: 100px;">Billing</div>
                        <div style="flex: 1; display: flex; gap: 2px; margin: 0 0.5rem;">
                            <div style="background: #10B981; height: 16px; width: 40%; border-radius: 2px 0 0 2px;"></div>
                            <div style="background: #F59E0B; height: 16px; width: 32%;"></div>
                            <div style="background: #EF4444; height: 16px; width: 28%; border-radius: 0 2px 2px 0;"></div>
                        </div>
                        <span style="width: 50px; color: #F59E0B; font-weight: 700; font-size: 0.8rem;">+12</span>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; display: flex; justify-content: center; gap: 1.5rem; font-size: 0.7rem;">
                    <span><span style="background: #10B981; display: inline-block; width: 10px; height: 10px; border-radius: 2px; margin-right: 4px;"></span>Positive</span>
                    <span><span style="background: #F59E0B; display: inline-block; width: 10px; height: 10px; border-radius: 2px; margin-right: 4px;"></span>Neutral</span>
                    <span><span style="background: #EF4444; display: inline-block; width: 10px; height: 10px; border-radius: 2px; margin-right: 4px;"></span>Negative</span>
                </div>
                """, unsafe_allow_html=True)
        
        with col_drop:
            st.markdown('<div class="section-header">Journey Drop-off Analysis</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="text-align: center; margin-bottom: 0.75rem;">
                        <span style="font-size: 0.75rem; color: #6B7280;">Purchase Journey Conversion Funnel</span>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
                        <div style="background: linear-gradient(90deg, #29B5E8, #0EA5E9); width: 100%; padding: 0.5rem; border-radius: 4px; display: flex; justify-content: space-between;">
                            <span style="color: white; font-weight: 600;">Browse Plans</span>
                            <span style="color: white;">100%</span>
                        </div>
                        <div style="color: #EF4444; font-size: 0.7rem;">↓ -22% drop</div>
                        <div style="background: linear-gradient(90deg, #29B5E8, #0EA5E9); width: 78%; padding: 0.5rem; border-radius: 4px; display: flex; justify-content: space-between;">
                            <span style="color: white; font-weight: 600;">Configure</span>
                            <span style="color: white;">78%</span>
                        </div>
                        <div style="color: #EF4444; font-size: 0.7rem;">↓ -15% drop</div>
                        <div style="background: linear-gradient(90deg, #29B5E8, #0EA5E9); width: 63%; padding: 0.5rem; border-radius: 4px; display: flex; justify-content: space-between;">
                            <span style="color: white; font-weight: 600;">Cart</span>
                            <span style="color: white;">63%</span>
                        </div>
                        <div style="color: #EF4444; font-size: 0.7rem;">↓ -18% drop</div>
                        <div style="background: linear-gradient(90deg, #29B5E8, #0EA5E9); width: 45%; padding: 0.5rem; border-radius: 4px; display: flex; justify-content: space-between;">
                            <span style="color: white; font-weight: 600;">Checkout</span>
                            <span style="color: white;">45%</span>
                        </div>
                        <div style="color: #10B981; font-size: 0.7rem;">↓ -7% drop</div>
                        <div style="background: linear-gradient(90deg, #10B981, #059669); width: 38%; padding: 0.5rem; border-radius: 4px; display: flex; justify-content: space-between;">
                            <span style="color: white; font-weight: 600;">Purchase</span>
                            <span style="color: white;">38%</span>
                        </div>
                    </div>
                    <div style="margin-top: 0.75rem; padding: 0.5rem; background: #FEF3C7; border-radius: 6px; font-size: 0.75rem; text-align: center;">
                        <span style="color: #92400E;">⚠️ Focus: Reduce Browse → Configure drop-off</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Customer Feedback Word Cloud & Trends</div>', unsafe_allow_html=True)
        
        col_words, col_trends = st.columns(2)
        
        with col_words:
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center; padding: 1rem;">
                    <span style="font-size: 2rem; color: #10B981; font-weight: 700;">fast </span>
                    <span style="font-size: 1.2rem; color: #10B981;">reliable </span>
                    <span style="font-size: 1.5rem; color: #10B981; font-weight: 600;">great coverage </span>
                    <span style="font-size: 0.9rem; color: #10B981;">helpful staff </span>
                    <span style="font-size: 1.8rem; color: #10B981; font-weight: 700;">5G </span>
                    <span style="font-size: 1.1rem; color: #10B981;">easy app </span>
                    <span style="font-size: 1.3rem; color: #F59E0B;">wait times </span>
                    <span style="font-size: 1rem; color: #10B981;">good value </span>
                    <span style="font-size: 1.4rem; color: #EF4444;">billing </span>
                    <span style="font-size: 1rem; color: #10B981;">streaming </span>
                    <span style="font-size: 0.9rem; color: #F59E0B;">pricing </span>
                    <span style="font-size: 1.6rem; color: #10B981; font-weight: 600;">recommend </span>
                    <span style="font-size: 1rem; color: #10B981;">quick </span>
                </div>
                <div style="display: flex; justify-content: center; gap: 1rem; font-size: 0.75rem; margin-top: 0.5rem;">
                    <span style="color: #10B981;">● Positive (68%)</span>
                    <span style="color: #F59E0B;">● Neutral (22%)</span>
                    <span style="color: #EF4444;">● Negative (10%)</span>
                </div>
                """, unsafe_allow_html=True)
        
        with col_trends:
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="font-weight: 600; color: #6B7280; margin-bottom: 0.75rem;">Emerging Themes This Month</div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>5G Speed Praise</span>
                        <span style="color: #10B981; font-weight: 600;">↑ +42%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>App Ease of Use</span>
                        <span style="color: #10B981; font-weight: 600;">↑ +28%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>In-Store Experience</span>
                        <span style="color: #10B981; font-weight: 600;">↑ +15%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Call Center Wait</span>
                        <span style="color: #EF4444; font-weight: 600;">↑ +8%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>Roaming Complaints</span>
                        <span style="color: #10B981; font-weight: 600;">↓ -22%</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        

    with tab_strategy:
        st.markdown('<div class="section-header">CXO Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">NPS to +50</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **+42** (target: +50)
                - Focus: Detractor recovery program
                - Proactive outreach: 2,400 at-risk
                - Target: **-3% detractors**
                """)
        
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Digital First 75%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **68%** (target: 75%)
                - App personalization: live Q1
                - Self-service expansion: 12 journeys
                - Cost savings: **£1.2M** projected
                """)
        
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Effort Score < 2.0</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **2.1** (target: <2.0)
                - Journey redesign: 4 flows in progress
                - AI chatbot: **40%** containment
                - Wait time: **-30s** target
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "What's the distribution of customer interactions by journey stage?",
            "Which channels have the highest customer effort scores?",
            "Show me the average sentiment score by channel this month.",
            "Compare digital vs physical channel performance.",
            "What's our NPS trend by customer segment?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_cno_network():
    import pandas as pd
    import altair as alt
    
    # CNO Header with Signal Wave Effect
    st.markdown("""
    <style>
    @keyframes cno-signal { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
    @keyframes cno-tower-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    @keyframes cno-wave-line { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
    .cno-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .cno-signal-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
    .cno-tower { position: absolute; font-size: 50px; opacity: 0.2; animation: cno-tower-pulse 2s ease-in-out infinite; }
    .cno-signal-ring { position: absolute; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; animation: cno-signal 2s ease-out infinite; }
    .cno-wave { position: absolute; height: 3px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); animation: cno-wave-line 3s linear infinite; }
    .cno-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(135deg, #ECFEFF 0%, #CFFAFE 100%);
        border: 1px solid #A5F3FC;
        padding: 2rem; color: #155E75;
    }
    .cno-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; color: #155E75; }
    .cno-header-content p { margin: 0.5rem 0 0 0; color: #0E7490; font-size: 1.1rem; }
    </style>
    <div class="cno-header-wrap">
        <div class="cno-signal-bg">
            <span class="cno-tower" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">📡</span>
            <div class="cno-signal-ring" style="left: 50%; top: 50%; width: 40px; height: 40px; margin: -20px 0 0 -20px; animation-delay: 0s;"></div>
            <div class="cno-signal-ring" style="left: 50%; top: 50%; width: 80px; height: 80px; margin: -40px 0 0 -40px; animation-delay: 0.5s;"></div>
            <div class="cno-signal-ring" style="left: 50%; top: 50%; width: 120px; height: 120px; margin: -60px 0 0 -60px; animation-delay: 1s;"></div>
            <div class="cno-wave" style="top: 30%; left: 0; width: 100%;"></div>
            <div class="cno-wave" style="top: 70%; left: 0; width: 100%; animation-delay: 1.5s;"></div>
        </div>
        <div class="cno-header-content">
            <h1>CNO Network Quality Dashboard</h1>
            <p>Network Performance, 5G Rollout & Quality of Experience</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_mlops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧪 Model Ops & Strategy", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['NETWORK_QOE', 'NETWORK_OPS', 'RAN']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # CNO NETWORK SIGNAL ANIMATION
        st.markdown("""
        <style>
        @keyframes signal-wave { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(2.5); opacity: 0; } }
        @keyframes bar-grow { 0%, 100% { height: 30%; } 50% { height: 100%; } }
        @keyframes status-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes cno-stat-slide { 0% { opacity: 0; transform: translateX(-20px); } 100% { opacity: 1; transform: translateX(0); } }
        @keyframes cno-val-glow { 0%, 100% { text-shadow: none; } 50% { text-shadow: 0 0 10px rgba(16,185,129,0.5); } }
        @keyframes cno-tower-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .cno-signal { background: linear-gradient(135deg, #0369A1 0%, #0284C7 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 2rem; }
        .signal-tower { width: 120px; height: 120px; position: relative; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
        .tower-icon { font-size: 2.5rem; z-index: 2; animation: cno-tower-pulse 3s ease-in-out infinite; }
        .signal-ring { position: absolute; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; animation: signal-wave 2s ease-out infinite; }
        .ring-1 { width: 50px; height: 50px; }
        .ring-2 { width: 50px; height: 50px; animation-delay: 0.5s; }
        .ring-3 { width: 50px; height: 50px; animation-delay: 1s; }
        .signal-bars { display: flex; align-items: flex-end; gap: 4px; height: 40px; margin-top: 0.5rem; justify-content: center; }
        .sig-bar { width: 8px; background: #10B981; border-radius: 2px; animation: bar-grow 1.5s ease-in-out infinite; }
        .sig-bar:nth-child(1) { animation-delay: 0s; }
        .sig-bar:nth-child(2) { animation-delay: 0.15s; }
        .sig-bar:nth-child(3) { animation-delay: 0.3s; }
        .sig-bar:nth-child(4) { animation-delay: 0.45s; }
        .sig-bar:nth-child(5) { animation-delay: 0.6s; }
        .network-stats { flex: 1; }
        .net-title { color: white; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; }
        .net-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .net-stat { background: rgba(255,255,255,0.1); border-radius: 10px; padding: 0.8rem; text-align: center; animation: cno-stat-slide 0.5s ease-out forwards; opacity: 0; }
        .net-stat:nth-child(2) { animation-delay: 0.1s; }
        .net-stat:nth-child(3) { animation-delay: 0.2s; }
        .net-stat:nth-child(4) { animation-delay: 0.3s; }
        .net-val { color: white; font-size: 1.4rem; font-weight: 700; }
        .net-val.good { color: #10B981; animation: cno-val-glow 2s ease-in-out infinite; }
        .net-label { color: rgba(255,255,255,0.7); font-size: 0.7rem; text-transform: uppercase; margin-top: 0.2rem; }
        .net-status { font-size: 0.7rem; margin-top: 0.3rem; animation: status-blink 2s ease-in-out infinite; }
        .net-status.green { color: #10B981; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="cno-signal"><div class="signal-tower"><div class="signal-ring ring-1"></div><div class="signal-ring ring-2"></div><div class="signal-ring ring-3"></div><div class="tower-icon">📡</div><div class="signal-bars"><div class="sig-bar"></div><div class="sig-bar"></div><div class="sig-bar"></div><div class="sig-bar"></div><div class="sig-bar"></div></div></div><div class="network-stats"><div class="net-title">📶 Network Signal Quality</div><div class="net-grid"><div class="net-stat"><div class="net-val good">99.7%</div><div class="net-label">Availability</div><div class="net-status green">● Excellent</div></div><div class="net-stat"><div class="net-val">12ms</div><div class="net-label">Latency</div><div class="net-status green">● Optimal</div></div><div class="net-stat"><div class="net-val">142</div><div class="net-label">Gbps Throughput</div><div class="net-status green">● Peak</div></div><div class="net-stat"><div class="net-val">487</div><div class="net-label">Sites Online</div><div class="net-status green">● 97.4%</div></div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes cno-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 1; } 
            50% { stroke-width: 3.5; opacity: 0.8; } 
        }
        @keyframes cno-fill-pulse { 
            0%, 100% { opacity: 0.15; transform: scaleY(1); } 
            50% { opacity: 0.25; transform: scaleY(1.02); } 
        }
        @keyframes cno-bar-wave { 
            0%, 100% { transform: scaleY(1); } 
            50% { transform: scaleY(0.7); } 
        }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.15;
        }
        .kpi-chart path[fill="none"] { animation: cno-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: cno-fill-pulse 3s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: cno-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Network Quality Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">📶</div>
                <div class="kpi-label">Avg Download Speed</div>
                <div class="kpi-value">142 Mbps</div>
                <div class="kpi-delta positive">↑ +28% YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">Avg Latency</div>
                <div class="kpi-value">18ms</div>
                <div class="kpi-delta positive">↓ -8ms vs Q3</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,12 L20,14 L40,18 L60,22 L80,28 L100,32" fill="none" stroke="#8B5CF6" stroke-width="2"/>
                    <path d="M0,12 L20,14 L40,18 L60,22 L80,28 L100,32 L100,40 L0,40 Z" fill="#8B5CF6"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">📺</div>
                <div class="kpi-label">Video Quality Score</div>
                <div class="kpi-value">4.2/5</div>
                <div class="kpi-delta positive">↑ +0.4 YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="32" width="12" height="8" fill="#29B5E8"/>
                    <rect x="22" y="28" width="12" height="12" fill="#29B5E8"/>
                    <rect x="39" y="24" width="12" height="16" fill="#29B5E8"/>
                    <rect x="56" y="20" width="12" height="20" fill="#29B5E8"/>
                    <rect x="73" y="14" width="12" height="26" fill="#29B5E8"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">🗼</div>
                <div class="kpi-label">5G Coverage</div>
                <div class="kpi-value">78%</div>
                <div class="kpi-delta positive">↑ +12% vs Q3</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16" fill="none" stroke="#F59E0B" stroke-width="2"/>
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16 L100,40 L0,40 Z" fill="#F59E0B"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">✅</div>
                <div class="kpi-label">Network Availability</div>
                <div class="kpi-value">99.94%</div>
                <div class="kpi-delta positive">↑ Above SLA</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">Call Success Rate</div>
                <div class="kpi-value">99.2%</div>
                <div class="kpi-delta positive">↑ +0.3% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">📡</div>
                <div class="kpi-label">Cell Sites</div>
                <div class="kpi-value">2,840</div>
                <div class="kpi-delta positive">↑ +120 YTD</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">Active Alarms</div>
                <div class="kpi-value">24</div>
                <div class="kpi-delta neutral">3 Critical</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Network Performance by Generation</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.6rem; color: #6B7280;">Network</th>
                            <th style="text-align: center; padding: 0.6rem; color: #6B7280;">Download</th>
                            <th style="text-align: center; padding: 0.6rem; color: #6B7280;">Upload</th>
                            <th style="text-align: center; padding: 0.6rem; color: #6B7280;">Latency</th>
                            <th style="text-align: center; padding: 0.6rem; color: #6B7280;">Video QoE</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6; background: linear-gradient(90deg, #EDE9FE 0%, white 30%);">
                            <td style="padding: 0.6rem; font-weight: 700; color: #8B5CF6;">5G</td>
                            <td style="text-align: center; padding: 0.6rem;"><span style="font-weight: 700; color: #10B981;">285 Mbps</span></td>
                            <td style="text-align: center; padding: 0.6rem;">48 Mbps</td>
                            <td style="text-align: center; padding: 0.6rem;"><span style="font-weight: 700; color: #10B981;">12ms</span></td>
                            <td style="text-align: center; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">4.6</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.6rem; font-weight: 600; color: #29B5E8;">4G LTE</td>
                            <td style="text-align: center; padding: 0.6rem;">68 Mbps</td>
                            <td style="text-align: center; padding: 0.6rem;">18 Mbps</td>
                            <td style="text-align: center; padding: 0.6rem;">28ms</td>
                            <td style="text-align: center; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">4.0</span></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.6rem; font-weight: 600; color: #6B7280;">3G</td>
                            <td style="text-align: center; padding: 0.6rem;">8 Mbps</td>
                            <td style="text-align: center; padding: 0.6rem;">2 Mbps</td>
                            <td style="text-align: center; padding: 0.6rem;">85ms</td>
                            <td style="text-align: center; padding: 0.6rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">2.8</span></td>
                        </tr>
                    </tbody>
                </table>
                <div style="margin-top: 1rem; padding: 0.75rem; background: #F0F9FF; border-radius: 8px; text-align: center; font-size: 0.85rem;">
                    <span style="color: #0369A1;">5G delivers <strong>4.2x faster</strong> downloads and <strong>58% lower</strong> latency vs 4G</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">UK Network Coverage Map</div>', unsafe_allow_html=True)
            
            components.html("""
            <!DOCTYPE html>
            <html>
            <head>
            <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
            @keyframes uk-map-pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
            @keyframes uk-tower-ping { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            @keyframes uk-status-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
            .uk-map-container {
                background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
                border-radius: 12px;
                padding: 1.5rem;
                position: relative;
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .uk-map-svg { width: 100%; max-width: 400px; height: 340px; }
            .uk-region { transition: all 0.3s ease; cursor: pointer; }
            .uk-region:hover { filter: brightness(1.1); }
            .uk-tower { animation: uk-map-pulse 2s ease-in-out infinite; }
            .uk-ping { animation: uk-tower-ping 2s ease-out infinite; }
            .uk-legend {
                display: flex;
                justify-content: center;
                gap: 1.5rem;
                margin-top: 1rem;
                font-size: 12px;
                flex-wrap: wrap;
            }
            .uk-legend-item { display: flex; align-items: center; gap: 6px; color: #374151; }
            .uk-legend-dot { width: 12px; height: 12px; border-radius: 50%; }
            </style>
            </head>
            <body>
            <div class="uk-map-container">
                <svg class="uk-map-svg" viewBox="0 0 320 380">
                    <!-- UK Map Outline - Stylized -->
                    <path d="M160,15 Q175,20 185,35 Q200,30 210,45 Q215,60 205,75 Q220,85 225,100 Q235,110 240,130 Q250,145 255,165 Q260,185 255,205 Q265,220 260,240 Q255,260 245,275 Q240,290 225,300 Q215,310 200,315 Q190,325 175,330 Q165,340 150,345 Q135,340 125,330 Q110,325 100,315 Q85,310 75,300 Q65,290 60,275 Q50,260 55,240 Q50,220 60,205 Q55,185 65,165 Q70,145 80,130 Q85,110 95,100 Q100,85 115,75 Q105,60 110,45 Q120,30 135,35 Q145,20 160,15 Z" 
                          fill="#BFDBFE" stroke="#60A5FA" stroke-width="2.5" opacity="0.8"/>
                    
                    <!-- Scotland -->
                    <ellipse cx="160" cy="55" rx="45" ry="32" fill="#10B981" opacity="0.75" class="uk-region"/>
                    <text x="160" y="52" text-anchor="middle" font-size="11" fill="#1B2A4E" font-weight="600">Scotland</text>
                    <circle class="uk-tower" cx="160" cy="40" r="5" fill="#10B981"/>
                    <circle class="uk-ping" cx="160" cy="40" r="5" fill="none" stroke="#10B981" stroke-width="2"/>
                    
                    <!-- North -->
                    <ellipse cx="150" cy="115" rx="40" ry="28" fill="#10B981" opacity="0.75" class="uk-region"/>
                    <text x="150" y="118" text-anchor="middle" font-size="11" fill="#1B2A4E" font-weight="600">North</text>
                    <circle class="uk-tower" cx="140" cy="100" r="4" fill="#10B981"/>
                    
                    <!-- Yorkshire with Alert -->
                    <ellipse cx="175" cy="165" rx="35" ry="25" fill="#F59E0B" opacity="0.75" class="uk-region"/>
                    <text x="175" y="168" text-anchor="middle" font-size="10" fill="#1B2A4E" font-weight="600">Yorkshire</text>
                    <g transform="translate(210, 155)">
                        <circle r="10" fill="#EF4444" class="uk-tower" style="animation: uk-status-blink 0.5s ease-in-out infinite;"/>
                        <text x="14" y="4" font-size="9" fill="#EF4444" font-weight="600">Alert</text>
                    </g>
                    
                    <!-- Wales -->
                    <ellipse cx="95" cy="210" rx="30" ry="40" fill="#10B981" opacity="0.75" class="uk-region"/>
                    <text x="95" y="213" text-anchor="middle" font-size="10" fill="#1B2A4E" font-weight="600">Wales</text>
                    <circle class="uk-tower" cx="95" cy="195" r="4" fill="#10B981"/>
                    
                    <!-- Midlands -->
                    <ellipse cx="160" cy="215" rx="40" ry="30" fill="#10B981" opacity="0.75" class="uk-region"/>
                    <text x="160" y="218" text-anchor="middle" font-size="11" fill="#1B2A4E" font-weight="600">Midlands</text>
                    <circle class="uk-tower" cx="150" cy="200" r="4" fill="#10B981"/>
                    <circle class="uk-tower" cx="170" cy="205" r="4" fill="#10B981"/>
                    
                    <!-- London -->
                    <ellipse cx="190" cy="275" rx="42" ry="32" fill="#10B981" opacity="0.8" class="uk-region"/>
                    <text x="190" y="270" text-anchor="middle" font-size="11" fill="#1B2A4E" font-weight="600">London</text>
                    <text x="190" y="285" text-anchor="middle" font-size="9" fill="#1B2A4E">168 Mbps</text>
                    <circle class="uk-tower" cx="190" cy="255" r="5" fill="#10B981"/>
                    <circle class="uk-ping" cx="190" cy="255" r="5" fill="none" stroke="#10B981" stroke-width="2" style="animation-delay: 1s;"/>
                    
                    <!-- South West -->
                    <ellipse cx="115" cy="305" rx="35" ry="28" fill="#29B5E8" opacity="0.75" class="uk-region"/>
                    <text x="115" y="308" text-anchor="middle" font-size="10" fill="#1B2A4E" font-weight="600">South West</text>
                    <circle class="uk-tower" cx="115" cy="290" r="4" fill="#29B5E8"/>
                    
                    <!-- Animated ping rings on right side -->
                    <circle cx="270" cy="120" r="8" fill="none" stroke="#10B981" stroke-width="1" class="uk-ping" style="animation-delay: 0.5s;"/>
                    <circle cx="275" cy="280" r="8" fill="none" stroke="#29B5E8" stroke-width="1" class="uk-ping" style="animation-delay: 1.5s;"/>
                    
                    <!-- Stats Panel -->
                    <rect x="15" y="20" width="90" height="70" rx="8" fill="white" stroke="#E5E7EB" stroke-width="1"/>
                    <text x="60" y="42" text-anchor="middle" font-size="9" fill="#6B7280">Sites Online</text>
                    <text x="60" y="62" text-anchor="middle" font-size="20" fill="#10B981" font-weight="700">487</text>
                    <text x="60" y="78" text-anchor="middle" font-size="8" fill="#10B981">99.7% uptime</text>
                </svg>
                <div class="uk-legend">
                    <div class="uk-legend-item"><div class="uk-legend-dot" style="background: #10B981;"></div>Excellent</div>
                    <div class="uk-legend-item"><div class="uk-legend-dot" style="background: #29B5E8;"></div>Good</div>
                    <div class="uk-legend-item"><div class="uk-legend-dot" style="background: #F59E0B;"></div>Moderate</div>
                    <div class="uk-legend-item"><div class="uk-legend-dot" style="background: #EF4444;"></div>Alert</div>
                </div>
            </div>
            </body>
            </html>
            """, height=450, scrolling=False)
            
            st.markdown('<div class="section-header">QoE by Region</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 100px; font-weight: 600;">London</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #10B981; width: 92%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="width: 80px; text-align: right; font-weight: 600;">168 Mbps</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 100px; font-weight: 600;">Manchester</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #10B981; width: 85%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="width: 80px; text-align: right; font-weight: 600;">152 Mbps</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 100px; font-weight: 600;">Birmingham</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #29B5E8; width: 78%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="width: 80px; text-align: right; font-weight: 600;">138 Mbps</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 100px; font-weight: 600;">Leeds</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #29B5E8; width: 72%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="width: 80px; text-align: right; font-weight: 600;">128 Mbps</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0;">
                        <span style="width: 100px; font-weight: 600;">Rural</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 14px; margin: 0 0.75rem;">
                            <div style="background: #F59E0B; width: 45%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="width: 80px; text-align: right; font-weight: 600;">82 Mbps</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">5G Rollout Progress</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center; margin-bottom: 1rem;">
                    <div style="font-size: 3rem; font-weight: 700; color: #8B5CF6;">78%</div>
                    <div style="font-size: 0.85rem; color: #6B7280;">Population Coverage</div>
                    <div style="background: #E5E7EB; border-radius: 4px; height: 16px; margin: 1rem 0;">
                        <div style="background: linear-gradient(90deg, #8B5CF6, #29B5E8); width: 78%; height: 100%; border-radius: 4px;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #6B7280;">
                        <span>Q4 Target: 85%</span>
                        <span>+12% vs Q3</span>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; font-size: 0.8rem;">
                    <div style="background: #F3F4F6; padding: 0.5rem; border-radius: 8px; text-align: center;">
                        <div style="color: #6B7280;">5G Sites</div>
                        <div style="font-weight: 700; color: #8B5CF6;">1,420</div>
                    </div>
                    <div style="background: #F3F4F6; padding: 0.5rem; border-radius: 8px; text-align: center;">
                        <div style="color: #6B7280;">Small Cells</div>
                        <div style="font-weight: 700; color: #29B5E8;">680</div>
                    </div>
                    <div style="background: #F3F4F6; padding: 0.5rem; border-radius: 8px; text-align: center;">
                        <div style="color: #6B7280;">Q1 Planned</div>
                        <div style="font-weight: 700; color: #10B981;">+350</div>
                    </div>
                    <div style="background: #F3F4F6; padding: 0.5rem; border-radius: 8px; text-align: center;">
                        <div style="color: #6B7280;">CapEx (Q1)</div>
                        <div style="font-weight: 700; color: #F59E0B;">£12M</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">App Category QoE</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>🎬 Video Streaming</span>
                        <span style="font-weight: 700; background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">4.2/5</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>🎮 Gaming</span>
                        <span style="font-weight: 700; background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">4.0/5</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>📱 Social Media</span>
                        <span style="font-weight: 700; background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">4.4/5</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>📞 Video Calls</span>
                        <span style="font-weight: 700; background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">3.8/5</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>🌐 Web Browsing</span>
                        <span style="font-weight: 700; background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">4.3/5</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Network vs Churn</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.8rem; padding: 0.5rem; background: #FEF3C7; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="color: #92400E;">⚠️ <strong>12%</strong> of churners cited network quality</span>
                </div>
                <div style="font-size: 0.8rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0;">
                        <span>5G Users Churn Rate</span>
                        <span style="font-weight: 700; color: #10B981;">0.8%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0;">
                        <span>4G Users Churn Rate</span>
                        <span style="font-weight: 700; color: #F59E0B;">1.4%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0;">
                        <span>3G Users Churn Rate</span>
                        <span style="font-weight: 700; color: #EF4444;">2.8%</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Network Performance Heatmap by Region</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            st.markdown("""
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.75rem; text-align: center;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="padding: 0.5rem; text-align: left; color: #6B7280;">Region</th>
                            <th style="padding: 0.5rem; color: #6B7280;">Download</th>
                            <th style="padding: 0.5rem; color: #6B7280;">Upload</th>
                            <th style="padding: 0.5rem; color: #6B7280;">Latency</th>
                            <th style="padding: 0.5rem; color: #6B7280;">Avail.</th>
                            <th style="padding: 0.5rem; color: #6B7280;">5G Cover</th>
                            <th style="padding: 0.5rem; color: #6B7280;">Alarms</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; text-align: left; font-weight: 600;">London</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">285 Mbps</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">48 Mbps</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">12ms</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">99.8%</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">92%</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">4</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; text-align: left; font-weight: 600;">Manchester</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">248 Mbps</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">42 Mbps</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">14ms</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">99.6%</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">85%</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">12</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; text-align: left; font-weight: 600;">Birmingham</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">232 Mbps</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">36 Mbps</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">18ms</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">99.4%</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">72%</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">18</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; text-align: left; font-weight: 600;">Edinburgh</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">198 Mbps</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">32 Mbps</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">22ms</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">99.2%</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">65%</td>
                            <td style="padding: 0.5rem; background: #D1FAE5; color: #065F46;">8</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem; text-align: left; font-weight: 600;">Cardiff</td>
                            <td style="padding: 0.5rem; background: #FEE2E2; color: #DC2626;">165 Mbps</td>
                            <td style="padding: 0.5rem; background: #FEE2E2; color: #DC2626;">28 Mbps</td>
                            <td style="padding: 0.5rem; background: #FEE2E2; color: #DC2626;">28ms</td>
                            <td style="padding: 0.5rem; background: #FEF3C7; color: #92400E;">98.8%</td>
                            <td style="padding: 0.5rem; background: #FEE2E2; color: #DC2626;">48%</td>
                            <td style="padding: 0.5rem; background: #FEE2E2; color: #DC2626;">24</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 0.75rem; display: flex; justify-content: center; gap: 1rem; font-size: 0.7rem;">
                <span><span style="background: #D1FAE5; padding: 0.2rem 0.5rem; border-radius: 4px; margin-right: 4px;">■</span>Excellent</span>
                <span><span style="background: #FEF3C7; padding: 0.2rem 0.5rem; border-radius: 4px; margin-right: 4px;">■</span>Moderate</span>
                <span><span style="background: #FEE2E2; padding: 0.2rem 0.5rem; border-radius: 4px; margin-right: 4px;">■</span>Needs Attention</span>
            </div>
            """, unsafe_allow_html=True)
        
        col_cap, col_alarm = st.columns(2)
        
        with col_cap:
            st.markdown('<div class="section-header">Capacity Utilization Trend</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb']
                cap_data = pd.DataFrame({
                    'Month': months,
                    'Utilization': [52, 54, 56, 58, 60, 62, 64],
                    'Status': ['Normal', 'Normal', 'Normal', 'Warning', 'Warning', 'Warning', 'Warning']
                })
                
                cap_area = alt.Chart(cap_data).mark_area(
                    line={'color': '#F59E0B', 'strokeWidth': 3},
                    color=alt.Gradient(
                        gradient='linear',
                        stops=[alt.GradientStop(color='rgba(245, 158, 11, 0.3)', offset=0),
                               alt.GradientStop(color='rgba(245, 158, 11, 0)', offset=1)],
                        x1=1, x2=1, y1=1, y2=0
                    )
                ).encode(
                    x=alt.X('Month:N', sort=months, axis=alt.Axis(labelAngle=0, title=None)),
                    y=alt.Y('Utilization:Q', scale=alt.Scale(domain=[40, 90]), axis=alt.Axis(title='Utilization %'))
                )
                
                cap_points = alt.Chart(cap_data).mark_circle(size=80).encode(
                    x=alt.X('Month:N', sort=months),
                    y=alt.Y('Utilization:Q'),
                    color=alt.Color('Status:N', scale=alt.Scale(
                        domain=['Normal', 'Warning'],
                        range=['#10B981', '#F59E0B']
                    ), legend=None),
                    tooltip=['Month:N', alt.Tooltip('Utilization:Q', title='Utilization', format='d%')]
                )
                
                critical_line = alt.Chart(pd.DataFrame({'y': [80]})).mark_rule(
                    color='#EF4444', strokeDash=[4, 4]
                ).encode(y='y:Q')
                
                warning_line = alt.Chart(pd.DataFrame({'y': [60]})).mark_rule(
                    color='#F59E0B', strokeDash=[4, 4]
                ).encode(y='y:Q')
                
                cap_label = alt.Chart(cap_data.tail(1)).mark_text(
                    dy=-15, fontSize=12, fontWeight='bold', color='#F59E0B'
                ).encode(
                    x=alt.X('Month:N', sort=months),
                    y=alt.Y('Utilization:Q'),
                    text=alt.Text('Utilization:Q', format='d%')
                )
                
                st.altair_chart((cap_area + cap_points + critical_line + warning_line + cap_label).properties(height=160), use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; justify-content: space-around; font-size: 0.75rem; margin-top: 0.5rem;">
                    <div style="text-align: center;">
                        <div style="color: #6B7280;">Peak Hour</div>
                        <div style="font-weight: 700; color: #F59E0B;">78%</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: #6B7280;">Off-Peak</div>
                        <div style="font-weight: 700; color: #10B981;">42%</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: #6B7280;">Sites >70%</div>
                        <div style="font-weight: 700; color: #EF4444;">124</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_alarm:
            st.markdown('<div class="section-header">Alarm Trend Analysis</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-bottom: 1rem;">
                    <div style="background: #FEE2E2; border-radius: 8px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #DC2626;">Critical</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #DC2626;">12</div>
                        <div style="font-size: 0.65rem; color: #DC2626;">↓ -4 vs yesterday</div>
                    </div>
                    <div style="background: #FEF3C7; border-radius: 8px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #92400E;">Major</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #F59E0B;">48</div>
                        <div style="font-size: 0.65rem; color: #92400E;">↓ -12 vs yesterday</div>
                    </div>
                    <div style="background: #E0F2FE; border-radius: 8px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #0369A1;">Minor</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #29B5E8;">156</div>
                        <div style="font-size: 0.65rem; color: #0369A1;">↑ +8 vs yesterday</div>
                    </div>
                </div>
                <div style="font-size: 0.8rem;">
                    <div style="font-weight: 600; color: #6B7280; margin-bottom: 0.5rem;">Top Alarm Categories</div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>RAN Cell Degradation</span>
                        <span style="font-weight: 600; color: #EF4444;">38</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Backhaul Congestion</span>
                        <span style="font-weight: 600; color: #F59E0B;">24</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Power Issues</span>
                        <span style="font-weight: 600; color: #F59E0B;">18</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.3rem 0;">
                        <span>Temperature Alerts</span>
                        <span style="font-weight: 600; color: #29B5E8;">12</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        # Looping progress bar animations for CNO
        st.markdown("""
        <style>
        @keyframes progress-pulse {
            0%, 100% { filter: brightness(1); transform: scaleX(1); }
            50% { filter: brightness(1.2); transform: scaleX(1.02); }
        }
        .progress-bar { animation: progress-pulse 2s ease-in-out infinite; transform-origin: left; border-radius: 4px; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Cell Site Performance Distribution</div>', unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake** — Real-time network telemetry from 15,000+ cell sites processed via Snowpipe Streaming with Time Series Analysis")
        
        col_perf1, col_perf2, col_perf3, col_perf4 = st.columns(4)
        
        with col_perf1:
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 0.75rem; color: #6B7280;">Excellent Sites</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #10B981;">1,842</div>
                    <div style="font-size: 0.7rem; color: #10B981;">KPIs > 95th percentile</div>
                    <div style="background: #E5E7EB; height: 8px; border-radius: 4px; margin-top: 0.5rem;">
                        <div class="progress-bar" style="background: #10B981; width: 62%; height: 100%; animation-delay: 0s;"></div>
                    </div>
                    <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">62% of fleet</div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_perf2:
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 0.75rem; color: #6B7280;">Good Sites</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #29B5E8;">724</div>
                    <div style="font-size: 0.7rem; color: #29B5E8;">KPIs 80-95th percentile</div>
                    <div style="background: #E5E7EB; height: 8px; border-radius: 4px; margin-top: 0.5rem;">
                        <div class="progress-bar" style="background: #29B5E8; width: 24%; height: 100%; animation-delay: 0.2s;"></div>
                    </div>
                    <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">24% of fleet</div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_perf3:
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 0.75rem; color: #6B7280;">Degraded Sites</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #F59E0B;">312</div>
                    <div style="font-size: 0.7rem; color: #F59E0B;">KPIs 60-80th percentile</div>
                    <div style="background: #E5E7EB; height: 8px; border-radius: 4px; margin-top: 0.5rem;">
                        <div class="progress-bar" style="background: #F59E0B; width: 10%; height: 100%; animation-delay: 0.4s;"></div>
                    </div>
                    <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">10% of fleet</div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_perf4:
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 0.75rem; color: #6B7280;">Critical Sites</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #EF4444;">98</div>
                    <div style="font-size: 0.7rem; color: #EF4444;">KPIs < 60th percentile</div>
                    <div style="background: #E5E7EB; height: 8px; border-radius: 4px; margin-top: 0.5rem;">
                        <div class="progress-bar" style="background: #EF4444; width: 4%; height: 100%; animation-delay: 0.6s;"></div>
                    </div>
                    <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem;">4% of fleet</div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Traffic & Throughput Insights</div>', unsafe_allow_html=True)
        
        col_traffic1, col_traffic2 = st.columns(2)
        
        with col_traffic1:
            # Add looping animation for traffic bars
            st.markdown("""
            <style>
            @keyframes traffic-wave {
                0%, 100% { transform: scaleY(1); }
                50% { transform: scaleY(0.85); }
            }
            .traffic-bar { transform-origin: bottom; animation: traffic-wave 1.5s ease-in-out infinite; border-radius: 2px 2px 0 0; }
            .traffic-bars > div:nth-child(1) { animation-delay: 0s; }
            .traffic-bars > div:nth-child(2) { animation-delay: 0.06s; }
            .traffic-bars > div:nth-child(3) { animation-delay: 0.12s; }
            .traffic-bars > div:nth-child(4) { animation-delay: 0.18s; }
            .traffic-bars > div:nth-child(5) { animation-delay: 0.24s; }
            .traffic-bars > div:nth-child(6) { animation-delay: 0.3s; }
            .traffic-bars > div:nth-child(7) { animation-delay: 0.36s; }
            .traffic-bars > div:nth-child(8) { animation-delay: 0.42s; }
            .traffic-bars > div:nth-child(9) { animation-delay: 0.48s; }
            .traffic-bars > div:nth-child(10) { animation-delay: 0.54s; }
            .traffic-bars > div:nth-child(11) { animation-delay: 0.6s; }
            .traffic-bars > div:nth-child(12) { animation-delay: 0.66s; }
            .traffic-bars > div:nth-child(13) { animation-delay: 0.72s; }
            .traffic-bars > div:nth-child(14) { animation-delay: 0.78s; }
            .traffic-bars > div:nth-child(15) { animation-delay: 0.84s; }
            .traffic-bars > div:nth-child(16) { animation-delay: 0.9s; }
            .traffic-bars > div:nth-child(17) { animation-delay: 0.96s; }
            .traffic-bars > div:nth-child(18) { animation-delay: 1.02s; }
            .traffic-bars > div:nth-child(19) { animation-delay: 1.08s; }
            .traffic-bars > div:nth-child(20) { animation-delay: 1.14s; }
            .traffic-bars > div:nth-child(21) { animation-delay: 1.2s; }
            .traffic-bars > div:nth-child(22) { animation-delay: 1.26s; }
            .traffic-bars > div:nth-child(23) { animation-delay: 1.32s; }
            .traffic-bars > div:nth-child(24) { animation-delay: 1.38s; }
            </style>
            """, unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="font-weight: 600; margin-bottom: 0.75rem; color: #1B2A4E;">Daily Traffic Pattern</div>
                    <div class="traffic-bars" style="display: flex; align-items: flex-end; height: 100px; gap: 4px; margin-bottom: 0.5rem;">
                        <div class="traffic-bar" style="flex: 1; height: 20%; background: #E0F2FE;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 15%; background: #E0F2FE;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 12%; background: #E0F2FE;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 18%; background: #E0F2FE;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 35%; background: #BAE6FD;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 55%; background: #7DD3FC;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 65%; background: #38BDF8;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 70%; background: #0EA5E9;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 75%; background: #0EA5E9;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 68%; background: #0EA5E9;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 72%; background: #0EA5E9;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 78%; background: #0284C7;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 82%; background: #0284C7;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 75%; background: #0EA5E9;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 70%; background: #0EA5E9;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 68%; background: #0EA5E9;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 72%; background: #0EA5E9;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 85%; background: #0369A1;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 95%; background: #0369A1;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 100%; background: linear-gradient(180deg, #EF4444, #0369A1);"></div>
                        <div class="traffic-bar" style="flex: 1; height: 90%; background: #0369A1;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 75%; background: #0EA5E9;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 55%; background: #7DD3FC;"></div>
                        <div class="traffic-bar" style="flex: 1; height: 35%; background: #BAE6FD;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.65rem; color: #6B7280;">
                        <span>00:00</span>
                        <span>06:00</span>
                        <span>12:00</span>
                        <span>18:00</span>
                        <span>24:00</span>
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.7rem; text-align: center; color: #EF4444;">
                        Peak: 20:00-21:00 (2.4 PB/hour)
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_traffic2:
            # Add looping animation for app bars
            st.markdown("""
            <style>
            @keyframes app-bar-pulse {
                0%, 100% { filter: brightness(1); transform: scaleX(1); }
                50% { filter: brightness(1.15); transform: scaleX(1.02); }
            }
            .app-bar { animation: app-bar-pulse 2s ease-in-out infinite; transform-origin: left; border-radius: 4px; }
            </style>
            """, unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="font-weight: 600; margin-bottom: 0.75rem; color: #1B2A4E;">Traffic by Application</div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Video Streaming</span>
                            <span style="font-weight: 600;">48%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div class="app-bar" style="background: linear-gradient(90deg, #8B5CF6, #A78BFA); width: 48%; height: 100%; animation-delay: 0s;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Social Media</span>
                            <span style="font-weight: 600;">22%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div class="app-bar" style="background: linear-gradient(90deg, #29B5E8, #7DD3FC); width: 22%; height: 100%; animation-delay: 0.2s;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Gaming</span>
                            <span style="font-weight: 600;">12%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div class="app-bar" style="background: linear-gradient(90deg, #10B981, #6EE7B7); width: 12%; height: 100%; animation-delay: 0.4s;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Web/Other</span>
                            <span style="font-weight: 600;">18%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div class="app-bar" style="background: linear-gradient(90deg, #F59E0B, #FCD34D); width: 18%; height: 100%; animation-delay: 0.6s;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        # Network Coverage Map
        st.markdown('<div class="section-header">🗺️ UK Network Coverage & Performance</div>', unsafe_allow_html=True)
        
        map_col1, map_col2 = st.columns([2, 1])
        
        with map_col1:
            # UK cell site locations (sample data points)
            import numpy as np
            np.random.seed(42)
            
            # Major UK cities as base points
            uk_cities = [
                (51.5074, -0.1278, "London"),      # London
                (53.4808, -2.2426, "Manchester"),  # Manchester
                (52.4862, -1.8904, "Birmingham"),  # Birmingham
                (53.8008, -1.5491, "Leeds"),       # Leeds
                (55.9533, -3.1883, "Edinburgh"),   # Edinburgh
                (55.8642, -4.2518, "Glasgow"),     # Glasgow
                (51.4545, -2.5879, "Bristol"),     # Bristol
                (52.6309, -1.1398, "Leicester"),   # Leicester
                (53.4084, -2.9916, "Liverpool"),   # Liverpool
                (54.9783, -1.6178, "Newcastle"),   # Newcastle
            ]
            
            # Generate cell sites around cities
            sites_data = []
            for lat, lon, city in uk_cities:
                # Add multiple sites per city
                for _ in range(np.random.randint(15, 40)):
                    sites_data.append({
                        'lat': lat + np.random.uniform(-0.3, 0.3),
                        'lon': lon + np.random.uniform(-0.4, 0.4),
                    })
            
            sites_df = pd.DataFrame(sites_data)
            st.map(sites_df, zoom=5, use_container_width=True)
        
        with map_col2:
            with st.container(border=True):
                st.markdown("**Coverage by Region**")
                
                regions = [
                    ("London & South East", "99.4%", "#10B981"),
                    ("Midlands", "98.2%", "#10B981"),
                    ("North West", "97.8%", "#10B981"),
                    ("Yorkshire", "96.4%", "#F59E0B"),
                    ("Scotland", "94.2%", "#F59E0B"),
                    ("Wales", "92.8%", "#F59E0B"),
                    ("Northern Ireland", "91.5%", "#F59E0B"),
                    ("Rural Areas", "86.4%", "#EF4444"),
                ]
                
                for region, coverage, color in regions:
                    pct = float(coverage.replace('%', ''))
                    st.markdown(f"**{region}**")
                    st.progress(pct / 100)
                    st.caption(f"{coverage} population coverage")
            
            with st.container(border=True):
                st.markdown("**Network Type Mix**")
                st.metric("5G Coverage", "68%", "+12% YoY")
                st.metric("4G Coverage", "99%", "+0.4% YoY")
                st.metric("Cell Sites", "24,847", "+1,240 YoY")
        

    with tab_strategy:
        st.markdown('<div class="section-header">CNO Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">5G Coverage 85%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **78%** (target: 85%)
                - 350 new sites planned Q1
                - Focus: Rural & indoor coverage
                - CapEx: **£12M** allocated
                """)
        
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Latency < 15ms</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **18ms** (target: <15ms)
                - Edge compute: 8 sites Q1
                - Core optimization: in progress
                - Gaming QoE: **+0.4** target
                """)
        
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Availability 99.97%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **99.94%** (target: 99.97%)
                - Redundancy upgrade: 12 sites
                - MTTR reduction: **-15 min**
                - Zero P1 outages target
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "What's the average download speed by network generation (3G/4G/5G)?",
            "Show me the cells with the worst latency performance.",
            "How does network performance correlate with churn risk?",
            "Compare 5G vs 4G customer experience metrics.",
            "Which cells need capacity upgrades based on customer experience?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_cdo_data_science():
    import pandas as pd
    import altair as alt
    
    # Matrix Rain Header for CDO - AI themed
    st.markdown("""
    <style>
    @keyframes cdo-matrix-fall {
        0% { transform: translateY(-100%); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(100%); opacity: 0; }
    }
    .cdo-header-wrapper {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        margin-bottom: 2rem;
    }
    .cdo-matrix-bg {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        opacity: 0.2;
        pointer-events: none;
    }
    .cdo-matrix-col {
        position: absolute;
        font-family: 'Courier New', monospace;
        font-size: 11px;
        color: #8B5CF6;
        writing-mode: vertical-rl;
        animation: cdo-matrix-fall linear infinite;
        text-shadow: 0 0 8px #8B5CF6;
    }
    .cdo-header-content {
        position: relative;
        z-index: 1;
        background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%);
        border: 1px solid #C7D2FE;
        padding: 2rem;
        color: #3730A3;
    }
    .cdo-header-content h1 { color: #3730A3; }
    .cdo-header-content p { color: #4F46E5; }
    .cdo-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; }
    .cdo-header-content p { margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 1.1rem; }
    </style>
    <div class="cdo-header-wrapper">
        <div class="cdo-matrix-bg">
            <div class="cdo-matrix-col" style="left: 3%; animation-duration: 7s;">AI∞ML</div>
            <div class="cdo-matrix-col" style="left: 12%; animation-duration: 5s; animation-delay: -2s;">▼△▼△</div>
            <div class="cdo-matrix-col" style="left: 21%; animation-duration: 8s; animation-delay: -3s;">0.87</div>
            <div class="cdo-matrix-col" style="left: 30%; animation-duration: 6s; animation-delay: -1s;">⚡⚡⚡</div>
            <div class="cdo-matrix-col" style="left: 39%; animation-duration: 9s; animation-delay: -4s;">pred</div>
            <div class="cdo-matrix-col" style="left: 48%; animation-duration: 5s; animation-delay: -2s;">★★★</div>
            <div class="cdo-matrix-col" style="left: 57%; animation-duration: 7s; animation-delay: -5s;">f(x)</div>
            <div class="cdo-matrix-col" style="left: 66%; animation-duration: 6s; animation-delay: -1s;">∑∫∂</div>
            <div class="cdo-matrix-col" style="left: 75%; animation-duration: 8s; animation-delay: -3s;">92%</div>
            <div class="cdo-matrix-col" style="left: 84%; animation-duration: 5s; animation-delay: -2s;">◉◎◉</div>
            <div class="cdo-matrix-col" style="left: 93%; animation-duration: 7s; animation-delay: -4s;">∞</div>
        </div>
        <div class="cdo-header-content">
            <h1>CDO AI/ML Analytics Dashboard</h1>
            <p>Predictive Analytics, Propensity Models & Data-Driven Decisions</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_mlops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧪 Model Ops & Strategy", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['PROPENSITY', 'MOBILE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # CDO AI NEURAL NETWORK ANIMATION
        st.markdown("""
        <style>
        @keyframes neuron-pulse { 0%, 100% { opacity: 0.4; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        @keyframes signal-flow { 0% { stroke-dashoffset: 20; } 100% { stroke-dashoffset: 0; } }
        @keyframes brain-glow { 0%, 100% { filter: drop-shadow(0 0 5px rgba(139,92,246,0.3)); } 50% { filter: drop-shadow(0 0 15px rgba(139,92,246,0.7)); } }
        @keyframes cdo-card-flip { 0% { opacity: 0; transform: rotateY(-90deg); } 100% { opacity: 1; transform: rotateY(0); } }
        @keyframes cdo-acc-count { 0% { opacity: 0; transform: scale(0.5); } 50% { transform: scale(1.1); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cdo-neural-breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        .cdo-neural { background: linear-gradient(135deg, #1E1B4B 0%, #312E81 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 2rem; animation: cdo-neural-breathe 4s ease-in-out infinite; }
        .neural-viz { width: 160px; height: 120px; position: relative; flex-shrink: 0; }
        .neuron { position: absolute; width: 14px; height: 14px; background: #8B5CF6; border-radius: 50%; animation: neuron-pulse 2s ease-in-out infinite; }
        .layer-input .neuron { background: #06B6D4; }
        .layer-hidden .neuron { background: #8B5CF6; }
        .layer-output .neuron { background: #10B981; }
        .neural-svg { position: absolute; width: 100%; height: 100%; }
        .neural-line { stroke: rgba(139,92,246,0.4); stroke-width: 1; stroke-dasharray: 5,5; animation: signal-flow 1s linear infinite; }
        .cdo-models { flex: 1; }
        .cdo-title { color: white; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .model-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
        .model-card { background: rgba(139,92,246,0.2); border: 1px solid rgba(139,92,246,0.3); border-radius: 10px; padding: 0.8rem; text-align: center; animation: cdo-card-flip 0.6s ease-out forwards, brain-glow 3s ease-in-out 0.6s infinite; opacity: 0; perspective: 1000px; }
        .model-card:nth-child(2) { animation-delay: 0.15s, 1.15s; }
        .model-card:nth-child(3) { animation-delay: 0.3s, 1.3s; }
        .model-name { color: rgba(255,255,255,0.7); font-size: 0.7rem; margin-bottom: 0.3rem; }
        .model-acc { color: #10B981; font-size: 1.3rem; font-weight: 700; animation: cdo-acc-count 0.5s ease-out 0.5s forwards; opacity: 0; }
        .model-card:nth-child(2) .model-acc { animation-delay: 0.65s; }
        .model-card:nth-child(3) .model-acc { animation-delay: 0.8s; }
        .model-type { color: rgba(255,255,255,0.5); font-size: 0.65rem; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="cdo-neural"><div class="neural-viz"><svg class="neural-svg"><line class="neural-line" x1="20" y1="20" x2="70" y2="35"/><line class="neural-line" x1="20" y1="60" x2="70" y2="35" style="animation-delay:0.2s"/><line class="neural-line" x1="20" y1="100" x2="70" y2="85" style="animation-delay:0.4s"/><line class="neural-line" x1="20" y1="60" x2="70" y2="85" style="animation-delay:0.6s"/><line class="neural-line" x1="70" y1="35" x2="120" y2="60" style="animation-delay:0.3s"/><line class="neural-line" x1="70" y1="85" x2="120" y2="60" style="animation-delay:0.5s"/><line class="neural-line" x1="120" y1="60" x2="150" y2="60" style="animation-delay:0.7s"/></svg><div class="layer-input"><div class="neuron" style="left:10px;top:15px"></div><div class="neuron" style="left:10px;top:55px;animation-delay:0.3s"></div><div class="neuron" style="left:10px;top:95px;animation-delay:0.6s"></div></div><div class="layer-hidden"><div class="neuron" style="left:65px;top:30px;animation-delay:0.4s"></div><div class="neuron" style="left:65px;top:80px;animation-delay:0.7s"></div></div><div class="layer-output"><div class="neuron" style="left:115px;top:55px;animation-delay:0.9s"></div></div></div><div class="cdo-models"><div class="cdo-title">🧠 AI Models Performance</div><div class="model-grid"><div class="model-card"><div class="model-name">Churn Prediction</div><div class="model-acc">94.2%</div><div class="model-type">XGBoost</div></div><div class="model-card"><div class="model-name">Upsell Propensity</div><div class="model-acc">87.8%</div><div class="model-type">Neural Net</div></div><div class="model-card"><div class="model-name">CLV Forecast</div><div class="model-acc">91.5%</div><div class="model-type">Gradient Boost</div></div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes cdo-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 1; } 
            50% { stroke-width: 3.5; opacity: 0.8; } 
        }
        @keyframes cdo-fill-pulse { 
            0%, 100% { opacity: 0.15; transform: scaleY(1); } 
            50% { opacity: 0.25; transform: scaleY(1.02); } 
        }
        @keyframes cdo-bar-wave { 
            0%, 100% { transform: scaleY(1); } 
            50% { transform: scaleY(0.7); } 
        }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.15;
        }
        .kpi-chart path[fill="none"] { animation: cdo-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: cdo-fill-pulse 3s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: cdo-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI/ML Analytics Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">High Churn Risk</div>
                <div class="kpi-value">2,840</div>
                <div class="kpi-delta negative">9.5% of base</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,30 L20,28 L40,24 L60,20 L80,16 L100,14" fill="none" stroke="#EF4444" stroke-width="2"/>
                    <path d="M0,30 L20,28 L40,24 L60,20 L80,16 L100,14 L100,40 L0,40 Z" fill="#EF4444"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Revenue at Risk</div>
                <div class="kpi-value">£1.8M</div>
                <div class="kpi-delta negative">Monthly impact</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="32" width="12" height="8" fill="#F59E0B"/>
                    <rect x="22" y="28" width="12" height="12" fill="#F59E0B"/>
                    <rect x="39" y="24" width="12" height="16" fill="#F59E0B"/>
                    <rect x="56" y="20" width="12" height="20" fill="#F59E0B"/>
                    <rect x="73" y="14" width="12" height="26" fill="#F59E0B"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">Upsell Propensity</div>
                <div class="kpi-value">4,620</div>
                <div class="kpi-delta positive">High probability</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,35 L20,32 L40,28 L60,24 L80,18 L100,12 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">🎯</div>
                <div class="kpi-label">Model Accuracy</div>
                <div class="kpi-value">87%</div>
                <div class="kpi-delta positive">↑ +3% vs baseline</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16" fill="none" stroke="#8B5CF6" stroke-width="2"/>
                    <path d="M0,28 L20,26 L40,24 L60,22 L80,18 L100,16 L100,40 L0,40 Z" fill="#8B5CF6"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">💵</div>
                <div class="kpi-label">Avg Predicted CLV</div>
                <div class="kpi-value">£1,842</div>
                <div class="kpi-delta positive">↑ +£124 YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🤖</div>
                <div class="kpi-label">ML Models Active</div>
                <div class="kpi-value">12</div>
                <div class="kpi-delta positive">All healthy</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Predictions (MTD)</div>
                <div class="kpi-value">2.4M</div>
                <div class="kpi-delta positive">↑ +18% vs avg</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">✅</div>
                <div class="kpi-label">Actions Taken</div>
                <div class="kpi-value">1,240</div>
                <div class="kpi-delta positive">68% success rate</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Churn and propensity models built with Snowflake ML using CORTEX.ML_PREDICT() for real-time scoring on 30M+ customer records")
        
        # Predictive Insights Cards - Real-time AI Predictions
        st.markdown('<div class="section-header">Live Predictive Insights</div>', unsafe_allow_html=True)
        
        components.html("""
        <!DOCTYPE html>
        <html>
        <head>
        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        @keyframes insight-pulse {
            0%, 100% { box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2); }
            50% { box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4); }
        }
        @keyframes confidence-grow {
            0% { width: 0%; }
            100% { width: var(--conf); }
        }
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            padding: 0.5rem;
        }
        .insight-card {
            background: linear-gradient(135deg, #FAFAFA 0%, #F5F5F5 100%);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid #E5E7EB;
            position: relative;
            overflow: hidden;
            animation: insight-pulse 3s ease-in-out infinite;
        }
        .insight-card.card-red { border-left: 4px solid #EF4444; }
        .insight-card.card-green { border-left: 4px solid #10B981; }
        .insight-card.card-purple { border-left: 4px solid #8B5CF6; }
        .insight-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        .badge-critical { background: #FEE2E2; color: #DC2626; }
        .badge-warning { background: #FEF3C7; color: #D97706; }
        .badge-opportunity { background: #D1FAE5; color: #059669; }
        .insight-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .insight-title { font-size: 0.9rem; font-weight: 600; color: #1B2A4E; margin-bottom: 0.25rem; }
        .insight-value { font-size: 1.8rem; font-weight: 700; color: #1B2A4E; }
        .insight-subtitle { font-size: 0.75rem; color: #6B7280; margin-bottom: 0.75rem; }
        .confidence-bar { height: 6px; background: #E5E7EB; border-radius: 3px; overflow: hidden; margin-top: 0.5rem; }
        .confidence-fill { height: 100%; border-radius: 3px; animation: confidence-grow 1.5s ease-out forwards; }
        .confidence-label { display: flex; justify-content: space-between; font-size: 0.7rem; color: #9CA3AF; margin-top: 0.25rem; }
        .insight-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            color: white;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.75rem;
            cursor: pointer;
        }
        .action-red { background: #EF4444; }
        .action-green { background: #10B981; }
        .action-purple { background: #8B5CF6; }
        </style>
        </head>
        <body>
        <div class="insights-grid">
            <div class="insight-card card-red">
                <span class="insight-badge badge-critical">CRITICAL</span>
                <div class="insight-icon">⚠️</div>
                <div class="insight-title">Churn Alert</div>
                <div class="insight-value">847</div>
                <div class="insight-subtitle">High-value customers at risk this week</div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="--conf: 94%; background: linear-gradient(90deg, #EF4444, #DC2626);"></div>
                </div>
                <div class="confidence-label">
                    <span>Model Confidence</span>
                    <span style="font-weight: 600; color: #EF4444;">94%</span>
                </div>
                <div class="insight-action action-red">Launch Retention Campaign</div>
            </div>
            
            <div class="insight-card card-green">
                <span class="insight-badge badge-opportunity">OPPORTUNITY</span>
                <div class="insight-icon">💎</div>
                <div class="insight-title">Upsell Ready</div>
                <div class="insight-value">1,234</div>
                <div class="insight-subtitle">Customers likely to upgrade to 5G</div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="--conf: 87%; background: linear-gradient(90deg, #10B981, #059669);"></div>
                </div>
                <div class="confidence-label">
                    <span>Model Confidence</span>
                    <span style="font-weight: 600; color: #10B981;">87%</span>
                </div>
                <div class="insight-action action-green">Send Personalized Offers</div>
            </div>
            
            <div class="insight-card card-purple">
                <span class="insight-badge badge-warning">ACTION NEEDED</span>
                <div class="insight-icon">📞</div>
                <div class="insight-title">Support Prediction</div>
                <div class="insight-value">2,156</div>
                <div class="insight-subtitle">Likely to contact support in 7 days</div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="--conf: 82%; background: linear-gradient(90deg, #8B5CF6, #7C3AED);"></div>
                </div>
                <div class="confidence-label">
                    <span>Model Confidence</span>
                    <span style="font-weight: 600; color: #8B5CF6;">82%</span>
                </div>
                <div class="insight-action action-purple">Proactive Outreach</div>
            </div>
        </div>
        </body>
        </html>
        """, height=320, scrolling=False)
        
        # AI Model Performance - Animated Circular Progress
        st.markdown("""
        <style>
        /* Looping fill animations for CDO model gauges */
        @keyframes cdo-fill-green { 0%, 100% { stroke-dashoffset: 283; } 50% { stroke-dashoffset: 37; } }
        @keyframes cdo-fill-blue { 0%, 100% { stroke-dashoffset: 283; } 50% { stroke-dashoffset: 45; } }
        @keyframes cdo-fill-purple { 0%, 100% { stroke-dashoffset: 283; } 50% { stroke-dashoffset: 23; } }
        @keyframes cdo-fill-pink { 0%, 100% { stroke-dashoffset: 283; } 50% { stroke-dashoffset: 51; } }
        .cdo-models-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        .cdo-model-card { background: #F8FAFC; border-radius: 16px; padding: 1.25rem; text-align: center; border: 1px solid #E2E8F0; }
        .cdo-model-ring { width: 90px; height: 90px; margin: 0 auto 0.75rem; }
        .cdo-model-ring svg { transform: rotate(-90deg); }
        .cdo-model-ring .bg { fill: none; stroke: #E2E8F0; stroke-width: 8; }
        .cdo-model-ring .progress { fill: none; stroke-width: 8; stroke-linecap: round; stroke-dasharray: 283; }
        .cdo-model-ring .progress.green { stroke: #10B981; animation: cdo-fill-green 3s ease-in-out infinite; }
        .cdo-model-ring .progress.blue { stroke: #29B5E8; animation: cdo-fill-blue 3s ease-in-out infinite 0.3s; }
        .cdo-model-ring .progress.purple { stroke: #8B5CF6; animation: cdo-fill-purple 3s ease-in-out infinite 0.6s; }
        .cdo-model-ring .progress.pink { stroke: #EC4899; animation: cdo-fill-pink 3s ease-in-out infinite 0.9s; }
        .cdo-model-value { font-size: 1.4rem; font-weight: 700; color: #1B2A4E; }
        .cdo-model-name { font-size: 0.85rem; color: #1B2A4E; margin-top: 0.5rem; font-weight: 600; }
        .cdo-model-metric { font-size: 0.7rem; color: #6B7280; margin-top: 0.25rem; }
        </style>
        <div class="cdo-models-grid">
            <div class="cdo-model-card">
                <div class="cdo-model-ring">
                    <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="45"/>
                        <circle class="progress green" cx="50" cy="50" r="45"/>
                    </svg>
                </div>
                <div class="cdo-model-value">87%</div>
                <div class="cdo-model-name">Churn Model</div>
                <div class="cdo-model-metric">AUC-ROC Score</div>
            </div>
            <div class="cdo-model-card">
                <div class="cdo-model-ring">
                    <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="45"/>
                        <circle class="progress blue" cx="50" cy="50" r="45"/>
                    </svg>
                </div>
                <div class="cdo-model-value">84%</div>
                <div class="cdo-model-name">Upsell Model</div>
                <div class="cdo-model-metric">Precision</div>
            </div>
            <div class="cdo-model-card">
                <div class="cdo-model-ring">
                    <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="45"/>
                        <circle class="progress purple" cx="50" cy="50" r="45"/>
                    </svg>
                </div>
                <div class="cdo-model-value">92%</div>
                <div class="cdo-model-name">CLV Predictor</div>
                <div class="cdo-model-metric">R² Score</div>
            </div>
            <div class="cdo-model-card">
                <div class="cdo-model-ring">
                    <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="45"/>
                        <circle class="progress pink" cx="50" cy="50" r="45"/>
                    </svg>
                </div>
                <div class="cdo-model-value">82%</div>
                <div class="cdo-model-name">NPS Predictor</div>
                <div class="cdo-model-metric">Accuracy</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Churn Risk Distribution</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 80px; font-weight: 600; color: #EF4444;">High Risk</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 24px; margin: 0 0.75rem; position: relative;">
                            <div style="background: linear-gradient(90deg, #EF4444, #F87171); width: 28%; height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 0.5rem;">
                                <span style="color: white; font-size: 0.75rem; font-weight: 600;">2,840</span>
                            </div>
                        </div>
                        <span style="width: 60px; text-align: right; font-weight: 600; color: #EF4444;">9.5%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 80px; font-weight: 600; color: #F59E0B;">Medium</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 24px; margin: 0 0.75rem; position: relative;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 42%; height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 0.5rem;">
                                <span style="color: white; font-size: 0.75rem; font-weight: 600;">5,180</span>
                            </div>
                        </div>
                        <span style="width: 60px; text-align: right; font-weight: 600; color: #F59E0B;">17.3%</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.6rem 0;">
                        <span style="width: 80px; font-weight: 600; color: #10B981;">Low Risk</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 24px; margin: 0 0.75rem; position: relative;">
                            <div style="background: linear-gradient(90deg, #10B981, #34D399); width: 100%; height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 0.5rem;">
                                <span style="color: white; font-size: 0.75rem; font-weight: 600;">21,980</span>
                            </div>
                        </div>
                        <span style="width: 60px; text-align: right; font-weight: 600; color: #10B981;">73.2%</span>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: #FEF3C7; border-radius: 8px; text-align: center; font-size: 0.85rem;">
                    <span style="color: #92400E;">⚠️ 2,840 customers need retention intervention — <strong>£1.8M/month</strong> at risk</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Next Best Action Distribution</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem; color: #6B7280;">Action</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Count</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Revenue</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Conf.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #8B5CF6;">●</span> Upgrade to 5G</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">2,840</td>
                            <td style="text-align: right; padding: 0.5rem;">+£284K</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">92%</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #10B981;">●</span> Add Family Plan</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">1,620</td>
                            <td style="text-align: right; padding: 0.5rem;">+£194K</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">88%</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #EF4444;">●</span> Retention Offer</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">1,480</td>
                            <td style="text-align: right; padding: 0.5rem;">Save £148K</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">78%</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #29B5E8;">●</span> Data Boost</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">980</td>
                            <td style="text-align: right; padding: 0.5rem;">+£49K</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">85%</span></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;"><span style="color: #F59E0B;">●</span> International Add-on</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">720</td>
                            <td style="text-align: right; padding: 0.5rem;">+£36K</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">82%</span></td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Churn by Segment</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.6rem; border-left: 4px solid #EF4444; background: #FEE2E2; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #DC2626;">Budget Segment</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">5,400 customers</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #DC2626;">14.2%</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">Standard Segment</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">10,500 customers</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #F59E0B;">8.6%</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #10B981; background: #D1FAE5; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #065F46;">Premium Segment</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">3,200 customers</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #10B981;">4.2%</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #29B5E8; background: #E0F2FE; border-radius: 0 8px 8px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #0369A1;">5G Adopters</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">12,600 customers</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #29B5E8;">3.8%</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Model Performance</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Churn Model (XGBoost)</span>
                        <span style="font-weight: 700; background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">AUC: 0.89</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>CLV Model (Regression)</span>
                        <span style="font-weight: 700; background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">R²: 0.84</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Upsell Propensity</span>
                        <span style="font-weight: 700; background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">AUC: 0.86</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>NBA Recommender</span>
                        <span style="font-weight: 700; background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Prec: 0.82</span>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #F3F4F6; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #6B7280;">All models retrained weekly · Last update: 2 days ago</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">CLV Distribution</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                    <div style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #065F46;">High CLV (>£2.5K)</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #065F46;">4,200</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">14% of base</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #E0F2FE 0%, #F0F9FF 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #0369A1;">Medium CLV</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #0369A1;">18,400</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">61% of base</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #92400E;">Low CLV (<£800)</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #92400E;">7,400</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">25% of base</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #EDE9FE 0%, #F5F3FF 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #5B21B6;">Total Base</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #5B21B6;">30,000</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">Avg CLV: £1,842</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Model Performance Over Time</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            col_chart, col_legend = st.columns([2, 1])
            
            with col_chart:
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb']
                model_perf_data = pd.DataFrame({
                    'Month': months * 3,
                    'Model': ['Churn AUC'] * 7 + ['Upsell AUC'] * 7 + ['NBA Precision'] * 7,
                    'Score': [0.83, 0.84, 0.85, 0.86, 0.87, 0.88, 0.89,
                             0.80, 0.81, 0.82, 0.83, 0.84, 0.85, 0.86,
                             0.78, 0.79, 0.80, 0.81, 0.81, 0.82, 0.82]
                })
                
                model_chart = alt.Chart(model_perf_data).mark_line(
                    strokeWidth=3,
                    point=alt.OverlayMarkDef(size=60)
                ).encode(
                    x=alt.X('Month:N', sort=months, axis=alt.Axis(labelAngle=0, title=None)),
                    y=alt.Y('Score:Q', scale=alt.Scale(domain=[0.75, 0.92]), axis=alt.Axis(title='Score', format='.2f')),
                    color=alt.Color('Model:N', scale=alt.Scale(
                        domain=['Churn AUC', 'Upsell AUC', 'NBA Precision'],
                        range=['#10B981', '#8B5CF6', '#F59E0B']
                    ), legend=None),
                    strokeDash=alt.StrokeDash('Model:N', scale=alt.Scale(
                        domain=['Churn AUC', 'Upsell AUC', 'NBA Precision'],
                        range=[[1, 0], [6, 3], [3, 3]]
                    ), legend=None),
                    tooltip=['Month:N', 'Model:N', alt.Tooltip('Score:Q', format='.2f')]
                ).properties(height=180)
                
                st.altair_chart(model_chart, use_container_width=True)
            
            with col_legend:
                st.markdown("""
                <div style="font-size: 0.75rem; color: #6B7280; margin-bottom: 0.75rem;">Latest Metrics</div>
                <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                    <div style="width: 20px; height: 3px; background: #10B981; margin-right: 0.5rem;"></div>
                    <span style="font-size: 0.8rem;">Churn AUC: <strong>0.89</strong></span>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                    <div style="width: 20px; height: 3px; background: #8B5CF6; margin-right: 0.5rem; border-top: 3px dashed #8B5CF6; height: 0;"></div>
                    <span style="font-size: 0.8rem;">Upsell AUC: <strong>0.86</strong></span>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <div style="width: 20px; height: 3px; background: #F59E0B; margin-right: 0.5rem; border-top: 3px dotted #F59E0B; height: 0;"></div>
                    <span style="font-size: 0.8rem;">NBA Prec: <strong>0.82</strong></span>
                </div>
                <div style="padding: 0.5rem; background: #D1FAE5; border-radius: 6px; text-align: center; font-size: 0.75rem;">
                    <span style="color: #065F46;">↑ All models improving</span>
                </div>
                """, unsafe_allow_html=True)
        
        col_feat, col_pred = st.columns(2)
        
        with col_feat:
            st.markdown('<div class="section-header">Churn Model Feature Importance</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Contract End Date</span>
                            <span style="font-weight: 600;">24.2%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #EF4444, #F87171); width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Service Tickets (90d)</span>
                            <span style="font-weight: 600;">18.6%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 77%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Data Usage Decline</span>
                            <span style="font-weight: 600;">14.8%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 61%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>NPS Score</span>
                            <span style="font-weight: 600;">12.4%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #29B5E8, #7DD3FC); width: 51%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Network QoE Score</span>
                            <span style="font-weight: 600;">10.2%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #29B5E8, #7DD3FC); width: 42%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Other Features</span>
                            <span style="font-weight: 600;">19.8%</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #9CA3AF, #D1D5DB); width: 82%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_pred:
            st.markdown('<div class="section-header">Prediction Accuracy Tracking</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1rem;">
                        <div style="background: #F0F9FF; border-radius: 8px; padding: 0.75rem; text-align: center;">
                            <div style="font-size: 0.7rem; color: #0369A1;">True Positives</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #0369A1;">847</div>
                            <div style="font-size: 0.65rem; color: #10B981;">Correctly predicted churn</div>
                        </div>
                        <div style="background: #FEF3C7; border-radius: 8px; padding: 0.75rem; text-align: center;">
                            <div style="font-size: 0.7rem; color: #92400E;">False Positives</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #F59E0B;">142</div>
                            <div style="font-size: 0.65rem; color: #92400E;">Predicted but stayed</div>
                        </div>
                        <div style="background: #FEE2E2; border-radius: 8px; padding: 0.75rem; text-align: center;">
                            <div style="font-size: 0.7rem; color: #DC2626;">False Negatives</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #EF4444;">98</div>
                            <div style="font-size: 0.65rem; color: #DC2626;">Missed churners</div>
                        </div>
                        <div style="background: #D1FAE5; border-radius: 8px; padding: 0.75rem; text-align: center;">
                            <div style="font-size: 0.7rem; color: #065F46;">True Negatives</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #10B981;">28.9K</div>
                            <div style="font-size: 0.65rem; color: #065F46;">Correctly predicted stay</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-around; font-size: 0.75rem; padding: 0.5rem; background: #F9FAFB; border-radius: 6px;">
                        <div style="text-align: center;">
                            <div style="color: #6B7280;">Precision</div>
                            <div style="font-weight: 700; color: #10B981;">85.6%</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #6B7280;">Recall</div>
                            <div style="font-weight: 700; color: #10B981;">89.6%</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #6B7280;">F1 Score</div>
                            <div style="font-weight: 700; color: #10B981;">87.6%</div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI/ML Campaign Performance</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            st.markdown("""
            <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem;">
                <thead>
                    <tr style="border-bottom: 2px solid #E5E7EB; background: #F9FAFB;">
                        <th style="text-align: left; padding: 0.6rem; color: #6B7280;">Campaign</th>
                        <th style="text-align: center; padding: 0.6rem; color: #6B7280;">Model</th>
                        <th style="text-align: right; padding: 0.6rem; color: #6B7280;">Targeted</th>
                        <th style="text-align: right; padding: 0.6rem; color: #6B7280;">Converted</th>
                        <th style="text-align: right; padding: 0.6rem; color: #6B7280;">Rate</th>
                        <th style="text-align: right; padding: 0.6rem; color: #6B7280;">Revenue</th>
                        <th style="text-align: right; padding: 0.6rem; color: #6B7280;">ROI</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom: 1px solid #F3F4F6;">
                        <td style="padding: 0.6rem; font-weight: 600;">Churn Prevention</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #EDE9FE; color: #5B21B6; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">XGBoost</span></td>
                        <td style="text-align: right; padding: 0.6rem;">2,450</td>
                        <td style="text-align: right; padding: 0.6rem;">847</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="color: #10B981; font-weight: 600;">34.6%</span></td>
                        <td style="text-align: right; padding: 0.6rem;">£1.2M saved</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">8.4x</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid #F3F4F6;">
                        <td style="padding: 0.6rem; font-weight: 600;">5G Upsell</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #E0F2FE; color: #0369A1; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">PropModel</span></td>
                        <td style="text-align: right; padding: 0.6rem;">5,200</td>
                        <td style="text-align: right; padding: 0.6rem;">1,248</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="color: #10B981; font-weight: 600;">24.0%</span></td>
                        <td style="text-align: right; padding: 0.6rem;">£312K MRR</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">5.2x</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid #F3F4F6;">
                        <td style="padding: 0.6rem; font-weight: 600;">Data Add-On</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">NBA</span></td>
                        <td style="text-align: right; padding: 0.6rem;">8,400</td>
                        <td style="text-align: right; padding: 0.6rem;">2,856</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="color: #10B981; font-weight: 600;">34.0%</span></td>
                        <td style="text-align: right; padding: 0.6rem;">£142K MRR</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">4.8x</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 0.6rem; font-weight: 600;">Device Upgrade</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">Hybrid</span></td>
                        <td style="text-align: right; padding: 0.6rem;">3,100</td>
                        <td style="text-align: right; padding: 0.6rem;">682</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="color: #F59E0B; font-weight: 600;">22.0%</span></td>
                        <td style="text-align: right; padding: 0.6rem;">£682K</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">3.2x</span></td>
                    </tr>
                </tbody>
            </table>
            <div style="margin-top: 0.75rem; padding: 0.5rem; background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-radius: 6px; font-size: 0.8rem; text-align: center;">
                <span style="color: #065F46;">📈 <strong>Total ML-Driven Revenue Impact:</strong> £2.34M this quarter | Avg ROI: 5.4x</span>
            </div>
            """, unsafe_allow_html=True)
        
        # Customer Intelligence Section
        st.markdown('<div class="section-header">Customer Intelligence & Analytics</div>', unsafe_allow_html=True)
        
        clv_col, churn_seg_col = st.columns(2)
        
        with clv_col:
            st.markdown("**Customer Lifetime Value Distribution**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>High Value (£2K+)</span><span style="font-weight: 600;">8,420 <span style="color: #10B981;">£4.2M revenue</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: linear-gradient(90deg, #10B981, #059669); width: 18%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Medium Value (£800-2K)</span><span style="font-weight: 600;">24,680 <span style="color: #29B5E8;">£8.6M revenue</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: linear-gradient(90deg, #29B5E8, #0EA5E9); width: 52%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Low Value (£300-800)</span><span style="font-weight: 600;">38,420 <span style="color: #F59E0B;">£5.8M revenue</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #D97706); width: 82%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>At Risk (<£300)</span><span style="font-weight: 600;">14,280 <span style="color: #DC2626;">£1.2M revenue</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: linear-gradient(90deg, #DC2626, #B91C1C); width: 30%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #6B7280;">Total CLV: £19.8M across 85,800 customers</div>
                """, unsafe_allow_html=True)
        
        with churn_seg_col:
            st.markdown("**Churn Risk by Customer Segment**")
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; font-size: 0.8rem; border-collapse: collapse;">
                    <tr style="border-bottom: 2px solid #E5E7EB; background: #F9FAFB;">
                        <th style="text-align: left; padding: 0.5rem;">Segment</th>
                        <th style="text-align: center; padding: 0.5rem;">Customers</th>
                        <th style="text-align: center; padding: 0.5rem;">High Risk</th>
                        <th style="text-align: center; padding: 0.5rem;">£ at Risk</th>
                    </tr>
                    <tr style="border-bottom: 1px solid #E5E7EB;">
                        <td style="padding: 0.5rem;">Consumer Post-Pay</td>
                        <td style="text-align: center; padding: 0.5rem;">62,400</td>
                        <td style="text-align: center; padding: 0.5rem; color: #DC2626;"><strong>8.2%</strong></td>
                        <td style="text-align: center; padding: 0.5rem;">£1.84M</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #E5E7EB;">
                        <td style="padding: 0.5rem;">Consumer Pre-Pay</td>
                        <td style="text-align: center; padding: 0.5rem;">38,200</td>
                        <td style="text-align: center; padding: 0.5rem; color: #F59E0B;"><strong>12.4%</strong></td>
                        <td style="text-align: center; padding: 0.5rem;">£0.42M</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #E5E7EB;">
                        <td style="padding: 0.5rem;">B2B Enterprise</td>
                        <td style="text-align: center; padding: 0.5rem;">524</td>
                        <td style="text-align: center; padding: 0.5rem; color: #10B981;"><strong>3.2%</strong></td>
                        <td style="text-align: center; padding: 0.5rem;">£0.86M</td>
                    </tr>
                    <tr>
                        <td style="padding: 0.5rem;">B2B SMB</td>
                        <td style="text-align: center; padding: 0.5rem;">2,180</td>
                        <td style="text-align: center; padding: 0.5rem; color: #F59E0B;"><strong>6.8%</strong></td>
                        <td style="text-align: center; padding: 0.5rem;">£0.34M</td>
                    </tr>
                </table>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #DC2626;">⚠️ Total Revenue at Risk: £3.46M</div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Propensity & Churn Signals</div>', unsafe_allow_html=True)
        signal_col1, signal_col2 = st.columns(2)
        
        with signal_col1:
            st.markdown("**Churn Risk Distribution**")
            with st.container(border=True):
                churn_dist = pd.DataFrame({
                    'Risk Band': ['Low', 'Medium', 'High', 'Critical'],
                    'Customers': [48200, 26500, 8420, 2940]
                })
                churn_chart = alt.Chart(churn_dist).mark_bar(cornerRadiusEnd=6).encode(
                    x=alt.X('Customers:Q', title='Customers'),
                    y=alt.Y('Risk Band:N', sort='-x', title=None),
                    color=alt.Color('Risk Band:N', scale=alt.Scale(
                        domain=['Low', 'Medium', 'High', 'Critical'],
                        range=['#10B981', '#F59E0B', '#EF4444', '#7F1D1D']
                    ), legend=None),
                    tooltip=['Risk Band:N', 'Customers:Q']
                ).properties(height=200)
                st.altair_chart(churn_chart, use_container_width=True)
                st.caption("Critical and high-risk cohorts drive 62% of projected churn revenue risk.")
        
        with signal_col2:
            st.markdown("**Upsell Propensity Lift (Deciles)**")
            with st.container(border=True):
                lift_df = pd.DataFrame({
                    'Decile': list(range(1, 11)),
                    'Lift': [0.9, 1.2, 1.4, 1.7, 2.1, 2.6, 3.0, 3.4, 3.8, 4.2]
                })
                lift_line = alt.Chart(lift_df).mark_line(color='#8B5CF6', strokeWidth=2).encode(
                    x=alt.X('Decile:Q', title='Propensity Decile'),
                    y=alt.Y('Lift:Q', title='Lift vs Baseline')
                )
                lift_points = alt.Chart(lift_df).mark_circle(size=60, color='#6366F1').encode(
                    x='Decile:Q',
                    y='Lift:Q',
                    tooltip=['Decile:Q', alt.Tooltip('Lift:Q', format='.1f')]
                )
                st.altair_chart((lift_line + lift_points).properties(height=200), use_container_width=True)
                st.caption("Top two deciles deliver 3.8–4.2x response lift.")
        
        # Cross-sell and NBA
        cross_col, nba_col = st.columns(2)
        
        with cross_col:
            st.markdown("**Cross-sell Propensity Matrix**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Mobile → Broadband</span><span style="font-weight: 600; color: #10B981;">72% likely (4,280)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #10B981; width: 72%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>4G → 5G Upgrade</span><span style="font-weight: 600; color: #29B5E8;">58% likely (12,640)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #29B5E8; width: 58%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>PAYG → Contract</span><span style="font-weight: 600; color: #8B5CF6;">45% likely (8,420)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #8B5CF6; width: 45%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Add Family Line</span><span style="font-weight: 600; color: #F59E0B;">34% likely (6,840)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #F59E0B; width: 34%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #10B981;">🎯 Potential Revenue: £2.8M</div>
                """, unsafe_allow_html=True)
        
        with nba_col:
            st.markdown("**Next Best Action Recommendations**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.8rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB; align-items: center;">
                        <span style="flex: 2;">Retention Offer</span>
                        <span style="flex: 1; text-align: center;"><strong>4,820</strong></span>
                        <span style="flex: 1; text-align: right; background: #DC2626; color: white; padding: 0.15rem 0.4rem; border-radius: 10px; font-size: 0.7rem;">Urgent</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB; align-items: center;">
                        <span style="flex: 2;">5G Upgrade</span>
                        <span style="flex: 1; text-align: center;"><strong>12,640</strong></span>
                        <span style="flex: 1; text-align: right; background: #10B981; color: white; padding: 0.15rem 0.4rem; border-radius: 10px; font-size: 0.7rem;">High Value</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB; align-items: center;">
                        <span style="flex: 2;">Bundle Offer</span>
                        <span style="flex: 1; text-align: center;"><strong>8,240</strong></span>
                        <span style="flex: 1; text-align: right; background: #29B5E8; color: white; padding: 0.15rem 0.4rem; border-radius: 10px; font-size: 0.7rem;">Opportunity</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; align-items: center;">
                        <span style="flex: 2;">Loyalty Reward</span>
                        <span style="flex: 1; text-align: center;"><strong>6,420</strong></span>
                        <span style="flex: 1; text-align: right; background: #8B5CF6; color: white; padding: 0.15rem 0.4rem; border-radius: 10px; font-size: 0.7rem;">Nurture</span>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #6B7280;">32,120 customers with active recommendations</div>
                """, unsafe_allow_html=True)
        

    with tab_mlops:
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['MLOPS', 'FEATURE_STORE', 'MODEL_MONITOR']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        @keyframes cdo-ops-sweep { 0% { transform: translateX(-120%); opacity: 0; } 25% { opacity: 0.6; } 100% { transform: translateX(120%); opacity: 0; } }
        @keyframes cdo-ops-glow { 0%, 100% { box-shadow: 0 0 0 rgba(99,102,241,0.25); } 50% { box-shadow: 0 0 16px rgba(99,102,241,0.45); } }
        .cdo-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: white;
            margin-bottom: 1.5rem;
            animation: cdo-ops-glow 2.8s ease-in-out infinite;
        }
        .cdo-ops-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -50%;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: cdo-ops-sweep 3.4s ease-in-out infinite;
        }
        .cdo-ops-title { font-weight: 700; font-size: 1rem; position: relative; z-index: 1; }
        .cdo-ops-sub { font-size: 0.85rem; opacity: 0.85; position: relative; z-index: 1; }
        .cdo-ops-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-top: 0.9rem; position: relative; z-index: 1; }
        .cdo-ops-card { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25); border-radius: 10px; padding: 0.6rem 0.75rem; }
        .cdo-ops-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.06em; color: rgba(255,255,255,0.7); }
        .cdo-ops-value { font-size: 1.2rem; font-weight: 700; color: #FFFFFF; margin-top: 0.2rem; }
        .cdo-ops-delta { font-size: 0.7rem; color: rgba(255,255,255,0.85); margin-top: 0.15rem; }
        @media (max-width: 900px) { .cdo-ops-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="cdo-ops-pulse">
            <div class="cdo-ops-title">🧪 Model Ops Pulse</div>
            <div class="cdo-ops-sub">Real-time model health, drift, and inference latency.</div>
            <div class="cdo-ops-grid">
                <div class="cdo-ops-card">
                    <div class="cdo-ops-label">Accuracy</div>
                    <div class="cdo-ops-value">92.4%</div>
                    <div class="cdo-ops-delta">↑ +0.6% WoW</div>
                </div>
                <div class="cdo-ops-card">
                    <div class="cdo-ops-label">Drift Score</div>
                    <div class="cdo-ops-value">0.07</div>
                    <div class="cdo-ops-delta">Low risk</div>
                </div>
                <div class="cdo-ops-card">
                    <div class="cdo-ops-label">Latency</div>
                    <div class="cdo-ops-value">84 ms</div>
                    <div class="cdo-ops-delta">Target &lt; 100 ms</div>
                </div>
                <div class="cdo-ops-card">
                    <div class="cdo-ops-label">Jobs Healthy</div>
                    <div class="cdo-ops-value">98%</div>
                    <div class="cdo-ops-delta">2 retrains pending</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Model Health Trends</div>', unsafe_allow_html=True)
        mlops_left, mlops_right = st.columns(2)
        
        with mlops_left:
            st.markdown("**Accuracy & AUC (12 Weeks)**")
            with st.container(border=True):
                perf_df = pd.DataFrame({
                    'Week': list(range(1, 13)),
                    'Accuracy': [90.1, 90.4, 90.6, 90.9, 91.2, 91.6, 91.8, 92.0, 92.2, 92.3, 92.4, 92.4],
                    'AUC': [0.86, 0.865, 0.868, 0.872, 0.878, 0.882, 0.885, 0.889, 0.892, 0.894, 0.897, 0.898]
                })
                acc_line = alt.Chart(perf_df).mark_line(color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Week:Q', title='Week'),
                    y=alt.Y('Accuracy:Q', title='Accuracy (%)', scale=alt.Scale(domain=[89, 93]))
                )
                auc_line = alt.Chart(perf_df).mark_line(color='#8B5CF6', strokeWidth=2, strokeDash=[4, 3]).encode(
                    x='Week:Q',
                    y=alt.Y('AUC:Q', title='AUC', scale=alt.Scale(domain=[0.85, 0.91]))
                )
                st.altair_chart((acc_line + auc_line).properties(height=200), use_container_width=True)
                st.caption("Accuracy and AUC trending upward after feature refresh.")
        
        with mlops_right:
            st.markdown("**Drift Score by Feature Group**")
            with st.container(border=True):
                drift_df = pd.DataFrame({
                    'Feature Group': ['Usage', 'Device', 'Billing', 'Network', 'Engagement'],
                    'Drift Score': [0.05, 0.09, 0.03, 0.07, 0.06]
                })
                drift_chart = alt.Chart(drift_df).mark_bar(color='#F59E0B', cornerRadiusEnd=6).encode(
                    x=alt.X('Drift Score:Q', title='PSI / Drift Score', scale=alt.Scale(domain=[0, 0.12])),
                    y=alt.Y('Feature Group:N', sort='-x', title=None),
                    tooltip=['Feature Group:N', alt.Tooltip('Drift Score:Q', format='.2f')]
                ).properties(height=200)
                st.altair_chart(drift_chart, use_container_width=True)
                st.caption("Device features show elevated drift; retrain queued.")
        
        st.markdown('<div class="section-header">Operational Throughput & Reliability</div>', unsafe_allow_html=True)
        ops_left, ops_right = st.columns(2)
        
        with ops_left:
            st.markdown("**Inference Volume by Channel (14 Days)**")
            with st.container(border=True):
                vol_df = pd.DataFrame({
                    'Day': list(range(1, 15)),
                    'Digital': [42, 44, 45, 47, 49, 46, 48, 50, 52, 54, 53, 55, 56, 58],
                    'Care': [28, 27, 29, 31, 30, 32, 33, 31, 34, 35, 36, 34, 37, 38]
                })
                vol_melt = vol_df.melt('Day', var_name='Channel', value_name='Requests_K')
                vol_chart = alt.Chart(vol_melt).mark_area(opacity=0.5).encode(
                    x=alt.X('Day:Q', title='Day'),
                    y=alt.Y('Requests_K:Q', title='Requests (K)'),
                    color=alt.Color('Channel:N', scale=alt.Scale(range=['#6366F1', '#22C55E']), legend=None)
                )
                st.altair_chart(vol_chart.properties(height=200), use_container_width=True)
                st.caption("Digital channels drive ~60% of real-time scoring volume.")
        
        with ops_right:
            st.markdown("**Retraining Pipeline Status**")
            with st.container(border=True):
                retrain_df = pd.DataFrame({
                    'Stage': ['Queued', 'Running', 'Validating', 'Deployed'],
                    'Models': [6, 3, 4, 18]
                })
                retrain_chart = alt.Chart(retrain_df).mark_bar(color='#8B5CF6', cornerRadiusEnd=6).encode(
                    x=alt.X('Models:Q', title='Models'),
                    y=alt.Y('Stage:N', sort='-x', title=None),
                    tooltip=['Stage:N', 'Models:Q']
                ).properties(height=200)
                st.altair_chart(retrain_chart, use_container_width=True)
                st.caption("Deployment backlog low; 18 models promoted this month.")
        
        st.markdown('<div class="section-header">Feature Store Freshness</div>', unsafe_allow_html=True)
        fresh_col1, fresh_col2 = st.columns(2)
        
        with fresh_col1:
            st.markdown("**Top Feature Groups (SLA %)**")
            with st.container(border=True):
                fresh_df = pd.DataFrame({
                    'feature_group': ['Usage', 'Device', 'Billing', 'Network', 'Engagement'],
                    'sla_pct': [99.2, 97.8, 98.6, 96.9, 98.1]
                }).set_index('feature_group')
                st.bar_chart(fresh_df, height=220, color="#0EA5E9")
                st.caption("Network features are closest to SLA threshold.")
        
        with fresh_col2:
            st.markdown("**Latency Distribution (p50/p95/p99)**")
            with st.container(border=True):
                latency_df = pd.DataFrame({
                    'Percentile': ['p50', 'p95', 'p99'],
                    'Latency_ms': [62, 118, 164]
                })
                latency_chart = alt.Chart(latency_df).mark_bar(color='#10B981', cornerRadiusEnd=6).encode(
                    x=alt.X('Latency_ms:Q', title='Latency (ms)'),
                    y=alt.Y('Percentile:N', sort=['p50', 'p95', 'p99'], title=None),
                    tooltip=['Percentile:N', 'Latency_ms:Q']
                ).properties(height=200)
                st.altair_chart(latency_chart, use_container_width=True)
                st.caption("p99 latency remains below 200 ms target.")
        
        st.markdown('<div class="section-header">Experimentation & Quality</div>', unsafe_allow_html=True)
        col_exp1, col_exp2, col_exp3, col_exp4 = st.columns(4)
        
        with col_exp1:
            st.markdown('<div class="section-header">A/B Test Results</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 0.75rem; color: #6B7280; margin-bottom: 0.5rem;">Offer Personalization</div>
                    <div style="display: flex; justify-content: center; gap: 0.5rem;">
                        <div style="background: #E5E7EB; padding: 0.5rem; border-radius: 8px; flex: 1;">
                            <div style="font-size: 0.65rem; color: #6B7280;">Control</div>
                            <div style="font-size: 1.2rem; font-weight: 700;">12.4%</div>
                        </div>
                        <div style="background: #D1FAE5; padding: 0.5rem; border-radius: 8px; flex: 1;">
                            <div style="font-size: 0.65rem; color: #065F46;">Variant</div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #10B981;">18.2%</div>
                        </div>
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.7rem; color: #10B981; font-weight: 600;">+47% lift ✓</div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_exp2:
            st.markdown('<div class="section-header">Data Quality</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #10B981;">98.4%</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">Data Completeness</div>
                    <div style="margin-top: 0.5rem; font-size: 0.75rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Freshness</span>
                            <span style="color: #10B981;">✓ 2hr</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Accuracy</span>
                            <span style="color: #10B981;">✓ 99.1%</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_exp3:
            st.markdown('<div class="section-header">Model Drift</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #10B981;">Low</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">Drift Detected</div>
                    <div style="margin-top: 0.5rem; font-size: 0.75rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Feature Drift</span>
                            <span style="color: #10B981;">2.1%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Target Drift</span>
                            <span style="color: #10B981;">1.4%</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_exp4:
            st.markdown('<div class="section-header">Inference Load</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #29B5E8;">142K</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">Daily Predictions</div>
                    <div style="margin-top: 0.5rem; font-size: 0.75rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Avg Latency</span>
                            <span style="color: #10B981;">12ms</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>P99 Latency</span>
                            <span style="color: #F59E0B;">45ms</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
    with tab_strategy:
        st.markdown("""
        <style>
        .cdo-ai-pulse {
            background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%);
            border-radius: 16px;
            border: 1px solid #C7D2FE;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .cdo-ai-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99,102,241,0.18), transparent);
            animation: cdo-ai-sweep 4s ease-in-out infinite;
        }
        @keyframes cdo-ai-sweep { 0% { left: -120%; } 100% { left: 220%; } }
        .cdo-ai-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .cdo-ai-title { font-weight: 700; color: #3730A3; font-size: 1.05rem; }
        .cdo-ai-tag { background: #4F46E5; color: white; font-size: 0.75rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 999px; }
        .cdo-ai-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.9rem; position: relative; z-index: 1; }
        .cdo-ai-card { background: white; border-radius: 12px; border: 1px solid #C7D2FE; padding: 0.85rem 0.95rem; }
        .cdo-ai-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9CA3AF; }
        .cdo-ai-value { font-size: 1.3rem; font-weight: 700; color: #3730A3; }
        .cdo-ai-sub { font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) { .cdo-ai-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="cdo-ai-pulse">
            <div class="cdo-ai-header">
                <div class="cdo-ai-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="cdo-ai-tag">AI LIVE</div>
            </div>
            <div class="cdo-ai-grid">
                <div class="cdo-ai-card">
                    <div class="cdo-ai-label">Model Accuracy</div>
                    <div class="cdo-ai-value">92.4%</div>
                    <div class="cdo-ai-sub">+0.6% vs last week</div>
                </div>
                <div class="cdo-ai-card">
                    <div class="cdo-ai-label">Feature Freshness</div>
                    <div class="cdo-ai-value">98.1%</div>
                    <div class="cdo-ai-sub">Streaming feeds healthy</div>
                </div>
                <div class="cdo-ai-card">
                    <div class="cdo-ai-label">Decision Velocity</div>
                    <div class="cdo-ai-value">84 ms</div>
                    <div class="cdo-ai-sub">Target &lt; 100 ms</div>
                </div>
                <div class="cdo-ai-card">
                    <div class="cdo-ai-label">Drift Alerts</div>
                    <div class="cdo-ai-value">3</div>
                    <div class="cdo-ai-sub">2 resolved today</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Summary synthesized from model performance, drift, and feature health telemetry.")
        
        with st.container(border=True):
            st.markdown("""
            **Executive Summary (Q1 2026):**
            - Churn and upsell models are stable with **92%+ accuracy** across core segments.
            - Drift signals are concentrated in **prepaid cohorts** and **regional devices**.
            - Real-time scoring latency is **84 ms**, within the sub-100 ms target.
            """)
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Churn risk** elevated in top 3 urban clusters
                - **Upsell lift** +12% in 5G-eligible segments
                - **CLV growth** strongest in bundled households
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Feature drift** in device age and ARPU
                - **Cold-start** risk for new prepaid activations
                - **Data lag** in partner app events
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Growth Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **NBA adoption** up to 68% of agents
                - **Campaign ROI** +1.8x vs baseline
                - **Real-time scoring** expanding to web
                """)
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                - **Reduce drift** with weekly retraining on prepaid cohorts
                - Prioritize top 20 features by SHAP impact
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                - **Scale NBA** across call center + digital channels
                - Target 80% adoption by end of quarter
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                - **Boost CLV** via bundle propensity campaigns
                - Focus on households with 2+ lines
                """)
        
        st.markdown('<div class="section-header">CDO Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Churn Reduction -20%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - At-risk: **2,840** customers
                - Intervention rate: **75%** target
                - Revenue save: **£1.4M** projected
                - Model accuracy: **87% → 90%**
                """)
        
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">NBA Adoption 80%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **68%** agent adoption
                - Integration: CRM + app push
                - Conversion lift: **+12%** target
                - Upsell revenue: **£480K** Q1
                """)
        
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Real-Time ML</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Batch → streaming inference
                - Latency: **<100ms** predictions
                - Use cases: fraud, NBA, pricing
                - Launch: **March 2026**
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "Show churn risk distribution by segment and device type.",
            "Which features are driving the top 10% churn predictions?",
            "What is the uplift from NBA recommendations by channel?",
            "List customers with highest upsell propensity in the last 7 days.",
            "Compare model accuracy for prepaid vs postpaid cohorts."
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_cso_sustainability():
    import pandas as pd
    import altair as alt
    
    # CSO Header with Floating Leaves Effect
    st.markdown("""
    <style>
    @keyframes cso-leaf-fall {
        0% { transform: translateY(-20px) rotate(0deg); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(100px) rotate(360deg); opacity: 0; }
    }
    @keyframes cso-sway { 0%, 100% { transform: translateX(0) rotate(0deg); } 50% { transform: translateX(10px) rotate(5deg); } }
    .cso-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .cso-nature-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
    .cso-leaf { position: absolute; font-size: 20px; animation: cso-leaf-fall 6s ease-in-out infinite; }
    .cso-tree { position: absolute; font-size: 30px; opacity: 0.15; animation: cso-sway 4s ease-in-out infinite; }
    .cso-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%);
        border: 1px solid #BBF7D0;
        padding: 2rem; color: #166534;
    }
    .cso-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; color: #166534; }
    .cso-header-content p { margin: 0.5rem 0 0 0; color: #15803D; font-size: 1.1rem; }
    </style>
    <div class="cso-header-wrap">
        <div class="cso-nature-bg">
            <span class="cso-leaf" style="left: 8%; top: -5%; animation-delay: 0s;">🍃</span>
            <span class="cso-leaf" style="left: 20%; top: -10%; animation-delay: 1s;">🌿</span>
            <span class="cso-leaf" style="left: 35%; top: -8%; animation-delay: 2s;">🍃</span>
            <span class="cso-leaf" style="left: 50%; top: -12%; animation-delay: 3s;">🌱</span>
            <span class="cso-leaf" style="left: 65%; top: -6%; animation-delay: 4s;">🍃</span>
            <span class="cso-leaf" style="left: 80%; top: -15%; animation-delay: 0.5s;">🌿</span>
            <span class="cso-leaf" style="left: 92%; top: -8%; animation-delay: 1.5s;">🍃</span>
            <span class="cso-tree" style="left: 5%; bottom: 5%;">🌳</span>
            <span class="cso-tree" style="right: 8%; bottom: 5%; animation-delay: 2s;">🌲</span>
        </div>
        <div class="cso-header-content">
            <h1>CSO Sustainability & ESG Dashboard</h1>
            <p>Carbon Reduction, Renewable Energy & Net Zero Progress</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🌿 Operations & Impact", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['SUSTAINABILITY']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # CSO GREEN ENERGY ANIMATION
        st.markdown("""
        <style>
        @keyframes leaf-float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-10px) rotate(5deg); } }
        @keyframes eco-pulse { 0%, 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.3); } 50% { box-shadow: 0 0 25px rgba(16, 185, 129, 0.6); } }
        @keyframes fill-up { 0% { height: 0%; } 100% { height: var(--fill); } }
        @keyframes cso-meter-rise { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes cso-badge-pop { 0% { opacity: 0; transform: scale(0); } 50% { transform: scale(1.2); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cso-label-fade { 0% { opacity: 0; } 100% { opacity: 1; } }
        .cso-green { background: linear-gradient(135deg, #065F46 0%, #047857 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .green-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .green-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .green-badge { background: rgba(16,185,129,0.3); color: #10B981; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; animation: cso-badge-pop 0.5s ease-out forwards; }
        .eco-meters { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; }
        .eco-meter { text-align: center; animation: cso-meter-rise 0.6s ease-out forwards; opacity: 0; }
        .eco-meter:nth-child(2) { animation-delay: 0.1s; }
        .eco-meter:nth-child(3) { animation-delay: 0.2s; }
        .eco-meter:nth-child(4) { animation-delay: 0.3s; }
        .meter-container { width: 70px; height: 100px; background: rgba(0,0,0,0.2); border-radius: 35px; margin: 0 auto 0.5rem; position: relative; overflow: hidden; animation: eco-pulse 3s ease-in-out infinite; }
        .meter-fill { position: absolute; bottom: 0; width: 100%; border-radius: 0 0 35px 35px; animation: fill-up 2s ease-out forwards; }
        .meter-fill.renewable { background: linear-gradient(to top, #10B981, #34D399); --fill: 72%; }
        .meter-fill.carbon { background: linear-gradient(to top, #F59E0B, #FBBF24); --fill: 58%; animation-delay: 0.3s; }
        .meter-fill.waste { background: linear-gradient(to top, #3B82F6, #60A5FA); --fill: 85%; animation-delay: 0.6s; }
        .meter-fill.water { background: linear-gradient(to top, #06B6D4, #22D3EE); --fill: 67%; animation-delay: 0.9s; }
        .meter-icon { position: absolute; top: 8px; left: 50%; transform: translateX(-50%); font-size: 1.2rem; animation: leaf-float 3s ease-in-out infinite; z-index: 2; }
        .meter-val { color: white; font-size: 1.3rem; font-weight: 700; }
        .meter-label { color: rgba(255,255,255,0.7); font-size: 0.7rem; text-transform: uppercase; }
        .meter-target { color: rgba(255,255,255,0.5); font-size: 0.65rem; margin-top: 0.2rem; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="cso-green"><div class="green-header"><div class="green-title">🌱 Sustainability Metrics</div><div class="green-badge">Net Zero 2030</div></div><div class="eco-meters"><div class="eco-meter"><div class="meter-container"><div class="meter-icon">🌿</div><div class="meter-fill renewable"></div></div><div class="meter-val">72%</div><div class="meter-label">Renewable Energy</div><div class="meter-target">Target: 100%</div></div><div class="eco-meter"><div class="meter-container"><div class="meter-icon">🏭</div><div class="meter-fill carbon"></div></div><div class="meter-val">-42%</div><div class="meter-label">Carbon Reduction</div><div class="meter-target">vs 2019 baseline</div></div><div class="eco-meter"><div class="meter-container"><div class="meter-icon">♻️</div><div class="meter-fill waste"></div></div><div class="meter-val">85%</div><div class="meter-label">Waste Recycled</div><div class="meter-target">Target: 95%</div></div><div class="eco-meter"><div class="meter-container"><div class="meter-icon">💧</div><div class="meter-fill water"></div></div><div class="meter-val">-33%</div><div class="meter-label">Water Usage</div><div class="meter-target">vs 2020</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .kpi-card:hover {
            border-color: #29B5E8;
            box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
        }
        .kpi-label {
            font-size: 0.8rem;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1B2A4E;
            line-height: 1.1;
        }
        .kpi-delta {
            display: inline-flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        @keyframes cso-line-pulse { 
            0%, 100% { stroke-width: 2; opacity: 1; } 
            50% { stroke-width: 3.5; opacity: 0.8; } 
        }
        @keyframes cso-fill-pulse { 
            0%, 100% { opacity: 0.15; transform: scaleY(1); } 
            50% { opacity: 0.25; transform: scaleY(1.02); } 
        }
        @keyframes cso-bar-wave { 
            0%, 100% { transform: scaleY(1); } 
            50% { transform: scaleY(0.7); } 
        }
        .kpi-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.15;
        }
        .kpi-chart path[fill="none"] { animation: cso-line-pulse 2s ease-in-out infinite; }
        .kpi-chart path[fill]:not([fill="none"]) { transform-origin: bottom; animation: cso-fill-pulse 3s ease-in-out infinite; }
        .kpi-chart rect { transform-origin: bottom; animation: cso-bar-wave 1.5s ease-in-out infinite; }
        .kpi-card:nth-child(1) .kpi-chart path, .kpi-card:nth-child(1) .kpi-chart rect { animation-delay: 0s; }
        .kpi-card:nth-child(2) .kpi-chart path, .kpi-card:nth-child(2) .kpi-chart rect { animation-delay: 0.2s; }
        .kpi-card:nth-child(3) .kpi-chart path, .kpi-card:nth-child(3) .kpi-chart rect { animation-delay: 0.4s; }
        .kpi-card:nth-child(4) .kpi-chart path, .kpi-card:nth-child(4) .kpi-chart rect { animation-delay: 0.6s; }
        .kpi-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Sustainability Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">🌿</div>
                <div class="kpi-label">Renewable Energy</div>
                <div class="kpi-value">65%</div>
                <div class="kpi-delta positive">↑ +12% YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,35 L20,32 L40,28 L60,22 L80,18 L100,12" fill="none" stroke="#10B981" stroke-width="2"/>
                    <path d="M0,35 L20,32 L40,28 L60,22 L80,18 L100,12 L100,40 L0,40 Z" fill="#10B981"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #3B82F6;">
                <div class="kpi-icon">⚡</div>
                <div class="kpi-label">Energy Consumption</div>
                <div class="kpi-value">48.2 GWh</div>
                <div class="kpi-delta positive">↓ -8% YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,15 L20,18 L40,22 L60,26 L80,30 L100,32" fill="none" stroke="#3B82F6" stroke-width="2"/>
                    <path d="M0,15 L20,18 L40,22 L60,26 L80,30 L100,32 L100,40 L0,40 Z" fill="#3B82F6"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">🏭</div>
                <div class="kpi-label">Carbon Emissions</div>
                <div class="kpi-value">12.4K tCO₂e</div>
                <div class="kpi-delta positive">↓ -15% YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <path d="M0,12 L20,16 L40,20 L60,24 L80,28 L100,34" fill="none" stroke="#6366F1" stroke-width="2"/>
                    <path d="M0,12 L20,16 L40,20 L60,24 L80,28 L100,34 L100,40 L0,40 Z" fill="#6366F1"/>
                </svg>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">PUE Ratio</div>
                <div class="kpi-value">1.42</div>
                <div class="kpi-delta positive">↓ -0.08 YoY</div>
                <svg class="kpi-chart" viewBox="0 0 100 40" preserveAspectRatio="none">
                    <rect x="5" y="30" width="12" height="10" fill="#F59E0B"/>
                    <rect x="22" y="26" width="12" height="14" fill="#F59E0B"/>
                    <rect x="39" y="22" width="12" height="18" fill="#F59E0B"/>
                    <rect x="56" y="20" width="12" height="20" fill="#F59E0B"/>
                    <rect x="73" y="16" width="12" height="24" fill="#F59E0B"/>
                </svg>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🎯</div>
                <div class="kpi-label">Net Zero Progress</div>
                <div class="kpi-value">42%</div>
                <div class="kpi-delta positive">On track for 2035</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">♻️</div>
                <div class="kpi-label">E-Waste Recycled</div>
                <div class="kpi-value">94%</div>
                <div class="kpi-delta positive">↑ +6% YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">🌱</div>
                <div class="kpi-label">Green Tariff Customers</div>
                <div class="kpi-value">8,420</div>
                <div class="kpi-delta positive">28% of base</div>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">🏢</div>
                <div class="kpi-label">Sites Monitored</div>
                <div class="kpi-value">475</div>
                <div class="kpi-delta neutral">100% coverage</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake** — ESG metrics aggregated from 475+ sites using Snowflake Data Sharing for regulatory reporting and stakeholder transparency")
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Renewable Energy Progress</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600; color: #1B2A4E;">2024 Target: 70% Renewable</span>
                        <span style="font-weight: 700; color: #10B981;">65% Achieved</span>
                    </div>
                    <div style="background: #E5E7EB; border-radius: 8px; height: 32px; position: relative; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #10B981, #34D399); width: 65%; height: 100%; border-radius: 8px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.75rem;">
                            <span style="color: white; font-weight: 600; font-size: 0.85rem;">65%</span>
                        </div>
                        <div style="position: absolute; left: 70%; top: 0; bottom: 0; border-left: 3px dashed #1B2A4E; opacity: 0.5;"></div>
                        <span style="position: absolute; left: 70%; top: -18px; font-size: 0.65rem; color: #6B7280; transform: translateX(-50%);">Target</span>
                    </div>
                </div>
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 100px; font-weight: 600; color: #10B981;">Solar PV</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem;">
                            <div style="background: linear-gradient(90deg, #FBBF24, #F59E0B); width: 35%; height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 0.5rem;">
                                <span style="color: white; font-size: 0.7rem; font-weight: 600;">35%</span>
                            </div>
                        </div>
                        <span style="width: 70px; text-align: right; font-size: 0.8rem; color: #6B7280;">16.9 GWh</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 100px; font-weight: 600; color: #10B981;">Wind Power</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem;">
                            <div style="background: linear-gradient(90deg, #3B82F6, #60A5FA); width: 20%; height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 0.5rem;">
                                <span style="color: white; font-size: 0.7rem; font-weight: 600;">20%</span>
                            </div>
                        </div>
                        <span style="width: 70px; text-align: right; font-size: 0.8rem; color: #6B7280;">9.6 GWh</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #F3F4F6;">
                        <span style="width: 100px; font-weight: 600; color: #10B981;">Grid Green</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem;">
                            <div style="background: linear-gradient(90deg, #10B981, #34D399); width: 10%; height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 0.5rem;">
                                <span style="color: white; font-size: 0.7rem; font-weight: 600;">10%</span>
                            </div>
                        </div>
                        <span style="width: 70px; text-align: right; font-size: 0.8rem; color: #6B7280;">4.8 GWh</span>
                    </div>
                    <div style="display: flex; align-items: center; padding: 0.5rem 0;">
                        <span style="width: 100px; font-weight: 600; color: #6B7280;">Grid (Non-Ren)</span>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 20px; margin: 0 0.75rem;">
                            <div style="background: linear-gradient(90deg, #9CA3AF, #D1D5DB); width: 35%; height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 0.5rem;">
                                <span style="color: white; font-size: 0.7rem; font-weight: 600;">35%</span>
                            </div>
                        </div>
                        <span style="width: 70px; text-align: right; font-size: 0.8rem; color: #6B7280;">16.9 GWh</span>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: #D1FAE5; border-radius: 8px; text-align: center; font-size: 0.85rem;">
                    <span style="color: #065F46;">🌿 <strong>5% gap to 2024 target</strong> — Solar expansion in progress for Q2</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Energy Consumption by Site Type</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem; color: #6B7280;">Site Type</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Sites</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Energy (GWh)</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Avg/Site</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Efficiency</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #EF4444;">●</span> Macro Cell</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">185</td>
                            <td style="text-align: right; padding: 0.5rem;">32.4</td>
                            <td style="text-align: right; padding: 0.5rem;">175 MWh</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Medium</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #10B981;">●</span> Small Cell</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">240</td>
                            <td style="text-align: right; padding: 0.5rem;">8.6</td>
                            <td style="text-align: right; padding: 0.5rem;">36 MWh</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">High</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #3B82F6;">●</span> Data Centre</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">3</td>
                            <td style="text-align: right; padding: 0.5rem;">5.8</td>
                            <td style="text-align: right; padding: 0.5rem;">1,933 MWh</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">Review</span></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;"><span style="color: #8B5CF6;">●</span> Office/Retail</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">47</td>
                            <td style="text-align: right; padding: 0.5rem;">1.4</td>
                            <td style="text-align: right; padding: 0.5rem;">30 MWh</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">High</span></td>
                        </tr>
                    </tbody>
                </table>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #E0F2FE; border-radius: 8px; font-size: 0.8rem;">
                    <span style="color: #0369A1;">💡 Small cells are <strong>4.8x more energy efficient</strong> per unit than macro cells</span>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Carbon Emissions Trend</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.6rem; border-left: 4px solid #EF4444; background: #FEE2E2; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #DC2626;">2022 (Baseline)</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Pre-initiative</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #DC2626;">18.2K tCO₂e</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">2023</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">↓ 20% reduction</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #F59E0B;">14.6K tCO₂e</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #10B981; background: #D1FAE5; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #065F46;">2024 YTD</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">↓ 32% from baseline</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #10B981;">12.4K tCO₂e</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #29B5E8; background: #E0F2FE; border-radius: 0 8px 8px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #0369A1;">2035 Target</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Net Zero</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #29B5E8;">0 tCO₂e</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">PUE by Facility</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>London DC (Primary)</span>
                        <span style="font-weight: 700; background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">PUE: 1.35</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Manchester DC</span>
                        <span style="font-weight: 700; background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">PUE: 1.48</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Birmingham DC</span>
                        <span style="font-weight: 700; background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">PUE: 1.52</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span style="font-weight: 600;">Network Average</span>
                        <span style="font-weight: 700; background: #E0F2FE; color: #0369A1; padding: 0.2rem 0.5rem; border-radius: 12px;">PUE: 1.42</span>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #F3F4F6; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #6B7280;">Industry benchmark: 1.58 · Target: 1.30 by 2026</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">E-Waste Management</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                    <div style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #065F46;">Recycled</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #065F46;">94%</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">847 tonnes</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #E0F2FE 0%, #F0F9FF 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #0369A1;">Refurbished</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #0369A1;">4,200</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">Devices reused</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #92400E;">Landfill Diverted</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #92400E;">98%</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">Near zero waste</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #EDE9FE 0%, #F5F3FF 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #5B21B6;">CO₂ Avoided</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #5B21B6;">1,240t</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">Via recycling</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Net Zero Roadmap Progress</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            col_chart, col_legend = st.columns([2, 1])
            
            with col_chart:
                # Net Zero Progress Data
                years = ['2022', '2023', '2024', 'Now', '2030', '2035']
                net_zero_data = pd.DataFrame({
                    'Year': years,
                    'Progress': [0, 17, 32, 42, 72, 100],
                    'Type': ['Actual', 'Actual', 'Actual', 'Actual', 'Projected', 'Target'],
                    'Label': ['Baseline', '17%', '32%', '42%', '72%', '100%']
                })
                
                # Actual progress (solid line)
                actual_data = net_zero_data[net_zero_data['Type'] == 'Actual']
                projected_data = net_zero_data[net_zero_data['Year'].isin(['Now', '2030', '2035'])]
                
                # Create layered chart
                base = alt.Chart(net_zero_data).encode(
                    x=alt.X('Year:N', sort=years, axis=alt.Axis(labelAngle=0, title=None))
                )
                
                # Actual progress line
                actual_line = alt.Chart(actual_data).mark_line(
                    strokeWidth=4, color='#10B981'
                ).encode(
                    x=alt.X('Year:N', sort=years),
                    y=alt.Y('Progress:Q', scale=alt.Scale(domain=[0, 110]), axis=alt.Axis(title='% to Net Zero', format='d'))
                )
                
                # Projected line (dashed)
                projected_line = alt.Chart(projected_data).mark_line(
                    strokeWidth=3, color='#10B981', strokeDash=[6, 4]
                ).encode(
                    x=alt.X('Year:N', sort=years),
                    y=alt.Y('Progress:Q')
                )
                
                # Points
                points = base.mark_circle(size=150).encode(
                    y=alt.Y('Progress:Q'),
                    color=alt.Color('Type:N', scale=alt.Scale(
                        domain=['Actual', 'Projected', 'Target'],
                        range=['#10B981', '#29B5E8', '#10B981']
                    ), legend=None),
                    tooltip=['Year:N', alt.Tooltip('Progress:Q', title='Progress', format='d%'), 'Type:N']
                )
                
                # Labels
                labels = base.mark_text(dy=-15, fontSize=11, fontWeight='bold').encode(
                    y=alt.Y('Progress:Q'),
                    text='Label:N',
                    color=alt.value('#1B2A4E')
                )
                
                # Target line
                target_rule = alt.Chart(pd.DataFrame({'y': [100]})).mark_rule(
                    color='#10B981', strokeDash=[4, 4], opacity=0.5
                ).encode(y='y:Q')
                
                combined_chart = (actual_line + projected_line + points + labels + target_rule).properties(height=180)
                st.altair_chart(combined_chart, use_container_width=True)
            
            with col_legend:
                st.markdown("""
                <div style="font-size: 0.75rem; color: #6B7280; margin-bottom: 0.75rem;">Milestones</div>
                <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                    <div style="width: 12px; height: 12px; background: #EF4444; border-radius: 50%; margin-right: 0.5rem;"></div>
                    <span style="font-size: 0.8rem;"><strong>2022:</strong> Baseline set</span>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                    <div style="width: 12px; height: 12px; background: #F59E0B; border-radius: 50%; margin-right: 0.5rem;"></div>
                    <span style="font-size: 0.8rem;"><strong>2024:</strong> 32% reduction</span>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                    <div style="width: 12px; height: 12px; background: #10B981; border-radius: 50%; margin-right: 0.5rem;"></div>
                    <span style="font-size: 0.8rem;"><strong>Now:</strong> 42% complete</span>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <div style="width: 12px; height: 12px; background: #29B5E8; border-radius: 50%; margin-right: 0.5rem;"></div>
                    <span style="font-size: 0.8rem;"><strong>2035:</strong> Net Zero</span>
                </div>
                <div style="padding: 0.5rem; background: #D1FAE5; border-radius: 6px; text-align: center; font-size: 0.75rem;">
                    <span style="color: #065F46;">✓ On track to target</span>
                </div>
                """, unsafe_allow_html=True)
        
        col_site, col_carbon = st.columns(2)
        
        with col_site:
            st.markdown('<div class="section-header">Top Energy Consuming Sites</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>London DC (Primary)</span>
                            <span style="font-weight: 600;">2,450 MWh</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #3B82F6, #60A5FA); width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Manchester DC</span>
                            <span style="font-weight: 600;">1,840 MWh</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #3B82F6, #60A5FA); width: 75%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Birmingham DC</span>
                            <span style="font-weight: 600;">1,510 MWh</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #3B82F6, #60A5FA); width: 62%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Leeds Macro Cluster</span>
                            <span style="font-weight: 600;">890 MWh</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 36%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Glasgow Macro Cluster</span>
                            <span style="font-weight: 600;">720 MWh</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 29%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Other Sites (465)</span>
                            <span style="font-weight: 600;">40,790 MWh</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #10B981, #34D399); width: 85%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_carbon:
            st.markdown('<div class="section-header">Carbon Intensity by Region</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1rem;">
                        <div style="background: #FEE2E2; border-radius: 8px; padding: 0.75rem; text-align: center;">
                            <div style="font-size: 0.7rem; color: #DC2626;">Midlands</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #DC2626;">284</div>
                            <div style="font-size: 0.65rem; color: #6B7280;">gCO₂/kWh</div>
                        </div>
                        <div style="background: #FEF3C7; border-radius: 8px; padding: 0.75rem; text-align: center;">
                            <div style="font-size: 0.7rem; color: #92400E;">North</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #F59E0B;">248</div>
                            <div style="font-size: 0.65rem; color: #6B7280;">gCO₂/kWh</div>
                        </div>
                        <div style="background: #D1FAE5; border-radius: 8px; padding: 0.75rem; text-align: center;">
                            <div style="font-size: 0.7rem; color: #065F46;">Scotland</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #10B981;">156</div>
                            <div style="font-size: 0.65rem; color: #6B7280;">gCO₂/kWh</div>
                        </div>
                        <div style="background: #E0F2FE; border-radius: 8px; padding: 0.75rem; text-align: center;">
                            <div style="font-size: 0.7rem; color: #0369A1;">South</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #0369A1;">198</div>
                            <div style="font-size: 0.65rem; color: #6B7280;">gCO₂/kWh</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-around; font-size: 0.75rem; padding: 0.5rem; background: #F9FAFB; border-radius: 6px;">
                        <div style="text-align: center;">
                            <div style="color: #6B7280;">UK Average</div>
                            <div style="font-weight: 700; color: #1B2A4E;">212 g/kWh</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #6B7280;">Our Average</div>
                            <div style="font-weight: 700; color: #10B981;">221 g/kWh</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #6B7280;">Target</div>
                            <div style="font-weight: 700; color: #29B5E8;">180 g/kWh</div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">ESG Scorecard</div>', unsafe_allow_html=True)
        
        with st.container(border=True):
            st.markdown("""
            <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem;">
                <thead>
                    <tr style="border-bottom: 2px solid #E5E7EB; background: #F9FAFB;">
                        <th style="text-align: left; padding: 0.6rem; color: #6B7280;">ESG Metric</th>
                        <th style="text-align: center; padding: 0.6rem; color: #6B7280;">Category</th>
                        <th style="text-align: right; padding: 0.6rem; color: #6B7280;">2023</th>
                        <th style="text-align: right; padding: 0.6rem; color: #6B7280;">2024 YTD</th>
                        <th style="text-align: right; padding: 0.6rem; color: #6B7280;">Target</th>
                        <th style="text-align: right; padding: 0.6rem; color: #6B7280;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom: 1px solid #F3F4F6;">
                        <td style="padding: 0.6rem; font-weight: 600;">Carbon Emissions (Scope 1+2)</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">Environmental</span></td>
                        <td style="text-align: right; padding: 0.6rem;">14.6K tCO₂e</td>
                        <td style="text-align: right; padding: 0.6rem;">12.4K tCO₂e</td>
                        <td style="text-align: right; padding: 0.6rem;">13.0K</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">✓ Ahead</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid #F3F4F6;">
                        <td style="padding: 0.6rem; font-weight: 600;">Renewable Energy %</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">Environmental</span></td>
                        <td style="text-align: right; padding: 0.6rem;">53%</td>
                        <td style="text-align: right; padding: 0.6rem;">65%</td>
                        <td style="text-align: right; padding: 0.6rem;">70%</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">→ On Track</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid #F3F4F6;">
                        <td style="padding: 0.6rem; font-weight: 600;">E-Waste Recycling Rate</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">Environmental</span></td>
                        <td style="text-align: right; padding: 0.6rem;">88%</td>
                        <td style="text-align: right; padding: 0.6rem;">94%</td>
                        <td style="text-align: right; padding: 0.6rem;">90%</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">✓ Ahead</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid #F3F4F6;">
                        <td style="padding: 0.6rem; font-weight: 600;">Gender Diversity (Leadership)</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #EDE9FE; color: #5B21B6; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">Social</span></td>
                        <td style="text-align: right; padding: 0.6rem;">38%</td>
                        <td style="text-align: right; padding: 0.6rem;">42%</td>
                        <td style="text-align: right; padding: 0.6rem;">45%</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">→ On Track</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid #F3F4F6;">
                        <td style="padding: 0.6rem; font-weight: 600;">Employee Safety (LTIR)</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #EDE9FE; color: #5B21B6; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">Social</span></td>
                        <td style="text-align: right; padding: 0.6rem;">0.42</td>
                        <td style="text-align: right; padding: 0.6rem;">0.38</td>
                        <td style="text-align: right; padding: 0.6rem;"><0.40</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">✓ Ahead</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 0.6rem; font-weight: 600;">Supplier ESG Compliance</td>
                        <td style="text-align: center; padding: 0.6rem;"><span style="background: #E0F2FE; color: #0369A1; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem;">Governance</span></td>
                        <td style="text-align: right; padding: 0.6rem;">72%</td>
                        <td style="text-align: right; padding: 0.6rem;">84%</td>
                        <td style="text-align: right; padding: 0.6rem;">80%</td>
                        <td style="text-align: right; padding: 0.6rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 8px; font-weight: 600;">✓ Ahead</span></td>
                    </tr>
                </tbody>
            </table>
            <div style="margin-top: 0.75rem; padding: 0.5rem; background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-radius: 6px; font-size: 0.8rem; text-align: center;">
                <span style="color: #065F46;">🌍 <strong>Overall ESG Score: 78/100</strong> — Top quartile in UK Telecoms · MSCI Rating: A</span>
            </div>
            """, unsafe_allow_html=True)
        
        col_exp1, col_exp2, col_exp3, col_exp4 = st.columns(4)
        
        with col_exp1:
            st.markdown('<div class="section-header">Green Customers</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #10B981;">8,420</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">Green Tariff Subs</div>
                    <div style="margin-top: 0.5rem; font-size: 0.75rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>% of Base</span>
                            <span style="color: #10B981;">28%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>YoY Growth</span>
                            <span style="color: #10B981;">+42%</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_exp2:
            st.markdown('<div class="section-header">Water Usage</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #3B82F6;">12.4K</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">m³ Consumed</div>
                    <div style="margin-top: 0.5rem; font-size: 0.75rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>vs 2023</span>
                            <span style="color: #10B981;">-8%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Recycled</span>
                            <span style="color: #10B981;">45%</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_exp3:
            st.markdown('<div class="section-header">Fleet Emissions</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #F59E0B;">34%</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">EV Fleet</div>
                    <div style="margin-top: 0.5rem; font-size: 0.75rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Vehicles</span>
                            <span style="color: #1B2A4E;">142/420</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>2025 Target</span>
                            <span style="color: #29B5E8;">50%</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_exp4:
            st.markdown('<div class="section-header">Supply Chain</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #8B5CF6;">84%</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">ESG Compliant</div>
                    <div style="margin-top: 0.5rem; font-size: 0.75rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Suppliers</span>
                            <span style="color: #1B2A4E;">168/200</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Audited</span>
                            <span style="color: #10B981;">92%</span>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        

    with tab_ops:
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['ENERGY', 'CARBON', 'ESG']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        @keyframes cso-ops-sweep { 0% { transform: translateX(-120%); opacity: 0; } 25% { opacity: 0.6; } 100% { transform: translateX(120%); opacity: 0; } }
        @keyframes cso-ops-glow { 0%, 100% { box-shadow: 0 0 0 rgba(16,185,129,0.25); } 50% { box-shadow: 0 0 16px rgba(16,185,129,0.45); } }
        .cso-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, #059669 0%, #10B981 100%);
            color: white;
            margin-bottom: 1.5rem;
            animation: cso-ops-glow 2.8s ease-in-out infinite;
        }
        .cso-ops-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -50%;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: cso-ops-sweep 3.4s ease-in-out infinite;
        }
        .cso-ops-title { font-weight: 700; font-size: 1rem; position: relative; z-index: 1; }
        .cso-ops-sub { font-size: 0.85rem; opacity: 0.85; position: relative; z-index: 1; }
        .cso-ops-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-top: 0.9rem; position: relative; z-index: 1; }
        .cso-ops-card { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25); border-radius: 10px; padding: 0.6rem 0.75rem; }
        .cso-ops-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.06em; color: rgba(255,255,255,0.7); }
        .cso-ops-value { font-size: 1.2rem; font-weight: 700; color: #FFFFFF; margin-top: 0.2rem; }
        .cso-ops-delta { font-size: 0.7rem; color: rgba(255,255,255,0.85); margin-top: 0.15rem; }
        @media (max-width: 900px) { .cso-ops-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="cso-ops-pulse">
            <div class="cso-ops-title">🌿 Operations & Impact Pulse</div>
            <div class="cso-ops-sub">Energy, emissions, and ESG compliance signals across the footprint.</div>
            <div class="cso-ops-grid">
                <div class="cso-ops-card">
                    <div class="cso-ops-label">Renewables</div>
                    <div class="cso-ops-value">65%</div>
                    <div class="cso-ops-delta">↑ +12% YoY</div>
                </div>
                <div class="cso-ops-card">
                    <div class="cso-ops-label">Emissions</div>
                    <div class="cso-ops-value">12.4K tCO₂e</div>
                    <div class="cso-ops-delta">↓ -15% YoY</div>
                </div>
                <div class="cso-ops-card">
                    <div class="cso-ops-label">PUE</div>
                    <div class="cso-ops-value">1.42</div>
                    <div class="cso-ops-delta">Target 1.30</div>
                </div>
                <div class="cso-ops-card">
                    <div class="cso-ops-label">Supplier ESG</div>
                    <div class="cso-ops-value">84%</div>
                    <div class="cso-ops-delta">Tier 2 focus</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Energy & Emissions Operations</div>', unsafe_allow_html=True)
        ops_left, ops_right = st.columns(2)
        
        with ops_left:
            st.markdown("**Energy Consumption by Site Type**")
            with st.container(border=True):
                energy_df = pd.DataFrame({
                    'Site Type': ['Macro Sites', 'Small Cells', 'Data Centers', 'Offices'],
                    'MWh': [18400, 6200, 9800, 2100]
                })
                energy_chart = alt.Chart(energy_df).mark_bar(color='#10B981', cornerRadiusEnd=6).encode(
                    x=alt.X('MWh:Q', title='MWh (Monthly)'),
                    y=alt.Y('Site Type:N', sort='-x', title=None),
                    tooltip=['Site Type:N', 'MWh:Q']
                ).properties(height=220)
                st.altair_chart(energy_chart, use_container_width=True)
                st.caption("Macro sites account for 52% of total energy load.")
        
        with ops_right:
            st.markdown("**Emissions Trend (12 Months)**")
            with st.container(border=True):
                emissions_df = pd.DataFrame({
                    'Month': ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
                    'tCO2e': [1200, 1180, 1165, 1152, 1128, 1105, 1092, 1080, 1068, 1050, 1036, 1022]
                })
                emissions_line = alt.Chart(emissions_df).mark_line(color='#059669', strokeWidth=2).encode(
                    x=alt.X('Month:N', title=None),
                    y=alt.Y('tCO2e:Q', title='tCO₂e')
                )
                emissions_area = alt.Chart(emissions_df).mark_area(color='rgba(16,185,129,0.2)').encode(
                    x='Month:N',
                    y='tCO2e:Q'
                )
                st.altair_chart((emissions_area + emissions_line).properties(height=220), use_container_width=True)
                st.caption("Emissions down 15% YoY with renewable ramp-up.")
        
        st.markdown('<div class="section-header">Renewables & Water Stewardship</div>', unsafe_allow_html=True)
        mix_left, mix_right = st.columns(2)
        
        with mix_left:
            st.markdown("**Renewable Mix**")
            with st.container(border=True):
                mix_df = pd.DataFrame({
                    'Source': ['Solar', 'Wind', 'Hydro', 'Grid'],
                    'Share': [28, 22, 15, 35]
                })
                donut = alt.Chart(mix_df).mark_arc(innerRadius=50, outerRadius=90).encode(
                    theta=alt.Theta('Share:Q'),
                    color=alt.Color('Source:N', scale=alt.Scale(range=['#10B981', '#22C55E', '#34D399', '#9CA3AF']), legend=None),
                    tooltip=['Source:N', 'Share:Q']
                ).properties(height=220)
                st.altair_chart(donut, use_container_width=True)
                st.caption("Renewables now represent 65% of total energy.")
        
        with mix_right:
            st.markdown("**Water Usage by Region**")
            with st.container(border=True):
                water_df = pd.DataFrame({
                    'Region': ['London', 'Midlands', 'North', 'Scotland', 'Wales'],
                    'MLiters': [5.2, 3.8, 3.1, 2.6, 2.2]
                })
                water_chart = alt.Chart(water_df).mark_bar(color='#0EA5E9', cornerRadiusEnd=6).encode(
                    x=alt.X('MLiters:Q', title='ML (Quarterly)'),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    tooltip=['Region:N', 'MLiters:Q']
                ).properties(height=220)
                st.altair_chart(water_chart, use_container_width=True)
                st.caption("Water intensity improves as cooling upgrades roll out.")
        
        st.markdown('<div class="section-header">Compliance & Supplier ESG</div>', unsafe_allow_html=True)
        comp_left, comp_right = st.columns(2)
        
        with comp_left:
            st.markdown("**Regulatory Reporting Readiness**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;"><span>Scope 1+2 reporting</span><span style="font-weight: 600;">96%</span></div>
                    <div style="background: #E5E7EB; border-radius: 6px; height: 10px; margin-bottom: 0.6rem;">
                        <div style="background: #10B981; width: 96%; height: 100%; border-radius: 6px;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;"><span>Scope 3 coverage</span><span style="font-weight: 600;">82%</span></div>
                    <div style="background: #E5E7EB; border-radius: 6px; height: 10px; margin-bottom: 0.6rem;">
                        <div style="background: #F59E0B; width: 82%; height: 100%; border-radius: 6px;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;"><span>EU CSRD alignment</span><span style="font-weight: 600;">88%</span></div>
                    <div style="background: #E5E7EB; border-radius: 6px; height: 10px;">
                        <div style="background: #3B82F6; width: 88%; height: 100%; border-radius: 6px;"></div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with comp_right:
            st.markdown("**Supplier ESG Compliance**")
            with st.container(border=True):
                supplier_df = pd.DataFrame({
                    'Tier': ['Tier 1', 'Tier 2', 'Tier 3'],
                    'Compliance': [92, 84, 76]
                }).set_index('Tier')
                st.bar_chart(supplier_df, height=220, color="#8B5CF6")
                st.caption("Tier 2 remediation plan scheduled for Q2.")

    with tab_strategy:
        st.markdown("""
        <style>
        .cso-ai-pulse {
            background: linear-gradient(135deg, #ECFEFF 0%, #CFFAFE 100%);
            border-radius: 16px;
            border: 1px solid #A5F3FC;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .cso-ai-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(14,116,144,0.18), transparent);
            animation: cso-ai-sweep 4s ease-in-out infinite;
        }
        @keyframes cso-ai-sweep { 0% { left: -120%; } 100% { left: 220%; } }
        .cso-ai-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .cso-ai-title { font-weight: 700; color: #0E7490; font-size: 1.05rem; }
        .cso-ai-tag { background: #0284C7; color: white; font-size: 0.75rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 999px; }
        .cso-ai-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.9rem; position: relative; z-index: 1; }
        .cso-ai-card { background: white; border-radius: 12px; border: 1px solid #A5F3FC; padding: 0.85rem 0.95rem; }
        .cso-ai-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9CA3AF; }
        .cso-ai-value { font-size: 1.3rem; font-weight: 700; color: #0E7490; }
        .cso-ai-sub { font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) { .cso-ai-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="cso-ai-pulse">
            <div class="cso-ai-header">
                <div class="cso-ai-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="cso-ai-tag">AI LIVE</div>
            </div>
            <div class="cso-ai-grid">
                <div class="cso-ai-card">
                    <div class="cso-ai-label">Renewables</div>
                    <div class="cso-ai-value">65%</div>
                    <div class="cso-ai-sub">Target 70%</div>
                </div>
                <div class="cso-ai-card">
                    <div class="cso-ai-label">Carbon Reduction</div>
                    <div class="cso-ai-value">-42%</div>
                    <div class="cso-ai-sub">vs 2019 baseline</div>
                </div>
                <div class="cso-ai-card">
                    <div class="cso-ai-label">PUE Average</div>
                    <div class="cso-ai-value">1.42</div>
                    <div class="cso-ai-sub">Target 1.30</div>
                </div>
                <div class="cso-ai-card">
                    <div class="cso-ai-label">Supplier ESG</div>
                    <div class="cso-ai-value">84%</div>
                    <div class="cso-ai-sub">Tier 2 focus</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Summary synthesized from energy, emissions, and ESG compliance data.")
        
        with st.container(border=True):
            st.markdown("""
            **Executive Summary (Q1 2026):**
            - Renewable energy reached **65%**, on track to hit 70% target.
            - Emissions are **down 15% YoY** with data center efficiency gains.
            - Supply chain compliance improved to **84%**, with Tier 2 remediation planned.
            """)
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Macro sites** drive 52% of energy load
                - **Wind + solar** deliver 50% of renewables
                - **Water intensity** down in London and North
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Network features** closest to SLA thresholds
                - **Tier 2 suppliers** below 85% compliance
                - **PUE** above target in Manchester DC
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Growth Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Solar expansion** adds +5% renewables
                - **Fleet EV** rollout to 50% by 2025
                - **Energy efficiency** saves £180K/year
                """)
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                - **Accelerate renewables** via PPAs in top 3 regions
                - Prioritize sites with >1.5 PUE
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                - **Reduce water intensity** with closed-loop cooling
                - Target 10% reduction by Q4
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                - **Improve supplier ESG** with quarterly audits
                - Enforce Tier 2 remediation milestones
                """)
        
        st.markdown('<div class="section-header">CSO Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Renewable Energy 70%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **65%** renewable
                - Gap: **5%** to target
                - Action: Solar expansion Q2
                - Investment: **£2.4M** approved
                """)
        
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">PUE Improvement</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **1.42** average
                - Target: **1.30** by 2026
                - Focus: Manchester DC cooling
                - Savings: **£180K/year** energy
                """)
        
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Fleet Electrification</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **34%** EV fleet
                - Target: **50%** by end 2025
                - Vehicles: +70 EVs planned
                - CO₂ reduction: **-420 tonnes**
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "What's our total energy consumption this year?",
            "What percentage of our energy comes from renewable sources?",
            "Show me our carbon emissions trend.",
            "Which sites consume the most energy?",
            "What's our average PUE ratio?",
            "Compare energy consumption by site type.",
            "What's our progress toward net zero?",
            "How many customers are on green tariffs?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_customer_service():
    import pandas as pd
    import altair as alt
    
    # VP Customer Service Header with Chat Bubbles Effect
    st.markdown("""
    <style>
    @keyframes cs-bubble-rise { 0% { transform: translateY(20px) scale(0); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-30px) scale(1); opacity: 0; } }
    @keyframes cs-typing { 0%, 60%, 100% { opacity: 0.3; } 30% { opacity: 1; } }
    .cs-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .cs-bubbles-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; opacity: 0.25; }
    .cs-bubble { position: absolute; font-size: 24px; animation: cs-bubble-rise 4s ease-out infinite; }
    .cs-typing-dot { display: inline-block; width: 8px; height: 8px; background: white; border-radius: 50%; margin: 0 2px; animation: cs-typing 1.5s ease-in-out infinite; }
    .cs-typing-indicator { position: absolute; display: flex; }
    .cs-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(-45deg, #0EA5E9, #0284C7, #0369A1, #075985);
        background-size: 400% 400%;
        animation: gradient-shift 12s ease infinite;
        padding: 2rem; color: white;
    }
    .cs-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; }
    .cs-header-content p { margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 1.1rem; }
    </style>
    <div class="cs-header-wrap">
        <div class="cs-bubbles-bg">
            <span class="cs-bubble" style="left: 8%; bottom: 10%; animation-delay: 0s;">💬</span>
            <span class="cs-bubble" style="left: 22%; bottom: 15%; animation-delay: 0.8s;">💬</span>
            <span class="cs-bubble" style="left: 38%; bottom: 8%; animation-delay: 1.6s;">💬</span>
            <span class="cs-bubble" style="left: 55%; bottom: 12%; animation-delay: 2.4s;">💬</span>
            <span class="cs-bubble" style="left: 72%; bottom: 10%; animation-delay: 3.2s;">💬</span>
            <span class="cs-bubble" style="left: 88%; bottom: 15%; animation-delay: 0.4s;">💬</span>
            <div class="cs-typing-indicator" style="left: 15%; top: 25%;">
                <span class="cs-typing-dot" style="animation-delay: 0s;"></span>
                <span class="cs-typing-dot" style="animation-delay: 0.2s;"></span>
                <span class="cs-typing-dot" style="animation-delay: 0.4s;"></span>
            </div>
            <div class="cs-typing-indicator" style="right: 20%; top: 35%;">
                <span class="cs-typing-dot" style="animation-delay: 0.5s;"></span>
                <span class="cs-typing-dot" style="animation-delay: 0.7s;"></span>
                <span class="cs-typing-dot" style="animation-delay: 0.9s;"></span>
            </div>
        </div>
        <div class="cs-header-content">
            <h1>VP Customer Service Dashboard</h1>
            <p>Contact Centre Operations, Ticket Management & CSAT Analytics</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧭 Service Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['SUPPORT', 'SUPPORT_TICKET', 'COMPLAINT', 'MOBILE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP CUSTOMER SERVICE - TICKET FLOW ANIMATION
        st.markdown("""
        <style>
        @keyframes ticket-flow { 0% { transform: translateX(-20px); opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { transform: translateX(20px); opacity: 0; } }
        @keyframes ring-phone { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-10deg); } 75% { transform: rotate(10deg); } }
        @keyframes cs-stage-pop { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes cs-count-up { 0% { opacity: 0; transform: translateY(15px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes cs-stat-slide { 0% { opacity: 0; transform: translateX(-15px); } 100% { opacity: 1; transform: translateX(0); } }
        @keyframes cs-resolved-glow { 0%, 100% { text-shadow: none; } 50% { text-shadow: 0 0 15px rgba(16,185,129,0.8); } }
        .cs-flow { background: linear-gradient(135deg, #0891B2 0%, #0E7490 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .cs-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .cs-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .cs-live { display: flex; align-items: center; gap: 0.5rem; color: #10B981; font-size: 0.8rem; }
        .cs-live .phone { animation: ring-phone 0.5s ease-in-out infinite; display: inline-block; }
        .ticket-pipeline { display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.2); border-radius: 10px; padding: 1rem; margin-bottom: 1rem; }
        .pipeline-stage { text-align: center; flex: 1; animation: cs-stage-pop 0.5s ease-out forwards; opacity: 0; }
        .pipeline-stage:nth-child(3) { animation-delay: 0.1s; }
        .pipeline-stage:nth-child(5) { animation-delay: 0.2s; }
        .pipeline-stage:nth-child(7) { animation-delay: 0.3s; }
        .stage-count { color: white; font-size: 1.5rem; font-weight: 700; animation: cs-count-up 0.6s ease-out 0.3s forwards; opacity: 0; }
        .stage-label { color: rgba(255,255,255,0.7); font-size: 0.7rem; text-transform: uppercase; }
        .stage-arrow { color: rgba(255,255,255,0.4); font-size: 1.2rem; animation: ticket-flow 1.5s ease-in-out infinite; }
        .cs-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .cs-stat { background: rgba(255,255,255,0.1); border-radius: 8px; padding: 0.6rem; text-align: center; animation: cs-stat-slide 0.5s ease-out forwards; opacity: 0; }
        .cs-stat:nth-child(2) { animation-delay: 0.1s; }
        .cs-stat:nth-child(3) { animation-delay: 0.2s; }
        .cs-stat:nth-child(4) { animation-delay: 0.3s; }
        .cs-stat-val { color: white; font-size: 1.2rem; font-weight: 700; }
        .cs-stat-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="cs-flow"><div class="cs-header"><div class="cs-title">🎧 Contact Centre Live</div><div class="cs-live"><span class="phone">📞</span> 142 Active Calls</div></div><div class="ticket-pipeline"><div class="pipeline-stage"><div class="stage-count">847</div><div class="stage-label">New</div></div><div class="stage-arrow">→</div><div class="pipeline-stage"><div class="stage-count">423</div><div class="stage-label">In Progress</div></div><div class="stage-arrow">→</div><div class="pipeline-stage"><div class="stage-count">156</div><div class="stage-label">Pending</div></div><div class="stage-arrow">→</div><div class="pipeline-stage"><div class="stage-count" style="color:#10B981">12.4K</div><div class="stage-label">Resolved Today</div></div></div><div class="cs-stats"><div class="cs-stat"><div class="cs-stat-val">2:34</div><div class="cs-stat-label">Avg Wait Time</div></div><div class="cs-stat"><div class="cs-stat-val">87%</div><div class="cs-stat-label">FCR Rate</div></div><div class="cs-stat"><div class="cs-stat-val">4.6</div><div class="cs-stat-label">CSAT Score</div></div><div class="cs-stat"><div class="cs-stat-val">94%</div><div class="cs-stat-label">SLA Met</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; overflow: hidden; transition: all 0.2s ease; }
        .kpi-card:hover { border-color: #29B5E8; box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15); transform: translateY(-2px); }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; line-height: 1.1; }
        .kpi-delta { display: inline-flex; align-items: center; font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        @media (max-width: 768px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Contact Centre Performance</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">📞</div>
                <div class="kpi-label">Calls Today</div>
                <div class="kpi-value">2,847</div>
                <div class="kpi-delta positive">↑ +12% vs avg</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">⭐</div>
                <div class="kpi-label">CSAT Score</div>
                <div class="kpi-value">4.2/5</div>
                <div class="kpi-delta positive">↑ +0.3 MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">Avg Handle Time</div>
                <div class="kpi-value">6:42</div>
                <div class="kpi-delta positive">↓ -0:18 vs target</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">✅</div>
                <div class="kpi-label">First Call Resolution</div>
                <div class="kpi-value">78%</div>
                <div class="kpi-delta positive">↑ +3% MoM</div>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">🎫</div>
                <div class="kpi-label">Open Tickets</div>
                <div class="kpi-value">1,842</div>
                <div class="kpi-delta negative">↑ +124 vs yesterday</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">⏳</div>
                <div class="kpi-label">Avg Wait Time</div>
                <div class="kpi-value">2:15</div>
                <div class="kpi-delta positive">↓ -0:30 vs target</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">📋</div>
                <div class="kpi-label">Complaints MTD</div>
                <div class="kpi-value">284</div>
                <div class="kpi-delta negative">↑ +12% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">Agents Online</div>
                <div class="kpi-value">142</div>
                <div class="kpi-delta neutral">92% staffed</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # New: CSAT Trend and Channel Distribution
        trend_col, channel_col = st.columns(2)
        
        with trend_col:
            st.markdown('<div class="section-header">CSAT Trend (12 Weeks)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                weeks = [f'W{i}' for i in range(1, 13)]
                csat_trend_data = pd.DataFrame({
                    'Week': weeks,
                    'CSAT': [4.0, 4.1, 4.0, 4.2, 4.1, 4.3, 4.2, 4.1, 4.2, 4.3, 4.2, 4.2],
                    'Target': [4.0] * 12
                })
                
                csat_line = alt.Chart(csat_trend_data).mark_line(color='#29B5E8', strokeWidth=3).encode(
                    x=alt.X('Week:N', sort=weeks, title=None, axis=alt.Axis(labelAngle=0)),
                    y=alt.Y('CSAT:Q', scale=alt.Scale(domain=[3.5, 4.5]), title='CSAT Score'),
                    tooltip=['Week:N', alt.Tooltip('CSAT:Q', format='.2f')]
                )
                
                csat_points = alt.Chart(csat_trend_data).mark_circle(color='#29B5E8', size=60).encode(
                    x=alt.X('Week:N', sort=weeks),
                    y=alt.Y('CSAT:Q'),
                    tooltip=['Week:N', alt.Tooltip('CSAT:Q', format='.2f')]
                )
                
                target_rule = alt.Chart(csat_trend_data).mark_rule(color='#DC2626', strokeDash=[4, 4]).encode(
                    y='Target:Q'
                )
                
                st.altair_chart((csat_line + csat_points + target_rule).properties(height=180), use_container_width=True)
        
        with channel_col:
            st.markdown('<div class="section-header">Channel Distribution</div>', unsafe_allow_html=True)
            with st.container(border=True):
                channel_data = pd.DataFrame({
                    'Channel': ['Phone', 'Chat', 'Email', 'Social', 'Self-Service'],
                    'Volume': [65, 18, 8, 5, 4],
                    'CSAT': [4.2, 4.4, 3.8, 4.1, 4.6]
                })
                
                channel_donut = alt.Chart(channel_data).mark_arc(innerRadius=50, outerRadius=80).encode(
                    theta=alt.Theta('Volume:Q'),
                    color=alt.Color('Channel:N', scale=alt.Scale(
                        domain=['Phone', 'Chat', 'Email', 'Social', 'Self-Service'],
                        range=['#29B5E8', '#10B981', '#F59E0B', '#EC4899', '#8B5CF6']
                    ), legend=alt.Legend(orient='right', title=None)),
                    tooltip=['Channel:N', alt.Tooltip('Volume:Q', title='%'), alt.Tooltip('CSAT:Q', format='.1f')]
                ).properties(height=180)
                
                st.altair_chart(channel_donut, use_container_width=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">CSAT by Queue</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                queue_data = pd.DataFrame({
                    'Queue': ['Sales', 'Technical Support', 'Billing', 'Retention', 'General Enquiries'],
                    'CSAT': [4.5, 4.1, 3.9, 4.3, 4.0],
                    'Calls': [620, 890, 540, 320, 477],
                    'AHT': ['5:20', '8:45', '6:10', '9:30', '4:45']
                })
                
                csat_bars = alt.Chart(queue_data).mark_bar(cornerRadiusTopRight=8, cornerRadiusBottomRight=8).encode(
                    y=alt.Y('Queue:N', sort=alt.EncodingSortField(field='CSAT', order='descending'), title=None),
                    x=alt.X('CSAT:Q', scale=alt.Scale(domain=[0, 5]), title='CSAT Score'),
                    color=alt.condition(
                        alt.datum.CSAT >= 4.0,
                        alt.value('#10B981'),
                        alt.value('#F59E0B')
                    ),
                    tooltip=['Queue:N', alt.Tooltip('CSAT:Q', format='.1f'), 'Calls:Q', 'AHT:N']
                ).properties(height=200)
                
                target_line = alt.Chart(pd.DataFrame({'x': [4.0]})).mark_rule(
                    color='#DC2626', strokeDash=[4, 4], strokeWidth=2
                ).encode(x='x:Q')
                
                st.altair_chart(csat_bars + target_line, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; gap: 1rem; font-size: 0.75rem; justify-content: center;">
                    <span><span style="color: #10B981;">●</span> Above Target (4.0)</span>
                    <span><span style="color: #F59E0B;">●</span> Below Target</span>
                    <span><span style="color: #DC2626;">╌╌</span> Target</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Ticket Categories</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem; color: #6B7280;">Category</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Volume</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Avg Resolution</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">SLA %</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #EF4444;">●</span> Network Issues</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">524</td>
                            <td style="text-align: right; padding: 0.5rem;">4.2 hrs</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">82%</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #F59E0B;">●</span> Billing Queries</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">412</td>
                            <td style="text-align: right; padding: 0.5rem;">2.8 hrs</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">94%</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #10B981;">●</span> Plan Changes</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">328</td>
                            <td style="text-align: right; padding: 0.5rem;">1.5 hrs</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">98%</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;"><span style="color: #29B5E8;">●</span> Device Support</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">298</td>
                            <td style="text-align: right; padding: 0.5rem;">3.1 hrs</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">89%</span></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;"><span style="color: #8B5CF6;">●</span> Account Issues</td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">280</td>
                            <td style="text-align: right; padding: 0.5rem;">2.4 hrs</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">92%</span></td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Agent Performance</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.6rem; border-left: 4px solid #10B981; background: #D1FAE5; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #065F46;">Sarah Mitchell</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Technical Support • 42 calls</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #10B981;">4.8</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #10B981; background: #D1FAE5; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #065F46;">James Chen</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Retention • 38 calls</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #10B981;">4.7</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #10B981; background: #D1FAE5; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #065F46;">Emma Thompson</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Sales • 35 calls</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #10B981;">4.6</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">David Wilson</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Billing • 28 calls</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #F59E0B;">3.8</span>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #F3F4F6; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #6B7280;">Team Average: 4.2 • Top Performer Bonus: £250/month</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Complaint Status</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                    <div style="background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #DC2626;">Open</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #DC2626;">84</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">Avg age: 3.2 days</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #92400E;">In Progress</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #F59E0B;">142</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">Avg age: 5.8 days</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #065F46;">Resolved MTD</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #10B981;">312</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">Avg: 4.1 days</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #EDE9FE 0%, #DDD6FE 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #5B21B6;">Ombudsman</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #8B5CF6;">8</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">2.8% escalation</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        # New: Escalation Funnel and Hourly Volume
        funnel_col, hourly_col = st.columns(2)
        
        with funnel_col:
            st.markdown('<div class="section-header">Escalation Funnel</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>L1 Resolved</span><span style="font-weight: 600;">2,420 (85%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #10B981; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>L2 Escalated</span><span style="font-weight: 600;">312 (11%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 13%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>L3 Escalated</span><span style="font-weight: 600;">89 (3%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #F59E0B; width: 4%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Manager Escalated</span><span style="font-weight: 600;">26 (1%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #EF4444; width: 1%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; font-size: 0.75rem; color: #6B7280; margin-top: 0.5rem;">
                    <strong>85%</strong> First Contact Resolution at L1
                </div>
                """, unsafe_allow_html=True)
        
        with hourly_col:
            st.markdown('<div class="section-header">Hourly Call Volume</div>', unsafe_allow_html=True)
            with st.container(border=True):
                hours = ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00']
                hourly_data = pd.DataFrame({
                    'Hour': hours,
                    'Calls': [145, 312, 428, 389, 298, 342, 456, 412, 378, 289, 198, 120],
                    'Wait Time': [1.2, 2.8, 4.1, 3.2, 2.1, 2.5, 3.8, 3.1, 2.4, 1.8, 1.4, 1.1]
                })
                
                call_bars = alt.Chart(hourly_data).mark_bar(color='#29B5E8', cornerRadiusTopLeft=4, cornerRadiusTopRight=4).encode(
                    x=alt.X('Hour:N', sort=hours, title=None, axis=alt.Axis(labelAngle=-45)),
                    y=alt.Y('Calls:Q', title='Calls'),
                    tooltip=['Hour:N', 'Calls:Q', alt.Tooltip('Wait Time:Q', title='Avg Wait (min)', format='.1f')]
                ).properties(height=160)
                
                st.altair_chart(call_bars, use_container_width=True)
        
        # Customer Experience Metrics Section
        st.markdown('<div class="section-header">Customer Experience Metrics</div>', unsafe_allow_html=True)
        
        nps_col, ces_col, segment_col = st.columns(3)
        
        with nps_col:
            st.markdown("**NPS Trend by Segment**")
            with st.container(border=True):
                st.markdown("""
                <svg viewBox="0 0 200 100" style="width: 100%; height: 100px;">
                    <!-- Consumer line -->
                    <polyline points="10,60 40,55 70,50 100,52 130,48 160,45" fill="none" stroke="#29B5E8" stroke-width="2"/>
                    <!-- B2B line -->
                    <polyline points="10,40 40,38 70,35 100,32 130,30 160,28" fill="none" stroke="#10B981" stroke-width="2"/>
                    <text x="10" y="95" font-size="8" fill="#6B7280">Aug</text>
                    <text x="85" y="95" font-size="8" fill="#6B7280">Oct</text>
                    <text x="155" y="95" font-size="8" fill="#6B7280">Jan</text>
                </svg>
                <div style="display: flex; justify-content: center; gap: 1rem; font-size: 0.75rem;">
                    <span><span style="color: #29B5E8;">—</span> Consumer: +42</span>
                    <span><span style="color: #10B981;">—</span> B2B: +58</span>
                </div>
                <div style="text-align: center; font-size: 0.7rem; color: #10B981; margin-top: 0.3rem;">▲ Both segments improving</div>
                """, unsafe_allow_html=True)
        
        with ces_col:
            st.markdown("**Customer Effort Score**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Bill Payment</span><span style="font-weight: 600; color: #10B981;">1.8</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                            <div style="background: #10B981; width: 36%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Plan Change</span><span style="font-weight: 600; color: #F59E0B;">2.8</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                            <div style="background: #F59E0B; width: 56%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Technical Support</span><span style="font-weight: 600; color: #DC2626;">3.4</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                            <div style="background: #DC2626; width: 68%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Complaint Resolution</span><span style="font-weight: 600; color: #DC2626;">3.8</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                            <div style="background: #DC2626; width: 76%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; font-size: 0.7rem; color: #6B7280; margin-top: 0.4rem;">Scale: 1 (Easy) - 5 (Difficult)</div>
                """, unsafe_allow_html=True)
        
        with segment_col:
            st.markdown("**Issue Resolution by Value Tier**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.8rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>🥇 Platinum</span>
                        <span><strong>94%</strong> FCR</span>
                        <span style="color: #10B981;">2.1 min wait</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>🥈 Gold</span>
                        <span><strong>86%</strong> FCR</span>
                        <span style="color: #F59E0B;">4.2 min wait</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>🥉 Silver</span>
                        <span><strong>78%</strong> FCR</span>
                        <span style="color: #F59E0B;">6.8 min wait</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>Bronze</span>
                        <span><strong>72%</strong> FCR</span>
                        <span style="color: #DC2626;">9.4 min wait</span>
                    </div>
                </div>
                <div style="text-align: center; font-size: 0.7rem; color: #6B7280; margin-top: 0.4rem;">Priority routing enabled</div>
                """, unsafe_allow_html=True)
        
        # Repeat Contact Analysis
        repeat_col, journey_col = st.columns(2)
        
        with repeat_col:
            st.markdown("**Repeat Contact Analysis**")
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; justify-content: space-around; text-align: center; padding: 0.5rem 0;">
                    <div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: #10B981;">72%</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">One & Done</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: #F59E0B;">18%</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">2 Contacts</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: #DC2626;">10%</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">3+ Contacts</div>
                    </div>
                </div>
                <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #E5E7EB; font-size: 0.75rem;">
                    <strong>Top Repeat Reasons:</strong> Billing disputes (34%), Network issues (28%), Plan confusion (22%)
                </div>
                """, unsafe_allow_html=True)
        
        with journey_col:
            st.markdown("**Customer Journey Touchpoints**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.8rem;">
                    <div style="display: flex; align-items: center; margin-bottom: 0.4rem;">
                        <div style="width: 80px;">App</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 16px; margin-right: 0.5rem;">
                            <div style="background: #29B5E8; width: 45%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 600;">45%</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 0.4rem;">
                        <div style="width: 80px;">Phone</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 16px; margin-right: 0.5rem;">
                            <div style="background: #10B981; width: 28%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 600;">28%</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 0.4rem;">
                        <div style="width: 80px;">Web Chat</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 16px; margin-right: 0.5rem;">
                            <div style="background: #8B5CF6; width: 15%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 600;">15%</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div style="width: 80px;">Store</div>
                        <div style="flex: 1; background: #E5E7EB; border-radius: 4px; height: 16px; margin-right: 0.5rem;">
                            <div style="background: #F59E0B; width: 12%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-weight: 600;">12%</span>
                    </div>
                </div>
                <div style="text-align: center; font-size: 0.7rem; color: #10B981; margin-top: 0.4rem;">Digital channels +12% YoY</div>
                """, unsafe_allow_html=True)
        
        # Customer 360 Deep Dive
        st.markdown('<div class="section-header">🔍 Customer 360 Deep Dive</div>', unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake** — Unified customer view combining data from 12+ source systems using Dynamic Tables and Cortex AI for real-time scoring")
        
        # Customer lookup
        c360_col1, c360_col2 = st.columns([1, 3])
        
        with c360_col1:
            with st.container(border=True):
                st.markdown("**Customer Lookup**")
                customer_id = st.text_input("Customer ID", value="CUST-2847156", label_visibility="collapsed", placeholder="Enter Customer ID", key="cs_cust_id")
                segment_filter = st.selectbox("Or select segment", ["High Value", "At Risk", "New Customer", "Dormant"], index=0, key="cs_segment")
                st.button("🔍 Load Profile", use_container_width=True, type="primary", key="cs_load_btn")
        
        with c360_col2:
            with st.container(border=True):
                # Customer Header
                st.markdown("""
                <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 1rem; border-bottom: 1px solid #E5E7EB; margin-bottom: 1rem;">
                    <div>
                        <div style="font-size: 1.2rem; font-weight: 700; color: #1B2A4E;">Sarah Mitchell</div>
                        <div style="font-size: 0.85rem; color: #6B7280;">ID: CUST-2847156 • Premium Customer since 2019</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <div style="background: #DCFCE7; color: #166534; padding: 0.4rem 0.8rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">High Value</div>
                        <div style="background: #FEF3C7; color: #92400E; padding: 0.4rem 0.8rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">Churn Risk: Medium</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
                
                # Customer metrics
                metric_cols = st.columns(6)
                with metric_cols[0]:
                    st.metric("CLV", "£4,820", "Top 8%")
                with metric_cols[1]:
                    st.metric("Tenure", "5.2 yrs", "Loyal")
                with metric_cols[2]:
                    st.metric("ARPU", "£68.40", "+£4.20")
                with metric_cols[3]:
                    st.metric("NPS Score", "9", "Promoter")
                with metric_cols[4]:
                    st.metric("Churn Prob", "18%", "↑ 4%", delta_color="inverse")
                with metric_cols[5]:
                    st.metric("Upsell Prob", "72%", "High")
                
                st.markdown("---")
                
                # Customer details tabs
                detail_tabs = st.tabs(["📱 Products", "📞 Interactions", "🎯 Recommendations", "📊 Usage"])
                
                with detail_tabs[0]:
                    st.markdown("""
                    | Product | Plan | Monthly | Status |
                    |---------|------|---------|--------|
                    | Mobile (Primary) | Unlimited Max | £45.00 | Active |
                    | Mobile (Family) | Unlimited Plus | £32.00 | Active |
                    | Home Broadband | Fibre 500 | £38.00 | Active |
                    | TV Bundle | Entertainment+ | £15.00 | Active |
                    """)
                
                with detail_tabs[1]:
                    st.markdown("""
                    | Date | Channel | Type | Resolution |
                    |------|---------|------|------------|
                    | 28 Jan 2026 | App | Billing Query | ✅ Resolved |
                    | 15 Jan 2026 | Call | Upgrade Inquiry | ⏳ Pending |
                    | 02 Jan 2026 | Chat | Technical Support | ✅ Resolved |
                    | 18 Dec 2025 | Store | Device Purchase | ✅ Completed |
                    """)
                
                with detail_tabs[2]:
                    rec_cols = st.columns(3)
                    with rec_cols[0]:
                        with st.container(border=True):
                            st.markdown("**🎯 Top Recommendation**")
                            st.markdown("Upgrade to 5G Unlimited")
                            st.caption("72% acceptance probability")
                            st.caption("£8/mo additional revenue")
                    with rec_cols[1]:
                        with st.container(border=True):
                            st.markdown("**📦 Bundle Opportunity**")
                            st.markdown("Add Mobile Insurance")
                            st.caption("64% acceptance probability")
                            st.caption("£12/mo additional revenue")
                    with rec_cols[2]:
                        with st.container(border=True):
                            st.markdown("**⚠️ Retention Action**")
                            st.markdown("Loyalty reward due")
                            st.caption("Tenure milestone: 5 years")
                            st.caption("Offer: 20% off for 6 months")
                
                with detail_tabs[3]:
                    usage_cols = st.columns(4)
                    with usage_cols[0]:
                        st.metric("Data Used", "48.2 GB", "of Unlimited")
                    with usage_cols[1]:
                        st.metric("Minutes", "842", "of Unlimited")
                    with usage_cols[2]:
                        st.metric("Texts", "234", "of Unlimited")
                    with usage_cols[3]:
                        st.metric("Roaming", "2.4 GB", "EU included")
        

    with tab_ops:
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['SUPPORT', 'WORKFORCE', 'QUALITY']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        @keyframes cs-ops-sweep { 0% { transform: translateX(-120%); opacity: 0; } 25% { opacity: 0.6; } 100% { transform: translateX(120%); opacity: 0; } }
        @keyframes cs-ops-glow { 0%, 100% { box-shadow: 0 0 0 rgba(14,116,144,0.25); } 50% { box-shadow: 0 0 16px rgba(14,116,144,0.45); } }
        .cs-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, #0EA5E9 0%, #0284C7 100%);
            color: white;
            margin-bottom: 1.5rem;
            animation: cs-ops-glow 2.8s ease-in-out infinite;
        }
        .cs-ops-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -50%;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: cs-ops-sweep 3.4s ease-in-out infinite;
        }
        .cs-ops-title { font-weight: 700; font-size: 1rem; position: relative; z-index: 1; }
        .cs-ops-sub { font-size: 0.85rem; opacity: 0.85; position: relative; z-index: 1; }
        .cs-ops-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-top: 0.9rem; position: relative; z-index: 1; }
        .cs-ops-card { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25); border-radius: 10px; padding: 0.6rem 0.75rem; }
        .cs-ops-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.06em; color: rgba(255,255,255,0.7); }
        .cs-ops-value { font-size: 1.2rem; font-weight: 700; color: #FFFFFF; margin-top: 0.2rem; }
        .cs-ops-delta { font-size: 0.7rem; color: rgba(255,255,255,0.85); margin-top: 0.15rem; }
        @media (max-width: 900px) { .cs-ops-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="cs-ops-pulse">
            <div class="cs-ops-title">🎧 Service Operations Pulse</div>
            <div class="cs-ops-sub">Queue health, backlog, and workforce performance signals.</div>
            <div class="cs-ops-grid">
                <div class="cs-ops-card">
                    <div class="cs-ops-label">SLA Met</div>
                    <div class="cs-ops-value">94%</div>
                    <div class="cs-ops-delta">↑ +2% WoW</div>
                </div>
                <div class="cs-ops-card">
                    <div class="cs-ops-label">Backlog</div>
                    <div class="cs-ops-value">1,842</div>
                    <div class="cs-ops-delta">↓ -6% WoW</div>
                </div>
                <div class="cs-ops-card">
                    <div class="cs-ops-label">AHT</div>
                    <div class="cs-ops-value">6:42</div>
                    <div class="cs-ops-delta">↓ -0:18</div>
                </div>
                <div class="cs-ops-card">
                    <div class="cs-ops-label">CSAT</div>
                    <div class="cs-ops-value">4.2</div>
                    <div class="cs-ops-delta">↑ +0.3</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Backlog & Channel Load</div>', unsafe_allow_html=True)
        ops_left, ops_right = st.columns(2)
        
        with ops_left:
            st.markdown("**Ticket Aging Breakdown**")
            with st.container(border=True):
                aging_df = pd.DataFrame({
                    'Age Bucket': ['0-24h', '1-3d', '4-7d', '8-14d', '15+d'],
                    'Tickets': [620, 540, 360, 210, 112]
                })
                aging_chart = alt.Chart(aging_df).mark_bar(color='#0EA5E9', cornerRadiusEnd=6).encode(
                    x=alt.X('Tickets:Q', title='Tickets'),
                    y=alt.Y('Age Bucket:N', sort='-x', title=None),
                    tooltip=['Age Bucket:N', 'Tickets:Q']
                ).properties(height=220)
                st.altair_chart(aging_chart, use_container_width=True)
                st.caption("32% of backlog is within SLA (0–3 days).")
        
        with ops_right:
            st.markdown("**Channel Mix**")
            with st.container(border=True):
                channel_df = pd.DataFrame({
                    'Channel': ['App', 'Phone', 'Chat', 'Store'],
                    'Share': [45, 28, 15, 12]
                })
                channel_chart = alt.Chart(channel_df).mark_arc(innerRadius=50, outerRadius=90).encode(
                    theta=alt.Theta('Share:Q'),
                    color=alt.Color('Channel:N', scale=alt.Scale(range=['#0EA5E9', '#10B981', '#8B5CF6', '#F59E0B']), legend=None),
                    tooltip=['Channel:N', 'Share:Q']
                ).properties(height=220)
                st.altair_chart(channel_chart, use_container_width=True)
                st.caption("Digital channels represent 60% of total volume.")
        
        st.markdown('<div class="section-header">Workforce & Quality</div>', unsafe_allow_html=True)
        wf_left, wf_right = st.columns(2)
        
        with wf_left:
            st.markdown("**Agent Occupancy Trend (8 Weeks)**")
            with st.container(border=True):
                occ_df = pd.DataFrame({
                    'Week': [f'W{i}' for i in range(1, 9)],
                    'Occupancy': [76, 78, 79, 81, 80, 82, 83, 81]
                })
                occ_chart = alt.Chart(occ_df).mark_line(color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Week:N', title=None),
                    y=alt.Y('Occupancy:Q', title='Occupancy %', scale=alt.Scale(domain=[70, 90]))
                )
                st.altair_chart(occ_chart.properties(height=200), use_container_width=True)
                st.caption("Occupancy stays within 78–83% target band.")
        
        with wf_right:
            st.markdown("**Repeat Contact Drivers**")
            with st.container(border=True):
                repeat_df = pd.DataFrame({
                    'Reason': ['Billing', 'Network', 'Plan Confusion', 'Device', 'Other'],
                    'Share': [34, 28, 22, 9, 7]
                })
                repeat_chart = alt.Chart(repeat_df).mark_bar(color='#F59E0B', cornerRadiusEnd=6).encode(
                    x=alt.X('Share:Q', title='Share (%)'),
                    y=alt.Y('Reason:N', sort='-x', title=None),
                    tooltip=['Reason:N', 'Share:Q']
                ).properties(height=200)
                st.altair_chart(repeat_chart, use_container_width=True)
                st.caption("Billing and network issues drive 62% of repeat contacts.")

    with tab_strategy:
        st.markdown("""
        <style>
        .cs-ai-pulse {
            background: linear-gradient(135deg, #ECFEFF 0%, #CFFAFE 100%);
            border-radius: 16px;
            border: 1px solid #A5F3FC;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .cs-ai-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(14,116,144,0.18), transparent);
            animation: cs-ai-sweep 4s ease-in-out infinite;
        }
        @keyframes cs-ai-sweep { 0% { left: -120%; } 100% { left: 220%; } }
        .cs-ai-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .cs-ai-title { font-weight: 700; color: #0E7490; font-size: 1.05rem; }
        .cs-ai-tag { background: #0284C7; color: white; font-size: 0.75rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 999px; }
        .cs-ai-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.9rem; position: relative; z-index: 1; }
        .cs-ai-card { background: white; border-radius: 12px; border: 1px solid #A5F3FC; padding: 0.85rem 0.95rem; }
        .cs-ai-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9CA3AF; }
        .cs-ai-value { font-size: 1.3rem; font-weight: 700; color: #0E7490; }
        .cs-ai-sub { font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) { .cs-ai-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="cs-ai-pulse">
            <div class="cs-ai-header">
                <div class="cs-ai-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="cs-ai-tag">AI LIVE</div>
            </div>
            <div class="cs-ai-grid">
                <div class="cs-ai-card">
                    <div class="cs-ai-label">CSAT</div>
                    <div class="cs-ai-value">4.2</div>
                    <div class="cs-ai-sub">Target 4.5</div>
                </div>
                <div class="cs-ai-card">
                    <div class="cs-ai-label">FCR</div>
                    <div class="cs-ai-value">78%</div>
                    <div class="cs-ai-sub">Target 85%</div>
                </div>
                <div class="cs-ai-card">
                    <div class="cs-ai-label">Deflection</div>
                    <div class="cs-ai-value">18%</div>
                    <div class="cs-ai-sub">AI chatbot pilot</div>
                </div>
                <div class="cs-ai-card">
                    <div class="cs-ai-label">Complaints</div>
                    <div class="cs-ai-value">284</div>
                    <div class="cs-ai-sub">↑ +12% MoM</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Summary synthesized from contact center, ticket, and CSAT data.")
        
        with st.container(border=True):
            st.markdown("""
            **Executive Summary (Q1 2026):**
            - CSAT holds at **4.2**, with technical support queues driving variance.
            - FCR is **78%**, improving as knowledge base coverage expands.
            - Backlog is trending down **6% WoW** with staffing stabilization.
            """)
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Digital volume** up 12% YoY
                - **Repeat contacts** driven by billing and network
                - **Top agents** exceed 4.7 CSAT
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Complaints MTD** +12% MoM
                - **AHT** above target in tech queue
                - **Pending tickets** >150
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Growth Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **AI chatbot** deflection trending 18%
                - **FCR** +3% MoM with KB refresh
                - **Wait time** down 30 seconds
                """)
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                - **Raise CSAT** by prioritizing tech support coaching
                - Add 25 agents to peak shifts
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                - **Lift FCR** via knowledge base coverage
                - Target top 5 ticket categories
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                - **Scale chatbot** to app + WhatsApp
                - Aim for 30% deflection by Q2
                """)
        
        st.markdown('<div class="section-header">VP Customer Service Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">CSAT to 4.5</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **4.2** average
                - Gap: **0.3** points
                - Focus: Technical Support queue
                - Training: Agent coaching program
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">FCR to 85%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **78%** FCR
                - Target: **85%** by Q2
                - Action: Knowledge base upgrade
                - Investment: **£180K** approved
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">AI Chatbot Launch</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Target: **30%** deflection
                - Launch: March 2026
                - Channels: Web, App, WhatsApp
                - Savings: **£420K** projected
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "Show me our contact centre performance - AHT, wait time, and CSAT by queue.",
            "What are the top support ticket categories and resolution times?",
            "Who are our top performing agents by CSAT?",
            "Show me our formal complaint volumes and resolution times.",
            "How does support performance differ between Consumer and B2B?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_network_operations():
    import pandas as pd
    import altair as alt
    
    def _spark_points(values, width=300, height=90, padding=8):
        min_v = min(values)
        max_v = max(values)
        span = max(max_v - min_v, 0.0001)
        step = (width - 2 * padding) / max(len(values) - 1, 1)
        points = []
        for i, v in enumerate(values):
            x = padding + i * step
            y = padding + (max_v - v) / span * (height - 2 * padding)
            points.append(f"{x:.1f},{y:.1f}")
        return " ".join(points)
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Network Operations Dashboard</h1>
        <p>Network Availability, RF Optimization, Alarm Management & SLA Delivery</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_rf, tab_strategy = st.tabs(["📊 Overview & Analysis", "📶 RF Optimization", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['NETWORK_OPS', 'NETWORK_ALARM', 'SLA', 'RAN']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP NETWORK OPS - NETWORK PULSE ANIMATION
        st.markdown("""
        <style>
        @keyframes netops-wave { 0% { transform: scaleY(0.3); } 50% { transform: scaleY(1); } 100% { transform: scaleY(0.3); } }
        @keyframes netops-glow { 0%, 100% { box-shadow: 0 0 5px rgba(16,185,129,0.3); } 50% { box-shadow: 0 0 20px rgba(16,185,129,0.6); } }
        @keyframes netops-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .netops-pulse { background: linear-gradient(135deg, #064E3B 0%, #047857 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .netops-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .netops-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .netops-status { display: flex; align-items: center; gap: 0.5rem; background: rgba(16,185,129,0.2); padding: 0.4rem 0.8rem; border-radius: 20px; animation: netops-glow 2s ease-in-out infinite; }
        .netops-dot { width: 8px; height: 8px; background: #10B981; border-radius: 50%; animation: netops-blink 1s ease-in-out infinite; }
        .netops-status-text { color: #10B981; font-size: 0.75rem; font-weight: 600; }
        .netops-grid { display: flex; gap: 1.5rem; align-items: center; }
        .netops-bars { display: flex; gap: 3px; align-items: flex-end; height: 60px; }
        .netops-bar { width: 6px; background: linear-gradient(to top, #10B981, #34D399); border-radius: 3px; animation: netops-wave 1s ease-in-out infinite; transform-origin: bottom; }
        .netops-metrics { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; flex: 1; }
        .netops-metric { text-align: center; }
        .netops-val { color: white; font-size: 1.4rem; font-weight: 700; }
        .netops-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="netops-pulse"><div class="netops-header"><div class="netops-title">📡 Network Operations Live</div><div class="netops-status"><div class="netops-dot"></div><span class="netops-status-text">All Systems Nominal</span></div></div><div class="netops-grid"><div class="netops-bars"><div class="netops-bar" style="height:45px;animation-delay:0s"></div><div class="netops-bar" style="height:55px;animation-delay:0.1s"></div><div class="netops-bar" style="height:40px;animation-delay:0.2s"></div><div class="netops-bar" style="height:60px;animation-delay:0.3s"></div><div class="netops-bar" style="height:35px;animation-delay:0.4s"></div><div class="netops-bar" style="height:50px;animation-delay:0.5s"></div><div class="netops-bar" style="height:45px;animation-delay:0.6s"></div><div class="netops-bar" style="height:55px;animation-delay:0.7s"></div><div class="netops-bar" style="height:40px;animation-delay:0.8s"></div><div class="netops-bar" style="height:48px;animation-delay:0.9s"></div></div><div class="netops-metrics"><div class="netops-metric"><div class="netops-val">99.72%</div><div class="netops-label">Availability</div></div><div class="netops-metric"><div class="netops-val">24ms</div><div class="netops-label">Latency</div></div><div class="netops-metric"><div class="netops-val">847</div><div class="netops-label">Active Alarms</div></div><div class="netops-metric"><div class="netops-val">12,847</div><div class="netops-label">Sites Online</div></div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; overflow: hidden; transition: all 0.2s ease; }
        .kpi-card:hover { border-color: #29B5E8; box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15); transform: translateY(-2px); }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; line-height: 1.1; }
        .kpi-delta { display: inline-flex; align-items: center; font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Network Health Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">📡</div>
                <div class="kpi-label">Network Availability</div>
                <div class="kpi-value">99.72%</div>
                <div class="kpi-delta positive">↑ +0.08% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">⚡</div>
                <div class="kpi-label">Avg Latency</div>
                <div class="kpi-value">24ms</div>
                <div class="kpi-delta positive">↓ -3ms vs target</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Throughput</div>
                <div class="kpi-value">4.2 Gbps</div>
                <div class="kpi-delta positive">↑ +12% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">🚨</div>
                <div class="kpi-label">Active Alarms</div>
                <div class="kpi-value">216</div>
                <div class="kpi-delta negative">↑ +18 vs yesterday</div>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">🔧</div>
                <div class="kpi-label">MTTR (Critical)</div>
                <div class="kpi-value">42 min</div>
                <div class="kpi-delta positive">↓ -8 min vs SLA</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">📋</div>
                <div class="kpi-label">SLA Attainment</div>
                <div class="kpi-value">97.8%</div>
                <div class="kpi-delta positive">Above 95% target</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">🏗️</div>
                <div class="kpi-label">Sites Monitored</div>
                <div class="kpi-value">475</div>
                <div class="kpi-delta neutral">100% coverage</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">Capacity Util.</div>
                <div class="kpi-value">64%</div>
                <div class="kpi-delta neutral">Within target</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # New: Network Availability Trend and Capacity Forecast
        avail_col, capacity_col = st.columns(2)
        
        with avail_col:
            st.markdown('<div class="section-header">Network Availability (30 Days)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                days = list(range(1, 31))
                avail_values = [99.8, 99.9, 99.7, 99.6, 99.8, 99.9, 99.9, 99.5, 99.7, 99.8,
                               99.9, 99.8, 99.7, 99.9, 99.8, 99.6, 99.7, 99.8, 99.9, 99.7,
                               99.8, 99.9, 99.8, 99.7, 99.8, 99.9, 99.7, 99.6, 99.7, 99.72]
                avail_data = pd.DataFrame({
                    'Day': days,
                    'Availability': avail_values
                })
                
                # Create bar chart for better visibility
                avail_bars = alt.Chart(avail_data).mark_bar(
                    color='#29B5E8', opacity=0.7
                ).encode(
                    x=alt.X('Day:O', title='Day', axis=alt.Axis(labelAngle=0, values=[1, 5, 10, 15, 20, 25, 30])),
                    y=alt.Y(
                        'Availability:Q',
                        scale=alt.Scale(domain=[99.0, 100], zero=False),
                        title='%',
                        axis=alt.Axis(format='.2f')
                    ),
                    tooltip=['Day:O', alt.Tooltip('Availability:Q', format='.2f', title='Availability %')]
                )
                
                # Line on top of bars
                avail_line = alt.Chart(avail_data).mark_line(
                    color='#0891B2', strokeWidth=2
                ).encode(
                    x=alt.X('Day:O'),
                    y=alt.Y('Availability:Q', scale=alt.Scale(domain=[99.0, 100], zero=False))
                )
                
                # SLA target line at 99.5%
                target_df = pd.DataFrame({'y': [99.5]})
                target_line = alt.Chart(target_df).mark_rule(
                    color='#DC2626', strokeDash=[5, 5], strokeWidth=2
                ).encode(y='y:Q')
                
                chart = (avail_bars + avail_line + target_line).properties(height=220)
                st.altair_chart(chart, use_container_width=True)
                st.markdown('<div style="text-align: center; font-size: 0.75rem; color: #6B7280;"><span style="color: #DC2626;">---</span> 99.5% SLA Target</div>', unsafe_allow_html=True)
        
        with capacity_col:
            st.markdown('<div class="section-header">Capacity Forecast</div>', unsafe_allow_html=True)
            with st.container(border=True):
                forecast_data = pd.DataFrame({
                    'Month': ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    'Actual': [64, 67, None, None, None, None],
                    'Forecast': [64, 67, 71, 74, 78, 82],
                    'Threshold': [80] * 6
                })
                
                actual_line = alt.Chart(forecast_data.dropna(subset=['Actual'])).mark_line(
                    color='#29B5E8', strokeWidth=3
                ).encode(
                    x=alt.X('Month:N', sort=['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'], title=None),
                    y=alt.Y('Actual:Q', scale=alt.Scale(domain=[50, 100]), title='Utilization %')
                )
                
                forecast_line = alt.Chart(forecast_data).mark_line(
                    color='#8B5CF6', strokeWidth=2, strokeDash=[5, 3]
                ).encode(
                    x=alt.X('Month:N', sort=['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun']),
                    y=alt.Y('Forecast:Q')
                )
                
                threshold_rule = alt.Chart(forecast_data).mark_rule(color='#EF4444', strokeDash=[4, 4]).encode(
                    y='Threshold:Q'
                )
                
                st.altair_chart((actual_line + forecast_line + threshold_rule).properties(height=160), use_container_width=True)
                st.markdown('<div style="text-align: center; font-size: 0.75rem;"><span style="color: #29B5E8;">—</span> Actual <span style="color: #8B5CF6;">- -</span> Forecast <span style="color: #EF4444;">---</span> 80% Threshold</div>', unsafe_allow_html=True)

        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Alarms by Severity</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                alarm_data = pd.DataFrame({
                    'Severity': ['Critical', 'Major', 'Minor', 'Warning'],
                    'Count': [12, 48, 98, 58],
                    'MTTR': [42, 68, 120, 180],
                    'Trend': ['↓', '↓', '↑', '→']
                })
                
                alarm_bars = alt.Chart(alarm_data).mark_bar(cornerRadiusTopRight=8, cornerRadiusBottomRight=8).encode(
                    y=alt.Y('Severity:N', sort=['Critical', 'Major', 'Minor', 'Warning'], title=None),
                    x=alt.X('Count:Q', scale=alt.Scale(domain=[0, 120]), title='Alarm Count'),
                    color=alt.Color('Severity:N', scale=alt.Scale(
                        domain=['Critical', 'Major', 'Minor', 'Warning'],
                        range=['#DC2626', '#F59E0B', '#3B82F6', '#9CA3AF']
                    ), legend=None),
                    tooltip=['Severity:N', 'Count:Q', alt.Tooltip('MTTR:Q', title='MTTR (min)')]
                ).properties(height=160)
                
                st.altair_chart(alarm_bars, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; justify-content: space-around; font-size: 0.75rem; padding: 0.5rem; background: #F9FAFB; border-radius: 8px;">
                    <div style="text-align: center;">
                        <div style="color: #DC2626; font-weight: 700;">12 Critical</div>
                        <div style="color: #6B7280;">MTTR: 42min</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: #F59E0B; font-weight: 700;">48 Major</div>
                        <div style="color: #6B7280;">MTTR: 68min</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: #3B82F6; font-weight: 700;">98 Minor</div>
                        <div style="color: #6B7280;">MTTR: 2hrs</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Regional Performance</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem; color: #6B7280;">Region</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Avail.</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Latency</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Alarms</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; font-weight: 600;">London</td>
                            <td style="text-align: right; padding: 0.5rem;">99.91%</td>
                            <td style="text-align: right; padding: 0.5rem;">18ms</td>
                            <td style="text-align: right; padding: 0.5rem;">24</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Healthy</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; font-weight: 600;">Manchester</td>
                            <td style="text-align: right; padding: 0.5rem;">99.68%</td>
                            <td style="text-align: right; padding: 0.5rem;">26ms</td>
                            <td style="text-align: right; padding: 0.5rem;">42</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Monitor</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; font-weight: 600;">Birmingham</td>
                            <td style="text-align: right; padding: 0.5rem;">99.54%</td>
                            <td style="text-align: right; padding: 0.5rem;">28ms</td>
                            <td style="text-align: right; padding: 0.5rem;">38</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Monitor</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; font-weight: 600;">Leeds</td>
                            <td style="text-align: right; padding: 0.5rem;">99.42%</td>
                            <td style="text-align: right; padding: 0.5rem;">32ms</td>
                            <td style="text-align: right; padding: 0.5rem;">52</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">Attention</span></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem; font-weight: 600;">Scotland</td>
                            <td style="text-align: right; padding: 0.5rem;">99.78%</td>
                            <td style="text-align: right; padding: 0.5rem;">22ms</td>
                            <td style="text-align: right; padding: 0.5rem;">28</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Healthy</span></td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">High Utilization Sites</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.6rem; border-left: 4px solid #EF4444; background: #FEE2E2; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #DC2626;">Leeds Central</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Macro Cell • 1,200 users</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #DC2626;">92%</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #EF4444; background: #FEE2E2; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #DC2626;">Manchester Arena</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Small Cell • 890 users</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #DC2626;">88%</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">Birmingham New St</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Macro Cell • 980 users</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #F59E0B;">78%</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">Sheffield City</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Macro Cell • 720 users</div>
                            </div>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #F59E0B;">74%</span>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #FEE2E2; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #DC2626;">⚠️ <strong>124 sites</strong> above 70% utilization threshold</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">SLA Performance</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                    <div style="background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #065F46;">SLAs Met</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #10B981;">2,847</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">97.8%</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #DC2626;">SLAs Breached</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #EF4444;">64</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">2.2%</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #0369A1;">Credit Liability</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #0EA5E9;">£12.4K</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">MTD exposure</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 12px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.7rem; color: #92400E;">At Risk</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #F59E0B;">18</div>
                        <div style="font-size: 0.65rem; color: #6B7280;">Trending to breach</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        

    with tab_rf:
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['RAN', 'NETWORK_OPS']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)

        st.markdown("""
        <style>
        @keyframes rf-ops-sweep { 0% { transform: translateX(-120%); opacity: 0; } 25% { opacity: 0.6; } 100% { transform: translateX(120%); opacity: 0; } }
        @keyframes rf-ops-glow { 0%, 100% { box-shadow: 0 0 0 rgba(14,165,233,0.25); } 50% { box-shadow: 0 0 16px rgba(14,165,233,0.45); } }
        .rf-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, #0EA5E9 0%, #0284C7 100%);
            color: white;
            margin-bottom: 1.5rem;
            animation: rf-ops-glow 2.8s ease-in-out infinite;
        }
        .rf-ops-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -50%;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: rf-ops-sweep 3.4s ease-in-out infinite;
        }
        .rf-ops-title { font-weight: 700; font-size: 1rem; position: relative; z-index: 1; }
        .rf-ops-sub { font-size: 0.85rem; opacity: 0.85; position: relative; z-index: 1; }
        .rf-ops-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-top: 0.9rem; position: relative; z-index: 1; }
        .rf-ops-card { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25); border-radius: 10px; padding: 0.6rem 0.75rem; }
        .rf-ops-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.06em; color: rgba(255,255,255,0.7); }
        .rf-ops-value { font-size: 1.2rem; font-weight: 700; color: #FFFFFF; margin-top: 0.2rem; }
        .rf-ops-delta { font-size: 0.7rem; color: rgba(255,255,255,0.85); margin-top: 0.15rem; }
        @media (max-width: 900px) { .rf-ops-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="rf-ops-pulse">
            <div class="rf-ops-title">📶 RF Optimization Pulse</div>
            <div class="rf-ops-sub">Signal quality, drops, and handover performance hotspots.</div>
            <div class="rf-ops-grid">
                <div class="rf-ops-card">
                    <div class="rf-ops-label">RSRP</div>
                    <div class="rf-ops-value">-97 dBm</div>
                    <div class="rf-ops-delta">Stable</div>
                </div>
                <div class="rf-ops-card">
                    <div class="rf-ops-label">RSRQ</div>
                    <div class="rf-ops-value">-9 dB</div>
                    <div class="rf-ops-delta">Within target</div>
                </div>
                <div class="rf-ops-card">
                    <div class="rf-ops-label">SINR</div>
                    <div class="rf-ops-value">18 dB</div>
                    <div class="rf-ops-delta">Monitor</div>
                </div>
                <div class="rf-ops-card">
                    <div class="rf-ops-label">Call Drops</div>
                    <div class="rf-ops-value">0.7%</div>
                    <div class="rf-ops-delta">↓ -0.2% MoM</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">RF Optimization KPIs</div>', unsafe_allow_html=True)
        with st.container(border=True):
            st.markdown("""
            <div class="kpi-grid">
                <div class="kpi-card" style="--accent: #0EA5E9;">
                    <div class="kpi-icon">📶</div>
                    <div class="kpi-label">RSRP (Signal)</div>
                    <div class="kpi-value">-97 dBm</div>
                    <div class="kpi-delta neutral">Stable vs baseline</div>
                </div>
                <div class="kpi-card" style="--accent: #22C55E;">
                    <div class="kpi-icon">🛰️</div>
                    <div class="kpi-label">RSRQ (Quality)</div>
                    <div class="kpi-value">-9 dB</div>
                    <div class="kpi-delta neutral">Within target</div>
                </div>
                <div class="kpi-card" style="--accent: #8B5CF6;">
                    <div class="kpi-icon">📡</div>
                    <div class="kpi-label">SINR</div>
                    <div class="kpi-value">18 dB</div>
                    <div class="kpi-delta neutral">Monitor hotspots</div>
                </div>
                <div class="kpi-card" style="--accent: #10B981;">
                    <div class="kpi-icon">🔁</div>
                    <div class="kpi-label">Handover Success</div>
                    <div class="kpi-value">98.4%</div>
                    <div class="kpi-delta positive">↑ +0.3% MoM</div>
                </div>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card" style="--accent: #EF4444;">
                    <div class="kpi-icon">📉</div>
                    <div class="kpi-label">Call Drop Rate</div>
                    <div class="kpi-value">0.7%</div>
                    <div class="kpi-delta positive">↓ -0.2% MoM</div>
                </div>
                <div class="kpi-card" style="--accent: #F59E0B;">
                    <div class="kpi-icon">📊</div>
                    <div class="kpi-label">PRB Utilization</div>
                    <div class="kpi-value">72%</div>
                    <div class="kpi-delta neutral">Near threshold</div>
                </div>
                <div class="kpi-card" style="--accent: #6366F1;">
                    <div class="kpi-icon">✅</div>
                    <div class="kpi-label">RRC Setup</div>
                    <div class="kpi-value">99.1%</div>
                    <div class="kpi-delta positive">↑ +0.4% MoM</div>
                </div>
                <div class="kpi-card" style="--accent: #14B8A6;">
                    <div class="kpi-icon">🧭</div>
                    <div class="kpi-label">E-RAB Setup</div>
                    <div class="kpi-value">98.7%</div>
                    <div class="kpi-delta neutral">Within SLA</div>
                </div>
            </div>

            <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #6B7280;">
                Optimization focus: improve SINR in Leeds and Manchester cells with PRB &gt;80%.
            </div>
            """, unsafe_allow_html=True)

        st.markdown("""
        <style>
        .rf-sparkline { width: 100%; height: 110px; }
        .rf-sparkline svg { width: 100%; height: 110px; }
        .rf-line { fill: none; stroke-width: 2.4; stroke-linecap: round; stroke-linejoin: round;
                   stroke-dasharray: 420; stroke-dashoffset: 420; animation: rf-draw 3.2s ease-in-out infinite; }
        .rf-line.b { animation-delay: 0.2s; }
        .rf-line.c { animation-delay: 0.4s; }
        @keyframes rf-draw { 0% { stroke-dashoffset: 420; opacity: 0.1; } 35% { opacity: 1; }
                             60% { stroke-dashoffset: 0; opacity: 1; } 100% { stroke-dashoffset: 0; opacity: 0.9; } }
        .rf-legend { font-size: 0.7rem; color: #6B7280; text-align: center; margin-top: 0.2rem; }
        </style>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">RF Optimization Analytics (2026)</div>', unsafe_allow_html=True)
        rf_cols = st.columns([1.4, 1.2, 1])

        rsrp_vals = [-100, -98, -101, -97, -99, -96, -98]
        rsrq_vals = [-11.2, -10.6, -10.9, -10.1, -10.4, -9.8, -10.2]
        sinr_vals = [15.4, 16.2, 14.8, 17.1, 16.6, 17.8, 16.9]
        rsrp_points = _spark_points(rsrp_vals)
        rsrq_points = _spark_points(rsrq_vals)
        sinr_points = _spark_points(sinr_vals)

        with rf_cols[0]:
            st.markdown('<div class="section-header">Signal Quality (Last 7 Days)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown(f"""
                <div class="rf-sparkline">
                    <svg viewBox="0 0 300 90" preserveAspectRatio="none">
                        <polyline class="rf-line a" stroke="#0EA5E9" points="{rsrp_points}"></polyline>
                        <polyline class="rf-line b" stroke="#22C55E" points="{rsrq_points}"></polyline>
                        <polyline class="rf-line c" stroke="#8B5CF6" points="{sinr_points}"></polyline>
                    </svg>
                </div>
                <div class="rf-legend">
                    RSRP (blue) • RSRQ (green) • SINR (purple)
                </div>
                """, unsafe_allow_html=True)

        handover_vals = [98.1, 98.3, 98.0, 98.4, 98.6, 98.5, 98.7]
        calldrop_vals = [0.9, 0.8, 0.95, 0.75, 0.7, 0.72, 0.68]
        handover_points = _spark_points(handover_vals)
        calldrop_points = _spark_points(calldrop_vals)

        with rf_cols[1]:
            st.markdown('<div class="section-header">Handover vs Call Drop</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown(f"""
                <div class="rf-sparkline">
                    <svg viewBox="0 0 300 90" preserveAspectRatio="none">
                        <polyline class="rf-line a" stroke="#10B981" points="{handover_points}"></polyline>
                        <polyline class="rf-line b" stroke="#EF4444" points="{calldrop_points}"></polyline>
                    </svg>
                </div>
                <div class="rf-legend">
                    Handover Success (green) • Call Drop Rate (red)
                </div>
                """, unsafe_allow_html=True)

        with rf_cols[2]:
            st.markdown('<div class="section-header">Top Call Drop Sites</div>', unsafe_allow_html=True)
            with st.container(border=True):
                drop_sites = pd.DataFrame({
                    'Site': ['Leeds Central', 'Manchester Arena', 'Birmingham New St', 'Sheffield City', 'Glasgow West'],
                    'Call Drop %': [1.4, 1.2, 1.0, 0.9, 0.85]
                })
                drop_chart = alt.Chart(drop_sites).mark_bar(color='#EF4444', cornerRadiusEnd=6).encode(
                    y=alt.Y('Site:N', sort='-x', title=None),
                    x=alt.X('Call Drop %:Q', title=None),
                    tooltip=['Site:N', alt.Tooltip('Call Drop %:Q', format='.2f')]
                ).properties(height=160)
                st.altair_chart(drop_chart, use_container_width=True)

        rf_row_left, rf_row_right = st.columns([1.2, 1])
        with rf_row_left:
            st.markdown('<div class="section-header">Correlation: Call Drop vs RSRP</div>', unsafe_allow_html=True)
            with st.container(border=True):
                corr_data = pd.DataFrame({
                    'Site': ['Leeds Central', 'Manchester Arena', 'Birmingham New St', 'Sheffield City', 'Glasgow West', 'London East', 'Liverpool Dock'],
                    'RSRP': [-106, -103, -101, -100, -98, -96, -97],
                    'Call Drop %': [1.5, 1.2, 1.0, 0.9, 0.8, 0.7, 0.75]
                })
                corr_chart = alt.Chart(corr_data).mark_circle(size=90, color='#EF4444', opacity=0.7).encode(
                    x=alt.X('RSRP:Q', title='RSRP (dBm)'),
                    y=alt.Y('Call Drop %:Q', title='Call Drop Rate %'),
                    tooltip=['Site:N', 'RSRP:Q', alt.Tooltip('Call Drop %:Q', format='.2f')]
                ).properties(height=200)
                st.altair_chart(corr_chart, use_container_width=True)

        with rf_row_right:
            st.markdown('<div class="section-header">SINR & PRB Hotspots</div>', unsafe_allow_html=True)
            with st.container(border=True):
                hotspot_data = pd.DataFrame({
                    'Cell': ['Leeds C-12', 'Manchester M-07', 'Birmingham B-03', 'Sheffield S-09', 'Liverpool L-05'],
                    'SINR (dB)': [8.4, 9.1, 7.8, 8.9, 9.4],
                    'PRB Util %': [88, 86, 91, 84, 82]
                })
                hotspot_chart = alt.Chart(hotspot_data).mark_bar(color='#F59E0B', cornerRadiusEnd=6).encode(
                    y=alt.Y('Cell:N', sort='-x', title=None),
                    x=alt.X('PRB Util %:Q', title='PRB Utilization %'),
                    tooltip=['Cell:N', 'SINR (dB):Q', 'PRB Util %:Q']
                ).properties(height=200)
                st.altair_chart(hotspot_chart, use_container_width=True)

    with tab_strategy:
        st.markdown("""
        <style>
        .net-ai-pulse {
            background: linear-gradient(135deg, #ECFEFF 0%, #CFFAFE 100%);
            border-radius: 16px;
            border: 1px solid #A5F3FC;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .net-ai-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(14,116,144,0.18), transparent);
            animation: net-ai-sweep 4s ease-in-out infinite;
        }
        @keyframes net-ai-sweep { 0% { left: -120%; } 100% { left: 220%; } }
        .net-ai-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .net-ai-title { font-weight: 700; color: #0E7490; font-size: 1.05rem; }
        .net-ai-tag { background: #0284C7; color: white; font-size: 0.75rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 999px; }
        .net-ai-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.9rem; position: relative; z-index: 1; }
        .net-ai-card { background: white; border-radius: 12px; border: 1px solid #A5F3FC; padding: 0.85rem 0.95rem; }
        .net-ai-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9CA3AF; }
        .net-ai-value { font-size: 1.3rem; font-weight: 700; color: #0E7490; }
        .net-ai-sub { font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) { .net-ai-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="net-ai-pulse">
            <div class="net-ai-header">
                <div class="net-ai-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="net-ai-tag">AI LIVE</div>
            </div>
            <div class="net-ai-grid">
                <div class="net-ai-card">
                    <div class="net-ai-label">Availability</div>
                    <div class="net-ai-value">99.72%</div>
                    <div class="net-ai-sub">Target 99.9%</div>
                </div>
                <div class="net-ai-card">
                    <div class="net-ai-label">Latency</div>
                    <div class="net-ai-value">24 ms</div>
                    <div class="net-ai-sub">Target &lt; 20 ms</div>
                </div>
                <div class="net-ai-card">
                    <div class="net-ai-label">Call Drops</div>
                    <div class="net-ai-value">0.7%</div>
                    <div class="net-ai-sub">↓ -0.2% MoM</div>
                </div>
                <div class="net-ai-card">
                    <div class="net-ai-label">Sites at Risk</div>
                    <div class="net-ai-value">124</div>
                    <div class="net-ai-sub">>70% utilization</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Summary synthesized from availability, RF, and alarm telemetry.")
        
        with st.container(border=True):
            st.markdown("""
            **Executive Summary (Q1 2026):**
            - Network availability holds at **99.72%**, with localized alarms in Leeds and Manchester.
            - RF optimization shows improving SINR in priority cells, but **124 sites** remain above 70% utilization.
            - MTTR improved to **42 min**, trending toward the 30‑minute target.
            """)
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **5G** delivers 4.2x faster downloads vs 4G
                - **SINR** improving in Manchester hotspots
                - **SLA attainment** at 97.8%
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **124 sites** above 70% utilization
                - **Call drops** elevated in Leeds Central
                - **Critical alarms** at 12 sites
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Growth Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Capacity upgrades** scheduled for top 20 sites
                - **Handover success** at 98.4%
                - **RF tuning** coverage expanding weekly
                """)
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                - **Lift availability** with targeted Leeds upgrades
                - Automate P1 incident routing
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                - **Reduce MTTR** via AIOps auto-triage
                - Standardize playbooks across regions
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                - **Expand capacity** on top 20 congested sites
                - Prioritize PRB >80% cells
                """)
        
        st.markdown('<div class="section-header">VP Network Operations Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">99.9% Availability</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **99.72%** uptime
                - Gap: **0.18%** to target
                - Focus: Leeds region upgrades
                - Investment: **£1.2M** capex
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">MTTR Reduction</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Target: **30 min** for P1
                - Current: **42 min** MTTR
                - Action: AIOps automation
                - Launch: February 2026
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Capacity Planning</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Alert: **124 sites** >70%
                - Action: Expand top 20 sites
                - Budget: **£3.8M** approved
                - Timeline: Q1-Q2 2026
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "Show me the current health of our network - availability, latency, and throughput.",
            "Show me network alarms by severity with MTTR and alarm duration.",
            "How is our network performing by region?",
            "Which network elements have utilization above 60%?",
            "Show me RF optimization KPIs - RSRP, RSRQ, SINR, handover success, and call drop rate.",
            "Are we meeting our SLAs? Show me breaches and credit liability."
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_alert_center():
    import pandas as pd
    import altair as alt
    
    # Alert Center Header with Alarm Flash Effect
    st.markdown("""
    <style>
    @keyframes alert-flash { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0.5; } }
    @keyframes alert-ring { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
    @keyframes alert-scan { 0% { left: 0; } 100% { left: 100%; } }
    .alert-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .alert-effects { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
    .alert-beacon { position: absolute; width: 20px; height: 20px; background: #EF4444; border-radius: 50%; animation: alert-flash 1s ease-in-out infinite; }
    .alert-ring-effect { position: absolute; width: 30px; height: 30px; border: 2px solid #EF4444; border-radius: 50%; animation: alert-ring 2s ease-out infinite; }
    .alert-scan-line { position: absolute; top: 0; width: 3px; height: 100%; background: linear-gradient(180deg, transparent, rgba(239,68,68,0.5), transparent); animation: alert-scan 3s linear infinite; }
    .alert-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(-45deg, #DC2626, #EF4444, #B91C1C, #991B1B);
        background-size: 400% 400%;
        animation: gradient-shift 12s ease infinite;
        padding: 2rem; color: white;
    }
    .alert-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; }
    .alert-header-content p { margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 1.1rem; }
    </style>
    <div class="alert-header-wrap">
        <div class="alert-effects">
            <div class="alert-beacon" style="left: 10%; top: 30%;"></div>
            <div class="alert-beacon" style="right: 15%; top: 40%; animation-delay: 0.3s;"></div>
            <div class="alert-beacon" style="left: 40%; bottom: 25%; animation-delay: 0.6s;"></div>
            <div class="alert-ring-effect" style="left: 10%; top: 25%;"></div>
            <div class="alert-ring-effect" style="right: 15%; top: 35%; animation-delay: 1s;"></div>
            <div class="alert-scan-line"></div>
        </div>
        <div class="alert-header-content">
            <h1>🚨 Network Alert Center</h1>
            <p>Real-Time Network Monitoring, Incident Management & SLA Tracking</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🛠️ Incident Response", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['NETWORK_ALARM', 'NETWORK_OPS', 'SLA']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake** — Real-time alert streaming via Snowpipe Streaming with Cortex Anomaly Detection for predictive alerting")
        
        # Animated CSS Styles
        st.markdown("""
        <style>
        @keyframes pulse-critical {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.02); }
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            50% { opacity: 0.8; box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
        }
        @keyframes heartbeat {
            0%, 100% { height: 15%; }
            10% { height: 90%; }
            20% { height: 30%; }
            30% { height: 70%; }
            40% { height: 20%; }
            50% { height: 85%; }
            60% { height: 40%; }
            70% { height: 60%; }
            80% { height: 25%; }
            90% { height: 75%; }
        }
        @keyframes flow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }
        .pulse-critical { animation: pulse-critical 2s ease-in-out infinite; }
        .pulse-dot { animation: pulse-dot 1.5s ease-out infinite; }
        .heartbeat-bar { animation: heartbeat 0.8s ease-in-out infinite; transform-origin: bottom; }
        .flow-bar { animation: flow 2s linear infinite; background-size: 200% 100%; }
        .blink { animation: blink 1s ease-in-out infinite; }
        </style>
        """, unsafe_allow_html=True)
        
        # Alert Status Banner with Animation
        st.markdown("""
        <div class="pulse-critical" style="background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%); border: 2px solid #DC2626; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div class="pulse-dot" style="width: 20px; height: 20px; background: #DC2626; border-radius: 50%;"></div>
                    <div>
                        <div style="font-weight: 700; color: #DC2626; font-size: 1.1rem;">🚨 CRITICAL ALERT STATUS</div>
                        <div style="color: #991B1B; font-size: 0.9rem;">3 P1 Critical Alerts Active • 97,000 subscribers affected • NOC teams engaged</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 0.75rem; color: #DC2626;">LIVE</div>
                    <div class="blink" style="font-weight: 600; color: #DC2626;">● Recording</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # Live Network Heartbeat Monitor
        st.markdown("""
        <style>
        @keyframes eq-bar {
            0%, 100% { height: 20%; }
            10% { height: 80%; }
            20% { height: 40%; }
            30% { height: 90%; }
            40% { height: 30%; }
            50% { height: 70%; }
            60% { height: 50%; }
            70% { height: 85%; }
            80% { height: 35%; }
            90% { height: 60%; }
        }
        .eq-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: 2px;
            height: 70px;
            background: #F1F5F9;
            border-radius: 8px;
            padding: 12px 20px;
            border: 1px solid #E2E8F0;
        }
        .eq-bar {
            flex: 1;
            max-width: 8px;
            min-width: 4px;
            border-radius: 2px;
            animation: eq-bar 1.2s ease-in-out infinite;
        }
        </style>
        <div style="background: #F8FAFC; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem; border: 1px solid #E2E8F0;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
                <div style="color: #1B2A4E; font-weight: 600;">📡 Live Network Heartbeat</div>
                <div style="display: flex; gap: 1.5rem; font-size: 0.8rem;">
                    <span style="color: #10B981;">● 14,847 Active Sites</span>
                    <span style="color: #F59E0B;">● 62 Degraded</span>
                    <span style="color: #DC2626;">● 3 Critical</span>
                </div>
            </div>
            <div class="eq-container">
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.00s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.02s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.04s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.06s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.08s;"></div>
                <div class="eq-bar" style="background: #F59E0B; animation-delay: 0.10s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.12s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.14s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.16s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.18s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.20s;"></div>
                <div class="eq-bar" style="background: #DC2626; animation-delay: 0.22s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.24s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.26s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.28s;"></div>
                <div class="eq-bar" style="background: #F59E0B; animation-delay: 0.30s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.32s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.34s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.36s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.38s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.40s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.42s;"></div>
                <div class="eq-bar" style="background: #DC2626; animation-delay: 0.44s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.46s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.48s;"></div>
                <div class="eq-bar" style="background: #F59E0B; animation-delay: 0.50s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.52s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.54s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.56s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.58s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.60s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.62s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.64s;"></div>
                <div class="eq-bar" style="background: #DC2626; animation-delay: 0.66s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.68s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.70s;"></div>
                <div class="eq-bar" style="background: #F59E0B; animation-delay: 0.72s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.74s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.76s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.78s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.80s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.82s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.84s;"></div>
                <div class="eq-bar" style="background: #DC2626; animation-delay: 0.86s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.88s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.90s;"></div>
                <div class="eq-bar" style="background: #F59E0B; animation-delay: 0.92s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.94s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.96s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 0.98s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 1.00s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 1.02s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 1.04s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 1.06s;"></div>
                <div class="eq-bar" style="background: #F59E0B; animation-delay: 1.08s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 1.10s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 1.12s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 1.14s;"></div>
                <div class="eq-bar" style="background: #DC2626; animation-delay: 1.16s;"></div>
                <div class="eq-bar" style="background: #10B981; animation-delay: 1.18s;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.7rem; color: #94A3B8;">
                <span>Throughput: 142 Gbps</span>
                <span>Latency: 12ms avg</span>
                <span>Packets: 2.4B/sec</span>
                <span>Errors: 0.002%</span>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # AI Anomaly Detection Alerts
        st.markdown('<div class="section-header">AI-Detected Anomalies</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        @keyframes anomaly-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.6); }
        }
        @keyframes anomaly-scan {
            0% { left: 0; opacity: 0; }
            50% { opacity: 1; }
            100% { left: 100%; opacity: 0; }
        }
        @keyframes anomaly-pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        .anomaly-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .anomaly-card {
            background: linear-gradient(135deg, #F5F3FF 0%, #EDE9FE 100%);
            border: 1px solid #DDD6FE;
            border-radius: 12px;
            padding: 1rem;
            position: relative;
            overflow: hidden;
            animation: anomaly-glow 3s ease-in-out infinite;
        }
        .anomaly-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(139,92,246,0.1), transparent);
            animation: anomaly-scan 3s linear infinite;
        }
        .anomaly-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        .anomaly-icon-wrap {
            position: relative;
            width: 40px;
            height: 40px;
        }
        .anomaly-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            position: relative;
            z-index: 2;
        }
        .anomaly-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 2px solid #8B5CF6;
            border-radius: 10px;
            animation: anomaly-pulse-ring 2s ease-out infinite;
        }
        .anomaly-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .anomaly-badge.critical { background: #FEE2E2; color: #DC2626; }
        .anomaly-badge.warning { background: #FEF3C7; color: #D97706; }
        .anomaly-badge.info { background: #DBEAFE; color: #2563EB; }
        .anomaly-title {
            font-weight: 600;
            color: #1B2A4E;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }
        .anomaly-desc {
            font-size: 0.8rem;
            color: #6B7280;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }
        .anomaly-stats {
            display: flex;
            gap: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid #DDD6FE;
        }
        .anomaly-stat {
            flex: 1;
        }
        .anomaly-stat-label {
            font-size: 0.65rem;
            color: #9CA3AF;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .anomaly-stat-value {
            font-size: 0.9rem;
            font-weight: 700;
            color: #1B2A4E;
        }
        .anomaly-confidence {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .confidence-mini-bar {
            flex: 1;
            height: 4px;
            background: #E5E7EB;
            border-radius: 2px;
            overflow: hidden;
        }
        .confidence-mini-fill {
            height: 100%;
            background: linear-gradient(90deg, #8B5CF6, #7C3AED);
            border-radius: 2px;
        }
        .confidence-mini-label {
            font-size: 0.7rem;
            color: #8B5CF6;
            font-weight: 600;
        }
        </style>
        <div class="anomaly-grid">
            <div class="anomaly-card">
                <div class="anomaly-header">
                    <div class="anomaly-icon-wrap">
                        <div class="anomaly-ring"></div>
                        <div class="anomaly-icon">📡</div>
                    </div>
                    <span class="anomaly-badge critical">Critical</span>
                </div>
                <div class="anomaly-title">Unusual Traffic Spike Detected</div>
                <div class="anomaly-desc">AI detected 340% traffic increase on Manchester-Core-01 backbone link. Pattern suggests potential DDoS or major event. Auto-mitigation triggered.</div>
                <div class="anomaly-stats">
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Detected</div>
                        <div class="anomaly-stat-value">2 min ago</div>
                    </div>
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Impact</div>
                        <div class="anomaly-stat-value">47K users</div>
                    </div>
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Status</div>
                        <div class="anomaly-stat-value" style="color: #F59E0B;">Mitigating</div>
                    </div>
                </div>
                <div class="anomaly-confidence">
                    <div class="confidence-mini-bar"><div class="confidence-mini-fill" style="width: 96%;"></div></div>
                    <span class="confidence-mini-label">96% AI Confidence</span>
                </div>
            </div>
            <div class="anomaly-card">
                <div class="anomaly-header">
                    <div class="anomaly-icon-wrap">
                        <div class="anomaly-ring" style="animation-delay: 0.5s;"></div>
                        <div class="anomaly-icon">⚡</div>
                    </div>
                    <span class="anomaly-badge warning">Warning</span>
                </div>
                <div class="anomaly-title">Latency Pattern Anomaly</div>
                <div class="anomaly-desc">Predicted latency spike in London-East region within 15 minutes based on historical patterns and current load trajectory.</div>
                <div class="anomaly-stats">
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Predicted</div>
                        <div class="anomaly-stat-value">+45ms spike</div>
                    </div>
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Risk Level</div>
                        <div class="anomaly-stat-value" style="color: #F59E0B;">Medium</div>
                    </div>
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Action</div>
                        <div class="anomaly-stat-value" style="color: #10B981;">Pre-scaling</div>
                    </div>
                </div>
                <div class="anomaly-confidence">
                    <div class="confidence-mini-bar"><div class="confidence-mini-fill" style="width: 89%;"></div></div>
                    <span class="confidence-mini-label">89% AI Confidence</span>
                </div>
            </div>
            <div class="anomaly-card">
                <div class="anomaly-header">
                    <div class="anomaly-icon-wrap">
                        <div class="anomaly-ring" style="animation-delay: 1s;"></div>
                        <div class="anomaly-icon">🔋</div>
                    </div>
                    <span class="anomaly-badge warning">Warning</span>
                </div>
                <div class="anomaly-title">Equipment Degradation Predicted</div>
                <div class="anomaly-desc">ML model predicts hardware failure on BTS-4521 (Birmingham) within 72 hours based on temperature and error rate patterns.</div>
                <div class="anomaly-stats">
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Time to Fail</div>
                        <div class="anomaly-stat-value">~68 hours</div>
                    </div>
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Component</div>
                        <div class="anomaly-stat-value">Power Amp</div>
                    </div>
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Action</div>
                        <div class="anomaly-stat-value" style="color: #2563EB;">Scheduled</div>
                    </div>
                </div>
                <div class="anomaly-confidence">
                    <div class="confidence-mini-bar"><div class="confidence-mini-fill" style="width: 91%;"></div></div>
                    <span class="confidence-mini-label">91% AI Confidence</span>
                </div>
            </div>
            <div class="anomaly-card">
                <div class="anomaly-header">
                    <div class="anomaly-icon-wrap">
                        <div class="anomaly-ring" style="animation-delay: 1.5s;"></div>
                        <div class="anomaly-icon">👥</div>
                    </div>
                    <span class="anomaly-badge info">Info</span>
                </div>
                <div class="anomaly-title">Churn Correlation Detected</div>
                <div class="anomaly-desc">AI identified correlation: customers experiencing >3 network issues in Leeds area showing 4x higher churn propensity.</div>
                <div class="anomaly-stats">
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">At Risk</div>
                        <div class="anomaly-stat-value">234 customers</div>
                    </div>
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Revenue Risk</div>
                        <div class="anomaly-stat-value">£89K/mo</div>
                    </div>
                    <div class="anomaly-stat">
                        <div class="anomaly-stat-label">Action</div>
                        <div class="anomaly-stat-value" style="color: #10B981;">Outreach</div>
                    </div>
                </div>
                <div class="anomaly-confidence">
                    <div class="confidence-mini-bar"><div class="confidence-mini-fill" style="width: 87%;"></div></div>
                    <span class="confidence-mini-label">87% AI Confidence</span>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # KPI Cards with animations
        st.markdown("""
        <style>
        .alert-kpi-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .alert-kpi { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1rem; text-align: center; position: relative; transition: transform 0.2s, box-shadow 0.2s; }
        .alert-kpi:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .alert-kpi.critical { border-left: 4px solid #DC2626; animation: pulse-critical 2s ease-in-out infinite; }
        .alert-kpi.major { border-left: 4px solid #F59E0B; }
        .alert-kpi.minor { border-left: 4px solid #3B82F6; }
        .alert-kpi.warning { border-left: 4px solid #6B7280; }
        .alert-kpi.cleared { border-left: 4px solid #10B981; }
        .alert-kpi.sla { border-left: 4px solid #8B5CF6; }
        .alert-kpi-value { font-size: 2rem; font-weight: 700; }
        .alert-kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; }
        .alert-kpi-delta { font-size: 0.85rem; margin-top: 0.25rem; }
        </style>
        
        <div class="alert-kpi-grid">
            <div class="alert-kpi critical">
                <div class="pulse-dot" style="position: absolute; top: 8px; right: 8px; width: 10px; height: 10px; background: #DC2626; border-radius: 50%;"></div>
                <div class="alert-kpi-value" style="color: #DC2626;">3</div>
                <div class="alert-kpi-label">P1 Critical</div>
                <div class="alert-kpi-delta" style="color: #DC2626;">↑ +1 vs yesterday</div>
            </div>
            <div class="alert-kpi major">
                <div class="alert-kpi-value" style="color: #F59E0B;">12</div>
                <div class="alert-kpi-label">P2 Major</div>
                <div class="alert-kpi-delta" style="color: #10B981;">↓ -3 vs yesterday</div>
            </div>
            <div class="alert-kpi minor">
                <div class="alert-kpi-value" style="color: #3B82F6;">47</div>
                <div class="alert-kpi-label">P3 Minor</div>
                <div class="alert-kpi-delta" style="color: #6B7280;">— stable</div>
            </div>
            <div class="alert-kpi warning">
                <div class="alert-kpi-value" style="color: #6B7280;">128</div>
                <div class="alert-kpi-label">P4 Warning</div>
                <div class="alert-kpi-delta" style="color: #10B981;">↓ -8%</div>
            </div>
            <div class="alert-kpi cleared">
                <div class="alert-kpi-value" style="color: #10B981;">1,247</div>
                <div class="alert-kpi-label">Cleared Today</div>
                <div class="alert-kpi-delta" style="color: #10B981;">94% auto-resolved</div>
            </div>
            <div class="alert-kpi sla">
                <div class="alert-kpi-value" style="color: #8B5CF6;">98.2%</div>
                <div class="alert-kpi-label">SLA Compliance</div>
                <div class="alert-kpi-delta" style="color: #DC2626;">↓ -0.3% (target: 99%)</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # Main content - Map and Live Feed
        map_col, feed_col = st.columns([1.5, 1])
        
        with map_col:
            st.markdown('<div class="section-header">🗺️ UK Network Status Map</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                # Cell tower data with status
                tower_data = pd.DataFrame({
                    'lat': [51.5074, 51.4545, 53.4808, 53.8008, 52.4862, 55.9533, 51.4816, 
                            52.2053, 53.4084, 54.9783, 50.9097, 51.4552, 53.0027, 51.6214,
                            52.6309, 55.8642, 53.7676, 51.3811, 50.7184, 54.5973,
                            51.5287, 51.4427, 53.4631, 52.9548, 51.8787, 53.2307, 52.0406],
                    'lon': [-0.1278, -2.5879, -2.2426, -1.5491, -1.8904, -3.1883, -3.1791, 
                            0.1218, -2.9916, -1.6178, -1.4044, -0.9787, -2.1794, -0.3017,
                            -1.1398, -4.2518, -0.3274, -0.2889, -1.8795, -5.9301,
                            -0.1016, -0.3475, -2.2282, -1.1581, -0.4200, -2.9264, -0.7594],
                    'name': ['London Central', 'Bristol', 'Manchester', 'Leeds', 'Birmingham', 'Edinburgh', 'Cardiff',
                             'Cambridge', 'Liverpool', 'Newcastle', 'Southampton', 'Reading', 'Chester', 'Watford',
                             'Coventry', 'Glasgow', 'Hull', 'Croydon', 'Bournemouth', 'Belfast',
                             'Canary Wharf', 'Wimbledon', 'Salford', 'Leicester', 'Guildford', 'Bolton', 'Northampton'],
                    'status': ['critical', 'healthy', 'major', 'healthy', 'healthy', 'minor', 'healthy',
                               'healthy', 'major', 'healthy', 'healthy', 'minor', 'healthy', 'healthy',
                               'critical', 'healthy', 'healthy', 'healthy', 'healthy', 'major',
                               'critical', 'healthy', 'healthy', 'healthy', 'healthy', 'minor', 'healthy'],
                    'alerts': [5, 0, 3, 0, 1, 2, 0, 0, 4, 1, 0, 2, 0, 0, 6, 1, 0, 0, 0, 3, 4, 0, 1, 0, 0, 2, 0],
                    'subscribers': [42000, 18000, 35000, 28000, 31000, 22000, 15000, 12000, 24000, 19000, 
                                   14000, 16000, 11000, 13000, 17000, 26000, 9000, 21000, 10000, 8000,
                                   38000, 15000, 20000, 18000, 11000, 12000, 14000]
                })
                
                # Color mapping
                color_map = {'critical': '#DC2626', 'major': '#F59E0B', 'minor': '#3B82F6', 'healthy': '#10B981'}
                tower_data['color'] = tower_data['status'].map(color_map)
                
                # Size based on alerts (minimum size for visibility)
                tower_data['size'] = tower_data['alerts'].apply(lambda x: max(300, x * 200))
                
                st.map(tower_data, latitude='lat', longitude='lon', size='size', color='color', zoom=5.2)
                
                # Legend
                st.markdown("""
                <div style="display: flex; justify-content: center; gap: 1.5rem; margin-top: 0.5rem; font-size: 0.8rem;">
                    <span><span style="color: #DC2626;">●</span> Critical (3)</span>
                    <span><span style="color: #F59E0B;">●</span> Major (3)</span>
                    <span><span style="color: #3B82F6;">●</span> Minor (4)</span>
                    <span><span style="color: #10B981;">●</span> Healthy (17)</span>
                </div>
                <div style="text-align: center; font-size: 0.75rem; color: #6B7280; margin-top: 0.25rem;">
                    Bubble size = Active alerts at site
                </div>
                """, unsafe_allow_html=True)
        
        with feed_col:
            st.markdown('<div class="section-header">⚡ Live Alert Feed</div>', unsafe_allow_html=True)
            
            with st.container(border=True, height=450):
                # P1 Critical Alerts
                st.error("🔴 **P1 CRITICAL** — London Central - Core Router Failure  \n42,000 subscribers affected • MTTR: 45 min • *2 min ago*")
                st.error("🔴 **P1 CRITICAL** — Canary Wharf - Power Outage  \n38,000 subscribers affected • Backup active • *8 min ago*")
                st.error("🔴 **P1 CRITICAL** — Coventry - Fibre Cut Detected  \n17,000 subscribers affected • Field team dispatched • *15 min ago*")
                
                # P2 Major Alerts
                st.warning("🟠 **P2 MAJOR** — Manchester - High Latency  \nLatency: 85ms (threshold: 50ms) • *22 min ago*")
                st.warning("🟠 **P2 MAJOR** — Liverpool - Capacity Warning  \nCell utilization: 92% (threshold: 85%) • *31 min ago*")
                st.warning("🟠 **P2 MAJOR** — Belfast - Backhaul Degradation  \nThroughput: 60% of normal • *45 min ago*")
                
                # P3 Minor Alert
                st.info("🔵 **P3 MINOR** — Edinburgh - Antenna Tilt Drift  \nCoverage impact: Minimal • *52 min ago*")
                
                # Cleared Alert
                st.success("✅ **CLEARED** — Birmingham - RAN Software Update  \nAuto-resolved after successful patch • *1 hr ago*")
        
        # Second row - Charts
        st.markdown('<div class="section-header">📊 Alert Analytics</div>', unsafe_allow_html=True)
        
        chart_col1, chart_col2, chart_col3 = st.columns(3)
        
        with chart_col1:
            st.markdown("**Alert Trend (24 Hours)**")
            with st.container(border=True):
                hours = [f'{h:02d}:00' for h in range(24)]
                trend_data = pd.DataFrame({
                    'Hour': hours,
                    'P1': [1,1,0,0,0,0,0,1,1,2,2,3,3,3,2,2,3,3,3,2,2,2,2,3],
                    'P2': [5,4,4,3,3,4,5,7,9,12,14,15,14,13,12,11,12,13,12,11,10,9,8,12],
                    'P3': [20,18,15,14,12,15,22,35,42,48,52,55,50,48,45,42,47,50,48,45,40,35,30,47]
                })
                
                trend_melted = trend_data.melt(id_vars=['Hour'], var_name='Severity', value_name='Count')
                
                trend_chart = alt.Chart(trend_melted).mark_area(opacity=0.7).encode(
                    x=alt.X('Hour:N', title=None, axis=alt.Axis(labelAngle=-45, values=[f'{h:02d}:00' for h in range(0, 24, 4)])),
                    y=alt.Y('Count:Q', stack='zero', title='Alerts'),
                    color=alt.Color('Severity:N', scale=alt.Scale(
                        domain=['P1', 'P2', 'P3'],
                        range=['#DC2626', '#F59E0B', '#3B82F6']
                    ), legend=alt.Legend(orient='top', title=None)),
                    tooltip=['Hour:N', 'Severity:N', 'Count:Q']
                ).properties(height=200)
                
                st.altair_chart(trend_chart, use_container_width=True)
        
        with chart_col2:
            st.markdown("**Alerts by Region**")
            with st.container(border=True):
                region_alerts = pd.DataFrame({
                    'Region': ['London', 'North West', 'Midlands', 'Scotland', 'South East', 'Yorkshire', 'Wales', 'North East'],
                    'Alerts': [18, 14, 12, 8, 7, 6, 5, 4],
                    'Resolved': [15, 11, 10, 7, 6, 5, 4, 4]
                })
                
                bars = alt.Chart(region_alerts).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Alerts:Q', title='Active Alerts'),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.condition(
                        alt.datum.Alerts > 10,
                        alt.value('#DC2626'),
                        alt.value('#29B5E8')
                    ),
                    tooltip=['Region:N', 'Alerts:Q', 'Resolved:Q']
                ).properties(height=200)
                
                st.altair_chart(bars, use_container_width=True)
        
        with chart_col3:
            st.markdown("**MTTR by Severity**")
            with st.container(border=True):
                mttr_data = pd.DataFrame({
                    'Severity': ['P1 Critical', 'P2 Major', 'P3 Minor', 'P4 Warning'],
                    'Actual': [42, 68, 124, 240],
                    'Target': [30, 60, 120, 480],
                    'Status': ['Breached', 'Breached', 'Met', 'Met']
                })
                
                mttr_bars = alt.Chart(mttr_data).mark_bar(cornerRadiusTopRight=6, cornerRadiusTopLeft=6).encode(
                    x=alt.X('Severity:N', title=None, sort=['P1 Critical', 'P2 Major', 'P3 Minor', 'P4 Warning']),
                    y=alt.Y('Actual:Q', title='Minutes'),
                    color=alt.Color('Status:N', scale=alt.Scale(
                        domain=['Met', 'Breached'],
                        range=['#10B981', '#DC2626']
                    ), legend=alt.Legend(orient='top', title=None)),
                    tooltip=['Severity:N', alt.Tooltip('Actual:Q', title='Actual (min)'), alt.Tooltip('Target:Q', title='Target (min)')]
                ).properties(height=200)
                
                # Target line
                target_line = alt.Chart(mttr_data).mark_tick(color='#1B2A4E', thickness=3, size=30).encode(
                    x=alt.X('Severity:N', sort=['P1 Critical', 'P2 Major', 'P3 Minor', 'P4 Warning']),
                    y=alt.Y('Target:Q')
                )
                
                st.altair_chart(mttr_bars + target_line, use_container_width=True)
                st.caption("Black line = SLA Target")
        
    with tab_ops:
        st.markdown("""
        <style>
        @keyframes alert-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(220,38,38,0.15); }
            50% { box-shadow: 0 0 24px rgba(220,38,38,0.35); }
        }
        @keyframes alert-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .alert-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
            border: 1px solid #FCA5A5;
            animation: alert-ops-glow 3s ease-in-out infinite;
        }
        .alert-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: alert-ops-sweep 3s linear infinite;
        }
        .alert-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .alert-ops-title { font-weight: 700; color: #991B1B; }
        .alert-ops-tag {
            background: rgba(220,38,38,0.15);
            color: #991B1B;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .alert-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .alert-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(220,38,38,0.2);
        }
        .alert-ops-label { font-size: 0.7rem; color: #B91C1C; text-transform: uppercase; letter-spacing: 0.06em; }
        .alert-ops-value { font-size: 1.35rem; font-weight: 700; color: #7F1D1D; }
        .alert-ops-delta { font-size: 0.75rem; color: #991B1B; }
        </style>
        <div class="alert-ops-pulse">
            <div class="alert-ops-header">
                <div class="alert-ops-title">🛠️ Incident Response Pulse</div>
                <div class="alert-ops-tag">LIVE OPS</div>
            </div>
            <div class="alert-ops-grid">
                <div class="alert-ops-card">
                    <div class="alert-ops-label">Active Incidents</div>
                    <div class="alert-ops-value">9</div>
                    <div class="alert-ops-delta">3 critical • 6 major</div>
                </div>
                <div class="alert-ops-card">
                    <div class="alert-ops-label">Avg MTTR</div>
                    <div class="alert-ops-value">58 min</div>
                    <div class="alert-ops-delta">+6 min vs target</div>
                </div>
                <div class="alert-ops-card">
                    <div class="alert-ops-label">SLA Breaches</div>
                    <div class="alert-ops-value">2</div>
                    <div class="alert-ops-delta">£48K exposure</div>
                </div>
                <div class="alert-ops-card">
                    <div class="alert-ops-label">Engineers Online</div>
                    <div class="alert-ops-value">62</div>
                    <div class="alert-ops-delta">8 field teams active</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        # Third row - Affected Services and Impact
        st.markdown('<div class="section-header">🎯 Impact Analysis</div>', unsafe_allow_html=True)
        
        impact_col1, impact_col2 = st.columns(2)
        
        with impact_col1:
            st.markdown("**Affected Services**")
            with st.container(border=True):
                services_df = pd.DataFrame({
                    'Service': ['Voice Calls', 'Mobile Data', '5G Services', 'SMS', 'VoLTE', 'Roaming'],
                    'Status': ['🔴 Degraded', '🟠 Impacted', '🔴 Degraded', '🟢 Normal', '🟠 Impacted', '🟢 Normal'],
                    'Affected Users': ['42,000', '97,000', '38,000', '-', '24,000', '-'],
                    'Impact': ['High', 'Medium', 'High', 'None', 'Medium', 'None'],
                    'ETA': ['45 min', '30 min', '1 hr', '-', '30 min', '-']
                })
                st.dataframe(services_df, use_container_width=True, hide_index=True)
        
        with impact_col2:
            st.markdown("**SLA Credit Exposure**")
            with st.container(border=True):
                st.markdown("""
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <div style="background: #FEE2E2; padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.8rem; color: #DC2626;">P1 SLA Breaches</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: #DC2626;">2</div>
                        <div style="font-size: 0.75rem; color: #991B1B;">Credit exposure: £48K</div>
                    </div>
                    <div style="background: #FEF3C7; padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.8rem; color: #F59E0B;">P2 SLA At Risk</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: #F59E0B;">4</div>
                        <div style="font-size: 0.75rem; color: #92400E;">Potential: £24K</div>
                    </div>
                    <div style="background: #DBEAFE; padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.8rem; color: #3B82F6;">Credits YTD</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: #3B82F6;">£186K</div>
                        <div style="font-size: 0.75rem; color: #1D4ED8;">Budget: £250K</div>
                    </div>
                    <div style="background: #D1FAE5; padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.8rem; color: #10B981;">Uptime (MTD)</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: #10B981;">99.92%</div>
                        <div style="font-size: 0.75rem; color: #059669;">Target: 99.95%</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        # Incident Response Teams
        st.markdown('<div class="section-header">👥 Active Incident Response</div>', unsafe_allow_html=True)
        
        team_cols = st.columns(3)
        
        with team_cols[0]:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                    <div style="background: #DC2626; color: white; padding: 0.5rem; border-radius: 8px; font-weight: 700;">INC-4521</div>
                    <div style="font-weight: 600;">London Central Outage</div>
                </div>
                """, unsafe_allow_html=True)
                st.markdown("**Incident Commander:** Sarah Chen")
                st.markdown("**Team:** NOC Alpha (8 engineers)")
                st.progress(0.65, "Resolution Progress: 65%")
                st.caption("ETA: 45 minutes • Comms: Bridge active")
        
        with team_cols[1]:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                    <div style="background: #DC2626; color: white; padding: 0.5rem; border-radius: 8px; font-weight: 700;">INC-4519</div>
                    <div style="font-weight: 600;">Canary Wharf Power</div>
                </div>
                """, unsafe_allow_html=True)
                st.markdown("**Incident Commander:** Mike Thompson")
                st.markdown("**Team:** Field Ops + Facilities")
                st.progress(0.40, "Resolution Progress: 40%")
                st.caption("ETA: 1 hour • Generator running")
        
        with team_cols[2]:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                    <div style="background: #DC2626; color: white; padding: 0.5rem; border-radius: 8px; font-weight: 700;">INC-4518</div>
                    <div style="font-weight: 600;">Coventry Fibre Cut</div>
                </div>
                """, unsafe_allow_html=True)
                st.markdown("**Incident Commander:** James Wilson")
                st.markdown("**Team:** External contractor")
                st.progress(0.25, "Resolution Progress: 25%")
                st.caption("ETA: 2 hours • Excavation required")

    with tab_strategy:
        st.markdown("""
        <style>
        .sf-alert-pulse {
            background: linear-gradient(135deg, #0EA5E9 0%, #2563EB 100%);
            color: white;
            border-radius: 14px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .sf-alert-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: si-sweep 3s linear infinite;
        }
        @keyframes si-sweep {
            0% { transform: translateX(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(250%); opacity: 0; }
        }
        @keyframes si-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(14,165,233,0.35); }
            50% { box-shadow: 0 0 22px rgba(14,165,233,0.6); }
        }
        .sf-alert-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-alert-title { font-weight: 700; font-size: 1rem; }
        .sf-alert-tag { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 999px; background: rgba(255,255,255,0.2); letter-spacing: 0.08em; }
        .sf-alert-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-alert-card { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 0.75rem; animation: si-glow 3s ease-in-out infinite; }
        .sf-alert-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; opacity: 0.8; }
        .sf-alert-value { font-size: 1.25rem; font-weight: 700; }
        </style>
        <div class="sf-alert-pulse">
            <div class="sf-alert-header">
                <div class="sf-alert-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-alert-tag">AI LIVE</div>
            </div>
            <div class="sf-alert-grid">
                <div class="sf-alert-card">
                    <div class="sf-alert-label">Risk Hotspots</div>
                    <div class="sf-alert-value">6 regions</div>
                </div>
                <div class="sf-alert-card">
                    <div class="sf-alert-label">Predicted Breaches</div>
                    <div class="sf-alert-value">3 SLA</div>
                </div>
                <div class="sf-alert-card">
                    <div class="sf-alert-label">Auto-Mitigation</div>
                    <div class="sf-alert-value">92%</div>
                </div>
                <div class="sf-alert-card">
                    <div class="sf-alert-label">Revenue at Risk</div>
                    <div class="sf-alert-value">£142K</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Snowflake Intelligence** flags three high-risk incidents likely to breach SLA within 60 minutes, driven by correlated power faults and backhaul congestion. Automated mitigations are containing impact in 92% of cases, but two London sites require manual escalation.")

        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Escalation Pattern**")
                st.caption("P1 alerts rising in London + Midlands after 18:00; 4 sites share upstream power dependency.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**SLA Drift**")
                st.caption("MTTR for P2 incidents trending 12% above target; staffing gap in field ops coverage window.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Customer Impact**")
                st.caption("High-value enterprise accounts in Manchester show 3x incident exposure vs baseline this week.")

        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Automate Power Failover**")
                st.caption("Expand smart failover rules across 14 at-risk sites; projected SLA recovery +0.4%.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Targeted Field Dispatch**")
                st.caption("Pre-stage crews in London/Midlands corridors to cut P1 MTTR by ~18 minutes.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Alert Noise Reduction**")
                st.caption("Tune alarm thresholds for 9 low-impact KPIs to lower P3 volume by 22%.")

        st.markdown('<div class="section-header">Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        pri_col1, pri_col2, pri_col3 = st.columns(3)
        with pri_col1:
            with st.container(border=True):
                st.markdown("**SLA Resilience**")
                st.caption("Deploy predictive MTTR alerts and auto-remediation playbooks.")
        with pri_col2:
            with st.container(border=True):
                st.markdown("**Critical Site Hardening**")
                st.caption("Upgrade power redundancy for the top 20 revenue-impacting sites.")
        with pri_col3:
            with st.container(border=True):
                st.markdown("**Customer Impact Lens**")
                st.caption("Prioritize incident triage using churn risk and revenue weighting.")

        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "Show me all P1 critical alerts with their MTTR and affected subscribers.",
            "Which network sites have the most recurring alerts this month?",
            "What's our SLA compliance rate by region and alert severity?",
            "Show me the correlation between alerts and customer churn risk.",
            "Which alerts are impacting our highest-value customers?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_head_of_partners():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>Head of Partners Dashboard</h1>
        <p>Partner Performance, Commissions & Channel Revenue</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🤝 Partner Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['PARTNER', 'ORDER', 'SALES']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # HEAD OF PARTNERS - PARTNER NETWORK ANIMATION
        st.markdown("""
        <style>
        @keyframes partner-orbit { 0% { transform: rotate(0deg) translateX(70px) rotate(0deg); } 100% { transform: rotate(360deg) translateX(70px) rotate(-360deg); } }
        @keyframes partner-pulse { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.2); opacity: 1; } }
        @keyframes partner-glow { 0%, 100% { box-shadow: 0 0 10px rgba(59,130,246,0.3); } 50% { box-shadow: 0 0 25px rgba(59,130,246,0.6); } }
        .partner-network { background: linear-gradient(135deg, #1E3A5F 0%, #2563EB 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .partner-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .partner-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .partner-count { background: rgba(255,255,255,0.1); padding: 0.4rem 1rem; border-radius: 20px; animation: partner-glow 2s ease-in-out infinite; }
        .partner-count-val { color: white; font-size: 1.2rem; font-weight: 700; }
        .partner-count-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; }
        .partner-visual { display: flex; align-items: center; gap: 2rem; }
        .partner-orbit-container { position: relative; width: 160px; height: 160px; }
        .partner-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: rgba(255,255,255,0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .partner-dot { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; margin: -10px; border-radius: 50%; animation: partner-orbit 8s linear infinite; }
        .partner-dot.gold { background: #F59E0B; animation-duration: 6s; }
        .partner-dot.silver { background: #9CA3AF; animation-duration: 8s; animation-delay: -2s; }
        .partner-dot.bronze { background: #D97706; animation-duration: 10s; animation-delay: -4s; }
        .partner-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; flex: 1; }
        .partner-stat { background: rgba(255,255,255,0.08); border-radius: 8px; padding: 0.8rem; text-align: center; animation: partner-pulse 3s ease-in-out infinite; }
        .partner-stat:nth-child(2) { animation-delay: 0.5s; }
        .partner-stat:nth-child(3) { animation-delay: 1s; }
        .partner-stat-val { color: white; font-size: 1.3rem; font-weight: 700; }
        .partner-stat-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="partner-network"><div class="partner-header"><div class="partner-title">🤝 Partner Ecosystem</div><div class="partner-count"><div class="partner-count-val">348</div><div class="partner-count-label">Active Partners</div></div></div><div class="partner-visual"><div class="partner-orbit-container"><div class="partner-center">🏢</div><div class="partner-dot gold"></div><div class="partner-dot silver"></div><div class="partner-dot bronze"></div></div><div class="partner-stats"><div class="partner-stat"><div class="partner-stat-val">£2.8M</div><div class="partner-stat-label">Revenue MTD</div></div><div class="partner-stat"><div class="partner-stat-val">94%</div><div class="partner-stat-label">Active Rate</div></div><div class="partner-stat"><div class="partner-stat-val">£847K</div><div class="partner-stat-label">Commissions</div></div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; overflow: hidden; transition: all 0.2s ease; }
        .kpi-card:hover { border-color: #29B5E8; box-shadow: 0 4px 12px rgba(41, 181, 232, 0.15); transform: translateY(-2px); }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; line-height: 1.1; }
        .kpi-delta { display: inline-flex; align-items: center; font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; animation: neon-pulse-green 2.5s ease-in-out infinite; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; animation: neon-pulse-red 2s ease-in-out infinite; }
        .kpi-delta.neutral { background: #F3F4F6; color: #6B7280; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Partner Channel Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">🤝</div>
                <div class="kpi-label">Total Partners</div>
                <div class="kpi-value">348</div>
                <div class="kpi-delta positive">↑ +24 YTD</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Channel Revenue</div>
                <div class="kpi-value">£2.8M</div>
                <div class="kpi-delta positive">↑ +18% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Active This Month</div>
                <div class="kpi-value">286</div>
                <div class="kpi-delta neutral">82% active rate</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📦</div>
                <div class="kpi-label">Orders MTD</div>
                <div class="kpi-value">1,842</div>
                <div class="kpi-delta positive">↑ +22% vs target</div>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">💵</div>
                <div class="kpi-label">Commissions Paid</div>
                <div class="kpi-value">£142K</div>
                <div class="kpi-delta neutral">This month</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">Accrued</div>
                <div class="kpi-value">£68K</div>
                <div class="kpi-delta neutral">Next payment</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">New Customers</div>
                <div class="kpi-value">624</div>
                <div class="kpi-delta positive">Via partners</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">At Risk Partners</div>
                <div class="kpi-value">28</div>
                <div class="kpi-delta negative">Low activity</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Channel Performance Highlights</div>', unsafe_allow_html=True)
        
        perf_col1, perf_col2 = st.columns(2)
        
        with perf_col1:
            st.markdown("**Revenue by Product Line**")
            with st.container(border=True):
                product_rev = pd.DataFrame({
                    'Product': ['Mobile', 'Broadband', 'Business', 'IoT', 'Cloud'],
                    'Revenue': [1.12, 0.74, 0.46, 0.28, 0.20]
                })
                product_bar = alt.Chart(product_rev).mark_bar(cornerRadiusTopRight=8, cornerRadiusBottomRight=8).encode(
                    x=alt.X('Revenue:Q', title='Revenue (£M)'),
                    y=alt.Y('Product:N', sort='-x', title=None),
                    color=alt.Color('Product:N', legend=None, scale=alt.Scale(
                        domain=['Mobile', 'Broadband', 'Business', 'IoT', 'Cloud'],
                        range=['#2563EB', '#10B981', '#F59E0B', '#8B5CF6', '#14B8A6']
                    )),
                    tooltip=['Product:N', alt.Tooltip('Revenue:Q', format='.2f')]
                ).properties(height=180)
                st.altair_chart(product_bar, use_container_width=True)
        
        with perf_col2:
            st.markdown("**Order Mix by Channel**")
            with st.container(border=True):
                channel_mix = pd.DataFrame({
                    'Channel': ['Resellers', 'System Integrators', 'Retail Partners', 'Online Affiliates'],
                    'Orders': [640, 420, 510, 272]
                })
                channel_arc = alt.Chart(channel_mix).mark_arc(innerRadius=45).encode(
                    theta=alt.Theta('Orders:Q'),
                    color=alt.Color('Channel:N', scale=alt.Scale(
                        domain=['Resellers', 'System Integrators', 'Retail Partners', 'Online Affiliates'],
                        range=['#2563EB', '#F59E0B', '#10B981', '#8B5CF6']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Channel:N', 'Orders:Q']
                ).properties(height=200)
                st.altair_chart(channel_arc, use_container_width=True)
        
        growth_col1, growth_col2 = st.columns(2)
        
        with growth_col1:
            st.markdown("**Partner Activation Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                activation_df = pd.DataFrame({
                    'Month': months,
                    'Activation': [78, 79, 80, 81, 82, 82]
                })
                activation_line = alt.Chart(activation_df).mark_line(point=True, color='#2563EB').encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Activation:Q', title='Activation %', scale=alt.Scale(domain=[70, 90])),
                    tooltip=['Month:N', 'Activation:Q']
                ).properties(height=180)
                st.altair_chart(activation_line, use_container_width=True)
        
        with growth_col2:
            st.markdown("**Partner Tier Mix**")
            with st.container(border=True):
                tier_mix = pd.DataFrame({
                    'Tier': ['Gold', 'Silver', 'Bronze', 'Standard'],
                    'Partners': [24, 68, 124, 132]
                })
                tier_donut = alt.Chart(tier_mix).mark_arc(innerRadius=45).encode(
                    theta=alt.Theta('Partners:Q'),
                    color=alt.Color('Tier:N', scale=alt.Scale(
                        domain=['Gold', 'Silver', 'Bronze', 'Standard'],
                        range=['#F59E0B', '#9CA3AF', '#CD7F32', '#6366F1']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Tier:N', 'Partners:Q']
                ).properties(height=200)
                st.altair_chart(tier_donut, use_container_width=True)
        
    with tab_ops:
        st.markdown("""
        <style>
        @keyframes partner-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(37,99,235,0.2); }
            50% { box-shadow: 0 0 24px rgba(37,99,235,0.4); }
        }
        @keyframes partner-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .partner-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: partner-ops-glow 3s ease-in-out infinite;
        }
        .partner-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: partner-ops-sweep 3s linear infinite;
        }
        .partner-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .partner-ops-title { font-weight: 700; color: #1E3A8A; }
        .partner-ops-tag {
            background: rgba(37,99,235,0.15);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .partner-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .partner-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(37,99,235,0.2);
        }
        .partner-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .partner-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .partner-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="partner-ops-pulse">
            <div class="partner-ops-header">
                <div class="partner-ops-title">🤝 Partner Operations Pulse</div>
                <div class="partner-ops-tag">CHANNEL LIVE</div>
            </div>
            <div class="partner-ops-grid">
                <div class="partner-ops-card">
                    <div class="partner-ops-label">Active Partners</div>
                    <div class="partner-ops-value">286</div>
                    <div class="partner-ops-delta">82% activation rate</div>
                </div>
                <div class="partner-ops-card">
                    <div class="partner-ops-label">Pipeline</div>
                    <div class="partner-ops-value">22</div>
                    <div class="partner-ops-delta">14 in application</div>
                </div>
                <div class="partner-ops-card">
                    <div class="partner-ops-label">Commissions</div>
                    <div class="partner-ops-value">£142K</div>
                    <div class="partner-ops-delta">Paid MTD</div>
                </div>
                <div class="partner-ops-card">
                    <div class="partner-ops-label">At-Risk</div>
                    <div class="partner-ops-value">28</div>
                    <div class="partner-ops-delta">Needs outreach</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        # New: Partner Revenue Trend and Onboarding Pipeline
        trend_col, pipeline_col = st.columns(2)
        
        with trend_col:
            st.markdown('<div class="section-header">Partner Revenue Trend (6 Months)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                rev_trend_data = pd.DataFrame({
                    'Month': months * 4,
                    'Tier': ['Gold']*6 + ['Silver']*6 + ['Bronze']*6 + ['Standard']*6,
                    'Revenue': [0.98, 1.02, 1.08, 1.12, 1.18, 1.20,
                               0.72, 0.74, 0.78, 0.80, 0.82, 0.84,
                               0.42, 0.44, 0.46, 0.48, 0.50, 0.52,
                               0.18, 0.20, 0.21, 0.22, 0.23, 0.24]
                })
                
                stacked_area = alt.Chart(rev_trend_data).mark_area().encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Revenue:Q', stack='zero', title='Revenue (£M)'),
                    color=alt.Color('Tier:N', scale=alt.Scale(
                        domain=['Gold', 'Silver', 'Bronze', 'Standard'],
                        range=['#F59E0B', '#9CA3AF', '#CD7F32', '#6366F1']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Month:N', 'Tier:N', alt.Tooltip('Revenue:Q', format='.2f')]
                ).properties(height=180)
                
                st.altair_chart(stacked_area, use_container_width=True)
        
        with pipeline_col:
            st.markdown('<div class="section-header">Partner Onboarding Pipeline</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Prospect</span><span style="font-weight: 600;">22</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #6366F1; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Application</span><span style="font-weight: 600;">14 (64%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #8B5CF6; width: 64%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Approved</span><span style="font-weight: 600;">8 (36%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 36%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Training</span><span style="font-weight: 600;">5 (23%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #F59E0B; width: 23%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Active</span><span style="font-weight: 600;">3 (14%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #10B981; width: 14%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Partner Performance by Tier</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                tier_data = pd.DataFrame({
                    'Tier': ['Gold', 'Silver', 'Bronze', 'Standard'],
                    'Partners': [24, 68, 124, 132],
                    'Revenue': [1.2, 0.84, 0.52, 0.24],
                    'Avg Revenue': [50.0, 12.4, 4.2, 1.8]
                })
                
                tier_bars = alt.Chart(tier_data).mark_bar(cornerRadiusTopRight=8, cornerRadiusBottomRight=8).encode(
                    y=alt.Y('Tier:N', sort=['Gold', 'Silver', 'Bronze', 'Standard'], title=None),
                    x=alt.X('Revenue:Q', scale=alt.Scale(domain=[0, 1.5]), title='Revenue (£M)'),
                    color=alt.Color('Tier:N', scale=alt.Scale(
                        domain=['Gold', 'Silver', 'Bronze', 'Standard'],
                        range=['#F59E0B', '#9CA3AF', '#CD7F32', '#6366F1']
                    ), legend=None),
                    tooltip=['Tier:N', 'Partners:Q', alt.Tooltip('Revenue:Q', title='Revenue (£M)', format='.2f'), alt.Tooltip('Avg Revenue:Q', title='Avg/Partner (£K)', format='.1f')]
                ).properties(height=160)
                
                st.altair_chart(tier_bars, use_container_width=True)
                
                st.markdown("""
                <div style="display: flex; justify-content: space-around; font-size: 0.75rem; padding: 0.5rem; background: #F9FAFB; border-radius: 8px;">
                    <div style="text-align: center;">
                        <div style="color: #F59E0B; font-weight: 700;">🥇 Gold (24)</div>
                        <div style="color: #6B7280;">£1.2M • £50K avg</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: #9CA3AF; font-weight: 700;">🥈 Silver (68)</div>
                        <div style="color: #6B7280;">£840K • £12.4K avg</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: #CD7F32; font-weight: 700;">🥉 Bronze (124)</div>
                        <div style="color: #6B7280;">£520K • £4.2K avg</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">Top Performing Partners</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem; color: #6B7280;">Partner</th>
                            <th style="text-align: center; padding: 0.5rem; color: #6B7280;">Tier</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Revenue</th>
                            <th style="text-align: right; padding: 0.5rem; color: #6B7280;">Orders</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; font-weight: 600;">TechConnect Ltd</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Gold</span></td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">£124,500</td>
                            <td style="text-align: right; padding: 0.5rem;">186</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; font-weight: 600;">Mobile Solutions UK</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Gold</span></td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">£98,200</td>
                            <td style="text-align: right; padding: 0.5rem;">142</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; font-weight: 600;">DataFirst Partners</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #E5E7EB; color: #4B5563; padding: 0.2rem 0.5rem; border-radius: 12px;">Silver</span></td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">£76,800</td>
                            <td style="text-align: right; padding: 0.5rem;">98</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem; font-weight: 600;">Comms Direct</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Gold</span></td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">£68,400</td>
                            <td style="text-align: right; padding: 0.5rem;">112</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem; font-weight: 600;">Network Plus</td>
                            <td style="text-align: center; padding: 0.5rem;"><span style="background: #E5E7EB; color: #4B5563; padding: 0.2rem 0.5rem; border-radius: 12px;">Silver</span></td>
                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">£54,200</td>
                            <td style="text-align: right; padding: 0.5rem;">86</td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Commission Summary</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Paid This Month</span>
                            <span style="font-weight: 600;">£142,400</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #10B981, #34D399); width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Accrued (Pending)</span>
                            <span style="font-weight: 600;">£68,200</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 48%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>Bonuses Earned</span>
                            <span style="font-weight: 600;">£24,800</span>
                        </div>
                        <div style="background: #E5E7EB; height: 12px; border-radius: 4px; margin-top: 0.25rem;">
                            <div style="background: linear-gradient(90deg, #8B5CF6, #A78BFA); width: 17%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: #D1FAE5; border-radius: 8px; text-align: center; font-size: 0.85rem;">
                    <span style="color: #065F46;"><strong>Total YTD:</strong> £1.84M in partner commissions</span>
                </div>
                """, unsafe_allow_html=True)
            
            st.markdown('<div class="section-header">At-Risk Partners</div>', unsafe_allow_html=True)
            
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.6rem; border-left: 4px solid #EF4444; background: #FEE2E2; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #DC2626;">ConnectIT Services</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Silver • No orders in 45 days</div>
                            </div>
                            <span style="font-size: 0.75rem; background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">Critical</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">TelecomPro Ltd</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Bronze • Revenue down 60%</div>
                            </div>
                            <span style="font-size: 0.75rem; background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Warning</span>
                        </div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #92400E;">MobileMasters</div>
                                <div style="font-size: 0.75rem; color: #6B7280;">Standard • Low engagement</div>
                            </div>
                            <span style="font-size: 0.75rem; background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Warning</span>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #FEF3C7; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #92400E;">⚠️ 28 partners need outreach this month</span>
                </div>
                """, unsafe_allow_html=True)

    with tab_strategy:
        st.markdown("""
        <style>
        .sf-partner-pulse {
            background: linear-gradient(135deg, #0EA5E9 0%, #2563EB 100%);
            color: white;
            border-radius: 14px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .sf-partner-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: partner-si-sweep 3s linear infinite;
        }
        @keyframes partner-si-sweep {
            0% { transform: translateX(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(250%); opacity: 0; }
        }
        @keyframes partner-si-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(14,165,233,0.35); }
            50% { box-shadow: 0 0 22px rgba(14,165,233,0.6); }
        }
        .sf-partner-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-partner-title { font-weight: 700; font-size: 1rem; }
        .sf-partner-tag { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 999px; background: rgba(255,255,255,0.2); letter-spacing: 0.08em; }
        .sf-partner-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-partner-card { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 0.75rem; animation: partner-si-glow 3s ease-in-out infinite; }
        .sf-partner-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; opacity: 0.8; }
        .sf-partner-value { font-size: 1.25rem; font-weight: 700; }
        </style>
        <div class="sf-partner-pulse">
            <div class="sf-partner-header">
                <div class="sf-partner-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-partner-tag">AI LIVE</div>
            </div>
            <div class="sf-partner-grid">
                <div class="sf-partner-card">
                    <div class="sf-partner-label">Revenue at Risk</div>
                    <div class="sf-partner-value">£210K</div>
                </div>
                <div class="sf-partner-card">
                    <div class="sf-partner-label">Activation Lift</div>
                    <div class="sf-partner-value">+6.4%</div>
                </div>
                <div class="sf-partner-card">
                    <div class="sf-partner-label">Top Growth Tier</div>
                    <div class="sf-partner-value">Gold</div>
                </div>
                <div class="sf-partner-card">
                    <div class="sf-partner-label">Pipeline Velocity</div>
                    <div class="sf-partner-value">23 days</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Snowflake Intelligence** highlights a softening pipeline conversion in Silver-tier partners and a rising commission backlog. Targeted enablement and revised incentive tiers can unlock ~£210K in at-risk revenue and lift activation above 88%.")

        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Pipeline Bottleneck**")
                st.caption("Application-to-approval conversion dips 9% vs last quarter; training step is slowest.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**Tier Shift**")
                st.caption("Gold partners drive 52% of incremental revenue; Silver performance flattening.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Churn Risk**")
                st.caption("28 partners show low activity signals; 6 at immediate churn risk.")

        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Accelerate Onboarding**")
                st.caption("Introduce auto-approval for low-risk profiles to cut cycle time by 6 days.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Incentive Rebalance**")
                st.caption("Shift bonus weight to high-velocity SKUs; projected +£120K quarterly uplift.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**At-Risk Rescue**")
                st.caption("Run 4-week enablement sprints for 10 partners with highest revenue potential.")

        st.markdown('<div class="section-header">Head of Partners Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Channel Revenue £3.5M</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **£2.8M** MTD
                - Gap: **£700K** to target
                - Focus: Gold partner growth
                - Incentive: Q1 bonus program
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Partner Activation 90%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **82%** active
                - Target: **90%** by Q2
                - Action: Engagement program
                - At-risk: **28** partners
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Recruit 15 Partners</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Pipeline: **22** prospects
                - Target: **15** new partners
                - Focus: IT resellers
                - Onboarding: Streamlined
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        
        questions = [
            "Give me an overview of our partner channel - total partners and revenue contribution.",
            "Who are our top performing partners by revenue and orders?",
            "What commissions have we paid and what's accrued?",
            "Which partners are underperforming or at risk?",
            "What does our partner recruitment pipeline look like?"
        ]
        
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_billing_revenue():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Billing & Revenue Dashboard</h1>
        <p>Billing Performance, Payment Status & Revenue Assurance</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "💳 Revenue Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['BILLING', 'REVENUE_ASSURANCE', 'DISPUTE', 'MOBILE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP BILLING - BILLING STREAM ANIMATION
        st.markdown("""
        <style>
        @keyframes bill-flow { 0% { transform: translateX(-100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        @keyframes bill-tick { 0%, 100% { color: #10B981; } 50% { color: #34D399; } }
        @keyframes bill-counter { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .billing-stream { background: linear-gradient(135deg, #F0FDFA 0%, #CCFBF1 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; overflow: hidden; position: relative; border: 1px solid #99F6E4; }
        .billing-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .billing-title { color: #0F766E; font-size: 1.1rem; font-weight: 600; }
        .billing-live { display: flex; align-items: center; gap: 0.5rem; }
        .billing-live-dot { width: 8px; height: 8px; background: #10B981; border-radius: 50%; animation: bill-tick 1s ease-in-out infinite; }
        .billing-live-text { color: #0F766E; font-size: 0.75rem; }
        .billing-counter { text-align: center; margin-bottom: 1rem; }
        .billing-amount { font-size: 2.5rem; font-weight: 700; color: #0F766E; }
        .billing-label { color: #64748B; font-size: 0.75rem; }
        .billing-flow-track { height: 40px; background: #CCFBF1; border-radius: 20px; position: relative; overflow: hidden; }
        .billing-flow-item { position: absolute; top: 50%; transform: translateY(-50%); background: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.7rem; font-weight: 600; animation: bill-flow 3s linear infinite; color: #0F766E; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .billing-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-top: 1rem; }
        .billing-stat { background: white; border-radius: 8px; padding: 0.5rem; text-align: center; border: 1px solid #99F6E4; }
        .billing-stat-val { color: #0F766E; font-size: 1rem; font-weight: 700; }
        .billing-stat-label { color: #64748B; font-size: 0.6rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="billing-stream"><div class="billing-header"><div class="billing-title">💳 Billing Stream</div><div class="billing-live"><div class="billing-live-dot"></div><span class="billing-live-text">Processing</span></div></div><div class="billing-counter"><div class="billing-amount">£6.54M</div><div class="billing-label">Total Billed This Month</div></div><div class="billing-flow-track"><span class="billing-flow-item" style="animation-delay:0s">INV-31847</span><span class="billing-flow-item" style="animation-delay:1s">INV-31848</span><span class="billing-flow-item" style="animation-delay:2s">INV-31849</span></div><div class="billing-stats"><div class="billing-stat"><div class="billing-stat-val">31,847</div><div class="billing-stat-label">Invoices</div></div><div class="billing-stat"><div class="billing-stat-val">96.8%</div><div class="billing-stat-label">Collected</div></div><div class="billing-stat"><div class="billing-stat-val">£205</div><div class="billing-stat-label">Avg Invoice</div></div><div class="billing-stat"><div class="billing-stat-val">142</div><div class="billing-stat-label">Disputes</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; overflow: hidden; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; line-height: 1.1; }
        .kpi-delta { display: inline-flex; font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Billing Overview</div>', unsafe_allow_html=True)
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">📄</div>
                <div class="kpi-label">Invoices Generated</div>
                <div class="kpi-value">31,847</div>
                <div class="kpi-delta positive">↑ +3.2% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Total Billed</div>
                <div class="kpi-value">£6.54M</div>
                <div class="kpi-delta positive">↑ +8.4% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Avg Invoice Value</div>
                <div class="kpi-value">£205</div>
                <div class="kpi-delta positive">↑ +£12 MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">✅</div>
                <div class="kpi-label">Collection Rate</div>
                <div class="kpi-value">94.2%</div>
                <div class="kpi-delta positive">↑ +1.8% MoM</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">Overdue Amount</div>
                <div class="kpi-value">£312K</div>
                <div class="kpi-delta negative">4.8% of billed</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">📝</div>
                <div class="kpi-label">Credit Notes</div>
                <div class="kpi-value">£48.2K</div>
                <div class="kpi-delta negative">142 issued</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">Open Disputes</div>
                <div class="kpi-value">89</div>
                <div class="kpi-delta negative">£124K value</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">💵</div>
                <div class="kpi-label">Unbilled Usage</div>
                <div class="kpi-value">£28.4K</div>
                <div class="kpi-delta negative">Revenue at risk</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # New: Collection Trend and Aging Analysis
        collection_col, aging_col = st.columns(2)
        
        with collection_col:
            st.markdown('<div class="section-header">Collection Rate Trend (12 Months)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                collection_data = pd.DataFrame({
                    'Month': months,
                    'Rate': [91.2, 91.8, 92.4, 92.1, 92.8, 93.2, 93.0, 93.5, 93.8, 94.0, 93.9, 94.2],
                    'Target': [95.0] * 12
                })
                
                rate_line = alt.Chart(collection_data).mark_line(color='#10B981', strokeWidth=3).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Rate:Q', scale=alt.Scale(domain=[88, 98]), title='Collection %')
                )
                
                rate_points = alt.Chart(collection_data).mark_circle(color='#10B981', size=50).encode(
                    x=alt.X('Month:N', sort=months),
                    y=alt.Y('Rate:Q'),
                    tooltip=['Month:N', alt.Tooltip('Rate:Q', format='.1f')]
                )
                
                target_rule = alt.Chart(collection_data).mark_rule(color='#DC2626', strokeDash=[4, 4]).encode(y='Target:Q')
                
                st.altair_chart((rate_line + rate_points + target_rule).properties(height=160), use_container_width=True)
        
        with aging_col:
            st.markdown('<div class="section-header">Receivables Aging</div>', unsafe_allow_html=True)
            with st.container(border=True):
                aging_data = pd.DataFrame({
                    'Aging': ['Current', '1-30 Days', '31-60 Days', '61-90 Days', '90+ Days'],
                    'Amount': [5.82, 0.42, 0.18, 0.08, 0.04]
                })
                
                aging_bars = alt.Chart(aging_data).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Aging:N', sort=['Current', '1-30 Days', '31-60 Days', '61-90 Days', '90+ Days'], title=None),
                    y=alt.Y('Amount:Q', title='Amount (£M)'),
                    color=alt.Color('Aging:N', scale=alt.Scale(
                        domain=['Current', '1-30 Days', '31-60 Days', '61-90 Days', '90+ Days'],
                        range=['#10B981', '#29B5E8', '#F59E0B', '#F97316', '#EF4444']
                    ), legend=None),
                    tooltip=['Aging:N', alt.Tooltip('Amount:Q', format='.2f')]
                ).properties(height=160)
                
                st.altair_chart(aging_bars, use_container_width=True)
        
        st.markdown('<div class="section-header">Billing Quality Signals</div>', unsafe_allow_html=True)
        quality_col1, quality_col2 = st.columns(2)
        
        with quality_col1:
            st.markdown("**Invoice Volume vs Collected**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                volume_df = pd.DataFrame({
                    'Month': months * 2,
                    'Metric': ['Invoices'] * 6 + ['Collected'] * 6,
                    'Value': [26.4, 27.1, 28.3, 29.0, 30.2, 31.8,
                              24.8, 25.6, 26.4, 27.0, 28.5, 29.9]
                })
                volume_line = alt.Chart(volume_df).mark_line(point=True).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Value:Q', title='Volume (K)'),
                    color=alt.Color('Metric:N', scale=alt.Scale(
                        domain=['Invoices', 'Collected'],
                        range=['#2563EB', '#10B981']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Month:N', 'Metric:N', alt.Tooltip('Value:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(volume_line, use_container_width=True)
        
        with quality_col2:
            st.markdown("**Credit Notes by Reason**")
            with st.container(border=True):
                credit_df = pd.DataFrame({
                    'Reason': ['Pricing Error', 'Service Credit', 'Contract Adjustment', 'Usage Dispute', 'Other'],
                    'Amount': [18.6, 11.4, 7.2, 6.0, 5.0]
                })
                credit_bar = alt.Chart(credit_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Amount:Q', title='Amount (£K)'),
                    y=alt.Y('Reason:N', sort='-x', title=None),
                    color=alt.Color('Reason:N', legend=None, scale=alt.Scale(
                        range=['#EF4444', '#F59E0B', '#8B5CF6', '#29B5E8', '#10B981']
                    )),
                    tooltip=['Reason:N', alt.Tooltip('Amount:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(credit_bar, use_container_width=True)
        
    with tab_ops:
        st.markdown("""
        <style>
        @keyframes billing-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(16,185,129,0.2); }
            50% { box-shadow: 0 0 22px rgba(16,185,129,0.4); }
        }
        @keyframes billing-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .billing-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #D1FAE5 0%, #BBF7D0 100%);
            border: 1px solid #86EFAC;
            animation: billing-ops-glow 3s ease-in-out infinite;
        }
        .billing-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: billing-ops-sweep 3s linear infinite;
        }
        .billing-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .billing-ops-title { font-weight: 700; color: #065F46; }
        .billing-ops-tag {
            background: rgba(16,185,129,0.2);
            color: #065F46;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .billing-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .billing-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(16,185,129,0.2);
        }
        .billing-ops-label { font-size: 0.7rem; color: #047857; text-transform: uppercase; letter-spacing: 0.06em; }
        .billing-ops-value { font-size: 1.35rem; font-weight: 700; color: #065F46; }
        .billing-ops-delta { font-size: 0.75rem; color: #047857; }
        </style>
        <div class="billing-ops-pulse">
            <div class="billing-ops-header">
                <div class="billing-ops-title">💳 Revenue Operations Pulse</div>
                <div class="billing-ops-tag">LIVE OPS</div>
            </div>
            <div class="billing-ops-grid">
                <div class="billing-ops-card">
                    <div class="billing-ops-label">Collections</div>
                    <div class="billing-ops-value">94.2%</div>
                    <div class="billing-ops-delta">+1.8% MoM</div>
                </div>
                <div class="billing-ops-card">
                    <div class="billing-ops-label">Overdue</div>
                    <div class="billing-ops-value">£312K</div>
                    <div class="billing-ops-delta">4.8% of billed</div>
                </div>
                <div class="billing-ops-card">
                    <div class="billing-ops-label">Open Disputes</div>
                    <div class="billing-ops-value">89</div>
                    <div class="billing-ops-delta">£124K exposure</div>
                </div>
                <div class="billing-ops-card">
                    <div class="billing-ops-label">Leakage Risk</div>
                    <div class="billing-ops-value">£28.4K</div>
                    <div class="billing-ops-delta">Unbilled usage</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Revenue Assurance & Disputes</div>', unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown("**Payment Status Distribution**")
            with st.container(border=True):
                payment_data = pd.DataFrame({
                    'Status': ['Paid', 'Pending', 'Overdue 1-30d', 'Overdue 31-60d', 'Overdue 60d+'],
                    'Amount': [5.82, 0.42, 0.18, 0.08, 0.04],
                    'Count': [28450, 2100, 890, 320, 180]
                })
                
                donut = alt.Chart(payment_data).mark_arc(innerRadius=60, outerRadius=100).encode(
                    theta=alt.Theta('Amount:Q'),
                    color=alt.Color('Status:N', scale=alt.Scale(
                        domain=['Paid', 'Pending', 'Overdue 1-30d', 'Overdue 31-60d', 'Overdue 60d+'],
                        range=['#10B981', '#29B5E8', '#F59E0B', '#F97316', '#DC2626']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Status:N', alt.Tooltip('Amount:Q', title='Amount (£M)', format='.2f'), 'Count:Q']
                ).properties(height=220)
                
                st.altair_chart(donut, use_container_width=True)
        
        with col_right:
            st.markdown("**Dispute Categories**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Incorrect Charges</span>
                        <span style="font-weight: 600;">34 (£48K)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Service Quality</span>
                        <span style="font-weight: 600;">28 (£32K)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Contract Terms</span>
                        <span style="font-weight: 600;">15 (£24K)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Other</span>
                        <span style="font-weight: 600;">12 (£20K)</span>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #FEF3C7; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #92400E;">Avg resolution: 8.4 days</span>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Collections & Resolution Ops</div>', unsafe_allow_html=True)
        ops_col1, ops_col2 = st.columns(2)
        
        with ops_col1:
            st.markdown("**Dunning Effectiveness**")
            with st.container(border=True):
                dunning_df = pd.DataFrame({
                    'Stage': ['Reminder 1', 'Reminder 2', 'Final Notice', 'Collections'],
                    'Recovered': [38, 26, 18, 12]
                })
                dunning_bar = alt.Chart(dunning_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Recovered:Q', title='Recovered (£K)'),
                    y=alt.Y('Stage:N', sort='-x', title=None),
                    color=alt.Color('Stage:N', legend=None, scale=alt.Scale(
                        range=['#10B981', '#29B5E8', '#F59E0B', '#EF4444']
                    )),
                    tooltip=['Stage:N', alt.Tooltip('Recovered:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(dunning_bar, use_container_width=True)
        
        with ops_col2:
            st.markdown("**Dispute Resolution Time**")
            with st.container(border=True):
                weeks = ['Wk1', 'Wk2', 'Wk3', 'Wk4', 'Wk5', 'Wk6']
                resolution_df = pd.DataFrame({
                    'Week': weeks,
                    'Days': [9.6, 9.1, 8.7, 8.4, 8.3, 8.0]
                })
                resolution_line = alt.Chart(resolution_df).mark_line(point=True, color='#2563EB').encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Days:Q', title='Avg Days', scale=alt.Scale(domain=[6, 11])),
                    tooltip=['Week:N', alt.Tooltip('Days:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(resolution_line, use_container_width=True)

    with tab_strategy:
        st.markdown("""
        <style>
        .sf-billing-pulse {
            background: linear-gradient(135deg, #0EA5E9 0%, #2563EB 100%);
            color: white;
            border-radius: 14px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .sf-billing-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: billing-si-sweep 3s linear infinite;
        }
        @keyframes billing-si-sweep {
            0% { transform: translateX(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(250%); opacity: 0; }
        }
        @keyframes billing-si-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(14,165,233,0.35); }
            50% { box-shadow: 0 0 22px rgba(14,165,233,0.6); }
        }
        .sf-billing-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-billing-title { font-weight: 700; font-size: 1rem; }
        .sf-billing-tag { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 999px; background: rgba(255,255,255,0.2); letter-spacing: 0.08em; }
        .sf-billing-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-billing-card { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 0.75rem; animation: billing-si-glow 3s ease-in-out infinite; }
        .sf-billing-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; opacity: 0.8; }
        .sf-billing-value { font-size: 1.25rem; font-weight: 700; }
        </style>
        <div class="sf-billing-pulse">
            <div class="sf-billing-header">
                <div class="sf-billing-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-billing-tag">AI LIVE</div>
            </div>
            <div class="sf-billing-grid">
                <div class="sf-billing-card">
                    <div class="sf-billing-label">At-Risk Cash</div>
                    <div class="sf-billing-value">£312K</div>
                </div>
                <div class="sf-billing-card">
                    <div class="sf-billing-label">Leakage</div>
                    <div class="sf-billing-value">£28.4K</div>
                </div>
                <div class="sf-billing-card">
                    <div class="sf-billing-label">Dispute Risk</div>
                    <div class="sf-billing-value">£124K</div>
                </div>
                <div class="sf-billing-card">
                    <div class="sf-billing-label">Collection Lift</div>
                    <div class="sf-billing-value">+1.8%</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Snowflake Intelligence** detects overdue concentration in 1–30 day buckets and rising dispute volume in service quality. Focused recovery campaigns and invoice clarity updates can close the 1.8% collection gap and reduce dispute exposure by ~£30K.")
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Overdue Drift**")
                st.caption("1–30 day overdue balance climbs 12% vs last month; SME segment driving most uplift.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**Dispute Hotspots**")
                st.caption("Service quality disputes cluster in two regions; average resolution above target by 2.1 days.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Leakage Risk**")
                st.caption("Unbilled usage highest in roaming and IoT SKUs; daily reconciliation gap persists.")
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Targeted Collections**")
                st.caption("Deploy segmented dunning for 1–30 day balances; expected +0.6% collection lift.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Invoice Clarity Fixes**")
                st.caption("Redesign top dispute drivers; projected 25% reduction in incorrect charge claims.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Leakage Automation**")
                st.caption("Real-time usage reconciliation and alerting to close £28K leakage risk.")
        
        st.markdown('<div class="section-header">VP Billing & Revenue Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Collection Rate 96%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **94.2%** collected
                - Gap: **1.8%** to target
                - Focus: Overdue recovery
                - Action: Automated reminders
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Reduce Disputes 50%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **89** open disputes
                - Target: **<50** by Q2
                - Root cause: Billing clarity
                - Initiative: Invoice redesign
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Revenue Assurance</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Unbilled: **£28.4K** at risk
                - Target: **Zero** leakage
                - Action: Daily reconciliation
                - Automation: Real-time alerts
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = [
            "Show me billing performance - invoices, amounts, and average values.",
            "What's our payment status distribution?",
            "Are there revenue leakage risks?",
            "Show me billing disputes and resolution times."
        ]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_it_digital():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP IT & Digital Dashboard</h1>
        <p>IT Incident Management, SLA Compliance & Application Health</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧩 IT Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['IT_OPS', 'SLA', 'CUSTOMER_EXPERIENCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP IT & DIGITAL - SYSTEM HEALTH ANIMATION
        st.markdown("""
        <style>
        @keyframes it-scan { 0% { left: 0; } 100% { left: 100%; } }
        @keyframes it-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes it-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .it-health { background: linear-gradient(135deg, #1E1B4B 0%, #3730A3 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .it-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .it-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .it-status { color: #A5B4FC; font-size: 0.75rem; }
        .it-systems { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.75rem; margin-bottom: 1rem; }
        .it-system { background: rgba(255,255,255,0.08); border-radius: 10px; padding: 0.8rem; text-align: center; position: relative; overflow: hidden; }
        .it-system::before { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); animation: it-scan 3s ease-in-out infinite; }
        .it-system-icon { font-size: 1.5rem; margin-bottom: 0.3rem; }
        .it-system-name { color: rgba(255,255,255,0.7); font-size: 0.65rem; margin-bottom: 0.2rem; }
        .it-system-status { font-size: 0.7rem; font-weight: 600; padding: 0.15rem 0.4rem; border-radius: 10px; }
        .it-system-status.healthy { background: rgba(16,185,129,0.2); color: #10B981; }
        .it-system-status.warning { background: rgba(245,158,11,0.2); color: #F59E0B; animation: it-blink 1s ease-in-out infinite; }
        .it-system-status.critical { background: rgba(239,68,68,0.2); color: #EF4444; animation: it-blink 0.5s ease-in-out infinite; }
        .it-incidents { display: flex; gap: 1rem; justify-content: center; }
        .it-incident { display: flex; align-items: center; gap: 0.5rem; background: rgba(0,0,0,0.2); padding: 0.5rem 1rem; border-radius: 20px; animation: it-pulse 2s ease-in-out infinite; }
        .it-incident:nth-child(2) { animation-delay: 0.5s; }
        .it-incident:nth-child(3) { animation-delay: 1s; }
        .it-incident-dot { width: 10px; height: 10px; border-radius: 50%; }
        .it-incident-dot.p1 { background: #EF4444; }
        .it-incident-dot.p2 { background: #F59E0B; }
        .it-incident-dot.p3 { background: #3B82F6; }
        .it-incident-text { color: white; font-size: 0.75rem; font-weight: 600; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="it-health"><div class="it-header"><div class="it-title">💻 IT Systems Health Monitor</div><div class="it-status">Last scan: 2 min ago</div></div><div class="it-systems"><div class="it-system"><div class="it-system-icon">🗄️</div><div class="it-system-name">Database</div><div class="it-system-status healthy">Healthy</div></div><div class="it-system"><div class="it-system-icon">🌐</div><div class="it-system-name">Web Apps</div><div class="it-system-status warning">Warning</div></div><div class="it-system"><div class="it-system-icon">📧</div><div class="it-system-name">Email</div><div class="it-system-status healthy">Healthy</div></div><div class="it-system"><div class="it-system-icon">🔐</div><div class="it-system-name">Auth</div><div class="it-system-status healthy">Healthy</div></div><div class="it-system"><div class="it-system-icon">📊</div><div class="it-system-name">Analytics</div><div class="it-system-status healthy">Healthy</div></div></div><div class="it-incidents"><div class="it-incident"><div class="it-incident-dot p1"></div><span class="it-incident-text">P1: 3</span></div><div class="it-incident"><div class="it-incident-dot p2"></div><span class="it-incident-text">P2: 12</span></div><div class="it-incident"><div class="it-incident-dot p3"></div><span class="it-incident-text">P3/P4: 48</span></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">IT Operations Overview</div>', unsafe_allow_html=True)
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">🔴</div>
                <div class="kpi-label">P1 Incidents</div>
                <div class="kpi-value">3</div>
                <div class="kpi-delta negative">Active now</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">🟡</div>
                <div class="kpi-label">P2 Incidents</div>
                <div class="kpi-value">12</div>
                <div class="kpi-delta negative">↑ +4 vs yesterday</div>
            </div>
            <div class="kpi-card" style="--accent: #3B82F6;">
                <div class="kpi-icon">🔵</div>
                <div class="kpi-label">P3/P4 Incidents</div>
                <div class="kpi-value">48</div>
                <div class="kpi-delta positive">↓ -8 vs yesterday</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">✅</div>
                <div class="kpi-label">SLA Attainment</div>
                <div class="kpi-value">94.2%</div>
                <div class="kpi-delta positive">Above 90% target</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">MTTR (P1)</div>
                <div class="kpi-value">2.8 hrs</div>
                <div class="kpi-delta positive">↓ vs 4hr target</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">System Uptime</div>
                <div class="kpi-value">99.92%</div>
                <div class="kpi-delta positive">↑ +0.04% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">Changes This Week</div>
                <div class="kpi-value">24</div>
                <div class="kpi-delta positive">100% success</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">🛡️</div>
                <div class="kpi-label">Security Events</div>
                <div class="kpi-value">142</div>
                <div class="kpi-delta positive">All mitigated</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Service Reliability Signals</div>', unsafe_allow_html=True)
        rel_col1, rel_col2 = st.columns(2)
        
        with rel_col1:
            st.markdown("**Uptime Trend (12 Months)**")
            with st.container(border=True):
                months = ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                uptime_df = pd.DataFrame({
                    'Month': months,
                    'Uptime': [99.88, 99.89, 99.90, 99.91, 99.90, 99.91, 99.92, 99.91, 99.92, 99.93, 99.92, 99.92]
                })
                uptime_line = alt.Chart(uptime_df).mark_line(point=True, color='#10B981').encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Uptime:Q', title='Uptime %', scale=alt.Scale(domain=[99.7, 100])),
                    tooltip=['Month:N', alt.Tooltip('Uptime:Q', format='.2f')]
                ).properties(height=180)
                st.altair_chart(uptime_line, use_container_width=True)
        
        with rel_col2:
            st.markdown("**SLA Compliance by Application**")
            with st.container(border=True):
                sla_df = pd.DataFrame({
                    'App': ['CRM', 'Billing', 'Customer Portal', 'Network OSS', 'Analytics'],
                    'SLA': [99.6, 99.3, 99.1, 99.4, 99.8]
                })
                sla_chart = sla_df.set_index('App')
                st.bar_chart(sla_chart, height=180)
        
        backlog_col1, backlog_col2 = st.columns(2)
        
        with backlog_col1:
            st.markdown("**Ticket Backlog by Team**")
            with st.container(border=True):
                backlog_df = pd.DataFrame({
                    'Team': ['App Support', 'Network Ops', 'Security', 'Infra', 'Service Desk'],
                    'Backlog': [42, 36, 18, 24, 56]
                })
                backlog_bar = alt.Chart(backlog_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Backlog:Q', title='Open Tickets'),
                    y=alt.Y('Team:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Team:N', 'Backlog:Q']
                ).properties(height=180)
                st.altair_chart(backlog_bar, use_container_width=True)
        
        with backlog_col2:
            st.markdown("**Digital Experience Incidents**")
            with st.container(border=True):
                dx_df = pd.DataFrame({
                    'Week': ['W1', 'W2', 'W3', 'W4', 'W5', 'W6'],
                    'Incidents': [14, 12, 16, 11, 10, 9]
                })
                dx_line = alt.Chart(dx_df).mark_line(point=True, color='#6366F1').encode(
                    x=alt.X('Week:N', title=None),
                    y=alt.Y('Incidents:Q', title='Incidents'),
                    tooltip=['Week:N', 'Incidents:Q']
                ).properties(height=180)
                st.altair_chart(dx_line, use_container_width=True)
        
    with tab_ops:
        st.markdown("""
        <style>
        @keyframes it-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 24px rgba(59,130,246,0.4); }
        }
        @keyframes it-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .it-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: it-ops-glow 3s ease-in-out infinite;
        }
        .it-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: it-ops-sweep 3s linear infinite;
        }
        .it-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .it-ops-title { font-weight: 700; color: #1E3A8A; }
        .it-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .it-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .it-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .it-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .it-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .it-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="it-ops-pulse">
            <div class="it-ops-header">
                <div class="it-ops-title">🧩 IT Operations Pulse</div>
                <div class="it-ops-tag">LIVE OPS</div>
            </div>
            <div class="it-ops-grid">
                <div class="it-ops-card">
                    <div class="it-ops-label">P1 MTTR</div>
                    <div class="it-ops-value">2.8 hrs</div>
                    <div class="it-ops-delta">-1.2 hrs vs target</div>
                </div>
                <div class="it-ops-card">
                    <div class="it-ops-label">SLA Attainment</div>
                    <div class="it-ops-value">94.2%</div>
                    <div class="it-ops-delta">+0.8% QoQ</div>
                </div>
                <div class="it-ops-card">
                    <div class="it-ops-label">Changes</div>
                    <div class="it-ops-value">24</div>
                    <div class="it-ops-delta">100% success</div>
                </div>
                <div class="it-ops-card">
                    <div class="it-ops-label">Uptime</div>
                    <div class="it-ops-value">99.92%</div>
                    <div class="it-ops-delta">0.03% to goal</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # Incident Trend and Change Success Rate
        trend_col, change_col = st.columns(2)
        
        with trend_col:
            st.markdown('<div class="section-header">Incident Trend (8 Weeks)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                weeks = [f'W{i}' for i in range(1, 9)]
                it_trend_data = pd.DataFrame({
                    'Week': weeks * 3,
                    'Severity': ['P1']*8 + ['P2']*8 + ['P3/P4']*8,
                    'Count': [4, 3, 5, 2, 4, 3, 2, 3,
                             14, 12, 15, 11, 13, 10, 14, 12,
                             52, 48, 55, 45, 50, 42, 48, 48]
                })
                
                incident_lines = alt.Chart(it_trend_data).mark_line(strokeWidth=2).encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Count:Q', title='Incidents'),
                    color=alt.Color('Severity:N', scale=alt.Scale(
                        domain=['P1', 'P2', 'P3/P4'],
                        range=['#EF4444', '#F59E0B', '#3B82F6']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Week:N', 'Severity:N', 'Count:Q']
                ).properties(height=160)
                
                st.altair_chart(incident_lines, use_container_width=True)
        
        with change_col:
            st.markdown('<div class="section-header">Change Success Rate</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="text-align: center; padding: 1rem;">
                    <div style="font-size: 3rem; font-weight: 700; color: #10B981;">100%</div>
                    <div style="font-size: 0.85rem; color: #6B7280;">24/24 Changes Successful</div>
                    <div style="margin-top: 1rem; display: flex; justify-content: space-around; font-size: 0.75rem;">
                        <div><span style="color: #10B981; font-weight: 600;">18</span> Standard</div>
                        <div><span style="color: #F59E0B; font-weight: 600;">4</span> Normal</div>
                        <div><span style="color: #EF4444; font-weight: 600;">2</span> Emergency</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Incidents by Category</div>', unsafe_allow_html=True)
            with st.container(border=True):
                incident_data = pd.DataFrame({
                    'Category': ['Network', 'Application', 'Database', 'Security', 'Hardware'],
                    'Count': [18, 24, 8, 6, 7],
                    'MTTR': [3.2, 2.4, 4.1, 1.8, 6.2]
                })
                
                bars = alt.Chart(incident_data).mark_bar(cornerRadiusTopRight=8, cornerRadiusBottomRight=8).encode(
                    y=alt.Y('Category:N', sort=alt.EncodingSortField(field='Count', order='descending'), title=None),
                    x=alt.X('Count:Q', scale=alt.Scale(domain=[0, 30]), title='Incident Count'),
                    color=alt.value('#29B5E8'),
                    tooltip=['Category:N', 'Count:Q', alt.Tooltip('MTTR:Q', title='MTTR (hrs)', format='.1f')]
                ).properties(height=180)
                
                st.altair_chart(bars, use_container_width=True)
        
        with col_right:
            st.markdown('<div class="section-header">Top Affected Systems</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>CRM Platform</span>
                        <span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">8 incidents</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Billing System</span>
                        <span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">6 incidents</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Customer Portal</span>
                        <span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">5 incidents</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Network OSS</span>
                        <span style="background: #E0F2FE; color: #0369A1; padding: 0.2rem 0.5rem; border-radius: 12px;">4 incidents</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Operational Effectiveness</div>', unsafe_allow_html=True)
        ops_col1, ops_col2 = st.columns(2)
        
        with ops_col1:
            st.markdown("**Change Volume by Type**")
            with st.container(border=True):
                change_df = pd.DataFrame({
                    'Type': ['Standard', 'Normal', 'Emergency'],
                    'Changes': [18, 4, 2]
                })
                change_bar = alt.Chart(change_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Changes:Q', title='Changes'),
                    y=alt.Y('Type:N', sort='-x', title=None),
                    color=alt.Color('Type:N', legend=None, scale=alt.Scale(
                        domain=['Standard', 'Normal', 'Emergency'],
                        range=['#10B981', '#F59E0B', '#EF4444']
                    )),
                    tooltip=['Type:N', 'Changes:Q']
                ).properties(height=180)
                st.altair_chart(change_bar, use_container_width=True)
        
        with ops_col2:
            st.markdown("**MTTR by Category**")
            with st.container(border=True):
                mttr_df = pd.DataFrame({
                    'Category': ['Network', 'Application', 'Database', 'Security', 'Hardware'],
                    'MTTR': [3.2, 2.4, 4.1, 1.8, 6.2]
                })
                mttr_bar = alt.Chart(mttr_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('MTTR:Q', title='MTTR (hrs)'),
                    y=alt.Y('Category:N', sort='-x', title=None),
                    color=alt.Color('Category:N', legend=None, scale=alt.Scale(
                        range=['#29B5E8', '#8B5CF6', '#F59E0B', '#10B981', '#EF4444']
                    )),
                    tooltip=['Category:N', alt.Tooltip('MTTR:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(mttr_bar, use_container_width=True)
        
    with tab_strategy:
        st.markdown("""
        <style>
        .sf-it-pulse {
            background: linear-gradient(135deg, #0EA5E9 0%, #2563EB 100%);
            color: white;
            border-radius: 14px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .sf-it-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: it-si-sweep 3s linear infinite;
        }
        @keyframes it-si-sweep {
            0% { transform: translateX(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(250%); opacity: 0; }
        }
        @keyframes it-si-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(14,165,233,0.35); }
            50% { box-shadow: 0 0 22px rgba(14,165,233,0.6); }
        }
        .sf-it-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-it-title { font-weight: 700; font-size: 1rem; }
        .sf-it-tag { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 999px; background: rgba(255,255,255,0.2); letter-spacing: 0.08em; }
        .sf-it-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-it-card { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 0.75rem; animation: it-si-glow 3s ease-in-out infinite; }
        .sf-it-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; opacity: 0.8; }
        .sf-it-value { font-size: 1.25rem; font-weight: 700; }
        </style>
        <div class="sf-it-pulse">
            <div class="sf-it-header">
                <div class="sf-it-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-it-tag">AI LIVE</div>
            </div>
            <div class="sf-it-grid">
                <div class="sf-it-card">
                    <div class="sf-it-label">P1 Risk</div>
                    <div class="sf-it-value">3 active</div>
                </div>
                <div class="sf-it-card">
                    <div class="sf-it-label">MTTR Delta</div>
                    <div class="sf-it-value">+0.8 hrs</div>
                </div>
                <div class="sf-it-card">
                    <div class="sf-it-label">Uptime Gap</div>
                    <div class="sf-it-value">0.03%</div>
                </div>
                <div class="sf-it-card">
                    <div class="sf-it-label">Change Risk</div>
                    <div class="sf-it-value">Low</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Snowflake Intelligence** detects elevated P1 exposure tied to CRM and billing systems, with MTTR still above target. Change success is strong, and targeted automation should close the MTTR gap by 0.8 hours while protecting 99.95% uptime.")
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Incident Concentration**")
                st.caption("Application incidents account for 36% of volume; CRM and portal drive most alerts.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**MTTR Variance**")
                st.caption("Hardware incidents average 6.2 hours; automation gaps in diagnostics.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**SLA Drift**")
                st.caption("Uptime at 99.92%; billing system maintenance drives 0.03% shortfall.")
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Runbook Automation**")
                st.caption("Expand auto-remediation for top 5 incident patterns; expected MTTR -0.6 hrs.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**CRM Stability Sprint**")
                st.caption("Prioritize CRM patching and capacity tuning to reduce P1 exposure by 30%.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Change Risk Controls**")
                st.caption("Adopt canary releases for emergency changes to keep success rate at 99%+.")
        
        st.markdown('<div class="section-header">VP IT & Digital Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">P1 MTTR < 2 hrs</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **2.8 hrs** MTTR
                - Target: **<2 hrs** by Q2
                - Action: Automated runbooks
                - Investment: **£240K** AIOps
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">99.95% Uptime</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **99.92%** uptime
                - Gap: **0.03%** to target
                - Focus: CRM stability
                - Action: Infrastructure upgrade
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Cloud Migration</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Target: **60%** on cloud
                - Current: **42%** migrated
                - Q1 Focus: Billing system
                - Budget: **£1.8M** approved
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["Show me open IT incidents by severity.", "What's our MTTR by severity?", "Which applications have the most incidents?", "How are we performing against IT SLAs?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_field_operations():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Field Operations Dashboard</h1>
        <p>Workforce Optimization, First-Time Fix & SLA Compliance</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🛠️ Field Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['FIELD_OPERATIONS']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP FIELD OPERATIONS - TECHNICIAN DISPATCH ANIMATION
        st.markdown("""
        <style>
        @keyframes field-move { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(10px); } }
        @keyframes field-pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        @keyframes field-ping { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
        .field-dispatch { background: linear-gradient(135deg, #78350F 0%, #D97706 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .field-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .field-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .field-live { color: rgba(255,255,255,0.8); font-size: 0.75rem; }
        .field-map { display: flex; gap: 1.5rem; align-items: center; margin-bottom: 1rem; }
        .field-techs { display: flex; gap: 0.5rem; flex-wrap: wrap; flex: 1; }
        .field-tech { position: relative; width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: field-move 2s ease-in-out infinite; }
        .field-tech:nth-child(2n) { animation-delay: 0.5s; }
        .field-tech:nth-child(3n) { animation-delay: 1s; }
        .field-tech-icon { font-size: 1.2rem; }
        .field-tech.active::after { content: ''; position: absolute; width: 100%; height: 100%; border: 2px solid #10B981; border-radius: 50%; animation: field-ping 1.5s ease-out infinite; }
        .field-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; }
        .field-stat { background: rgba(255,255,255,0.1); border-radius: 10px; padding: 0.7rem; text-align: center; animation: field-pulse 3s ease-in-out infinite; }
        .field-stat:nth-child(2) { animation-delay: 0.5s; }
        .field-stat:nth-child(3) { animation-delay: 1s; }
        .field-stat:nth-child(4) { animation-delay: 1.5s; }
        .field-stat-val { color: white; font-size: 1.3rem; font-weight: 700; }
        .field-stat-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="field-dispatch"><div class="field-header"><div class="field-title">🔧 Field Technician Dispatch</div><div class="field-live">Live Tracking</div></div><div class="field-map"><div class="field-techs"><div class="field-tech active"><span class="field-tech-icon">👷</span></div><div class="field-tech active"><span class="field-tech-icon">👷</span></div><div class="field-tech"><span class="field-tech-icon">👷</span></div><div class="field-tech active"><span class="field-tech-icon">👷</span></div><div class="field-tech"><span class="field-tech-icon">👷</span></div><div class="field-tech active"><span class="field-tech-icon">👷</span></div><div class="field-tech"><span class="field-tech-icon">👷</span></div><div class="field-tech active"><span class="field-tech-icon">👷</span></div></div></div><div class="field-stats"><div class="field-stat"><div class="field-stat-val">142</div><div class="field-stat-label">Jobs Today</div></div><div class="field-stat"><div class="field-stat-val">87%</div><div class="field-stat-label">First-Time Fix</div></div><div class="field-stat"><div class="field-stat-val">52 min</div><div class="field-stat-label">Avg Duration</div></div><div class="field-stat"><div class="field-stat-val">94%</div><div class="field-stat-label">SLA Met</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Field Operations Overview</div>', unsafe_allow_html=True)
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">🔧</div>
                <div class="kpi-label">First-Time Fix Rate</div>
                <div class="kpi-value">87%</div>
                <div class="kpi-delta positive">↑ +3% vs target</div>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">📋</div>
                <div class="kpi-label">Jobs Today</div>
                <div class="kpi-value">142</div>
                <div class="kpi-delta positive">92% completed</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">Avg Job Duration</div>
                <div class="kpi-value">52 min</div>
                <div class="kpi-delta positive">↓ -8 min vs avg</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📍</div>
                <div class="kpi-label">SLA Compliance</div>
                <div class="kpi-value">94%</div>
                <div class="kpi-delta positive">↑ Above 90% target</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">👷</div>
                <div class="kpi-label">Technicians Active</div>
                <div class="kpi-value">86</div>
                <div class="kpi-delta positive">94% utilization</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">⭐</div>
                <div class="kpi-label">Customer CSAT</div>
                <div class="kpi-value">4.4/5</div>
                <div class="kpi-delta positive">↑ +0.2 MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">Rescheduled</div>
                <div class="kpi-value">18</div>
                <div class="kpi-delta negative">↑ +6 vs yesterday</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Cost Per Visit</div>
                <div class="kpi-value">£68</div>
                <div class="kpi-delta positive">↓ -£4 vs budget</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Workforce & Cost Signals</div>', unsafe_allow_html=True)
        work_col1, work_col2 = st.columns(2)
        
        with work_col1:
            st.markdown("**Jobs by Region**")
            with st.container(border=True):
                region_jobs = pd.DataFrame({
                    'Region': ['London', 'North West', 'Midlands', 'South East', 'Scotland', 'Wales'],
                    'Jobs': [38, 26, 22, 24, 16, 12]
                })
                region_bar = alt.Chart(region_jobs).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Jobs:Q', title='Jobs'),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Region:N', 'Jobs:Q']
                ).properties(height=180)
                st.altair_chart(region_bar, use_container_width=True)
        
        with work_col2:
            st.markdown("**Cost per Visit Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                cost_df = pd.DataFrame({
                    'Month': months,
                    'Cost': [72, 70, 69, 71, 68, 68]
                })
                cost_line = alt.Chart(cost_df).mark_line(point=True, color='#F59E0B').encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Cost:Q', title='£ per Visit', scale=alt.Scale(domain=[60, 80])),
                    tooltip=['Month:N', alt.Tooltip('Cost:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(cost_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Operational Mix</div>', unsafe_allow_html=True)
        mix_col1, mix_col2 = st.columns(2)
        
        with mix_col1:
            st.markdown("**Jobs by Type**")
            with st.container(border=True):
                job_mix = pd.DataFrame({
                    'Type': ['Installation', 'Repair', 'Maintenance', 'Upgrade'],
                    'Jobs': [48, 42, 32, 20]
                }).set_index('Type')
                st.bar_chart(job_mix, height=180)
        
        with mix_col2:
            st.markdown("**Technician Utilization Trend**")
            with st.container(border=True):
                util_df = pd.DataFrame({
                    'Month': months,
                    'Utilization': [90, 91, 92, 93, 94, 94]
                }).set_index('Month')
                st.line_chart(util_df, height=180)
        
    with tab_ops:
        st.markdown("""
        <style>
        @keyframes field-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(16,185,129,0.2); }
            50% { box-shadow: 0 0 24px rgba(16,185,129,0.4); }
        }
        @keyframes field-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .field-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #D1FAE5 0%, #BBF7D0 100%);
            border: 1px solid #86EFAC;
            animation: field-ops-glow 3s ease-in-out infinite;
        }
        .field-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: field-ops-sweep 3s linear infinite;
        }
        .field-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .field-ops-title { font-weight: 700; color: #065F46; }
        .field-ops-tag {
            background: rgba(16,185,129,0.2);
            color: #065F46;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .field-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .field-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(16,185,129,0.2);
        }
        .field-ops-label { font-size: 0.7rem; color: #047857; text-transform: uppercase; letter-spacing: 0.06em; }
        .field-ops-value { font-size: 1.35rem; font-weight: 700; color: #065F46; }
        .field-ops-delta { font-size: 0.75rem; color: #047857; }
        </style>
        <div class="field-ops-pulse">
            <div class="field-ops-header">
                <div class="field-ops-title">🛠️ Field Operations Pulse</div>
                <div class="field-ops-tag">LIVE OPS</div>
            </div>
            <div class="field-ops-grid">
                <div class="field-ops-card">
                    <div class="field-ops-label">First-Time Fix</div>
                    <div class="field-ops-value">87%</div>
                    <div class="field-ops-delta">+3% vs target</div>
                </div>
                <div class="field-ops-card">
                    <div class="field-ops-label">SLA Compliance</div>
                    <div class="field-ops-value">94%</div>
                    <div class="field-ops-delta">Above 90% target</div>
                </div>
                <div class="field-ops-card">
                    <div class="field-ops-label">Avg Duration</div>
                    <div class="field-ops-value">52 min</div>
                    <div class="field-ops-delta">-8 min vs avg</div>
                </div>
                <div class="field-ops-card">
                    <div class="field-ops-label">Cost/Visit</div>
                    <div class="field-ops-value">£68</div>
                    <div class="field-ops-delta">-£4 vs budget</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # SLA Compliance Trend and FTF by Visit Type
        sla_col, ftf_col = st.columns(2)
        
        with sla_col:
            st.markdown('<div class="section-header">SLA Compliance Trend</div>', unsafe_allow_html=True)
            with st.container(border=True):
                weeks = [f'W{i}' for i in range(1, 13)]
                sla_trend = pd.DataFrame({
                    'Week': weeks,
                    'Compliance': [92, 93, 91, 94, 93, 95, 94, 93, 95, 94, 93, 94],
                    'Target': [90] * 12
                })
                
                sla_line = alt.Chart(sla_trend).mark_line(color='#10B981', strokeWidth=3).encode(
                    x=alt.X('Week:N', sort=weeks, title=None, axis=alt.Axis(labelAngle=0)),
                    y=alt.Y('Compliance:Q', scale=alt.Scale(domain=[85, 100]), title='%'),
                    tooltip=['Week:N', alt.Tooltip('Compliance:Q', format='.0f')]
                )
                
                sla_points = alt.Chart(sla_trend).mark_circle(color='#10B981', size=50).encode(
                    x=alt.X('Week:N', sort=weeks),
                    y=alt.Y('Compliance:Q'),
                    tooltip=['Week:N', alt.Tooltip('Compliance:Q', format='.0f')]
                )
                
                target_rule = alt.Chart(sla_trend).mark_rule(color='#DC2626', strokeDash=[4, 4]).encode(y='Target:Q')
                
                st.altair_chart((sla_line + sla_points + target_rule).properties(height=160), use_container_width=True)
                st.markdown('<div style="text-align: center; font-size: 0.75rem; color: #6B7280;"><span style="color: #DC2626;">---</span> 90% SLA Target</div>', unsafe_allow_html=True)
        
        with ftf_col:
            st.markdown('<div class="section-header">First-Time Fix by Type</div>', unsafe_allow_html=True)
            with st.container(border=True):
                ftf_data = pd.DataFrame({
                    'Type': ['Installation', 'Repair', 'Maintenance', 'Upgrade'],
                    'FTF': [92, 78, 95, 88],
                    'Jobs': [48, 42, 32, 20]
                })
                
                ftf_bars = alt.Chart(ftf_data).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Type:N', title=None),
                    y=alt.Y('FTF:Q', scale=alt.Scale(domain=[0, 100]), title='FTF %'),
                    color=alt.condition(alt.datum.FTF >= 90, alt.value('#10B981'), alt.value('#F59E0B')),
                    tooltip=['Type:N', alt.Tooltip('FTF:Q', format='.0f'), 'Jobs:Q']
                ).properties(height=160)
                
                st.altair_chart(ftf_bars, use_container_width=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Top Technicians (CSAT)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                tech_data = pd.DataFrame({
                    'Technician': ['Mike Johnson', 'Sarah Williams', 'Dave Brown', 'Lisa Chen', 'Tom Harris'],
                    'CSAT': [4.9, 4.8, 4.7, 4.6, 4.5],
                    'Jobs': [28, 32, 25, 30, 27],
                    'FTF': [96, 94, 92, 90, 91]
                })
                
                bars = alt.Chart(tech_data).mark_bar(cornerRadiusTopRight=8, cornerRadiusBottomRight=8).encode(
                    y=alt.Y('Technician:N', sort=alt.EncodingSortField(field='CSAT', order='descending'), title=None),
                    x=alt.X('CSAT:Q', scale=alt.Scale(domain=[0, 5]), title='CSAT Score'),
                    color=alt.value('#10B981'),
                    tooltip=['Technician:N', alt.Tooltip('CSAT:Q', format='.1f'), 'Jobs:Q', alt.Tooltip('FTF:Q', title='First-Time Fix %')]
                ).properties(height=180)
                
                st.altair_chart(bars, use_container_width=True)
        
        with col_right:
            st.markdown('<div class="section-header">Visit Types</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Installation</span>
                        <span style="font-weight: 600;">48 (£72 avg)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Repair</span>
                        <span style="font-weight: 600;">42 (£85 avg)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Maintenance</span>
                        <span style="font-weight: 600;">32 (£48 avg)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Upgrade</span>
                        <span style="font-weight: 600;">20 (£62 avg)</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Reschedule Drivers</div>', unsafe_allow_html=True)
        res_col1, res_col2 = st.columns(2)
        
        with res_col1:
            st.markdown("**Reschedule Reasons**")
            with st.container(border=True):
                res_df = pd.DataFrame({
                    'Reason': ['Customer Not Home', 'Parts Missing', 'Weather', 'Access Issue', 'Other'],
                    'Count': [6, 5, 3, 2, 2]
                })
                res_bar = alt.Chart(res_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Count:Q', title='Reschedules'),
                    y=alt.Y('Reason:N', sort='-x', title=None),
                    color=alt.Color('Reason:N', legend=None, scale=alt.Scale(
                        range=['#EF4444', '#F59E0B', '#29B5E8', '#10B981', '#8B5CF6']
                    )),
                    tooltip=['Reason:N', 'Count:Q']
                ).properties(height=180)
                st.altair_chart(res_bar, use_container_width=True)
        
        with res_col2:
            st.markdown("**Parts Availability by Depot**")
            with st.container(border=True):
                parts_df = pd.DataFrame({
                    'Depot': ['London', 'Manchester', 'Birmingham', 'Leeds', 'Glasgow'],
                    'Availability': [96, 92, 94, 90, 93]
                })
                parts_chart = parts_df.set_index('Depot')
                st.bar_chart(parts_chart, height=180)
        
    with tab_strategy:
        st.markdown("""
        <style>
        .sf-field-pulse {
            background: linear-gradient(135deg, #0EA5E9 0%, #2563EB 100%);
            color: white;
            border-radius: 14px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .sf-field-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: field-si-sweep 3s linear infinite;
        }
        @keyframes field-si-sweep {
            0% { transform: translateX(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(250%); opacity: 0; }
        }
        @keyframes field-si-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(14,165,233,0.35); }
            50% { box-shadow: 0 0 22px rgba(14,165,233,0.6); }
        }
        .sf-field-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-field-title { font-weight: 700; font-size: 1rem; }
        .sf-field-tag { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 999px; background: rgba(255,255,255,0.2); letter-spacing: 0.08em; }
        .sf-field-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-field-card { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 0.75rem; animation: field-si-glow 3s ease-in-out infinite; }
        .sf-field-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; opacity: 0.8; }
        .sf-field-value { font-size: 1.25rem; font-weight: 700; }
        </style>
        <div class="sf-field-pulse">
            <div class="sf-field-header">
                <div class="sf-field-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-field-tag">AI LIVE</div>
            </div>
            <div class="sf-field-grid">
                <div class="sf-field-card">
                    <div class="sf-field-label">FTF Gap</div>
                    <div class="sf-field-value">5%</div>
                </div>
                <div class="sf-field-card">
                    <div class="sf-field-label">SLA Risk</div>
                    <div class="sf-field-value">6 routes</div>
                </div>
                <div class="sf-field-card">
                    <div class="sf-field-label">Cost Drift</div>
                    <div class="sf-field-value">£6/visit</div>
                </div>
                <div class="sf-field-card">
                    <div class="sf-field-label">CSAT Trend</div>
                    <div class="sf-field-value">+0.2</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Snowflake Intelligence** identifies a 5% first-time fix gap tied to repair visits and parts availability, while SLA compliance remains strong. Route optimization and targeted upskilling can reduce cost per visit by £6 and lift FTF toward the 92% target.")
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**FTF Variance**")
                st.caption("Repair visits underperform at 78% FTF; maintenance leads at 95%.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**Route Efficiency**")
                st.caption("High reschedule rates in two regions increase cost per visit by £4.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Technician Performance**")
                st.caption("Top 10 technicians deliver 18% higher CSAT and 4% better FTF.")
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Parts Pre-Positioning**")
                st.caption("Stock critical parts per route to lift repair FTF by ~6%.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Dynamic Routing**")
                st.caption("Rebalance technician routes to cut travel time by 12%.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Skills Match**")
                st.caption("Match complex repairs to high-CSAT techs to reduce reschedules.")
        
        st.markdown('<div class="section-header">VP Field Operations Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">FTF Rate 92%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **87%** FTF
                - Gap: **5%** to target
                - Action: Parts inventory
                - Training: Upskill program
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Cost Reduction 10%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **£68** per visit
                - Target: **£62** per visit
                - Action: Route optimization
                - Savings: **£180K** projected
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Mobile App Launch</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Target: **100%** adoption
                - Features: Job mgmt, parts
                - Launch: February 2026
                - Efficiency: **+15%** projected
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What's our first-time fix rate?", "Show me technician performance rankings.", "What's our SLA compliance rate by region?", "What's the average cost per visit by type?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_strategy():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Strategy Dashboard</h1>
        <p>Market Position, Competitive Intelligence & Growth Opportunities</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_market, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧭 Market & Growth", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['MARKET_INTELLIGENCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        @keyframes viz-pulse {
            0%, 100% { box-shadow: 0 0 0 rgba(59,130,246,0.0); transform: translateY(0); }
            50% { box-shadow: 0 8px 24px rgba(59,130,246,0.18); transform: translateY(-2px); }
        }
        @keyframes viz-sweep {
            0% { transform: translateX(-120%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(120%); opacity: 0; }
        }
        .viz-pulse {
            position: relative;
            padding: 0.35rem;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(219,234,254,0.35), rgba(191,219,254,0.35));
            animation: viz-pulse 4s ease-in-out infinite;
            margin-bottom: 0.5rem;
        }
        .viz-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 35%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: viz-sweep 3.5s linear infinite;
            pointer-events: none;
            border-radius: 14px;
        }
        </style>
        """, unsafe_allow_html=True)
        
        # VP STRATEGY - COMPETITIVE RADAR ANIMATION
        st.markdown("""
        <style>
        @keyframes orbit { 0% { transform: rotate(0deg) translateX(50px) rotate(0deg); } 100% { transform: rotate(360deg) translateX(50px) rotate(-360deg); } }
        @keyframes pulse-quad { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        @keyframes strat-item-fade { 0% { opacity: 0; transform: translateY(10px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes strat-val-pop { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes strat-radar-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .strategy-radar { background: #F8FAFC; border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 2rem; border: 1px solid #E2E8F0; }
        .radar-viz { width: 160px; height: 160px; position: relative; flex-shrink: 0; }
        .quadrant { position: absolute; width: 50%; height: 50%; }
        .quadrant.tl { top: 0; left: 0; background: rgba(16,185,129,0.2); border-radius: 80px 0 0 0; animation: pulse-quad 3s ease-in-out infinite; }
        .quadrant.tr { top: 0; right: 0; background: rgba(59,130,246,0.2); border-radius: 0 80px 0 0; animation: pulse-quad 3s ease-in-out infinite 0.5s; }
        .quadrant.bl { bottom: 0; left: 0; background: rgba(245,158,11,0.2); border-radius: 0 0 0 80px; animation: pulse-quad 3s ease-in-out infinite 1s; }
        .quadrant.br { bottom: 0; right: 0; background: rgba(139,92,246,0.2); border-radius: 0 0 80px 0; animation: pulse-quad 3s ease-in-out infinite 1.5s; }
        .center-point { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; background: white; border-radius: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .orbit-dot { position: absolute; top: 50%; left: 50%; width: 12px; height: 12px; border-radius: 50%; animation: orbit 8s linear infinite; box-shadow: 0 0 8px currentColor; }
        .orbit-dot.ee { background: #8B5CF6; color: #8B5CF6; }
        .orbit-dot.o2 { background: #3B82F6; color: #3B82F6; animation-delay: -2s; }
        .orbit-dot.voda { background: #EF4444; color: #EF4444; animation-delay: -4s; }
        .orbit-dot.three { background: #F59E0B; color: #F59E0B; animation-delay: -6s; }
        .strategy-insights { flex: 1; }
        .strat-title { color: #1B2A4E; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; }
        .strat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
        .strat-item { background: white; border: 1px solid #E2E8F0; border-radius: 8px; padding: 0.8rem; }
        .strat-label { color: #64748B; font-size: 0.7rem; text-transform: uppercase; }
        .strat-val { color: #1B2A4E; font-size: 1.2rem; font-weight: 700; }
        .strat-sub { color: #94A3B8; font-size: 0.7rem; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="strategy-radar"><div class="radar-viz"><div class="quadrant tl"></div><div class="quadrant tr"></div><div class="quadrant bl"></div><div class="quadrant br"></div><div class="center-point"></div><div class="orbit-dot ee"></div><div class="orbit-dot o2"></div><div class="orbit-dot voda"></div><div class="orbit-dot three"></div></div><div class="strategy-insights"><div class="strat-title">🎯 Competitive Intelligence</div><div class="strat-grid"><div class="strat-item"><div class="strat-label">Market Position</div><div class="strat-val">#5 UK</div><div class="strat-sub">5.2% share</div></div><div class="strat-item"><div class="strat-label">Target 2027</div><div class="strat-val">#4 UK</div><div class="strat-sub">7% share goal</div></div><div class="strat-item"><div class="strat-label">Opportunity</div><div class="strat-val">£180M</div><div class="strat-sub">Addressable gap</div></div><div class="strat-item"><div class="strat-label">Threat Level</div><div class="strat-val">Medium</div><div class="strat-sub">Three declining</div></div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Market Position Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Market Share</div>
                <div class="kpi-value">5.2%</div>
                <div class="kpi-delta positive">↑ +0.4% YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">TAM (UK Mobile)</div>
                <div class="kpi-value">£18.4B</div>
                <div class="kpi-delta positive">↑ +3.2% YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">🎯</div>
                <div class="kpi-label">SAM</div>
                <div class="kpi-value">£2.8B</div>
                <div class="kpi-delta positive">SMB + Consumer</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">ARPU vs Market</div>
                <div class="kpi-value">+£4.20</div>
                <div class="kpi-delta positive">Above average</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Growth & Segment Signals</div>', unsafe_allow_html=True)
        seg_col1, seg_col2 = st.columns(2)
        
        with seg_col1:
            st.markdown("**Subscriber Growth by Segment**")
            with st.container(border=True):
                seg_df = pd.DataFrame({
                    'Segment': ['Consumer', 'SMB', 'Enterprise'],
                    'Growth': [3.4, 5.1, 2.2]
                }).set_index('Segment')
                st.bar_chart(seg_df, height=180)
        
        with seg_col2:
            st.markdown("**Churn vs Market (Quarterly)**")
            with st.container(border=True):
                churn_df = pd.DataFrame({
                    'Quarter': ['Q2', 'Q3', 'Q4', 'Q1'],
                    'SnowTelco': [1.8, 1.7, 1.6, 1.6],
                    'Market': [2.1, 2.0, 1.9, 1.9]
                }).set_index('Quarter')
                st.line_chart(churn_df, height=180)
        
        st.markdown('<div class="section-header">Brand & Adoption Signals</div>', unsafe_allow_html=True)
        brand_col1, brand_col2 = st.columns(2)
        
        with brand_col1:
            st.markdown("**NPS by Competitor**")
            with st.container(border=True):
                nps_df = pd.DataFrame({
                    'Brand': ['SnowTelco', 'EE', 'O2', 'Vodafone', 'Three'],
                    'NPS': [38, 32, 28, 26, 20]
                }).set_index('Brand')
                st.bar_chart(nps_df, height=180)
        
        with brand_col2:
            st.markdown("**5G Adoption Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                adoption_df = pd.DataFrame({
                    'Month': months,
                    'Adoption': [28, 30, 32, 34, 36, 38]
                })
                adoption_area = alt.Chart(adoption_df).mark_area(opacity=0.25, color='#2563EB').encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Adoption:Q', title='Adoption %', scale=alt.Scale(domain=[20, 45])),
                    tooltip=['Month:N', alt.Tooltip('Adoption:Q', format='.0f')]
                )
                adoption_line = alt.Chart(adoption_df).mark_line(point=True, color='#2563EB', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months),
                    y=alt.Y('Adoption:Q')
                )
                st.markdown('<div class="viz-pulse">', unsafe_allow_html=True)
                st.altair_chart((adoption_area + adoption_line).properties(height=180), use_container_width=True)
                st.markdown('</div>', unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Regional Growth & Acquisition</div>', unsafe_allow_html=True)
        reg_col1, reg_col2 = st.columns(2)
        
        with reg_col1:
            st.markdown("**Regional Net Adds**")
            with st.container(border=True):
                region_df = pd.DataFrame({
                    'Region': ['London', 'North West', 'Midlands', 'South East', 'Scotland', 'Wales'],
                    'Net Adds': [18.4, 12.6, 9.8, 11.2, 6.4, 4.8]
                })
                region_bar = alt.Chart(region_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Net Adds:Q', title='Net Adds (K)'),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Region:N', alt.Tooltip('Net Adds:Q', format='.1f')]
                ).properties(height=180)
                st.markdown('<div class="viz-pulse">', unsafe_allow_html=True)
                st.altair_chart(region_bar, use_container_width=True)
                st.markdown('</div>', unsafe_allow_html=True)
        
        with reg_col2:
            st.markdown("**Acquisition Channels Mix**")
            with st.container(border=True):
                channel_df = pd.DataFrame({
                    'Channel': ['Retail', 'Online', 'Partner', 'Inbound'],
                    'Share': [38, 32, 18, 12]
                })
                channel_donut = alt.Chart(channel_df).mark_arc(innerRadius=45).encode(
                    theta=alt.Theta('Share:Q'),
                    color=alt.Color('Channel:N', scale=alt.Scale(
                        domain=['Retail', 'Online', 'Partner', 'Inbound'],
                        range=['#2563EB', '#10B981', '#F59E0B', '#8B5CF6']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Channel:N', 'Share:Q']
                ).properties(height=180)
                st.markdown('<div class="viz-pulse">', unsafe_allow_html=True)
                st.altair_chart(channel_donut, use_container_width=True)
                st.markdown('</div>', unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Plan Mix & Win-Back</div>', unsafe_allow_html=True)
        mix_col1, mix_col2 = st.columns(2)
        
        with mix_col1:
            st.markdown("**Plan Mix (Active Base)**")
            with st.container(border=True):
                plan_df = pd.DataFrame({
                    'Plan': ['SIM Only', 'Handset', '5G Premium', 'Family'],
                    'Share': [44, 28, 18, 10]
                })
                plan_donut = alt.Chart(plan_df).mark_arc(innerRadius=45).encode(
                    theta=alt.Theta('Share:Q'),
                    color=alt.Color('Plan:N', scale=alt.Scale(
                        domain=['SIM Only', 'Handset', '5G Premium', 'Family'],
                        range=['#29B5E8', '#9CA3AF', '#10B981', '#F59E0B']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Plan:N', 'Share:Q']
                ).properties(height=180)
                st.markdown('<div class="viz-pulse">', unsafe_allow_html=True)
                st.altair_chart(plan_donut, use_container_width=True)
                st.markdown('</div>', unsafe_allow_html=True)
        
        with mix_col2:
            st.markdown("**Win-Back Conversion Trend**")
            with st.container(border=True):
                quarters = ['Q2', 'Q3', 'Q4', 'Q1']
                winback_df = pd.DataFrame({
                    'Quarter': quarters,
                    'Conversion': [12, 14, 16, 18]
                })
                winback_line = alt.Chart(winback_df).mark_line(point=True, color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Quarter:N', sort=quarters, title=None),
                    y=alt.Y('Conversion:Q', title='Conversion %', scale=alt.Scale(domain=[8, 22])),
                    tooltip=['Quarter:N', alt.Tooltip('Conversion:Q', format='.0f')]
                ).properties(height=180)
                st.markdown('<div class="viz-pulse">', unsafe_allow_html=True)
                st.altair_chart(winback_line, use_container_width=True)
                st.markdown('</div>', unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Pricing Elasticity</div>', unsafe_allow_html=True)
        price_col1, price_col2 = st.columns(2)
        
        with price_col1:
            st.markdown("**Price Sensitivity by Segment**")
            with st.container(border=True):
                elastic_df = pd.DataFrame({
                    'Segment': ['Consumer', 'SMB', 'Enterprise'],
                    'Elasticity': [1.3, 0.9, 0.6]
                })
                elastic_bar = alt.Chart(elastic_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Elasticity:Q', title='Elasticity'),
                    y=alt.Y('Segment:N', sort='-x', title=None),
                    color=alt.Color('Segment:N', legend=None, scale=alt.Scale(
                        range=['#EF4444', '#F59E0B', '#10B981']
                    )),
                    tooltip=['Segment:N', alt.Tooltip('Elasticity:Q', format='.1f')]
                ).properties(height=180)
                st.markdown('<div class="viz-pulse">', unsafe_allow_html=True)
                st.altair_chart(elastic_bar, use_container_width=True)
                st.markdown('</div>', unsafe_allow_html=True)
        
        with price_col2:
            st.markdown("**Promo Lift vs Baseline**")
            with st.container(border=True):
                promo_df = pd.DataFrame({
                    'Offer': ['SIM Only', 'Handset', '5G Premium', 'Family'],
                    'Lift': [8, 6, 10, 5]
                })
                promo_bar = alt.Chart(promo_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Lift:Q', title='Lift %'),
                    y=alt.Y('Offer:N', sort='-x', title=None),
                    color=alt.Color('Offer:N', legend=None, scale=alt.Scale(
                        range=['#29B5E8', '#9CA3AF', '#10B981', '#F59E0B']
                    )),
                    tooltip=['Offer:N', alt.Tooltip('Lift:Q', format='.0f')]
                ).properties(height=180)
                st.markdown('<div class="viz-pulse">', unsafe_allow_html=True)
                st.altair_chart(promo_bar, use_container_width=True)
                st.markdown('</div>', unsafe_allow_html=True)
        
    with tab_market:
        st.markdown("""
        <style>
        @keyframes strat-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 24px rgba(59,130,246,0.4); }
        }
        @keyframes strat-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .strat-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: strat-ops-glow 3s ease-in-out infinite;
        }
        .strat-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: strat-ops-sweep 3s linear infinite;
        }
        .strat-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .strat-ops-title { font-weight: 700; color: #1E3A8A; }
        .strat-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .strat-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .strat-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .strat-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .strat-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .strat-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="strat-ops-pulse">
            <div class="strat-ops-header">
                <div class="strat-ops-title">🧭 Market & Growth Pulse</div>
                <div class="strat-ops-tag">LIVE</div>
            </div>
            <div class="strat-ops-grid">
                <div class="strat-ops-card">
                    <div class="strat-ops-label">Share</div>
                    <div class="strat-ops-value">5.2%</div>
                    <div class="strat-ops-delta">+0.4% YoY</div>
                </div>
                <div class="strat-ops-card">
                    <div class="strat-ops-label">ARPU Gap</div>
                    <div class="strat-ops-value">£4.20</div>
                    <div class="strat-ops-delta">Above market</div>
                </div>
                <div class="strat-ops-card">
                    <div class="strat-ops-label">Opportunity</div>
                    <div class="strat-ops-value">£180M</div>
                    <div class="strat-ops-delta">SMB + Consumer</div>
                </div>
                <div class="strat-ops-card">
                    <div class="strat-ops-label">Threat Level</div>
                    <div class="strat-ops-value">Medium</div>
                    <div class="strat-ops-delta">Three declining</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        # Market Share Trend and ARPU Comparison
        share_trend_col, arpu_col = st.columns(2)
        
        with share_trend_col:
            st.markdown('<div class="section-header">Market Share Trend (12 Months)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                share_trend_data = pd.DataFrame({
                    'Month': months * 3,
                    'MonthOrder': list(range(12)) * 3,
                    'Carrier': ['SnowTelco']*12 + ['Three']*12 + ['Others']*12,
                    'Share': [4.6, 4.7, 4.7, 4.8, 4.8, 4.9, 5.0, 5.0, 5.1, 5.1, 5.2, 5.2,
                             14.8, 14.7, 14.6, 14.5, 14.4, 14.3, 14.2, 14.2, 14.1, 14.0, 14.0, 14.0,
                             5.2, 5.1, 5.1, 5.0, 5.0, 4.9, 4.9, 4.9, 4.8, 4.8, 4.8, 4.8]
                })
                
                share_lines = alt.Chart(share_trend_data).mark_line(strokeWidth=2, point=True).encode(
                    x=alt.X('Month:N', sort=alt.EncodingSortField(field='MonthOrder'), title=None, axis=alt.Axis(labelAngle=-45)),
                    y=alt.Y('Share:Q', scale=alt.Scale(domain=[0, 20]), title='Share %'),
                    color=alt.Color('Carrier:N', scale=alt.Scale(
                        domain=['SnowTelco', 'Three', 'Others'],
                        range=['#29B5E8', '#EF4444', '#9CA3AF']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    order='MonthOrder:Q',
                    tooltip=['Month:N', 'Carrier:N', alt.Tooltip('Share:Q', format='.1f')]
                ).properties(height=160)
                
                st.altair_chart(share_lines, use_container_width=True)
        
        with arpu_col:
            st.markdown('<div class="section-header">ARPU Comparison</div>', unsafe_allow_html=True)
            with st.container(border=True):
                arpu_data = pd.DataFrame({
                    'Carrier': ['EE', 'Vodafone', 'SnowTelco', 'O2', 'Three'],
                    'ARPU': [48.20, 44.80, 43.60, 42.10, 38.40]
                })
                
                arpu_bars = alt.Chart(arpu_data).mark_bar(cornerRadiusTopRight=8, cornerRadiusBottomRight=8).encode(
                    y=alt.Y('Carrier:N', sort=alt.EncodingSortField(field='ARPU', order='descending'), title=None),
                    x=alt.X('ARPU:Q', scale=alt.Scale(domain=[0, 55]), title='ARPU (£)'),
                    color=alt.condition(alt.datum.Carrier == 'SnowTelco', alt.value('#29B5E8'), alt.value('#9CA3AF')),
                    tooltip=['Carrier:N', alt.Tooltip('ARPU:Q', format='£.2f')]
                ).properties(height=160)
                
                st.altair_chart(arpu_bars, use_container_width=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Competitor Market Share</div>', unsafe_allow_html=True)
            with st.container(border=True):
                market_data = pd.DataFrame({
                    'Carrier': ['EE', 'O2', 'Vodafone', 'Three', 'SnowTelco', 'Others'],
                    'Share': [28, 26, 22, 14, 5.2, 4.8],
                    'Trend': ['+0.2%', '-0.4%', '+0.1%', '-0.3%', '+0.4%', '0%']
                })
                
                bars = alt.Chart(market_data).mark_bar(cornerRadiusTopRight=8, cornerRadiusBottomRight=8).encode(
                    y=alt.Y('Carrier:N', sort=alt.EncodingSortField(field='Share', order='descending'), title=None),
                    x=alt.X('Share:Q', scale=alt.Scale(domain=[0, 35]), title='Market Share (%)'),
                    color=alt.condition(alt.datum.Carrier == 'SnowTelco', alt.value('#29B5E8'), alt.value('#9CA3AF')),
                    tooltip=['Carrier:N', alt.Tooltip('Share:Q', format='.1f'), 'Trend:N']
                ).properties(height=200)
                
                st.altair_chart(bars, use_container_width=True)
        
        with col_right:
            st.markdown('<div class="section-header">Competitive Threats</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.6rem; border-left: 4px solid #EF4444; background: #FEE2E2; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="font-weight: 600; color: #DC2626;">Three Price War</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">Aggressive SMB pricing -15%</div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #F59E0B; background: #FEF3C7; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                        <div style="font-weight: 600; color: #92400E;">EE 5G Expansion</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">+200 sites in our key regions</div>
                    </div>
                    <div style="padding: 0.6rem; border-left: 4px solid #10B981; background: #D1FAE5; border-radius: 0 8px 8px 0;">
                        <div style="font-weight: 600; color: #065F46;">Opportunity: Three Churn</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">+167 port-ins this quarter</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Pricing & Offer Dynamics</div>', unsafe_allow_html=True)
        price_col1, price_col2 = st.columns(2)
        
        with price_col1:
            st.markdown("**Promo Intensity by Competitor**")
            with st.container(border=True):
                promo_df = pd.DataFrame({
                    'Competitor': ['EE', 'O2', 'Vodafone', 'Three', 'SnowTelco'],
                    'Intensity': [78, 64, 59, 85, 52]
                })
                promo_bar = alt.Chart(promo_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Intensity:Q', title='Promo Intensity'),
                    y=alt.Y('Competitor:N', sort='-x', title=None),
                    color=alt.condition(alt.datum.Competitor == 'SnowTelco', alt.value('#29B5E8'), alt.value('#9CA3AF')),
                    tooltip=['Competitor:N', 'Intensity:Q']
                ).properties(height=180)
                st.altair_chart(promo_bar, use_container_width=True)
        
        with price_col2:
            st.markdown("**Offer Mix (New Activations)**")
            with st.container(border=True):
                offer_df = pd.DataFrame({
                    'Offer': ['SIM Only', 'Handset', '5G Premium', 'Family'],
                    'Share': [42, 26, 18, 14]
                }).set_index('Offer')
                st.bar_chart(offer_df, height=180)
        

    with tab_strategy:
        st.markdown("""
        <style>
        .sf-strategy-pulse {
            background: linear-gradient(135deg, #0EA5E9 0%, #2563EB 100%);
            color: white;
            border-radius: 14px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .sf-strategy-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: strategy-si-sweep 3s linear infinite;
        }
        @keyframes strategy-si-sweep {
            0% { transform: translateX(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(250%); opacity: 0; }
        }
        @keyframes strategy-si-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(14,165,233,0.35); }
            50% { box-shadow: 0 0 22px rgba(14,165,233,0.6); }
        }
        .sf-strategy-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-strategy-title { font-weight: 700; font-size: 1rem; }
        .sf-strategy-tag { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 999px; background: rgba(255,255,255,0.2); letter-spacing: 0.08em; }
        .sf-strategy-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-strategy-card { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 0.75rem; animation: strategy-si-glow 3s ease-in-out infinite; }
        .sf-strategy-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; opacity: 0.8; }
        .sf-strategy-value { font-size: 1.25rem; font-weight: 700; }
        </style>
        <div class="sf-strategy-pulse">
            <div class="sf-strategy-header">
                <div class="sf-strategy-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-strategy-tag">AI LIVE</div>
            </div>
            <div class="sf-strategy-grid">
                <div class="sf-strategy-card">
                    <div class="sf-strategy-label">Share Gap</div>
                    <div class="sf-strategy-value">0.8%</div>
                </div>
                <div class="sf-strategy-card">
                    <div class="sf-strategy-label">Port-in Lift</div>
                    <div class="sf-strategy-value">+167</div>
                </div>
                <div class="sf-strategy-card">
                    <div class="sf-strategy-label">ARPU Lead</div>
                    <div class="sf-strategy-value">£4.20</div>
                </div>
                <div class="sf-strategy-card">
                    <div class="sf-strategy-label">Threat Level</div>
                    <div class="sf-strategy-value">Medium</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Snowflake Intelligence** shows steady share gains but a 0.8% gap to the 6% target. ARPU leadership is strong, while competitor price pressure remains elevated in SMB. Focused win‑back and 5G differentiation can accelerate share momentum.")

        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Share Momentum**")
                st.caption("SnowTelco share trends +0.4% YoY; Three declining for 4 straight quarters.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**ARPU Advantage**")
                st.caption("ARPU sits £4.20 above market average, supported by premium 5G bundles.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Competitive Pressure**")
                st.caption("SMB price pressure intensifies; targeted discounts needed to protect margin.")

        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Win‑Back Acceleration**")
                st.caption("Target 3,200 churners with 5G‑plus bundles; projected +0.3% share lift.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**SMB Pricing Guardrails**")
                st.caption("Deploy segmented pricing to counter Three without eroding ARPU leadership.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**5G Differentiation**")
                st.caption("Lead with coverage + value messaging in top 5 growth regions.")

        st.markdown('<div class="section-header">VP Strategy Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">6% Market Share</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **5.2%** share
                - Gap: **0.8%** to target
                - Focus: SMB segment
                - Action: Competitive pricing
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Three Win-Back</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Opportunity: **3,200** churners
                - Target: **500** acquisitions
                - Campaign: March 2026
                - Budget: **£120K** approved
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">5G Differentiation</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Coverage: **65%** UK pop.
                - USP: Best value 5G
                - Marketing: Q1 campaign
                - Investment: **£2.4M** capex
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What's our market share vs competitors?", "How has our market share trended?", "How does our ARPU compare to competitors?", "Which competitors are gaining/losing share?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_communications():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Communications Dashboard</h1>
        <p>Brand Reputation, Social Media Monitoring & Crisis Management</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "📣 Communications Ops", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['SOCIAL_SENTIMENT']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP COMMUNICATIONS - SOCIAL SENTIMENT WAVE ANIMATION
        st.markdown("""
        <style>
        @keyframes social-wave { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes social-float { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-10px) scale(1.1); } }
        @keyframes social-pulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        @keyframes social-shimmer { 0% { left: -100%; } 100% { left: 200%; } }
        .social-sentiment { background: linear-gradient(135deg, #FDF2F8 0%, #FCE7F3 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #FBCFE8; position: relative; overflow: hidden; }
        .social-sentiment::before { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(219,39,119,0.08), transparent); animation: social-shimmer 4s ease-in-out infinite; }
        .social-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; position: relative; z-index: 1; }
        .social-title { color: #9D174D; font-size: 1.1rem; font-weight: 600; }
        .social-mentions { color: #BE185D; font-size: 0.75rem; }
        .social-emojis { display: flex; justify-content: center; gap: 2rem; margin-bottom: 1rem; position: relative; z-index: 1; }
        .social-emoji { text-align: center; animation: social-float 3s ease-in-out infinite; }
        .social-emoji:nth-child(2) { animation-delay: 0.5s; }
        .social-emoji:nth-child(3) { animation-delay: 1s; }
        .social-emoji-icon { font-size: 2.5rem; }
        .social-emoji-pct { color: #9D174D; font-size: 1.2rem; font-weight: 700; margin-top: 0.3rem; }
        .social-emoji-label { color: #BE185D; font-size: 0.65rem; }
        .social-channels { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .social-channel { background: white; border-radius: 8px; padding: 0.6rem; text-align: center; animation: social-wave 2s ease-in-out infinite; border: 1px solid #FBCFE8; }
        .social-channel:nth-child(2) { animation-delay: 0.25s; }
        .social-channel:nth-child(3) { animation-delay: 0.5s; }
        .social-channel:nth-child(4) { animation-delay: 0.75s; }
        .social-channel-icon { font-size: 1.2rem; }
        .social-channel-val { color: #9D174D; font-size: 0.9rem; font-weight: 700; }
        .social-channel-label { color: #BE185D; font-size: 0.6rem; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="social-sentiment"><div class="social-header"><div class="social-title">📱 Social Sentiment Live</div><div class="social-mentions">8,420 mentions today</div></div><div class="social-emojis"><div class="social-emoji"><div class="social-emoji-icon">😊</div><div class="social-emoji-pct">35%</div><div class="social-emoji-label">Positive</div></div><div class="social-emoji"><div class="social-emoji-icon">😐</div><div class="social-emoji-pct">25%</div><div class="social-emoji-label">Neutral</div></div><div class="social-emoji"><div class="social-emoji-icon">😠</div><div class="social-emoji-pct">40%</div><div class="social-emoji-label">Negative</div></div></div><div class="social-channels"><div class="social-channel"><div class="social-channel-icon">🐦</div><div class="social-channel-val">3.2K</div><div class="social-channel-label">Twitter</div></div><div class="social-channel"><div class="social-channel-icon">📘</div><div class="social-channel-val">2.8K</div><div class="social-channel-label">Facebook</div></div><div class="social-channel"><div class="social-channel-icon">📸</div><div class="social-channel-val">1.4K</div><div class="social-channel-label">Instagram</div></div><div class="social-channel"><div class="social-channel-icon">💼</div><div class="social-channel-val">1K</div><div class="social-channel-label">LinkedIn</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Social Media Overview</div>', unsafe_allow_html=True)
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">😊</div>
                <div class="kpi-label">Positive Sentiment</div>
                <div class="kpi-value">35%</div>
                <div class="kpi-delta positive">↑ +4% WoW</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">😠</div>
                <div class="kpi-label">Negative Sentiment</div>
                <div class="kpi-value">40%</div>
                <div class="kpi-delta negative">↑ +2% WoW</div>
            </div>
            <div class="kpi-card" style="--accent: #9CA3AF;">
                <div class="kpi-icon">😐</div>
                <div class="kpi-label">Neutral</div>
                <div class="kpi-value">25%</div>
                <div class="kpi-delta positive">-6% WoW</div>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">💬</div>
                <div class="kpi-label">Total Mentions</div>
                <div class="kpi-value">2,847</div>
                <div class="kpi-delta positive">↑ +18% WoW</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">Avg Response Time</div>
                <div class="kpi-value">2.4 hrs</div>
                <div class="kpi-delta positive">↓ -0.6 hrs</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📋</div>
                <div class="kpi-label">Response Backlog</div>
                <div class="kpi-value">42</div>
                <div class="kpi-delta negative">Need attention</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">🌟</div>
                <div class="kpi-label">Influencer Mentions</div>
                <div class="kpi-value">28</div>
                <div class="kpi-delta positive">High reach</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🎯</div>
                <div class="kpi-label">Engagement Rate</div>
                <div class="kpi-value">3.2%</div>
                <div class="kpi-delta positive">↑ +0.4%</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Awareness & Reach</div>', unsafe_allow_html=True)
        reach_col1, reach_col2 = st.columns(2)
        
        with reach_col1:
            st.markdown("**Share of Voice (Weekly)**")
            with st.container(border=True):
                weeks = ['W1', 'W2', 'W3', 'W4']
                sov_df = pd.DataFrame({
                    'Week': weeks * 3,
                    'Brand': ['SnowTelco'] * 4 + ['EE'] * 4 + ['O2'] * 4,
                    'Share': [18, 19, 20, 21, 28, 27, 27, 26, 24, 24, 23, 23]
                })
                sov_area = alt.Chart(sov_df).mark_area().encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Share:Q', stack='normalize', title='%'),
                    color=alt.Color('Brand:N', legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Week:N', 'Brand:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(sov_area, use_container_width=True)
        
        with reach_col2:
            st.markdown("**Earned Media Mentions**")
            with st.container(border=True):
                media_df = pd.DataFrame({
                    'Channel': ['Press', 'Broadcast', 'Online', 'Podcasts'],
                    'Mentions': [42, 18, 74, 12]
                })
                media_bar = alt.Chart(media_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Mentions:Q', title='Mentions'),
                    y=alt.Y('Channel:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Channel:N', 'Mentions:Q']
                ).properties(height=170)
                st.altair_chart(media_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Engagement Performance</div>', unsafe_allow_html=True)
        eng_col1, eng_col2 = st.columns(2)
        
        with eng_col1:
            st.markdown("**Engagement Rate by Platform**")
            with st.container(border=True):
                eng_df = pd.DataFrame({
                    'Platform': ['Twitter/X', 'Facebook', 'Instagram', 'LinkedIn'],
                    'Engagement': [2.8, 3.1, 4.4, 3.6]
                })
                eng_bar = alt.Chart(eng_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Engagement:Q', title='Engagement %'),
                    y=alt.Y('Platform:N', sort='-x', title=None),
                    color=alt.Color('Platform:N', legend=None, scale=alt.Scale(
                        range=['#2563EB', '#9CA3AF', '#EC4899', '#14B8A6']
                    )),
                    tooltip=['Platform:N', alt.Tooltip('Engagement:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(eng_bar, use_container_width=True)
        
        with eng_col2:
            st.markdown("**Crisis Alert Volume (Daily)**")
            with st.container(border=True):
                days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                crisis_df = pd.DataFrame({
                    'Day': days,
                    'Alerts': [6, 4, 8, 5, 7, 3, 2]
                })
                crisis_line = alt.Chart(crisis_df).mark_line(point=True, color='#EF4444', strokeWidth=2).encode(
                    x=alt.X('Day:N', sort=days, title=None),
                    y=alt.Y('Alerts:Q', title='Alerts'),
                    tooltip=['Day:N', 'Alerts:Q']
                ).properties(height=170)
                st.altair_chart(crisis_line, use_container_width=True)
        
    with tab_ops:
        st.markdown("""
        <style>
        @keyframes comms-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(219,39,119,0.2); }
            50% { box-shadow: 0 0 24px rgba(219,39,119,0.4); }
        }
        @keyframes comms-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .comms-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
            border: 1px solid #F9A8D4;
            animation: comms-ops-glow 3s ease-in-out infinite;
        }
        .comms-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: comms-ops-sweep 3s linear infinite;
        }
        .comms-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .comms-ops-title { font-weight: 700; color: #9D174D; }
        .comms-ops-tag {
            background: rgba(219,39,119,0.15);
            color: #9D174D;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .comms-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .comms-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(219,39,119,0.2);
        }
        .comms-ops-label { font-size: 0.7rem; color: #9D174D; text-transform: uppercase; letter-spacing: 0.06em; }
        .comms-ops-value { font-size: 1.35rem; font-weight: 700; color: #9D174D; }
        .comms-ops-delta { font-size: 0.75rem; color: #BE185D; }
        </style>
        <div class="comms-ops-pulse">
            <div class="comms-ops-header">
                <div class="comms-ops-title">📣 Communications Pulse</div>
                <div class="comms-ops-tag">LIVE</div>
            </div>
            <div class="comms-ops-grid">
                <div class="comms-ops-card">
                    <div class="comms-ops-label">Positive</div>
                    <div class="comms-ops-value">35%</div>
                    <div class="comms-ops-delta">+4% WoW</div>
                </div>
                <div class="comms-ops-card">
                    <div class="comms-ops-label">Negative</div>
                    <div class="comms-ops-value">40%</div>
                    <div class="comms-ops-delta">+2% WoW</div>
                </div>
                <div class="comms-ops-card">
                    <div class="comms-ops-label">Mentions</div>
                    <div class="comms-ops-value">2,847</div>
                    <div class="comms-ops-delta">+18% WoW</div>
                </div>
                <div class="comms-ops-card">
                    <div class="comms-ops-label">Response</div>
                    <div class="comms-ops-value">2.4 hrs</div>
                    <div class="comms-ops-delta">-0.6 hrs</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        # Sentiment Trend and Mention Volume
        sentiment_trend_col, volume_col = st.columns(2)
        
        with sentiment_trend_col:
            st.markdown('<div class="section-header">Sentiment Trend (4 Weeks)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                weeks = ['Week 1', 'Week 2', 'Week 3', 'Week 4']
                sentiment_trend = pd.DataFrame({
                    'Week': weeks * 3,
                    'Sentiment': ['Positive']*4 + ['Neutral']*4 + ['Negative']*4,
                    'Percentage': [32, 33, 34, 35, 28, 27, 26, 25, 40, 40, 40, 40]
                })
                
                sentiment_area = alt.Chart(sentiment_trend).mark_area().encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Percentage:Q', stack='normalize', title='%'),
                    color=alt.Color('Sentiment:N', scale=alt.Scale(
                        domain=['Positive', 'Neutral', 'Negative'],
                        range=['#10B981', '#9CA3AF', '#EF4444']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Week:N', 'Sentiment:N', alt.Tooltip('Percentage:Q', format='.0f')]
                ).properties(height=160)
                
                st.altair_chart(sentiment_area, use_container_width=True)
        
        with volume_col:
            st.markdown('<div class="section-header">Daily Mention Volume</div>', unsafe_allow_html=True)
            with st.container(border=True):
                days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                volume_data = pd.DataFrame({
                    'Day': days,
                    'Mentions': [420, 380, 450, 520, 480, 320, 280]
                })
                
                volume_bars = alt.Chart(volume_data).mark_bar(color='#29B5E8', cornerRadiusTopLeft=4, cornerRadiusTopRight=4).encode(
                    x=alt.X('Day:N', sort=days, title=None),
                    y=alt.Y('Mentions:Q', title='Mentions'),
                    tooltip=['Day:N', 'Mentions:Q']
                ).properties(height=160)
                
                st.altair_chart(volume_bars, use_container_width=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Sentiment by Platform</div>', unsafe_allow_html=True)
            with st.container(border=True):
                platform_data = pd.DataFrame({
                    'Platform': ['Twitter/X', 'Facebook', 'Instagram', 'LinkedIn', 'TrustPilot'],
                    'Positive': [32, 38, 45, 52, 28],
                    'Negative': [45, 38, 25, 18, 52],
                    'Mentions': [1240, 680, 420, 280, 227]
                })
                
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem;">Platform</th>
                            <th style="text-align: right; padding: 0.5rem;">Positive</th>
                            <th style="text-align: right; padding: 0.5rem;">Negative</th>
                            <th style="text-align: right; padding: 0.5rem;">Mentions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">Twitter/X</td>
                            <td style="text-align: right; padding: 0.5rem; color: #10B981;">32%</td>
                            <td style="text-align: right; padding: 0.5rem; color: #EF4444;">45%</td>
                            <td style="text-align: right; padding: 0.5rem;">1,240</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">Facebook</td>
                            <td style="text-align: right; padding: 0.5rem; color: #10B981;">38%</td>
                            <td style="text-align: right; padding: 0.5rem; color: #EF4444;">38%</td>
                            <td style="text-align: right; padding: 0.5rem;">680</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">Instagram</td>
                            <td style="text-align: right; padding: 0.5rem; color: #10B981;">45%</td>
                            <td style="text-align: right; padding: 0.5rem; color: #F59E0B;">25%</td>
                            <td style="text-align: right; padding: 0.5rem;">420</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">LinkedIn</td>
                            <td style="text-align: right; padding: 0.5rem; color: #10B981;">52%</td>
                            <td style="text-align: right; padding: 0.5rem; color: #10B981;">18%</td>
                            <td style="text-align: right; padding: 0.5rem;">280</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">TrustPilot</td>
                            <td style="text-align: right; padding: 0.5rem; color: #F59E0B;">28%</td>
                            <td style="text-align: right; padding: 0.5rem; color: #EF4444;">52%</td>
                            <td style="text-align: right; padding: 0.5rem;">227</td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Top Topics</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Network Coverage</span>
                        <span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">-0.42</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Customer Service</span>
                        <span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">-0.18</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>5G Plans</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">+0.32</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Pricing</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">+0.15</span>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #FEE2E2; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #DC2626;">⚠️ Network coverage driving negative sentiment</span>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Crisis Response Performance</div>', unsafe_allow_html=True)
        crisis_col1, crisis_col2 = st.columns(2)
        
        with crisis_col1:
            st.markdown("**Response Time Distribution**")
            with st.container(border=True):
                response_df = pd.DataFrame({
                    'Bucket': ['<30m', '30-60m', '1-2h', '2-4h', '4h+'],
                    'Cases': [42, 38, 28, 16, 8]
                })
                response_bar = alt.Chart(response_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Cases:Q', title='Cases'),
                    y=alt.Y('Bucket:N', sort='-x', title=None),
                    color=alt.Color('Bucket:N', legend=None, scale=alt.Scale(
                        range=['#10B981', '#14B8A6', '#F59E0B', '#F97316', '#EF4444']
                    )),
                    tooltip=['Bucket:N', 'Cases:Q']
                ).properties(height=170)
                st.altair_chart(response_bar, use_container_width=True)
        
        with crisis_col2:
            st.markdown("**Crisis Escalations by Severity**")
            with st.container(border=True):
                esc_df = pd.DataFrame({
                    'Severity': ['P1', 'P2', 'P3', 'P4'],
                    'Escalations': [6, 12, 18, 10]
                })
                esc_bar = alt.Chart(esc_df).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Severity:N', title=None),
                    y=alt.Y('Escalations:Q', title='Escalations'),
                    color=alt.Color('Severity:N', legend=None, scale=alt.Scale(
                        domain=['P1', 'P2', 'P3', 'P4'],
                        range=['#EF4444', '#F59E0B', '#29B5E8', '#9CA3AF']
                    )),
                    tooltip=['Severity:N', 'Escalations:Q']
                ).properties(height=170)
                st.altair_chart(esc_bar, use_container_width=True)
        
        backlog_col1, backlog_col2 = st.columns(2)
        
        with backlog_col1:
            st.markdown("**Response Backlog Trend**")
            with st.container(border=True):
                days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                backlog_df = pd.DataFrame({
                    'Day': days,
                    'Backlog': [46, 44, 42, 40, 38, 36, 34]
                })
                backlog_line = alt.Chart(backlog_df).mark_line(point=True, color='#8B5CF6', strokeWidth=2).encode(
                    x=alt.X('Day:N', sort=days, title=None),
                    y=alt.Y('Backlog:Q', title='Backlog'),
                    tooltip=['Day:N', 'Backlog:Q']
                ).properties(height=170)
                st.altair_chart(backlog_line, use_container_width=True)
        
        with backlog_col2:
            st.markdown("**Response Volume by Channel**")
            with st.container(border=True):
                resp_df = pd.DataFrame({
                    'Channel': ['Twitter/X', 'Facebook', 'Instagram', 'LinkedIn', 'TrustPilot'],
                    'Responses': [220, 180, 120, 90, 60]
                })
                resp_bar = alt.Chart(resp_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Responses:Q', title='Responses'),
                    y=alt.Y('Channel:N', sort='-x', title=None),
                    color=alt.Color('Channel:N', legend=None, scale=alt.Scale(
                        range=['#2563EB', '#9CA3AF', '#EC4899', '#14B8A6', '#F59E0B']
                    )),
                    tooltip=['Channel:N', 'Responses:Q']
                ).properties(height=170)
                st.altair_chart(resp_bar, use_container_width=True)
        

    with tab_strategy:
        st.markdown("""
        <style>
        .sf-comms-pulse {
            background: linear-gradient(135deg, #0EA5E9 0%, #2563EB 100%);
            color: white;
            border-radius: 14px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .sf-comms-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: comms-si-sweep 3s linear infinite;
        }
        @keyframes comms-si-sweep {
            0% { transform: translateX(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(250%); opacity: 0; }
        }
        @keyframes comms-si-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(14,165,233,0.35); }
            50% { box-shadow: 0 0 22px rgba(14,165,233,0.6); }
        }
        .sf-comms-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-comms-title { font-weight: 700; font-size: 1rem; }
        .sf-comms-tag { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 999px; background: rgba(255,255,255,0.2); letter-spacing: 0.08em; }
        .sf-comms-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-comms-card { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 0.75rem; animation: comms-si-glow 3s ease-in-out infinite; }
        .sf-comms-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; opacity: 0.8; }
        .sf-comms-value { font-size: 1.25rem; font-weight: 700; }
        </style>
        <div class="sf-comms-pulse">
            <div class="sf-comms-header">
                <div class="sf-comms-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-comms-tag">AI LIVE</div>
            </div>
            <div class="sf-comms-grid">
                <div class="sf-comms-card">
                    <div class="sf-comms-label">Positive</div>
                    <div class="sf-comms-value">35%</div>
                </div>
                <div class="sf-comms-card">
                    <div class="sf-comms-label">Negative</div>
                    <div class="sf-comms-value">40%</div>
                </div>
                <div class="sf-comms-card">
                    <div class="sf-comms-label">Mentions</div>
                    <div class="sf-comms-value">2,847</div>
                </div>
                <div class="sf-comms-card">
                    <div class="sf-comms-label">Response</div>
                    <div class="sf-comms-value">2.4 hrs</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Snowflake Intelligence** flags negative sentiment concentration around network coverage and response time. Prioritizing coverage narrative and expanding social response capacity can lift positive sentiment by 6–8 points.")

        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Sentiment Mix**")
                st.caption("Negative mentions hold at 40% with spikes after outage reports.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**Platform Risk**")
                st.caption("Twitter/X drives 44% of negative mentions; response latency highest.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Topic Drift**")
                st.caption("Coverage and pricing topics dominate share of voice this week.")

        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Rapid Response Pods**")
                st.caption("Deploy surge support for Twitter/X to reduce response time below 1 hr.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Coverage Narrative**")
                st.caption("Launch 5G coverage proof points to counter negative sentiment drivers.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Influencer Amplification**")
                st.caption("Expand positive influencer reach during peak sentiment windows.")

        st.markdown('<div class="section-header">VP Communications Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Positive Sentiment 45%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **35%** positive
                - Gap: **10%** to target
                - Focus: Network narrative
                - Campaign: 5G coverage story
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Response Time < 1hr</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **2.4 hrs** avg
                - Target: **<1 hr** response
                - Action: Social team expansion
                - Tools: AI triage pilot
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">TrustPilot 3.5 Stars</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **2.8** stars
                - Target: **3.5** by Q2
                - Action: Review response
                - Program: Happy customer asks
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What's our social media sentiment this month?", "Which platforms have the most negative mentions?", "What topics are customers talking about most?", "Show me high-reach negative mentions."]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_regulatory_compliance():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>Regulatory & Compliance Dashboard</h1>
        <p>Ofcom Compliance, SLA Management & Service Quality</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "⚖️ Compliance Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['SLA', 'COMPLAINT', 'NETWORK_OPS', 'MOBILE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # REGULATORY COMPLIANCE - COMPLIANCE SHIELD ANIMATION
        st.markdown("""
        <style>
        @keyframes reg-shield { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes reg-check { 0% { transform: scale(0); opacity: 0; } 50% { transform: scale(1.2); } 100% { transform: scale(1); opacity: 1; } }
        @keyframes reg-glow { 0%, 100% { box-shadow: 0 0 10px rgba(16,185,129,0.3); } 50% { box-shadow: 0 0 25px rgba(16,185,129,0.5); } }
        .reg-compliance { background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .reg-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .reg-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .reg-score { background: rgba(16,185,129,0.2); border: 2px solid #10B981; padding: 0.5rem 1rem; border-radius: 12px; animation: reg-glow 2s ease-in-out infinite; }
        .reg-score-val { color: #10B981; font-size: 1.4rem; font-weight: 700; }
        .reg-score-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; }
        .reg-items { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-bottom: 1rem; }
        .reg-item { background: rgba(255,255,255,0.1); border-radius: 10px; padding: 0.8rem; text-align: center; }
        .reg-item-icon { font-size: 1.5rem; margin-bottom: 0.3rem; animation: reg-shield 3s ease-in-out infinite; display: inline-block; }
        .reg-item-name { color: rgba(255,255,255,0.8); font-size: 0.7rem; margin-bottom: 0.2rem; }
        .reg-item-status { display: inline-flex; align-items: center; gap: 0.3rem; font-size: 0.7rem; font-weight: 600; }
        .reg-item-status.pass { color: #10B981; }
        .reg-item-status.warn { color: #F59E0B; }
        .reg-check-icon { animation: reg-check 0.5s ease-out forwards; }
        .reg-stats { display: flex; justify-content: center; gap: 2rem; }
        .reg-stat { text-align: center; }
        .reg-stat-val { color: white; font-size: 1.2rem; font-weight: 700; }
        .reg-stat-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="reg-compliance"><div class="reg-header"><div class="reg-title">⚖️ Regulatory Compliance Status</div><div class="reg-score"><div class="reg-score-val">97.8%</div><div class="reg-score-label">SLA Attainment</div></div></div><div class="reg-items"><div class="reg-item"><div class="reg-item-icon">🛡️</div><div class="reg-item-name">Ofcom SLAs</div><div class="reg-item-status pass"><span class="reg-check-icon">✓</span> Compliant</div></div><div class="reg-item"><div class="reg-item-icon">📋</div><div class="reg-item-name">GDPR</div><div class="reg-item-status pass"><span class="reg-check-icon">✓</span> Compliant</div></div><div class="reg-item"><div class="reg-item-icon">📊</div><div class="reg-item-name">ADR Scheme</div><div class="reg-item-status pass"><span class="reg-check-icon">✓</span> Active</div></div><div class="reg-item"><div class="reg-item-icon">⏱️</div><div class="reg-item-name">Response Time</div><div class="reg-item-status warn">⚠ Monitor</div></div></div><div class="reg-stats"><div class="reg-stat"><div class="reg-stat-val">9.4</div><div class="reg-stat-label">Complaints/1K</div></div><div class="reg-stat"><div class="reg-stat-val">8</div><div class="reg-stat-label">Ombudsman Cases</div></div><div class="reg-stat"><div class="reg-stat-val">99.1%</div><div class="reg-stat-label">Network SLA</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Regulatory Compliance Overview</div>', unsafe_allow_html=True)
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">✅</div>
                <div class="kpi-label">SLA Attainment</div>
                <div class="kpi-value">97.8%</div>
                <div class="kpi-delta positive">Above 95% target</div>
            </div>
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">📋</div>
                <div class="kpi-label">Complaints/1K Subs</div>
                <div class="kpi-value">9.4</div>
                <div class="kpi-delta positive">Below Ofcom avg</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">⚖️</div>
                <div class="kpi-label">Ombudsman Cases</div>
                <div class="kpi-value">8</div>
                <div class="kpi-delta positive">2.8% escalation</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📡</div>
                <div class="kpi-label">Network SLA</div>
                <div class="kpi-value">99.72%</div>
                <div class="kpi-delta positive">Above 99.5%</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">SLA Credits</div>
                <div class="kpi-value">£12.4K</div>
                <div class="kpi-delta negative">MTD liability</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">Avg Complaint Resolution</div>
                <div class="kpi-value">4.2 days</div>
                <div class="kpi-delta positive">Below 8-day target</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">🔒</div>
                <div class="kpi-label">GDPR Requests</div>
                <div class="kpi-value">24</div>
                <div class="kpi-delta positive">All within SLA</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Next Ofcom Report</div>
                <div class="kpi-value">14 days</div>
                <div class="kpi-delta positive">Data ready</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Compliance Trend & Risk</div>', unsafe_allow_html=True)
        trend_col1, trend_col2 = st.columns(2)
        
        with trend_col1:
            st.markdown("**SLA Credits Trend (6 Months)**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                credits_df = pd.DataFrame({
                    'Month': months,
                    'Credits': [18.2, 16.8, 15.4, 14.6, 13.1, 12.4]
                })
                credits_line = alt.Chart(credits_df).mark_line(point=True, color='#EF4444', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Credits:Q', title='£K'),
                    tooltip=['Month:N', alt.Tooltip('Credits:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(credits_line, use_container_width=True)
        
        with trend_col2:
            st.markdown("**Complaints by Region**")
            with st.container(border=True):
                region_df = pd.DataFrame({
                    'Region': ['London', 'North West', 'Midlands', 'South East', 'Scotland', 'Wales'],
                    'Complaints': [128, 92, 74, 88, 56, 42]
                })
                region_bar = alt.Chart(region_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Complaints:Q', title='Complaints'),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Region:N', 'Complaints:Q']
                ).properties(height=170)
                st.altair_chart(region_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Product & Root Cause Signals</div>', unsafe_allow_html=True)
        signal_col1, signal_col2 = st.columns(2)
        
        with signal_col1:
            st.markdown("**SLA Breaches by Product**")
            with st.container(border=True):
                product_df = pd.DataFrame({
                    'Product': ['Mobile', 'Broadband', 'TV', 'IoT'],
                    'Breaches': [22, 14, 8, 5]
                })
                product_bar = alt.Chart(product_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Breaches:Q', title='Breaches'),
                    y=alt.Y('Product:N', sort='-x', title=None),
                    color=alt.value('#EF4444'),
                    tooltip=['Product:N', 'Breaches:Q']
                ).properties(height=170)
                st.altair_chart(product_bar, use_container_width=True)
        
        with signal_col2:
            st.markdown("**Complaint Root Cause Mix**")
            with st.container(border=True):
                root_df = pd.DataFrame({
                    'Cause': ['Billing', 'Coverage', 'Service', 'Outage'],
                    'Share': [38, 26, 21, 15]
                })
                root_arc = alt.Chart(root_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Cause:N', legend=None, scale=alt.Scale(
                        range=['#6366F1', '#F59E0B', '#10B981', '#29B5E8']
                    )),
                    tooltip=['Cause:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(root_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Regulator Readiness</div>', unsafe_allow_html=True)
        ready_col1, ready_col2 = st.columns(2)
        
        with ready_col1:
            st.markdown("**Escalation Timeline (Weekly)**")
            with st.container(border=True):
                weeks = ['W1', 'W2', 'W3', 'W4', 'W5', 'W6']
                esc_week_df = pd.DataFrame({
                    'Week': weeks,
                    'Escalations': [6, 5, 4, 5, 3, 2]
                })
                esc_area = alt.Chart(esc_week_df).mark_area(opacity=0.25, color='#F59E0B').encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Escalations:Q', title='Cases')
                )
                esc_line = alt.Chart(esc_week_df).mark_line(point=True, color='#F59E0B', strokeWidth=2).encode(
                    x=alt.X('Week:N', sort=weeks),
                    y=alt.Y('Escalations:Q'),
                    tooltip=['Week:N', 'Escalations:Q']
                )
                st.altair_chart((esc_area + esc_line).properties(height=170), use_container_width=True)
        
        with ready_col2:
            st.markdown("**Regulatory Submission Readiness**")
            with st.container(border=True):
                report_df = pd.DataFrame({
                    'Report': ['Ofcom SLA', 'GDPR Audit', 'ADR Review', 'Ombudsman'],
                    'Ready': [92, 88, 81, 76]
                })
                report_bar = alt.Chart(report_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Ready:Q', title='Readiness %', scale=alt.Scale(domain=[0, 100])),
                    y=alt.Y('Report:N', sort='-x', title=None),
                    color=alt.value('#10B981'),
                    tooltip=['Report:N', 'Ready:Q']
                ).properties(height=170)
                st.altair_chart(report_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">SLA & Penalty Exposure</div>', unsafe_allow_html=True)
        exposure_col1, exposure_col2 = st.columns(2)
        
        with exposure_col1:
            st.markdown("**SLA Breaches by Region**")
            with st.container(border=True):
                breach_region_df = pd.DataFrame({
                    'Region': ['London', 'North West', 'Midlands', 'South East', 'Scotland', 'Wales'],
                    'Breaches': [12, 9, 7, 6, 4, 3]
                })
                breach_bar = alt.Chart(breach_region_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Breaches:Q', title='Breaches'),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.value('#F97316'),
                    tooltip=['Region:N', 'Breaches:Q']
                ).properties(height=170)
                st.altair_chart(breach_bar, use_container_width=True)
        
        with exposure_col2:
            st.markdown("**Penalty Exposure by Category**")
            with st.container(border=True):
                penalty_df = pd.DataFrame({
                    'Category': ['Network', 'Billing', 'Privacy', 'Service'],
                    'Exposure': [4.6, 3.2, 2.1, 1.4]
                })
                penalty_bar = alt.Chart(penalty_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Exposure:Q', title='£M Exposure'),
                    y=alt.Y('Category:N', sort='-x', title=None),
                    color=alt.value('#EF4444'),
                    tooltip=['Category:N', alt.Tooltip('Exposure:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(penalty_bar, use_container_width=True)
        
    with tab_ops:
        st.markdown("""
        <style>
        @keyframes reg-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 24px rgba(59,130,246,0.4); }
        }
        @keyframes reg-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .reg-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: reg-ops-glow 3s ease-in-out infinite;
        }
        .reg-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: reg-ops-sweep 3s linear infinite;
        }
        .reg-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .reg-ops-title { font-weight: 700; color: #1E3A8A; }
        .reg-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .reg-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .reg-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .reg-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .reg-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .reg-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="reg-ops-pulse">
            <div class="reg-ops-header">
                <div class="reg-ops-title">⚖️ Compliance Ops Pulse</div>
                <div class="reg-ops-tag">LIVE OPS</div>
            </div>
            <div class="reg-ops-grid">
                <div class="reg-ops-card">
                    <div class="reg-ops-label">SLA Attainment</div>
                    <div class="reg-ops-value">97.8%</div>
                    <div class="reg-ops-delta">Above 95%</div>
                </div>
                <div class="reg-ops-card">
                    <div class="reg-ops-label">Complaints/1K</div>
                    <div class="reg-ops-value">9.4</div>
                    <div class="reg-ops-delta">Below Ofcom avg</div>
                </div>
                <div class="reg-ops-card">
                    <div class="reg-ops-label">Ombudsman</div>
                    <div class="reg-ops-value">2.8%</div>
                    <div class="reg-ops-delta">Target <2%</div>
                </div>
                <div class="reg-ops-card">
                    <div class="reg-ops-label">GDPR Ready</div>
                    <div class="reg-ops-value">90%</div>
                    <div class="reg-ops-delta">Audit March</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Operational Readiness</div>', unsafe_allow_html=True)
        ops_col1, ops_col2 = st.columns(2)
        
        with ops_col1:
            st.markdown("**GDPR Request Mix**")
            with st.container(border=True):
                gdpr_df = pd.DataFrame({
                    'Type': ['Access', 'Deletion', 'Portability', 'Correction'],
                    'Requests': [12, 6, 4, 2]
                })
                gdpr_bar = alt.Chart(gdpr_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Requests:Q', title='Requests'),
                    y=alt.Y('Type:N', sort='-x', title=None),
                    color=alt.Color('Type:N', legend=None, scale=alt.Scale(
                        range=['#10B981', '#F59E0B', '#29B5E8', '#8B5CF6']
                    )),
                    tooltip=['Type:N', 'Requests:Q']
                ).properties(height=170)
                st.altair_chart(gdpr_bar, use_container_width=True)
        
        with ops_col2:
            st.markdown("**Ombudsman Escalations Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                esc_df = pd.DataFrame({
                    'Month': months,
                    'Escalations': [3.4, 3.2, 3.0, 2.9, 2.8, 2.8]
                })
                esc_line = alt.Chart(esc_df).mark_line(point=True, color='#F59E0B', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Escalations:Q', title='%'),
                    tooltip=['Month:N', alt.Tooltip('Escalations:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(esc_line, use_container_width=True)

        st.markdown('<div class="section-header">Case Operations Mix</div>', unsafe_allow_html=True)
        case_col1, case_col2 = st.columns(2)
        
        with case_col1:
            st.markdown("**Investigation Backlog by Stage**")
            with st.container(border=True):
                backlog_df = pd.DataFrame({
                    'Stage': ['Intake', 'Review', 'Legal', 'Resolution'],
                    'Cases': [46, 32, 18, 12]
                })
                backlog_bar = alt.Chart(backlog_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Cases:Q', title='Cases'),
                    y=alt.Y('Stage:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Stage:N', 'Cases:Q']
                ).properties(height=170)
                st.altair_chart(backlog_bar, use_container_width=True)
        
        with case_col2:
            st.markdown("**SLA Breach Drivers**")
            with st.container(border=True):
                driver_df = pd.DataFrame({
                    'Driver': ['Network', 'Vendor', 'Process', 'Complexity'],
                    'Incidents': [14, 9, 7, 5]
                })
                driver_bar = alt.Chart(driver_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Incidents:Q', title='Breaches'),
                    y=alt.Y('Driver:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Driver:N', 'Incidents:Q']
                ).properties(height=170)
                st.altair_chart(driver_bar, use_container_width=True)

        st.markdown('<div class="section-header">Regulatory Case Load</div>', unsafe_allow_html=True)
        load_col1, load_col2 = st.columns(2)
        
        with load_col1:
            st.markdown("**Open Cases by Regulator**")
            with st.container(border=True):
                regulator_df = pd.DataFrame({
                    'Regulator': ['Ofcom', 'ICO', 'ADR', 'Local'],
                    'Cases': [18, 9, 6, 4]
                })
                regulator_arc = alt.Chart(regulator_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Cases:Q', title=None),
                    color=alt.Color('Regulator:N', legend=None, scale=alt.Scale(
                        range=['#2563EB', '#10B981', '#F59E0B', '#EC4899']
                    )),
                    tooltip=['Regulator:N', 'Cases:Q']
                ).properties(height=170)
                st.altair_chart(regulator_arc, use_container_width=True)
        
        with load_col2:
            st.markdown("**Resolution Time by Channel**")
            with st.container(border=True):
                channel_df = pd.DataFrame({
                    'Channel': ['Call Center', 'Digital', 'Retail', 'Partner'],
                    'Days': [4.8, 3.6, 5.4, 4.1]
                })
                channel_bar = alt.Chart(channel_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Days:Q', title='Days to Resolve'),
                    y=alt.Y('Channel:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Channel:N', alt.Tooltip('Days:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(channel_bar, use_container_width=True)

        st.markdown('<div class="section-header">Severity & Aging</div>', unsafe_allow_html=True)
        sev_col1, sev_col2 = st.columns(2)
        
        with sev_col1:
            st.markdown("**Escalation Severity Mix**")
            with st.container(border=True):
                severity_df = pd.DataFrame({
                    'Severity': ['Critical', 'High', 'Medium', 'Low'],
                    'Cases': [6, 12, 18, 22]
                })
                severity_arc = alt.Chart(severity_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Cases:Q', title=None),
                    color=alt.Color('Severity:N', legend=None, scale=alt.Scale(
                        range=['#EF4444', '#F59E0B', '#29B5E8', '#10B981']
                    )),
                    tooltip=['Severity:N', 'Cases:Q']
                ).properties(height=170)
                st.altair_chart(severity_arc, use_container_width=True)
        
        with sev_col2:
            st.markdown("**Case Aging Buckets**")
            with st.container(border=True):
                aging_df = pd.DataFrame({
                    'Bucket': ['0-3 days', '4-7 days', '8-14 days', '15+ days'],
                    'Cases': [38, 22, 14, 6]
                })
                aging_bar = alt.Chart(aging_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Cases:Q', title='Cases'),
                    y=alt.Y('Bucket:N', sort='-x', title=None),
                    color=alt.value('#10B981'),
                    tooltip=['Bucket:N', 'Cases:Q']
                ).properties(height=170)
                st.altair_chart(aging_bar, use_container_width=True)

        # Compliance Score Trend and Complaint Resolution Funnel
        compliance_col, funnel_col = st.columns(2)
        
        with compliance_col:
            st.markdown('<div class="section-header">Compliance Score Trend</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                compliance_trend = pd.DataFrame({
                    'Month': months,
                    'Score': [94.2, 95.1, 95.8, 96.4, 97.2, 97.8],
                    'Target': [95.0] * 6
                })
                
                score_line = alt.Chart(compliance_trend).mark_line(color='#10B981', strokeWidth=3).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Score:Q', scale=alt.Scale(domain=[90, 100]), title='Score %')
                )
                
                score_points = alt.Chart(compliance_trend).mark_circle(color='#10B981', size=60).encode(
                    x=alt.X('Month:N', sort=months),
                    y=alt.Y('Score:Q'),
                    tooltip=['Month:N', alt.Tooltip('Score:Q', format='.1f')]
                )
                
                target_rule = alt.Chart(compliance_trend).mark_rule(color='#DC2626', strokeDash=[4, 4]).encode(y='Target:Q')
                
                st.altair_chart((score_line + score_points + target_rule).properties(height=160), use_container_width=True)
        
        with funnel_col:
            st.markdown('<div class="section-header">Complaint Resolution Flow</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Resolved</span><span style="font-weight: 600;">312</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #10B981; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Received</span><span style="font-weight: 600;">284</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 91%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>In Progress</span><span style="font-weight: 600;">142</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #F59E0B; width: 46%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Escalated</span><span style="font-weight: 600;">8</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #EF4444; width: 3%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">SLA Performance Summary</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem;">SLA Type</th>
                            <th style="text-align: right; padding: 0.5rem;">Target</th>
                            <th style="text-align: right; padding: 0.5rem;">Actual</th>
                            <th style="text-align: right; padding: 0.5rem;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">Network Availability</td>
                            <td style="text-align: right; padding: 0.5rem;">99.5%</td>
                            <td style="text-align: right; padding: 0.5rem;">99.72%</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Met</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">Complaint Resolution</td>
                            <td style="text-align: right; padding: 0.5rem;">8 days</td>
                            <td style="text-align: right; padding: 0.5rem;">4.2 days</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Met</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">Fault Response (P1)</td>
                            <td style="text-align: right; padding: 0.5rem;">4 hrs</td>
                            <td style="text-align: right; padding: 0.5rem;">2.8 hrs</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Met</span></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">GDPR Response</td>
                            <td style="text-align: right; padding: 0.5rem;">30 days</td>
                            <td style="text-align: right; padding: 0.5rem;">12 days</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Met</span></td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Complaint Categories</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Billing Disputes</span>
                        <span style="font-weight: 600;">98 (34%)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Service Quality</span>
                        <span style="font-weight: 600;">72 (25%)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Contract Terms</span>
                        <span style="font-weight: 600;">58 (20%)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Other</span>
                        <span style="font-weight: 600;">56 (21%)</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        

    with tab_strategy:
        st.markdown("""
        <style>
        .sf-reg-pulse {
            background: linear-gradient(135deg, #0EA5E9 0%, #2563EB 100%);
            color: white;
            border-radius: 14px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .sf-reg-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            animation: reg-si-sweep 3s linear infinite;
        }
        @keyframes reg-si-sweep {
            0% { transform: translateX(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(250%); opacity: 0; }
        }
        @keyframes reg-si-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(14,165,233,0.35); }
            50% { box-shadow: 0 0 22px rgba(14,165,233,0.6); }
        }
        .sf-reg-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-reg-title { font-weight: 700; font-size: 1rem; }
        .sf-reg-tag { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 999px; background: rgba(255,255,255,0.2); letter-spacing: 0.08em; }
        .sf-reg-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-reg-card { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 0.75rem; animation: reg-si-glow 3s ease-in-out infinite; }
        .sf-reg-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; opacity: 0.8; }
        .sf-reg-value { font-size: 1.25rem; font-weight: 700; }
        </style>
        <div class="sf-reg-pulse">
            <div class="sf-reg-header">
                <div class="sf-reg-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-reg-tag">AI LIVE</div>
            </div>
            <div class="sf-reg-grid">
                <div class="sf-reg-card">
                    <div class="sf-reg-label">SLA</div>
                    <div class="sf-reg-value">97.8%</div>
                </div>
                <div class="sf-reg-card">
                    <div class="sf-reg-label">Complaints</div>
                    <div class="sf-reg-value">9.4/1K</div>
                </div>
                <div class="sf-reg-card">
                    <div class="sf-reg-label">Escalation</div>
                    <div class="sf-reg-value">2.8%</div>
                </div>
                <div class="sf-reg-card">
                    <div class="sf-reg-label">Audit Ready</div>
                    <div class="sf-reg-value">90%</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Snowflake Intelligence** shows compliance trending above target, but ombudsman escalation remains above the 2% goal. Focused early‑resolution workflows and GDPR readiness actions can close the gap before the March audit.")

        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Escalation Risk**")
                st.caption("Ombudsman cases at 2.8% driven by billing dispute delays.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**SLA Stability**")
                st.caption("Network availability holds at 99.72% with no breach risk.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Audit Readiness**")
                st.caption("GDPR readiness at 90%; data retention gaps remain.")

        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Early Resolution Triage**")
                st.caption("Route billing disputes to specialist pods; target escalation <2%.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**SLA Monitoring**")
                st.caption("Automate SLA variance alerts for Ofcom submissions.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**GDPR Controls**")
                st.caption("Complete retention policy updates ahead of March audit.")

        st.markdown('<div class="section-header">Regulatory & Compliance Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Zero Ofcom Breaches</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **2** minor issues
                - Target: **Zero** breaches
                - Focus: Complaint handling
                - Action: Process automation
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Ombudsman < 2%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **2.8%** escalation
                - Target: **<2%** rate
                - Action: Early resolution
                - Training: Frontline teams
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">GDPR Audit Ready</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Audit: March 2026
                - Status: **90%** ready
                - Gap: Data retention
                - Action: Policy updates
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["Show me our regulatory compliance status.", "How are we performing against published SLAs?", "Are we meeting Ofcom complaint handling requirements?", "What data do we need for our Ofcom submission?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_security():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Security & Fraud Prevention Dashboard</h1>
        <p>Fraud Detection, Loss Prevention & Security Analytics</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🛡️ Security Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['FRAUD_DETECTION']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP SECURITY - THREAT RADAR ANIMATION
        st.markdown("""
        <style>
        @keyframes radar-sweep-sec { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes threat-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes shield-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .security-radar { background: linear-gradient(135deg, #1F2937 0%, #111827 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 2rem; }
        .radar-display { width: 140px; height: 140px; position: relative; flex-shrink: 0; }
        .radar-bg-sec { position: absolute; width: 100%; height: 100%; border: 2px solid rgba(16,185,129,0.3); border-radius: 50%; }
        .radar-inner-sec { position: absolute; width: 70%; height: 70%; top: 15%; left: 15%; border: 1px solid rgba(16,185,129,0.2); border-radius: 50%; }
        .radar-center-sec { position: absolute; width: 40%; height: 40%; top: 30%; left: 30%; border: 1px solid rgba(16,185,129,0.15); border-radius: 50%; }
        .radar-line-sec { position: absolute; width: 50%; height: 2px; top: 50%; left: 50%; background: linear-gradient(90deg, rgba(16,185,129,0.8), transparent); transform-origin: left center; animation: radar-sweep-sec 4s linear infinite; }
        .threat-dot { position: absolute; width: 8px; height: 8px; border-radius: 50%; animation: threat-blink 1s ease-in-out infinite; }
        .threat-dot.critical { background: #EF4444; }
        .threat-dot.warning { background: #F59E0B; }
        .threat-dot.safe { background: #10B981; }
        .shield-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2rem; animation: shield-pulse 2s ease-in-out infinite; }
        .security-stats { flex: 1; }
        .sec-title { color: white; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; }
        .sec-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
        .sec-item { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 0.8rem; border-left: 3px solid; }
        .sec-item.blocked { border-color: #10B981; }
        .sec-item.detected { border-color: #F59E0B; }
        .sec-item.prevented { border-color: #3B82F6; }
        .sec-item.saved { border-color: #8B5CF6; }
        .sec-val { color: white; font-size: 1.3rem; font-weight: 700; }
        .sec-label { color: rgba(255,255,255,0.6); font-size: 0.7rem; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="security-radar"><div class="radar-display"><div class="radar-bg-sec"></div><div class="radar-inner-sec"></div><div class="radar-center-sec"></div><div class="radar-line-sec"></div><div class="threat-dot critical" style="top:20%;left:65%"></div><div class="threat-dot warning" style="top:60%;left:25%;animation-delay:0.3s"></div><div class="threat-dot safe" style="top:75%;left:70%;animation-delay:0.6s"></div><div class="threat-dot warning" style="top:35%;left:30%;animation-delay:0.9s"></div><div class="shield-icon">🛡️</div></div><div class="security-stats"><div class="sec-title">🔒 Threat Detection Live</div><div class="sec-grid"><div class="sec-item blocked"><div class="sec-val">2,847</div><div class="sec-label">Threats Blocked Today</div></div><div class="sec-item detected"><div class="sec-val">23</div><div class="sec-label">Active Investigations</div></div><div class="sec-item prevented"><div class="sec-val">£1.2M</div><div class="sec-label">Fraud Prevented MTD</div></div><div class="sec-item saved"><div class="sec-val">99.7%</div><div class="sec-label">Detection Rate</div></div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Fraud Prevention Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">🛡️</div>
                <div class="kpi-label">Losses Prevented</div>
                <div class="kpi-value">£2.4M</div>
                <div class="kpi-delta positive">YTD savings</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">🚨</div>
                <div class="kpi-label">Active Cases</div>
                <div class="kpi-value">142</div>
                <div class="kpi-delta negative">18 critical</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">🔍</div>
                <div class="kpi-label">Detected MTD</div>
                <div class="kpi-value">847</div>
                <div class="kpi-delta positive">↑ +12% detection</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">🤖</div>
                <div class="kpi-label">ML Accuracy</div>
                <div class="kpi-value">94.2%</div>
                <div class="kpi-delta positive">↑ +2% MoM</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">Avg Resolution</div>
                <div class="kpi-value">4.2 hrs</div>
                <div class="kpi-delta positive">↓ -1.8 hrs</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">False Positive Rate</div>
                <div class="kpi-value">3.8%</div>
                <div class="kpi-delta positive">↓ -0.6%</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">SIM Swap Blocked</div>
                <div class="kpi-value">284</div>
                <div class="kpi-delta positive">This month</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">👤</div>
                <div class="kpi-label">Account Takeover</div>
                <div class="kpi-value">42</div>
                <div class="kpi-delta positive">Prevented</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Real-time fraud detection using Cortex Anomaly Detection and ML Classification with 94% accuracy on transaction data")
        
        # New: Fraud Trend and ML Model Performance
        fraud_trend_col, ml_col = st.columns(2)
        
        with fraud_trend_col:
            st.markdown('<div class="section-header">Fraud Cases Trend (6 Months)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                fraud_trend = pd.DataFrame({
                    'Month': months * 3,
                    'Type': ['Identity']*6 + ['SIM Swap']*6 + ['Other']*6,
                    'Cases': [280, 290, 295, 300, 308, 312,
                             240, 252, 260, 268, 276, 284,
                             180, 190, 200, 220, 240, 251]
                })
                
                fraud_area = alt.Chart(fraud_trend).mark_area().encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Cases:Q', stack='zero', title='Cases'),
                    color=alt.Color('Type:N', scale=alt.Scale(
                        domain=['Identity', 'SIM Swap', 'Other'],
                        range=['#EF4444', '#F59E0B', '#6B7280']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Month:N', 'Type:N', 'Cases:Q']
                ).properties(height=160)
                
                st.altair_chart(fraud_area, use_container_width=True)
        
        with ml_col:
            st.markdown('<div class="section-header">ML Model Accuracy</div>', unsafe_allow_html=True)
            with st.container(border=True):
                ml_data = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Accuracy': [91.2, 92.0, 92.8, 93.4, 93.8, 94.2],
                    'Precision': [89.5, 90.2, 91.0, 91.8, 92.4, 93.0]
                })
                
                accuracy_line = alt.Chart(ml_data).mark_line(color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Month:N', title=None),
                    y=alt.Y('Accuracy:Q', scale=alt.Scale(domain=[85, 100]), title='%'),
                    tooltip=['Month:N', alt.Tooltip('Accuracy:Q', format='.1f')]
                )
                
                precision_line = alt.Chart(ml_data).mark_line(color='#8B5CF6', strokeWidth=2, strokeDash=[4, 4]).encode(
                    x=alt.X('Month:N'),
                    y=alt.Y('Precision:Q'),
                    tooltip=['Month:N', alt.Tooltip('Precision:Q', format='.1f')]
                )
                
                st.altair_chart((accuracy_line + precision_line).properties(height=160), use_container_width=True)
                st.markdown('<div style="text-align: center; font-size: 0.75rem;"><span style="color: #10B981;">—</span> Accuracy <span style="color: #8B5CF6;">- -</span> Precision</div>', unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Channel & Segment Risk</div>', unsafe_allow_html=True)
        channel_col1, channel_col2 = st.columns(2)
        
        with channel_col1:
            st.markdown("**Fraud Losses by Channel**")
            with st.container(border=True):
                channel_df = pd.DataFrame({
                    'Channel': ['Digital', 'Retail', 'Call Center', 'Partner'],
                    'Losses': [1.1, 0.7, 0.4, 0.2]
                })
                channel_bar = alt.Chart(channel_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Losses:Q', title='£M'),
                    y=alt.Y('Channel:N', sort='-x', title=None),
                    color=alt.value('#EF4444'),
                    tooltip=['Channel:N', alt.Tooltip('Losses:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(channel_bar, use_container_width=True)
        
        with channel_col2:
            st.markdown("**High-Risk Segment Mix**")
            with st.container(border=True):
                segment_df = pd.DataFrame({
                    'Segment': ['Prepaid', 'SME', 'Consumer', 'Enterprise'],
                    'Share': [32, 26, 24, 18]
                })
                segment_arc = alt.Chart(segment_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Segment:N', legend=None, scale=alt.Scale(
                        range=['#F59E0B', '#6366F1', '#10B981', '#29B5E8']
                    )),
                    tooltip=['Segment:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(segment_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Threat Velocity</div>', unsafe_allow_html=True)
        velocity_col1, velocity_col2 = st.columns(2)
        
        with velocity_col1:
            st.markdown("**Suspicious Login Attempts (Weekly)**")
            with st.container(border=True):
                weeks = ['W1', 'W2', 'W3', 'W4', 'W5', 'W6']
                login_df = pd.DataFrame({
                    'Week': weeks,
                    'Attempts': [860, 910, 980, 940, 1020, 1085]
                })
                login_line = alt.Chart(login_df).mark_line(point=True, color='#29B5E8', strokeWidth=2).encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Attempts:Q', title='Attempts'),
                    tooltip=['Week:N', 'Attempts:Q']
                ).properties(height=170)
                st.altair_chart(login_line, use_container_width=True)
        
        with velocity_col2:
            st.markdown("**SIM Swap Attempts by Region**")
            with st.container(border=True):
                sim_df = pd.DataFrame({
                    'Region': ['London', 'North West', 'Midlands', 'South East', 'Scotland', 'Wales'],
                    'Attempts': [82, 64, 48, 52, 34, 21]
                })
                sim_bar = alt.Chart(sim_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Attempts:Q', title='Attempts'),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Region:N', 'Attempts:Q']
                ).properties(height=170)
                st.altair_chart(sim_bar, use_container_width=True)

    with tab_ops:
        st.markdown("""
        <style>
        @keyframes sec-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(37,99,235,0.2); }
            50% { box-shadow: 0 0 24px rgba(37,99,235,0.45); }
        }
        @keyframes sec-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .sec-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: sec-ops-glow 3s ease-in-out infinite;
        }
        .sec-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: sec-ops-sweep 3s linear infinite;
        }
        .sec-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .sec-ops-title { font-weight: 700; color: #1E3A8A; }
        .sec-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .sec-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .sec-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .sec-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .sec-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .sec-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="sec-ops-pulse">
            <div class="sec-ops-header">
                <div class="sec-ops-title">🛡️ Security Ops Pulse</div>
                <div class="sec-ops-tag">LIVE OPS</div>
            </div>
            <div class="sec-ops-grid">
                <div class="sec-ops-card">
                    <div class="sec-ops-label">Active Alerts</div>
                    <div class="sec-ops-value">186</div>
                    <div class="sec-ops-delta">28 critical</div>
                </div>
                <div class="sec-ops-card">
                    <div class="sec-ops-label">High Risk Cases</div>
                    <div class="sec-ops-value">42</div>
                    <div class="sec-ops-delta">Triage queue</div>
                </div>
                <div class="sec-ops-card">
                    <div class="sec-ops-label">Avg Triage</div>
                    <div class="sec-ops-value">18m</div>
                    <div class="sec-ops-delta">↓ 6m WoW</div>
                </div>
                <div class="sec-ops-card">
                    <div class="sec-ops-label">Fraud Losses</div>
                    <div class="sec-ops-value">£0.6M</div>
                    <div class="sec-ops-delta">MTD exposure</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Investigation Workbench</div>', unsafe_allow_html=True)
        work_col1, work_col2 = st.columns(2)
        
        with work_col1:
            st.markdown("**Case Volume by Queue**")
            with st.container(border=True):
                queue_df = pd.DataFrame({
                    'Queue': ['Identity', 'SIM Swap', 'Payments', 'Account'],
                    'Cases': [38, 29, 22, 17]
                })
                queue_bar = alt.Chart(queue_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Cases:Q', title='Cases'),
                    y=alt.Y('Queue:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Queue:N', 'Cases:Q']
                ).properties(height=170)
                st.altair_chart(queue_bar, use_container_width=True)
        
        with work_col2:
            st.markdown("**Alert Source Mix**")
            with st.container(border=True):
                source_df = pd.DataFrame({
                    'Source': ['ML Model', 'Rules', 'Customer', 'Partner'],
                    'Share': [54, 26, 12, 8]
                })
                source_arc = alt.Chart(source_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Source:N', legend=None, scale=alt.Scale(
                        range=['#10B981', '#29B5E8', '#F59E0B', '#EC4899']
                    )),
                    tooltip=['Source:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(source_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Containment Metrics</div>', unsafe_allow_html=True)
        cont_col1, cont_col2 = st.columns(2)
        
        with cont_col1:
            st.markdown("**Containment Rate Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                contain_df = pd.DataFrame({
                    'Month': months,
                    'Rate': [92.1, 92.8, 93.4, 94.0, 94.4, 94.9]
                })
                contain_line = alt.Chart(contain_df).mark_line(point=True, color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Rate:Q', title='%'),
                    tooltip=['Month:N', alt.Tooltip('Rate:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(contain_line, use_container_width=True)
        
        with cont_col2:
            st.markdown("**False Positives by Model**")
            with st.container(border=True):
                fp_df = pd.DataFrame({
                    'Model': ['Identity', 'SIM Swap', 'Payments', 'Device'],
                    'Rate': [4.2, 3.6, 3.1, 2.4]
                })
                fp_bar = alt.Chart(fp_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Rate:Q', title='%'),
                    y=alt.Y('Model:N', sort='-x', title=None),
                    color=alt.value('#EF4444'),
                    tooltip=['Model:N', alt.Tooltip('Rate:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(fp_bar, use_container_width=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Fraud by Category</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Identity Fraud</span><span style="font-weight: 600;">312 cases (£420K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #EF4444; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>SIM Swap</span><span style="font-weight: 600;">284 cases (£380K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #F59E0B; width: 91%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Traffic Fraud</span><span style="font-weight: 600;">142 cases (£280K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #3B82F6; width: 46%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Device Fraud</span><span style="font-weight: 600;">89 cases (£120K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #8B5CF6; width: 29%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Internal</span><span style="font-weight: 600;">20 cases (£45K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #6B7280; width: 6%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Detection Methods</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>ML Models</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">62% (526)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Rule Engine</span>
                        <span style="background: #E0F2FE; color: #0369A1; padding: 0.2rem 0.5rem; border-radius: 12px;">28% (237)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Manual Review</span>
                        <span style="background: #F3F4F6; color: #4B5563; padding: 0.2rem 0.5rem; border-radius: 12px;">10% (84)</span>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #D1FAE5; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #065F46;">ML models 3x more effective than rules</span>
                </div>
                """, unsafe_allow_html=True)

    with tab_strategy:
        st.markdown("""
        <style>
        @keyframes sf-sec-glow { 0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.25); } 50% { box-shadow: 0 0 26px rgba(59,130,246,0.45); } }
        @keyframes sf-sec-sweep { 0% { transform: translateX(-100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        .sf-sec-pulse { position: relative; overflow: hidden; border-radius: 14px; padding: 1.25rem; margin-bottom: 1.5rem; background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%); border: 1px solid #93C5FD; animation: sf-sec-glow 3s ease-in-out infinite; }
        .sf-sec-pulse::after { content: ''; position: absolute; top: 0; left: 0; width: 40%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); animation: sf-sec-sweep 3s linear infinite; }
        .sf-sec-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-sec-title { font-weight: 700; color: #1E3A8A; }
        .sf-sec-tag { background: rgba(59,130,246,0.2); color: #1E3A8A; padding: 0.25rem 0.6rem; border-radius: 999px; font-size: 0.7rem; font-weight: 700; letter-spacing: 0.04em; }
        .sf-sec-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-sec-card { background: rgba(255,255,255,0.85); border-radius: 10px; padding: 0.75rem 0.85rem; border: 1px solid rgba(59,130,246,0.2); }
        .sf-sec-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .sf-sec-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .sf-sec-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="sf-sec-pulse">
            <div class="sf-sec-header">
                <div class="sf-sec-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-sec-tag">AI INSIGHTS</div>
            </div>
            <div class="sf-sec-grid">
                <div class="sf-sec-card">
                    <div class="sf-sec-label">Fraud Risk</div>
                    <div class="sf-sec-value">High</div>
                    <div class="sf-sec-delta">SIM swap spike</div>
                </div>
                <div class="sf-sec-card">
                    <div class="sf-sec-label">Containment</div>
                    <div class="sf-sec-value">94.9%</div>
                    <div class="sf-sec-delta">↑ +1.2% MoM</div>
                </div>
                <div class="sf-sec-card">
                    <div class="sf-sec-label">Exposure</div>
                    <div class="sf-sec-value">£0.6M</div>
                    <div class="sf-sec-delta">MTD at risk</div>
                </div>
                <div class="sf-sec-card">
                    <div class="sf-sec-label">Model Lift</div>
                    <div class="sf-sec-value">3.1x</div>
                    <div class="sf-sec-delta">vs rules</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        st.info("Fraud attempts increased 9% WoW, driven by SIM swap and identity theft spikes in urban regions. ML models are sustaining 94%+ accuracy with reduced false positives, while containment improved to 94.9%. Focus on high-risk prepaid segments and partner-channel anomalies to reduce exposure below £0.5M this month.")
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**SIM Swap Clusters**")
                st.caption("Three SIM swap clusters account for 41% of current high-risk alerts in London and North West.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**Channel Leakage**")
                st.caption("Digital and partner channels show elevated loss ratios; authentication friction below baseline.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Model Drift Watch**")
                st.caption("Identity model drift detected in SME segment; retraining recommended within 2 weeks.")
        
        st.markdown('<div class="section-header">AI‑Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Tighten SIM Swap Controls**")
                st.caption("Add biometric step-up for high-risk prepaid and escalate to manual review.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Partner Channel Guardrails**")
                st.caption("Deploy anomaly detection on partner activations and block repeat device IDs.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Model Refresh Cadence**")
                st.caption("Accelerate retraining cadence to bi-weekly for identity and device fraud models.")
        
        st.markdown('<div class="section-header">Strategic Priorities</div>', unsafe_allow_html=True)
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">ML Accuracy 96%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **94.2%** accuracy
                - Gap: **1.8%** to target
                - Action: Model retraining
                - Data: Q4 fraud patterns
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">SIM Swap Zero Fraud</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Blocked: **284** this month
                - Target: **100%** prevention
                - Action: Biometric verification
                - Launch: February 2026
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">£3M Loss Prevention</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - YTD: **£2.4M** prevented
                - Target: **£3M** by Q2
                - Focus: Identity fraud
                - ROI: **8x** on investment
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What is our fraud detection volume by category?", "How effective are our detection methods?", "Show me critical and high severity fraud cases.", "What's our fraud resolution rate?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_enterprise_sales():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Enterprise Sales Dashboard</h1>
        <p>B2B Contract Renewals, Enterprise Revenue & Competitive Analysis</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "💼 Sales Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['B2B_CONTRACT']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP ENTERPRISE SALES - PIPELINE ANIMATION
        st.markdown("""
        <style>
        @keyframes deal-move { 0% { transform: translateX(0); } 50% { transform: translateX(5px); } 100% { transform: translateX(0); } }
        @keyframes glow-gold { 0%, 100% { box-shadow: 0 0 5px rgba(245, 158, 11, 0.3); } 50% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.6); } }
        @keyframes sales-stage-enter { 0% { opacity: 0; transform: translateY(20px) scale(0.9); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes sales-val-pop { 0% { opacity: 0; transform: scale(0); } 50% { transform: scale(1.2); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes sales-confetti { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); box-shadow: 0 0 30px rgba(16,185,129,0.8); } }
        .sales-pipeline { background: linear-gradient(135deg, #1E3A5F 0%, #2D4A6F 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .sales-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .sales-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .sales-target { color: #10B981; font-size: 0.85rem; font-weight: 600; }
        .pipeline-funnel { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
        .funnel-stage { flex: 1; text-align: center; padding: 0.8rem 0.5rem; border-radius: 8px; position: relative; animation: sales-stage-enter 0.5s ease-out forwards; opacity: 0; }
        .funnel-stage:nth-child(3) { animation-delay: 0.1s; }
        .funnel-stage:nth-child(5) { animation-delay: 0.2s; }
        .funnel-stage:nth-child(7) { animation-delay: 0.3s; }
        .funnel-stage:nth-child(9) { animation-delay: 0.4s; }
        .funnel-stage.prospect { background: rgba(59, 130, 246, 0.3); border: 1px solid rgba(59, 130, 246, 0.5); }
        .funnel-stage.qualified { background: rgba(139, 92, 246, 0.3); border: 1px solid rgba(139, 92, 246, 0.5); }
        .funnel-stage.proposal { background: rgba(245, 158, 11, 0.3); border: 1px solid rgba(245, 158, 11, 0.5); }
        .funnel-stage.negotiation { background: rgba(249, 115, 22, 0.3); border: 1px solid rgba(249, 115, 22, 0.5); }
        .funnel-stage.closed { background: rgba(16, 185, 129, 0.3); border: 1px solid rgba(16, 185, 129, 0.5); animation: sales-stage-enter 0.5s ease-out 0.4s forwards, sales-confetti 2s ease-in-out 1s infinite; opacity: 0; }
        .stage-val { color: white; font-size: 1.2rem; font-weight: 700; animation: sales-val-pop 0.5s ease-out 0.5s forwards; opacity: 0; }
        .stage-name { color: rgba(255,255,255,0.7); font-size: 0.65rem; text-transform: uppercase; }
        .stage-amount { color: rgba(255,255,255,0.5); font-size: 0.7rem; }
        .funnel-arrow { color: rgba(255,255,255,0.3); animation: deal-move 1s ease-in-out infinite; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="sales-pipeline"><div class="sales-header"><div class="sales-title">📊 Enterprise Pipeline</div><div class="sales-target">£24.5M Pipeline • 78% to Target</div></div><div class="pipeline-funnel"><div class="funnel-stage prospect"><div class="stage-val">47</div><div class="stage-name">Prospects</div><div class="stage-amount">£8.2M</div></div><span class="funnel-arrow">→</span><div class="funnel-stage qualified"><div class="stage-val">28</div><div class="stage-name">Qualified</div><div class="stage-amount">£6.4M</div></div><span class="funnel-arrow">→</span><div class="funnel-stage proposal"><div class="stage-val">15</div><div class="stage-name">Proposal</div><div class="stage-amount">£5.1M</div></div><span class="funnel-arrow">→</span><div class="funnel-stage negotiation"><div class="stage-val">8</div><div class="stage-name">Negotiation</div><div class="stage-amount">£3.2M</div></div><span class="funnel-arrow">→</span><div class="funnel-stage closed"><div class="stage-val">12</div><div class="stage-name">Closed Won</div><div class="stage-amount">£1.6M</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        
        <div class="section-header">Enterprise Portfolio Overview</div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">📋</div>
                <div class="kpi-label">Total ACV</div>
                <div class="kpi-value">£52.4M</div>
                <div class="kpi-delta positive">↑ +12% YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">Renewal Rate</div>
                <div class="kpi-value">87%</div>
                <div class="kpi-delta positive">↑ +4% vs target</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📅</div>
                <div class="kpi-label">Renewals (90d)</div>
                <div class="kpi-value">£8.4M</div>
                <div class="kpi-delta positive">42 contracts</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">At-Risk Revenue</div>
                <div class="kpi-value">£3.2M</div>
                <div class="kpi-delta negative">18 contracts</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">Expansion Pipeline</div>
                <div class="kpi-value">£2.8M</div>
                <div class="kpi-delta positive">Upsell opportunities</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🏆</div>
                <div class="kpi-label">Win Rate</div>
                <div class="kpi-value">34%</div>
                <div class="kpi-delta positive">↑ +6% vs BT</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">Active Accounts</div>
                <div class="kpi-value">524</div>
                <div class="kpi-delta positive">↑ +28 YTD</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Avg Contract Value</div>
                <div class="kpi-value">£100K</div>
                <div class="kpi-delta positive">↑ +8% YoY</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake** — B2B contract analytics with Cortex ML for renewal prediction and churn risk scoring on enterprise accounts")
        
        st.markdown('<div class="section-header">Enterprise Growth Signals</div>', unsafe_allow_html=True)
        growth_col1, growth_col2 = st.columns(2)
        
        with growth_col1:
            st.markdown("**ACV Trend (6 Quarters)**")
            with st.container(border=True):
                quarters = ['Q1', 'Q2', 'Q3', 'Q4', 'Q1', 'Q2']
                acv_df = pd.DataFrame({
                    'Quarter': quarters,
                    'ACV': [46.2, 47.8, 49.1, 50.6, 51.8, 52.4]
                })
                acv_line = alt.Chart(acv_df).mark_line(point=True, color='#29B5E8', strokeWidth=2).encode(
                    x=alt.X('Quarter:N', sort=quarters, title=None),
                    y=alt.Y('ACV:Q', title='£M'),
                    tooltip=['Quarter:N', alt.Tooltip('ACV:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(acv_line, use_container_width=True)
        
        with growth_col2:
            st.markdown("**Win Rate by Segment**")
            with st.container(border=True):
                segment_df = pd.DataFrame({
                    'Segment': ['Enterprise', 'Mid-Market', 'SMB', 'Public'],
                    'WinRate': [38, 34, 29, 41]
                })
                win_bar = alt.Chart(segment_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('WinRate:Q', title='%'),
                    y=alt.Y('Segment:N', sort='-x', title=None),
                    color=alt.value('#10B981'),
                    tooltip=['Segment:N', alt.Tooltip('WinRate:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(win_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Pipeline Mix</div>', unsafe_allow_html=True)
        mix_col1, mix_col2 = st.columns(2)
        
        with mix_col1:
            st.markdown("**Pipeline by Region**")
            with st.container(border=True):
                region_df = pd.DataFrame({
                    'Region': ['London', 'North', 'Midlands', 'South', 'Scotland'],
                    'Pipeline': [8.2, 5.6, 4.4, 3.8, 2.5]
                })
                region_bar = alt.Chart(region_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Pipeline:Q', title='£M'),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Region:N', alt.Tooltip('Pipeline:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(region_bar, use_container_width=True)
        
        with mix_col2:
            st.markdown("**Deal Size Distribution**")
            with st.container(border=True):
                size_df = pd.DataFrame({
                    'Band': ['<£50K', '£50-100K', '£100-250K', '£250K+'],
                    'Deals': [18, 24, 16, 7]
                })
                size_bar = alt.Chart(size_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Deals:Q', title='Deals'),
                    y=alt.Y('Band:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Band:N', 'Deals:Q']
                ).properties(height=170)
                st.altair_chart(size_bar, use_container_width=True)

        st.markdown('<div class="section-header">Revenue & Margin Signals</div>', unsafe_allow_html=True)
        rev_col1, rev_col2 = st.columns(2)
        
        with rev_col1:
            st.markdown("**Gross Margin by Product**")
            with st.container(border=True):
                margin_df = pd.DataFrame({
                    'Product': ['UCaaS', 'SIP Trunks', 'SD-WAN', 'Mobile Fleet', 'Security'],
                    'Margin': [46, 38, 41, 32, 52]
                })
                margin_bar = alt.Chart(margin_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Margin:Q', title='Margin %'),
                    y=alt.Y('Product:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Product:N', alt.Tooltip('Margin:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(margin_bar, use_container_width=True)
        
        with rev_col2:
            st.markdown("**ACV vs Revenue Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                rev_df = pd.DataFrame({
                    'Month': months * 2,
                    'Metric': ['ACV'] * 6 + ['Revenue'] * 6,
                    'Value': [46.2, 47.1, 48.0, 49.2, 50.6, 52.4,
                              3.8, 3.9, 4.1, 4.3, 4.5, 4.7]
                })
                rev_line = alt.Chart(rev_df).mark_line(point=True).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Value:Q', title='£M'),
                    color=alt.Color('Metric:N', scale=alt.Scale(
                        domain=['ACV', 'Revenue'], range=['#6366F1', '#10B981']
                    )),
                    tooltip=['Month:N', 'Metric:N', alt.Tooltip('Value:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(rev_line, use_container_width=True)

    with tab_ops:
        st.markdown("""
        <style>
        @keyframes ent-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 24px rgba(59,130,246,0.4); }
        }
        @keyframes ent-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .ent-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: ent-ops-glow 3s ease-in-out infinite;
        }
        .ent-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: ent-ops-sweep 3s linear infinite;
        }
        .ent-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .ent-ops-title { font-weight: 700; color: #1E3A8A; }
        .ent-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .ent-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .ent-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .ent-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .ent-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .ent-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="ent-ops-pulse">
            <div class="ent-ops-header">
                <div class="ent-ops-title">💼 Sales Ops Pulse</div>
                <div class="ent-ops-tag">LIVE OPS</div>
            </div>
            <div class="ent-ops-grid">
                <div class="ent-ops-card">
                    <div class="ent-ops-label">Renewals Due</div>
                    <div class="ent-ops-value">42</div>
                    <div class="ent-ops-delta">£8.4M ACV</div>
                </div>
                <div class="ent-ops-card">
                    <div class="ent-ops-label">At-Risk ACV</div>
                    <div class="ent-ops-value">£3.2M</div>
                    <div class="ent-ops-delta">18 contracts</div>
                </div>
                <div class="ent-ops-card">
                    <div class="ent-ops-label">Avg Cycle</div>
                    <div class="ent-ops-value">64d</div>
                    <div class="ent-ops-delta">↓ 6d QoQ</div>
                </div>
                <div class="ent-ops-card">
                    <div class="ent-ops-label">Forecast Attain</div>
                    <div class="ent-ops-value">78%</div>
                    <div class="ent-ops-delta">Target 85%</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Renewal Operations</div>', unsafe_allow_html=True)
        renew_col1, renew_col2 = st.columns(2)
        
        with renew_col1:
            st.markdown("**Renewal Risk by Stage**")
            with st.container(border=True):
                risk_df = pd.DataFrame({
                    'Stage': ['Discovery', 'Proposal', 'Negotiation', 'Legal'],
                    'AtRisk': [6, 8, 5, 4]
                })
                risk_bar = alt.Chart(risk_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('AtRisk:Q', title='At-Risk Accounts'),
                    y=alt.Y('Stage:N', sort='-x', title=None),
                    color=alt.value('#EF4444'),
                    tooltip=['Stage:N', 'AtRisk:Q']
                ).properties(height=170)
                st.altair_chart(risk_bar, use_container_width=True)
        
        with renew_col2:
            st.markdown("**Sales Cycle Time by Stage**")
            with st.container(border=True):
                cycle_df = pd.DataFrame({
                    'Stage': ['Lead', 'Qualified', 'Proposal', 'Negotiation', 'Closed'],
                    'Days': [8, 12, 16, 18, 10]
                })
                cycle_line = alt.Chart(cycle_df).mark_line(point=True, color='#29B5E8', strokeWidth=2).encode(
                    x=alt.X('Stage:N', title=None),
                    y=alt.Y('Days:Q', title='Days'),
                    tooltip=['Stage:N', 'Days:Q']
                ).properties(height=170)
                st.altair_chart(cycle_line, use_container_width=True)

        st.markdown('<div class="section-header">Forecast & Slippage</div>', unsafe_allow_html=True)
        forecast_col1, forecast_col2 = st.columns(2)
        
        with forecast_col1:
            st.markdown("**Forecast Attainment (Quarterly)**")
            with st.container(border=True):
                quarters = ['Q1', 'Q2', 'Q3', 'Q4']
                forecast_df = pd.DataFrame({
                    'Quarter': quarters,
                    'Attainment': [76, 78, 82, 80]
                })
                forecast_bar = alt.Chart(forecast_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Attainment:Q', title='%'),
                    y=alt.Y('Quarter:N', sort='-x', title=None),
                    color=alt.value('#10B981'),
                    tooltip=['Quarter:N', alt.Tooltip('Attainment:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(forecast_bar, use_container_width=True)
        
        with forecast_col2:
            st.markdown("**Pipeline Slippage (Days)**")
            with st.container(border=True):
                slip_df = pd.DataFrame({
                    'Stage': ['Qualified', 'Proposal', 'Negotiation'],
                    'Slippage': [2, 4, 6]
                })
                slip_bar = alt.Chart(slip_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Slippage:Q', title='Days'),
                    y=alt.Y('Stage:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Stage:N', 'Slippage:Q']
                ).properties(height=170)
                st.altair_chart(slip_bar, use_container_width=True)

        st.markdown('<div class="section-header">Team Performance</div>', unsafe_allow_html=True)
        team_col1, team_col2 = st.columns(2)
        
        with team_col1:
            st.markdown("**Quota Attainment by Team**")
            with st.container(border=True):
                team_df = pd.DataFrame({
                    'Team': ['North', 'South', 'London', 'Midlands'],
                    'Attainment': [82, 76, 88, 71]
                })
                team_bar = alt.Chart(team_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Attainment:Q', title='%'),
                    y=alt.Y('Team:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Team:N', alt.Tooltip('Attainment:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(team_bar, use_container_width=True)
        
        with team_col2:
            st.markdown("**Average Deal Velocity (Days)**")
            with st.container(border=True):
                velocity_df = pd.DataFrame({
                    'Rep': ['Team A', 'Team B', 'Team C', 'Team D'],
                    'Days': [52, 58, 61, 67]
                })
                velocity_bar = alt.Chart(velocity_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Days:Q', title='Days'),
                    y=alt.Y('Rep:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Rep:N', 'Days:Q']
                ).properties(height=170)
                st.altair_chart(velocity_bar, use_container_width=True)
        
        # Sales Pipeline and Renewal Calendar
        pipeline_col, renewal_col = st.columns(2)
        
        with pipeline_col:
            st.markdown('<div class="section-header">Sales Pipeline</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>Lead</span><span style="font-weight: 600;">£4.2M (42)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 20px; overflow: hidden;">
                            <div style="background: #6366F1; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>Qualified</span><span style="font-weight: 600;">£2.8M (28)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 20px; overflow: hidden;">
                            <div style="background: #8B5CF6; width: 67%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>Proposal</span><span style="font-weight: 600;">£1.8M (18)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 20px; overflow: hidden;">
                            <div style="background: #29B5E8; width: 43%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>Negotiation</span><span style="font-weight: 600;">£1.2M (12)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 20px; overflow: hidden;">
                            <div style="background: #F59E0B; width: 29%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>Won</span><span style="font-weight: 600;">£0.8M (8)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 20px; overflow: hidden;">
                            <div style="background: #10B981; width: 19%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with renewal_col:
            st.markdown('<div class="section-header">Renewal Timeline (90 Days)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 140px; padding: 0 1rem;">
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #EF4444; width: 60px; height: 100px; margin: 0 auto; border-radius: 6px 6px 0 0;"></div>
                        <div style="font-size: 0.75rem; margin-top: 0.5rem; color: #6B7280;">0-30 Days</div>
                        <div style="font-weight: 600; font-size: 0.85rem;">£3.2M</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">14 contracts</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #F59E0B; width: 60px; height: 87px; margin: 0 auto; border-radius: 6px 6px 0 0;"></div>
                        <div style="font-size: 0.75rem; margin-top: 0.5rem; color: #6B7280;">31-60 Days</div>
                        <div style="font-weight: 600; font-size: 0.85rem;">£2.8M</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">16 contracts</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #10B981; width: 60px; height: 75px; margin: 0 auto; border-radius: 6px 6px 0 0;"></div>
                        <div style="font-size: 0.75rem; margin-top: 0.5rem; color: #6B7280;">61-90 Days</div>
                        <div style="font-weight: 600; font-size: 0.85rem;">£2.4M</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">12 contracts</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Revenue by Product Type</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>UCaaS</span><span style="font-weight: 600;">£18.2M (142)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>SIP Trunks</span><span style="font-weight: 600;">£12.4M (186)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 68%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>SD-WAN</span><span style="font-weight: 600;">£8.6M (68)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 47%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Mobile Fleet</span><span style="font-weight: 600;">£7.8M (98)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 43%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Managed Security</span><span style="font-weight: 600;">£5.4M (30)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 30%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Competitive Threats</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>BT Business</span>
                        <span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">8 at risk</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Vodafone</span>
                        <span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">5 at risk</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Virgin Media O2</span>
                        <span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">3 at risk</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Other</span>
                        <span style="background: #E0F2FE; color: #0369A1; padding: 0.2rem 0.5rem; border-radius: 12px;">2 at risk</span>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #FEE2E2; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #DC2626;">⚠️ £3.2M revenue at competitive risk</span>
                </div>
                """, unsafe_allow_html=True)
        
        # B2B Account Health Section
        st.markdown('<div class="section-header">B2B Account Health & Intelligence</div>', unsafe_allow_html=True)
        
        health_col, industry_col = st.columns(2)
        
        with health_col:
            st.markdown("**Top 10 Accounts Health Scorecard**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.8rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span style="flex: 2;">Barclays PLC</span>
                        <span style="flex: 1; text-align: right;">£2.4M</span>
                        <span style="flex: 1; text-align: right; color: #10B981;">● Healthy</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span style="flex: 2;">NHS Trust London</span>
                        <span style="flex: 1; text-align: right;">£1.8M</span>
                        <span style="flex: 1; text-align: right; color: #10B981;">● Healthy</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span style="flex: 2;">Tesco Stores Ltd</span>
                        <span style="flex: 1; text-align: right;">£1.6M</span>
                        <span style="flex: 1; text-align: right; color: #F59E0B;">● At Risk</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span style="flex: 2;">HSBC Holdings</span>
                        <span style="flex: 1; text-align: right;">£1.4M</span>
                        <span style="flex: 1; text-align: right; color: #10B981;">● Healthy</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span style="flex: 2;">Lloyds Banking</span>
                        <span style="flex: 1; text-align: right;">£1.2M</span>
                        <span style="flex: 1; text-align: right; color: #10B981;">● Healthy</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span style="flex: 2;">Manchester Council</span>
                        <span style="flex: 1; text-align: right;">£1.1M</span>
                        <span style="flex: 1; text-align: right; color: #DC2626;">● Critical</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span style="flex: 2;">Sainsbury's</span>
                        <span style="flex: 1; text-align: right;">£0.9M</span>
                        <span style="flex: 1; text-align: right; color: #10B981;">● Healthy</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span style="flex: 2;">PWC UK</span>
                        <span style="flex: 1; text-align: right;">£0.8M</span>
                        <span style="flex: 1; text-align: right; color: #F59E0B;">● At Risk</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span style="flex: 2;">Deloitte LLP</span>
                        <span style="flex: 1; text-align: right;">£0.7M</span>
                        <span style="flex: 1; text-align: right; color: #10B981;">● Healthy</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.35rem 0;">
                        <span style="flex: 2;">BP PLC</span>
                        <span style="flex: 1; text-align: right;">£0.6M</span>
                        <span style="flex: 1; text-align: right; color: #10B981;">● Healthy</span>
                    </div>
                </div>
                <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #E5E7EB; font-size: 0.75rem; display: flex; justify-content: space-around;">
                    <span><span style="color: #10B981;">●</span> Healthy: 7</span>
                    <span><span style="color: #F59E0B;">●</span> At Risk: 2</span>
                    <span><span style="color: #DC2626;">●</span> Critical: 1</span>
                </div>
                """, unsafe_allow_html=True)
        
        with industry_col:
            st.markdown("**Revenue by Industry Vertical**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Financial Services</span><span style="font-weight: 600;">£8.4M (32%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Healthcare/NHS</span><span style="font-weight: 600;">£5.8M (22%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #10B981; width: 69%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Retail & Distribution</span><span style="font-weight: 600;">£4.2M (16%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #F59E0B; width: 50%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Public Sector</span><span style="font-weight: 600;">£3.6M (14%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #8B5CF6; width: 43%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Manufacturing</span><span style="font-weight: 600;">£2.4M (9%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #EC4899; width: 29%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)

    with tab_strategy:
        st.markdown("""
        <style>
        @keyframes sf-ent-glow { 0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.25); } 50% { box-shadow: 0 0 26px rgba(59,130,246,0.45); } }
        @keyframes sf-ent-sweep { 0% { transform: translateX(-100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        .sf-ent-pulse { position: relative; overflow: hidden; border-radius: 14px; padding: 1.25rem; margin-bottom: 1.5rem; background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%); border: 1px solid #93C5FD; animation: sf-ent-glow 3s ease-in-out infinite; }
        .sf-ent-pulse::after { content: ''; position: absolute; top: 0; left: 0; width: 40%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); animation: sf-ent-sweep 3s linear infinite; }
        .sf-ent-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-ent-title { font-weight: 700; color: #1E3A8A; }
        .sf-ent-tag { background: rgba(59,130,246,0.2); color: #1E3A8A; padding: 0.25rem 0.6rem; border-radius: 999px; font-size: 0.7rem; font-weight: 700; letter-spacing: 0.04em; }
        .sf-ent-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-ent-card { background: rgba(255,255,255,0.85); border-radius: 10px; padding: 0.75rem 0.85rem; border: 1px solid rgba(59,130,246,0.2); }
        .sf-ent-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .sf-ent-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .sf-ent-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="sf-ent-pulse">
            <div class="sf-ent-header">
                <div class="sf-ent-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-ent-tag">AI INSIGHTS</div>
            </div>
            <div class="sf-ent-grid">
                <div class="sf-ent-card">
                    <div class="sf-ent-label">Renewal Forecast</div>
                    <div class="sf-ent-value">89%</div>
                    <div class="sf-ent-delta">↑ +2% QoQ</div>
                </div>
                <div class="sf-ent-card">
                    <div class="sf-ent-label">At-Risk ACV</div>
                    <div class="sf-ent-value">£3.2M</div>
                    <div class="sf-ent-delta">18 accounts</div>
                </div>
                <div class="sf-ent-card">
                    <div class="sf-ent-label">Expansion</div>
                    <div class="sf-ent-value">£2.8M</div>
                    <div class="sf-ent-delta">UCaaS focus</div>
                </div>
                <div class="sf-ent-card">
                    <div class="sf-ent-label">Win Rate</div>
                    <div class="sf-ent-value">34%</div>
                    <div class="sf-ent-delta">Target 40%</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        st.info("Renewal momentum remains strong at 87% with risk concentrated in 18 competitive accounts worth £3.2M. Expansion pipeline is led by UCaaS and SD-WAN, while win rates lag in mid-market segments. Prioritize executive engagement on near-term renewals and accelerate competitive positioning to lift win rate toward 40%.")
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Renewal Risk Clusters**")
                st.caption("Five contracts drive 38% of at-risk ACV; most are in London finance accounts.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**Pipeline Slippage**")
                st.caption("Negotiation stage dwell time increased by 4 days, impacting Q2 forecast.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Expansion Hotspots**")
                st.caption("UCaaS upsell rate is highest in healthcare and public sector renewals.")
        
        st.markdown('<div class="section-header">AI‑Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Executive Renewal Plays**")
                st.caption("Activate executive sponsorship on top 10 at-risk accounts within 2 weeks.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Competitive Countering**")
                st.caption("Deploy battle cards for BT/Vodafone accounts and bundle SD-WAN offers.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Cycle Time Reduction**")
                st.caption("Standardize legal templates to cut negotiation stage by 3–5 days.")
        
        st.markdown('<div class="section-header">Strategic Priorities</div>', unsafe_allow_html=True)
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Renewal Rate 92%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **87%** renewal
                - Gap: **5%** to target
                - Focus: At-risk accounts
                - Action: Executive engagement
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Expansion £3.5M</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Pipeline: **£2.8M** identified
                - Target: **£3.5M** closed
                - Focus: UCaaS upsell
                - Timeline: Q1-Q2 2026
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Win Rate 40%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **34%** win rate
                - Target: **40%** by Q2
                - Action: Competitive intel
                - Training: Battle cards
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What is our B2B contract portfolio value?", "Show me contracts coming up for renewal in 90 days.", "Which contracts have competitive threats?", "What's our at-risk contract value?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_wholesale():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Wholesale & MVNO Dashboard</h1>
        <p>MVNO Traffic, Wholesale Revenue & Partner Settlements</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "📶 Wholesale Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['WHOLESALE_MVNO']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP WHOLESALE - TRAFFIC FLOW ANIMATION
        st.markdown("""
        <style>
        @keyframes traffic-flow { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        @keyframes partner-glow { 0%, 100% { box-shadow: 0 0 5px rgba(59,130,246,0.3); } 50% { box-shadow: 0 0 15px rgba(59,130,246,0.6); } }
        .wholesale-flow { background: linear-gradient(135deg, #1E3A5F 0%, #2D4A6F 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .flow-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .flow-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .flow-live { color: #10B981; font-size: 0.8rem; }
        .traffic-visual { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 10px; }
        .partner-node { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; animation: partner-glow 2s ease-in-out infinite; }
        .partner-node.mvno1 { background: rgba(139,92,246,0.3); border: 2px solid #8B5CF6; }
        .partner-node.mvno2 { background: rgba(16,185,129,0.3); border: 2px solid #10B981; animation-delay: 0.5s; }
        .partner-node.mvno3 { background: rgba(245,158,11,0.3); border: 2px solid #F59E0B; animation-delay: 1s; }
        .traffic-pipe { flex: 1; height: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; position: relative; overflow: hidden; }
        .traffic-packet { position: absolute; height: 100%; width: 40px; background: linear-gradient(90deg, transparent, rgba(59,130,246,0.6), #3B82F6, rgba(59,130,246,0.6), transparent); animation: traffic-flow 1.5s linear infinite; }
        .core-node { width: 80px; height: 60px; background: linear-gradient(135deg, #29B5E8, #0891B2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.8rem; }
        .wholesale-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .ws-stat { background: rgba(255,255,255,0.1); border-radius: 8px; padding: 0.8rem; text-align: center; }
        .ws-val { color: white; font-size: 1.3rem; font-weight: 700; }
        .ws-label { color: rgba(255,255,255,0.6); font-size: 0.7rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="wholesale-flow"><div class="flow-header"><div class="flow-title">🔄 MVNO Traffic Flow</div><div class="flow-live">● Live Traffic</div></div><div class="traffic-visual"><div class="partner-node mvno1">📱</div><div class="traffic-pipe"><div class="traffic-packet"></div><div class="traffic-packet" style="animation-delay:0.5s"></div></div><div class="core-node">SnowTelco Core</div><div class="traffic-pipe"><div class="traffic-packet" style="animation-delay:0.3s"></div><div class="traffic-packet" style="animation-delay:0.8s"></div></div><div class="partner-node mvno2">📱</div><div class="partner-node mvno3">📱</div></div><div class="wholesale-stats"><div class="ws-stat"><div class="ws-val">12</div><div class="ws-label">MVNO Partners</div></div><div class="ws-stat"><div class="ws-val">847K</div><div class="ws-label">Wholesale Subs</div></div><div class="ws-stat"><div class="ws-val">£2.4M</div><div class="ws-label">Monthly Revenue</div></div><div class="ws-stat"><div class="ws-val">142TB</div><div class="ws-label">Traffic Today</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Wholesale Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">🤝</div>
                <div class="kpi-label">MVNO Partners</div>
                <div class="kpi-value">12</div>
                <div class="kpi-delta positive">Active contracts</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Wholesale Revenue</div>
                <div class="kpi-value">£4.2M</div>
                <div class="kpi-delta positive">↑ +18% YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Data Traffic</div>
                <div class="kpi-value">842 TB</div>
                <div class="kpi-delta positive">↑ +40% YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">Overdue Settlements</div>
                <div class="kpi-value">£124K</div>
                <div class="kpi-delta negative">3 partners</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">📞</div>
                <div class="kpi-label">Voice Minutes</div>
                <div class="kpi-value">42M</div>
                <div class="kpi-delta positive">MTD</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">💬</div>
                <div class="kpi-label">SMS Volume</div>
                <div class="kpi-value">18M</div>
                <div class="kpi-delta positive">↑ +8% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">MVNO Subscribers</div>
                <div class="kpi-value">284K</div>
                <div class="kpi-delta positive">On our network</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">Avg ARPU</div>
                <div class="kpi-value">£4.80</div>
                <div class="kpi-delta positive">Per sub/month</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # New: Traffic Trend and Partner Growth
        traffic_col, growth_col = st.columns(2)
        
        with traffic_col:
            st.markdown('<div class="section-header">Traffic Trend (6 Months)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                traffic_trend = pd.DataFrame({
                    'Month': months * 3,
                    'Type': ['Voice']*6 + ['SMS']*6 + ['Data']*6,
                    'Volume': [38, 39, 40, 40, 41, 42,
                              15, 16, 16, 17, 17, 18,
                              620, 680, 720, 760, 800, 842]
                })
                
                # Normalize data for display
                traffic_lines = alt.Chart(traffic_trend[traffic_trend['Type'] != 'Data']).mark_line(strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Volume:Q', title='Voice/SMS (M)'),
                    color=alt.Color('Type:N', scale=alt.Scale(
                        domain=['Voice', 'SMS'],
                        range=['#29B5E8', '#10B981']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Month:N', 'Type:N', 'Volume:Q']
                ).properties(height=160)
                
                st.altair_chart(traffic_lines, use_container_width=True)
        
        with growth_col:
            st.markdown('<div class="section-header">Wholesale Revenue Trend</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                rev_df = pd.DataFrame({
                    'Month': months,
                    'Revenue': [3.2, 3.4, 3.6, 3.8, 4.0, 4.2]
                })
                rev_line = alt.Chart(rev_df).mark_line(point=True, color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Revenue:Q', title='£M'),
                    tooltip=['Month:N', alt.Tooltip('Revenue:Q', format='.1f')]
                ).properties(height=160)
                st.altair_chart(rev_line, use_container_width=True)

        st.markdown('<div class="section-header">Partner Economics</div>', unsafe_allow_html=True)
        econ_col1, econ_col2 = st.columns(2)
        
        with econ_col1:
            st.markdown("**ARPU by Partner**")
            with st.container(border=True):
                arpu_df = pd.DataFrame({
                    'Partner': ['Tesco', 'GiffGaff', 'Lebara', 'Lyca', 'iD'],
                    'ARPU': [5.4, 4.9, 4.6, 4.2, 3.9]
                })
                arpu_bar = alt.Chart(arpu_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('ARPU:Q', title='£/sub'),
                    y=alt.Y('Partner:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Partner:N', alt.Tooltip('ARPU:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(arpu_bar, use_container_width=True)
        
        with econ_col2:
            st.markdown("**Subscriber Share by Partner**")
            with st.container(border=True):
                share_df = pd.DataFrame({
                    'Partner': ['Tesco', 'GiffGaff', 'Lebara', 'Lyca', 'iD'],
                    'Share': [34, 22, 18, 14, 12]
                })
                share_arc = alt.Chart(share_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Partner:N', legend=None, scale=alt.Scale(
                        range=['#29B5E8', '#10B981', '#F59E0B', '#8B5CF6', '#EC4899']
                    )),
                    tooltip=['Partner:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(share_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Roaming & Cost Signals</div>', unsafe_allow_html=True)
        roam_col1, roam_col2 = st.columns(2)
        
        with roam_col1:
            st.markdown("**Roaming Revenue Mix**")
            with st.container(border=True):
                roam_df = pd.DataFrame({
                    'Type': ['Inbound', 'Outbound', 'Domestic'],
                    'Share': [18, 12, 70]
                })
                roam_arc = alt.Chart(roam_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Type:N', legend=None, scale=alt.Scale(
                        range=['#F59E0B', '#29B5E8', '#10B981']
                    )),
                    tooltip=['Type:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(roam_arc, use_container_width=True)
        
        with roam_col2:
            st.markdown("**Cost per GB by Partner**")
            with st.container(border=True):
                cost_df = pd.DataFrame({
                    'Partner': ['Tesco', 'GiffGaff', 'Lebara', 'Lyca', 'iD'],
                    'Cost': [0.42, 0.38, 0.46, 0.51, 0.55]
                })
                cost_bar = alt.Chart(cost_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Cost:Q', title='£/GB'),
                    y=alt.Y('Partner:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Partner:N', alt.Tooltip('Cost:Q', format='.2f')]
                ).properties(height=170)
                st.altair_chart(cost_bar, use_container_width=True)
        
    with tab_ops:
        st.markdown("""
        <style>
        @keyframes ws-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 24px rgba(59,130,246,0.4); }
        }
        @keyframes ws-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .ws-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: ws-ops-glow 3s ease-in-out infinite;
        }
        .ws-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: ws-ops-sweep 3s linear infinite;
        }
        .ws-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .ws-ops-title { font-weight: 700; color: #1E3A8A; }
        .ws-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .ws-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .ws-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .ws-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .ws-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .ws-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="ws-ops-pulse">
            <div class="ws-ops-header">
                <div class="ws-ops-title">📶 Wholesale Ops Pulse</div>
                <div class="ws-ops-tag">LIVE OPS</div>
            </div>
            <div class="ws-ops-grid">
                <div class="ws-ops-card">
                    <div class="ws-ops-label">Partner Tickets</div>
                    <div class="ws-ops-value">28</div>
                    <div class="ws-ops-delta">Open</div>
                </div>
                <div class="ws-ops-card">
                    <div class="ws-ops-label">Settlement Risk</div>
                    <div class="ws-ops-value">£124K</div>
                    <div class="ws-ops-delta">Overdue</div>
                </div>
                <div class="ws-ops-card">
                    <div class="ws-ops-label">Traffic SLA</div>
                    <div class="ws-ops-value">99.3%</div>
                    <div class="ws-ops-delta">Last 7d</div>
                </div>
                <div class="ws-ops-card">
                    <div class="ws-ops-label">Margin</div>
                    <div class="ws-ops-value">42%</div>
                    <div class="ws-ops-delta">Target 45%</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Partner Growth & Mix</div>', unsafe_allow_html=True)
        mix_col1, mix_col2 = st.columns(2)
        
        with mix_col1:
            st.markdown("**Partner YoY Growth**")
            with st.container(border=True):
                growth_df = pd.DataFrame({
                    'Partner': ['GiffGaff', 'Tesco', 'Lebara', 'Lyca', 'iD'],
                    'Growth': [24, 18, 12, 8, -5]
                })
                growth_bar = alt.Chart(growth_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Growth:Q', title='YoY %'),
                    y=alt.Y('Partner:N', sort='-x', title=None),
                    color=alt.condition(alt.datum.Growth > 0, alt.value('#10B981'), alt.value('#EF4444')),
                    tooltip=['Partner:N', alt.Tooltip('Growth:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(growth_bar, use_container_width=True)
        
        with mix_col2:
            st.markdown("**Traffic Mix by Type**")
            with st.container(border=True):
                mix_df = pd.DataFrame({
                    'Type': ['Voice', 'SMS', 'Data'],
                    'Share': [22, 8, 70]
                })
                mix_arc = alt.Chart(mix_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Type:N', legend=None, scale=alt.Scale(
                        range=['#29B5E8', '#10B981', '#6366F1']
                    )),
                    tooltip=['Type:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=190)
                st.altair_chart(mix_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Partner SLA & Tickets</div>', unsafe_allow_html=True)
        sla_col1, sla_col2 = st.columns(2)
        
        with sla_col1:
            st.markdown("**Partner SLA Trend (Monthly)**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                sla_df = pd.DataFrame({
                    'Month': months,
                    'SLA': [98.7, 98.9, 99.0, 99.1, 99.2, 99.3]
                })
                sla_line = alt.Chart(sla_df).mark_line(point=True, color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('SLA:Q', title='%'),
                    tooltip=['Month:N', alt.Tooltip('SLA:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(sla_line, use_container_width=True)
        
        with sla_col2:
            st.markdown("**Ticket Volume by Partner**")
            with st.container(border=True):
                ticket_df = pd.DataFrame({
                    'Partner': ['Tesco', 'GiffGaff', 'Lebara', 'Lyca', 'iD'],
                    'Tickets': [6, 5, 8, 4, 5]
                })
                ticket_bar = alt.Chart(ticket_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Tickets:Q', title='Tickets'),
                    y=alt.Y('Partner:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Partner:N', 'Tickets:Q']
                ).properties(height=170)
                st.altair_chart(ticket_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Settlement & Margin Ops</div>', unsafe_allow_html=True)
        settle_col1, settle_col2 = st.columns(2)
        
        with settle_col1:
            st.markdown("**Settlement Aging**")
            with st.container(border=True):
                aging_df = pd.DataFrame({
                    'Bucket': ['0-15d', '16-30d', '31-60d', '60d+'],
                    'Amount': [2.4, 0.24, 0.12, 0.06]
                })
                aging_bar = alt.Chart(aging_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Amount:Q', title='£M'),
                    y=alt.Y('Bucket:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Bucket:N', alt.Tooltip('Amount:Q', format='.2f')]
                ).properties(height=170)
                st.altair_chart(aging_bar, use_container_width=True)
        
        with settle_col2:
            st.markdown("**Margin by Service**")
            with st.container(border=True):
                margin_df = pd.DataFrame({
                    'Service': ['Voice', 'SMS', 'Data', 'Roaming'],
                    'Margin': [38, 44, 41, 32]
                })
                margin_bar = alt.Chart(margin_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Margin:Q', title='%'),
                    y=alt.Y('Service:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Service:N', alt.Tooltip('Margin:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(margin_bar, use_container_width=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Top MVNO Partners</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Tesco Mobile</span><span style="font-weight: 600;">£1.42M (98K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Lebara</span><span style="font-weight: 600;">£0.98M (72K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 69%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Lycamobile</span><span style="font-weight: 600;">£0.72M (54K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 51%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>GiffGaff</span><span style="font-weight: 600;">£0.54M (38K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 38%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>iD Mobile</span><span style="font-weight: 600;">£0.34M (22K)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 24%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Settlement Status</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Current (Paid)</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">£3.84M</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Pending (<30 days)</span>
                        <span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">£242K</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Overdue (>30 days)</span>
                        <span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">£124K</span>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #FEE2E2; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #DC2626;">⚠️ Lebara: 45 days overdue (£68K)</span>
                </div>
                """, unsafe_allow_html=True)

    with tab_strategy:
        st.markdown("""
        <style>
        @keyframes sf-ws-glow { 0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.25); } 50% { box-shadow: 0 0 26px rgba(59,130,246,0.45); } }
        @keyframes sf-ws-sweep { 0% { transform: translateX(-100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        .sf-ws-pulse { position: relative; overflow: hidden; border-radius: 14px; padding: 1.25rem; margin-bottom: 1.5rem; background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%); border: 1px solid #93C5FD; animation: sf-ws-glow 3s ease-in-out infinite; }
        .sf-ws-pulse::after { content: ''; position: absolute; top: 0; left: 0; width: 40%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); animation: sf-ws-sweep 3s linear infinite; }
        .sf-ws-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-ws-title { font-weight: 700; color: #1E3A8A; }
        .sf-ws-tag { background: rgba(59,130,246,0.2); color: #1E3A8A; padding: 0.25rem 0.6rem; border-radius: 999px; font-size: 0.7rem; font-weight: 700; letter-spacing: 0.04em; }
        .sf-ws-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-ws-card { background: rgba(255,255,255,0.85); border-radius: 10px; padding: 0.75rem 0.85rem; border: 1px solid rgba(59,130,246,0.2); }
        .sf-ws-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .sf-ws-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .sf-ws-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="sf-ws-pulse">
            <div class="sf-ws-header">
                <div class="sf-ws-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-ws-tag">AI INSIGHTS</div>
            </div>
            <div class="sf-ws-grid">
                <div class="sf-ws-card">
                    <div class="sf-ws-label">Revenue Run-Rate</div>
                    <div class="sf-ws-value">£4.2M</div>
                    <div class="sf-ws-delta">↑ +18% YoY</div>
                </div>
                <div class="sf-ws-card">
                    <div class="sf-ws-label">Settlement Risk</div>
                    <div class="sf-ws-value">£124K</div>
                    <div class="sf-ws-delta">3 partners</div>
                </div>
                <div class="sf-ws-card">
                    <div class="sf-ws-label">Traffic Growth</div>
                    <div class="sf-ws-value">+40%</div>
                    <div class="sf-ws-delta">Data YoY</div>
                </div>
                <div class="sf-ws-card">
                    <div class="sf-ws-label">Margin</div>
                    <div class="sf-ws-value">42%</div>
                    <div class="sf-ws-delta">Target 45%</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        st.info("Wholesale revenue continues to climb on strong data traffic growth, but settlement risk remains concentrated in three partners. Margin performance is healthy at 42% yet below target; contract renewal and pricing optimization on high-usage MVNOs can lift profitability. Focus on accelerating IoT MVNO pipeline and tightening overdue enforcement to secure Q1 goals.")
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Partner Growth Leaders**")
                st.caption("GiffGaff and Tesco account for 60% of net subscriber gains this quarter.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**Settlement Risk**")
                st.caption("Overdue exposure is concentrated in one partner; 45+ days past due.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Traffic Mix Shift**")
                st.caption("Data now represents 70% of traffic with accelerating roaming usage.")
        
        st.markdown('<div class="section-header">AI‑Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Incentivize Data Growth**")
                st.caption("Introduce tiered volume pricing to capture upside from heavy-usage MVNOs.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Automate Settlement Controls**")
                st.caption("Trigger auto-suspend workflows at 30+ day overdue thresholds.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Accelerate IoT MVNO Pipeline**")
                st.caption("Prioritize IoT partner onboarding to unlock £600K incremental revenue.")
        
        st.markdown('<div class="section-header">Strategic Priorities</div>', unsafe_allow_html=True)
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Revenue £5M</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **£4.2M** revenue
                - Gap: **£800K** to target
                - Focus: Data traffic growth
                - Action: Partner incentives
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Zero Overdue</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Overdue: **£124K** current
                - Target: **Zero** by Feb
                - Action: Lebara escalation
                - Process: Auto-suspend policy
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">New MVNO Partner</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Pipeline: **3** prospects
                - Target: **1** signed Q1
                - Focus: IoT MVNO
                - Revenue: **£600K** potential
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What is our MVNO partner portfolio and revenue?", "Show me MVNO traffic trends by partner.", "Which partners have overdue settlements?", "Which MVNOs are growing fastest?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_retail():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Retail Operations Dashboard</h1>
        <p>Store Performance, Sales Analytics & Footfall Conversion</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🛍️ Retail Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['RETAIL']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP RETAIL - STORE GRID ANIMATION
        st.markdown("""
        <style>
        @keyframes store-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        @keyframes retail-dot-pop { 0% { opacity: 0; transform: scale(0); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes retail-stat-rise { 0% { opacity: 0; transform: translateY(15px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes retail-val-count { 0% { opacity: 0; } 100% { opacity: 1; } }
        @keyframes retail-low-pulse { 
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239,68,68,0.4); } 
            50% { transform: scale(1.08); box-shadow: 0 0 20px 5px rgba(239,68,68,0.6); } 
        }
        @keyframes retail-medium-pulse { 
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(245,158,11,0.4); } 
            50% { transform: scale(1.05); box-shadow: 0 0 15px 3px rgba(245,158,11,0.5); } 
        }
        .retail-grid { background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #BFDBFE; }
        .retail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .retail-title { color: #1B2A4E; font-size: 1.1rem; font-weight: 600; }
        .retail-live { color: #10B981; font-size: 0.8rem; font-weight: 500; }
        .stores-map { display: grid; grid-template-columns: repeat(10, 1fr); gap: 0.5rem; margin-bottom: 1rem; padding: 1rem; background: #F1F5F9; border-radius: 10px; border: 1px solid #E2E8F0; }
        .store-dot { width: 100%; aspect-ratio: 1; border-radius: 6px; animation: retail-dot-pop 0.3s ease-out forwards; opacity: 0; display: flex; align-items: center; justify-content: center; font-size: 0.55rem; font-weight: 600; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .store-dot.high { background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
        .store-dot.medium { background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); animation: retail-dot-pop 0.3s ease-out forwards, retail-medium-pulse 1.5s ease-in-out 0.3s infinite; }
        .store-dot.low { background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); animation: retail-dot-pop 0.3s ease-out forwards, retail-low-pulse 1s ease-in-out 0.3s infinite; }
        .retail-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .retail-stat { background: white; border-radius: 8px; padding: 0.8rem; text-align: center; animation: retail-stat-rise 0.5s ease-out forwards; opacity: 0; border: 1px solid #E2E8F0; }
        .retail-stat:nth-child(2) { animation-delay: 0.1s; }
        .retail-stat:nth-child(3) { animation-delay: 0.2s; }
        .retail-stat:nth-child(4) { animation-delay: 0.3s; }
        .retail-val { color: #1B2A4E; font-size: 1.3rem; font-weight: 700; animation: retail-val-count 0.8s ease-out 0.4s forwards; opacity: 0; }
        .retail-label { color: #6B7280; font-size: 0.7rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="retail-grid"><div class="retail-header"><div class="retail-title">🏪 Store Network Live</div><div class="retail-live">● 170 Stores • Real-time</div></div><div class="stores-map"><div class="store-dot high">LON-OX</div><div class="store-dot high" style="animation-delay:0.1s">LON-RE</div><div class="store-dot medium" style="animation-delay:0.2s">MAN-AR</div><div class="store-dot high" style="animation-delay:0.3s">BIR-BU</div><div class="store-dot high" style="animation-delay:0.4s">LEE-TR</div><div class="store-dot low" style="animation-delay:0.5s">LIV-ON</div><div class="store-dot high" style="animation-delay:0.6s">GLA-BC</div><div class="store-dot medium" style="animation-delay:0.7s">EDI-PR</div><div class="store-dot high" style="animation-delay:0.8s">BRI-CA</div><div class="store-dot high" style="animation-delay:0.9s">CAR-QS</div><div class="store-dot high" style="animation-delay:1.0s">NEW-EG</div><div class="store-dot high" style="animation-delay:1.1s">SHE-ME</div><div class="store-dot high" style="animation-delay:1.2s">NOT-VR</div><div class="store-dot medium" style="animation-delay:1.3s">LES-HM</div><div class="store-dot high" style="animation-delay:1.4s">COV-WO</div><div class="store-dot low" style="animation-delay:1.5s">BRA-SG</div><div class="store-dot high" style="animation-delay:1.6s">STK-PO</div><div class="store-dot high" style="animation-delay:1.7s">HUL-PV</div><div class="store-dot medium" style="animation-delay:1.8s">PLY-DR</div><div class="store-dot high" style="animation-delay:1.9s">SOU-WQ</div></div><div class="retail-stats"><div class="retail-stat"><div class="retail-val">12.4K</div><div class="retail-label">Footfall Today</div></div><div class="retail-stat"><div class="retail-val">34%</div><div class="retail-label">Conversion</div></div><div class="retail-stat"><div class="retail-val">£847K</div><div class="retail-label">Revenue Today</div></div><div class="retail-stat"><div class="retail-val">4.7</div><div class="retail-label">CSAT</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Retail Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">🏪</div>
                <div class="kpi-label">Total Stores</div>
                <div class="kpi-value">170</div>
                <div class="kpi-delta positive">UK-wide</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Retail Revenue</div>
                <div class="kpi-value">£2.8M</div>
                <div class="kpi-delta positive">↑ +12% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">Footfall MTD</div>
                <div class="kpi-value">142K</div>
                <div class="kpi-delta positive">↑ +8% vs LY</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">🎯</div>
                <div class="kpi-label">Conversion Rate</div>
                <div class="kpi-value">24%</div>
                <div class="kpi-delta positive">↑ +3% MoM</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Sales/Sq Ft</div>
                <div class="kpi-value">£142</div>
                <div class="kpi-delta positive">↑ +£8 MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">📱</div>
                <div class="kpi-label">Contract Sales</div>
                <div class="kpi-value">68%</div>
                <div class="kpi-delta positive">vs 32% PAYG</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">👤</div>
                <div class="kpi-label">Sales/Employee</div>
                <div class="kpi-value">£4.2K</div>
                <div class="kpi-delta positive">↑ +£320 MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">📉</div>
                <div class="kpi-label">Underperforming</div>
                <div class="kpi-value">12</div>
                <div class="kpi-delta negative">Stores below target</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # New: Footfall vs Conversion Trend and Regional Performance
        footfall_col, regional_col = st.columns(2)
        
        with footfall_col:
            st.markdown('<div class="section-header">Footfall vs Conversion</div>', unsafe_allow_html=True)
            with st.container(border=True):
                weeks = [f'W{i}' for i in range(1, 9)]
                footfall_data = pd.DataFrame({
                    'Week': weeks,
                    'Footfall': [17.2, 18.1, 16.8, 17.5, 18.4, 17.9, 18.2, 18.8],
                    'Conversion': [22, 23, 21, 24, 23, 25, 24, 24]
                })
                
                footfall_bars = alt.Chart(footfall_data).mark_bar(color='#E5E7EB', cornerRadiusTopLeft=4, cornerRadiusTopRight=4).encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Footfall:Q', title='Footfall (K)')
                )
                
                conversion_line = alt.Chart(footfall_data).mark_line(color='#10B981', strokeWidth=3).encode(
                    x=alt.X('Week:N', sort=weeks),
                    y=alt.Y('Conversion:Q', scale=alt.Scale(domain=[15, 30]), title='Conv %'),
                    tooltip=['Week:N', alt.Tooltip('Conversion:Q', format='.0f')]
                )
                
                st.altair_chart(alt.layer(footfall_bars, conversion_line).resolve_scale(y='independent').properties(height=160), use_container_width=True)
        
        with regional_col:
            st.markdown('<div class="section-header">Regional Performance</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>London</span><span style="font-weight: 600;">£0.72M</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>North</span><span style="font-weight: 600;">£0.62M</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #29B5E8; width: 86%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>South East</span><span style="font-weight: 600;">£0.58M</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #29B5E8; width: 81%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Midlands</span><span style="font-weight: 600;">£0.52M</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #29B5E8; width: 72%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Scotland</span><span style="font-weight: 600;">£0.36M</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #29B5E8; width: 50%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Revenue & Basket Signals</div>', unsafe_allow_html=True)
        basket_col1, basket_col2 = st.columns(2)
        
        with basket_col1:
            st.markdown("**Average Basket Value (Weekly)**")
            with st.container(border=True):
                weeks = [f'W{i}' for i in range(1, 9)]
                basket_df = pd.DataFrame({
                    'Week': weeks,
                    'Basket': [92, 98, 96, 101, 104, 108, 110, 112]
                })
                basket_line = alt.Chart(basket_df).mark_line(point=True, color='#6366F1', strokeWidth=2).encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Basket:Q', title='£'),
                    tooltip=['Week:N', alt.Tooltip('Basket:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(basket_line, use_container_width=True)
        
        with basket_col2:
            st.markdown("**Revenue by Channel**")
            with st.container(border=True):
                channel_df = pd.DataFrame({
                    'Channel': ['In-Store', 'Click & Collect', 'Assisted Digital', 'Partners'],
                    'Share': [54, 18, 16, 12]
                })
                channel_arc = alt.Chart(channel_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Channel:N', legend=None, scale=alt.Scale(
                        range=['#29B5E8', '#10B981', '#F59E0B', '#8B5CF6']
                    )),
                    tooltip=['Channel:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(channel_arc, use_container_width=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Performance by Store Type</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Standard <span style="color: #6B7280; font-size: 0.75rem;">(86 stores)</span></span>
                            <span style="font-weight: 600;">£1.42M</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Flagship <span style="color: #6B7280; font-size: 0.75rem;">(12 stores)</span></span>
                            <span style="font-weight: 600;">£0.84M</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 59%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Express <span style="color: #6B7280; font-size: 0.75rem;">(48 stores)</span></span>
                            <span style="font-weight: 600;">£0.38M</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 27%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Kiosk <span style="color: #6B7280; font-size: 0.75rem;">(24 stores)</span></span>
                            <span style="font-weight: 600;">£0.16M</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 11%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Top Product Categories</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Contract Phones</span>
                        <span style="font-weight: 600;">£1.24M (44%)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>SIM Only</span>
                        <span style="font-weight: 600;">£680K (24%)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Accessories</span>
                        <span style="font-weight: 600;">£480K (17%)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>PAYG</span>
                        <span style="font-weight: 600;">£420K (15%)</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Inventory & Promo Signals</div>', unsafe_allow_html=True)
        inv_col1, inv_col2 = st.columns(2)
        
        with inv_col1:
            st.markdown("**Inventory Health by Category**")
            with st.container(border=True):
                inv_df = pd.DataFrame({
                    'Category': ['Contract Phones', 'SIM Only', 'Accessories', 'PAYG'],
                    'Days': [26, 18, 32, 14]
                })
                inv_bar = alt.Chart(inv_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Days:Q', title='Days on Hand'),
                    y=alt.Y('Category:N', sort='-x', title=None),
                    color=alt.value('#10B981'),
                    tooltip=['Category:N', 'Days:Q']
                ).properties(height=170)
                st.altair_chart(inv_bar, use_container_width=True)
        
        with inv_col2:
            st.markdown("**Promo Lift vs Baseline**")
            with st.container(border=True):
                promo_df = pd.DataFrame({
                    'Promo': ['Handset Bundle', 'Trade-In', 'Family Plan', 'SIM Only'],
                    'Lift': [22, 18, 14, 9]
                })
                promo_bar = alt.Chart(promo_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Lift:Q', title='Lift %'),
                    y=alt.Y('Promo:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Promo:N', alt.Tooltip('Lift:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(promo_bar, use_container_width=True)
        
        # In-Store Customer Behavior Section
        st.markdown('<div class="section-header">In-Store Customer Behavior</div>', unsafe_allow_html=True)
        
        demo_col, journey_col, cust_type_col = st.columns(3)
        
        with demo_col:
            st.markdown("**Visitor Demographics**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>18-24</span><span style="font-weight: 600;">22%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                            <div style="background: #8B5CF6; width: 22%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>25-34</span><span style="font-weight: 600;">32%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                            <div style="background: #6366F1; width: 32%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>35-44</span><span style="font-weight: 600;">24%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                            <div style="background: #3B82F6; width: 24%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>45-54</span><span style="font-weight: 600;">14%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                            <div style="background: #29B5E8; width: 14%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>55+</span><span style="font-weight: 600;">8%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                            <div style="background: #10B981; width: 8%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.4rem; font-size: 0.7rem; color: #6B7280;">Skews younger than online (median: 32)</div>
                """, unsafe_allow_html=True)
        
        with journey_col:
            st.markdown("**In-Store Journey**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>Footfall</span><span style="font-weight: 600;">48,200</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 20px;">
                            <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>Engaged (>5 min)</span><span style="font-weight: 600;">28,920 (60%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 20px;">
                            <div style="background: #10B981; width: 60%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>Staff Assisted</span><span style="font-weight: 600;">18,472 (38%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 20px;">
                            <div style="background: #8B5CF6; width: 38%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>Converted</span><span style="font-weight: 600;">11,568 (24%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 20px;">
                            <div style="background: #F59E0B; width: 24%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with cust_type_col:
            st.markdown("**New vs Existing Customers**")
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; justify-content: space-around; text-align: center; padding: 0.5rem 0;">
                    <div>
                        <div style="font-size: 1.8rem; font-weight: 700; color: #10B981;">62%</div>
                        <div style="font-size: 0.8rem; color: #6B7280;">New Customers</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">7,172 sales</div>
                    </div>
                    <div>
                        <div style="font-size: 1.8rem; font-weight: 700; color: #29B5E8;">38%</div>
                        <div style="font-size: 0.8rem; color: #6B7280;">Existing</div>
                        <div style="font-size: 0.7rem; color: #6B7280;">4,396 sales</div>
                    </div>
                </div>
                <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #E5E7EB; font-size: 0.75rem; text-align: center;">
                    <strong>Existing Customer Actions:</strong> Upgrade 58% • Support 24% • Add Line 18%
                </div>
                """, unsafe_allow_html=True)
        
        # Purchase Behavior
        purchase_col, reason_col = st.columns(2)
        
        with purchase_col:
            st.markdown("**Purchase Behavior by Customer Type**")
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; font-size: 0.8rem; border-collapse: collapse;">
                    <tr style="border-bottom: 2px solid #E5E7EB; background: #F9FAFB;">
                        <th style="text-align: left; padding: 0.4rem;">Type</th>
                        <th style="text-align: center; padding: 0.4rem;">Avg Basket</th>
                        <th style="text-align: center; padding: 0.4rem;">Time in Store</th>
                        <th style="text-align: center; padding: 0.4rem;">Upsell Rate</th>
                    </tr>
                    <tr style="border-bottom: 1px solid #E5E7EB;">
                        <td style="padding: 0.4rem;">New - Contract</td>
                        <td style="text-align: center; padding: 0.4rem; font-weight: 600;">£142</td>
                        <td style="text-align: center; padding: 0.4rem;">28 min</td>
                        <td style="text-align: center; padding: 0.4rem; color: #10B981;">68%</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #E5E7EB;">
                        <td style="padding: 0.4rem;">New - PAYG</td>
                        <td style="text-align: center; padding: 0.4rem; font-weight: 600;">£48</td>
                        <td style="text-align: center; padding: 0.4rem;">12 min</td>
                        <td style="text-align: center; padding: 0.4rem; color: #F59E0B;">34%</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #E5E7EB;">
                        <td style="padding: 0.4rem;">Upgrade</td>
                        <td style="text-align: center; padding: 0.4rem; font-weight: 600;">£186</td>
                        <td style="text-align: center; padding: 0.4rem;">22 min</td>
                        <td style="text-align: center; padding: 0.4rem; color: #10B981;">72%</td>
                    </tr>
                    <tr>
                        <td style="padding: 0.4rem;">Accessory Only</td>
                        <td style="text-align: center; padding: 0.4rem; font-weight: 600;">£38</td>
                        <td style="text-align: center; padding: 0.4rem;">8 min</td>
                        <td style="text-align: center; padding: 0.4rem; color: #DC2626;">12%</td>
                    </tr>
                </table>
                """, unsafe_allow_html=True)
        
        with reason_col:
            st.markdown("**Visit Reason Analysis**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>New Purchase</span><span style="font-weight: 600;">42%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #10B981; width: 42%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Upgrade/Renewal</span><span style="font-weight: 600;">28%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #29B5E8; width: 28%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Support/Repair</span><span style="font-weight: 600;">18%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #F59E0B; width: 18%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Browse/Research</span><span style="font-weight: 600;">12%</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                            <div style="background: #8B5CF6; width: 12%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.4rem; font-size: 0.7rem; color: #10B981;">Browsers convert at 32% on return visit</div>
                """, unsafe_allow_html=True)
        

    with tab_ops:
        st.markdown("""
        <style>
        @keyframes retail-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 24px rgba(59,130,246,0.4); }
        }
        @keyframes retail-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .retail-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: retail-ops-glow 3s ease-in-out infinite;
        }
        .retail-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: retail-ops-sweep 3s linear infinite;
        }
        .retail-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .retail-ops-title { font-weight: 700; color: #1E3A8A; }
        .retail-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .retail-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .retail-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .retail-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .retail-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .retail-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="retail-ops-pulse">
            <div class="retail-ops-header">
                <div class="retail-ops-title">🛍️ Retail Ops Pulse</div>
                <div class="retail-ops-tag">LIVE OPS</div>
            </div>
            <div class="retail-ops-grid">
                <div class="retail-ops-card">
                    <div class="retail-ops-label">Open Tickets</div>
                    <div class="retail-ops-value">56</div>
                    <div class="retail-ops-delta">Store ops</div>
                </div>
                <div class="retail-ops-card">
                    <div class="retail-ops-label">Staffed Shifts</div>
                    <div class="retail-ops-value">94%</div>
                    <div class="retail-ops-delta">Target 96%</div>
                </div>
                <div class="retail-ops-card">
                    <div class="retail-ops-label">Promo Compliance</div>
                    <div class="retail-ops-value">88%</div>
                    <div class="retail-ops-delta">Last audit</div>
                </div>
                <div class="retail-ops-card">
                    <div class="retail-ops-label">Stockouts</div>
                    <div class="retail-ops-value">14</div>
                    <div class="retail-ops-delta">Critical SKUs</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Store Ops Performance</div>', unsafe_allow_html=True)
        ops_col1, ops_col2 = st.columns(2)
        
        with ops_col1:
            st.markdown("**Queue Time by Store Type**")
            with st.container(border=True):
                queue_df = pd.DataFrame({
                    'Store Type': ['Flagship', 'Standard', 'Express', 'Kiosk'],
                    'Minutes': [7.2, 6.1, 5.4, 4.2]
                })
                queue_bar = alt.Chart(queue_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Minutes:Q', title='Minutes'),
                    y=alt.Y('Store Type:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Store Type:N', alt.Tooltip('Minutes:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(queue_bar, use_container_width=True)
        
        with ops_col2:
            st.markdown("**Staffing Coverage (Weekly)**")
            with st.container(border=True):
                weeks = [f'W{i}' for i in range(1, 9)]
                staff_df = pd.DataFrame({
                    'Week': weeks,
                    'Coverage': [91, 93, 94, 92, 95, 96, 94, 94]
                })
                staff_line = alt.Chart(staff_df).mark_line(point=True, color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Coverage:Q', title='%'),
                    tooltip=['Week:N', alt.Tooltip('Coverage:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(staff_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Returns & Service Ops</div>', unsafe_allow_html=True)
        ret_col1, ret_col2 = st.columns(2)
        
        with ret_col1:
            st.markdown("**Return Rate by Category**")
            with st.container(border=True):
                ret_df = pd.DataFrame({
                    'Category': ['Contract Phones', 'Accessories', 'SIM Only', 'PAYG'],
                    'Rate': [6.2, 4.1, 2.8, 3.4]
                })
                ret_bar = alt.Chart(ret_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Rate:Q', title='%'),
                    y=alt.Y('Category:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Category:N', alt.Tooltip('Rate:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(ret_bar, use_container_width=True)
        
        with ret_col2:
            st.markdown("**Service Ticket Resolution**")
            with st.container(border=True):
                res_df = pd.DataFrame({
                    'Stage': ['Same Day', '1-2 Days', '3-5 Days', '5+ Days'],
                    'Share': [42, 31, 18, 9]
                })
                res_arc = alt.Chart(res_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Stage:N', legend=None, scale=alt.Scale(
                        range=['#10B981', '#29B5E8', '#F59E0B', '#EF4444']
                    )),
                    tooltip=['Stage:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(res_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Store Compliance & Loss</div>', unsafe_allow_html=True)
        comp_col1, comp_col2 = st.columns(2)
        
        with comp_col1:
            st.markdown("**Promo Compliance by Region**")
            with st.container(border=True):
                comp_df = pd.DataFrame({
                    'Region': ['London', 'North', 'South East', 'Midlands', 'Scotland'],
                    'Compliance': [92, 86, 88, 84, 90]
                })
                comp_bar = alt.Chart(comp_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Compliance:Q', title='%'),
                    y=alt.Y('Region:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Region:N', alt.Tooltip('Compliance:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(comp_bar, use_container_width=True)
        
        with comp_col2:
            st.markdown("**Shrinkage by Store Type**")
            with st.container(border=True):
                shrink_df = pd.DataFrame({
                    'Store Type': ['Flagship', 'Standard', 'Express', 'Kiosk'],
                    'Shrinkage': [1.2, 0.9, 0.7, 0.5]
                })
                shrink_bar = alt.Chart(shrink_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Shrinkage:Q', title='%'),
                    y=alt.Y('Store Type:N', sort='-x', title=None),
                    color=alt.value('#EF4444'),
                    tooltip=['Store Type:N', alt.Tooltip('Shrinkage:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(shrink_bar, use_container_width=True)

    with tab_strategy:
        st.markdown("""
        <style>
        @keyframes sf-retail-glow { 0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.25); } 50% { box-shadow: 0 0 26px rgba(59,130,246,0.45); } }
        @keyframes sf-retail-sweep { 0% { transform: translateX(-100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        .sf-retail-pulse { position: relative; overflow: hidden; border-radius: 14px; padding: 1.25rem; margin-bottom: 1.5rem; background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%); border: 1px solid #93C5FD; animation: sf-retail-glow 3s ease-in-out infinite; }
        .sf-retail-pulse::after { content: ''; position: absolute; top: 0; left: 0; width: 40%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); animation: sf-retail-sweep 3s linear infinite; }
        .sf-retail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-retail-title { font-weight: 700; color: #1E3A8A; }
        .sf-retail-tag { background: rgba(59,130,246,0.2); color: #1E3A8A; padding: 0.25rem 0.6rem; border-radius: 999px; font-size: 0.7rem; font-weight: 700; letter-spacing: 0.04em; }
        .sf-retail-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-retail-card { background: rgba(255,255,255,0.85); border-radius: 10px; padding: 0.75rem 0.85rem; border: 1px solid rgba(59,130,246,0.2); }
        .sf-retail-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .sf-retail-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .sf-retail-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="sf-retail-pulse">
            <div class="sf-retail-header">
                <div class="sf-retail-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-retail-tag">AI INSIGHTS</div>
            </div>
            <div class="sf-retail-grid">
                <div class="sf-retail-card">
                    <div class="sf-retail-label">Conversion</div>
                    <div class="sf-retail-value">24%</div>
                    <div class="sf-retail-delta">Target 28%</div>
                </div>
                <div class="sf-retail-card">
                    <div class="sf-retail-label">Footfall</div>
                    <div class="sf-retail-value">142K</div>
                    <div class="sf-retail-delta">MTD</div>
                </div>
                <div class="sf-retail-card">
                    <div class="sf-retail-label">Sales/Sq Ft</div>
                    <div class="sf-retail-value">£142</div>
                    <div class="sf-retail-delta">Target £160</div>
                </div>
                <div class="sf-retail-card">
                    <div class="sf-retail-label">Underperforming</div>
                    <div class="sf-retail-value">12</div>
                    <div class="sf-retail-delta">Stores</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        st.info("Retail performance is improving with rising basket values and strong footfall, but conversion remains below target in several regions. Inventory pressure in accessories and promo compliance gaps are creating missed revenue opportunities. Prioritize staffing coverage and store coaching in underperforming locations to lift conversion and sales per square foot.")
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Conversion Hotspots**")
                st.caption("London flagships outperform by +6% conversion vs network average.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**Basket Value Lift**")
                st.caption("Accessory attach rate correlates with 18% higher basket size.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Promo Compliance Gaps**")
                st.caption("Midlands stores show the lowest promo compliance at 84%.")
        
        st.markdown('<div class="section-header">AI‑Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Staffing Optimization**")
                st.caption("Align peak-hour staffing to lift conversion by 2–3 points.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Merchandising Reset**")
                st.caption("Refresh accessory bays to increase attach and reduce stockouts.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Store Coaching**")
                st.caption("Target 12 underperforming stores with coaching and incentives.")
        
        st.markdown('<div class="section-header">Strategic Priorities</div>', unsafe_allow_html=True)
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Conversion 28%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **24%** conversion
                - Gap: **4%** to target
                - Action: Sales training
                - Incentive: Q1 bonus
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">£160/sq ft Target</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **£142**/sq ft
                - Gap: **£18** to target
                - Focus: Flagship stores
                - Action: Visual merchandising
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Underperformers Fix</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - At-risk: **12** stores
                - Action: Store reviews
                - Options: Relocate or close
                - Timeline: Q1 decision
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What is our retail sales revenue by store type?", "What are our footfall and conversion rates?", "Which stores are top and bottom performers?", "How are retail staff performing on commission?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_chro_people():
    import pandas as pd
    import altair as alt
    
    # CHRO Header with Connected People Network Effect
    st.markdown("""
    <style>
    @keyframes chro-connect { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.8; } }
    @keyframes chro-person-pop { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    .chro-header-wrap { position: relative; overflow: hidden; border-radius: 12px; margin-bottom: 2rem; }
    .chro-network-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; opacity: 0.2; }
    .chro-person { position: absolute; font-size: 24px; animation: chro-person-pop 0.5s ease-out forwards; }
    .chro-line { position: absolute; height: 2px; background: rgba(255,255,255,0.5); animation: chro-connect 2s ease-in-out infinite; transform-origin: left; }
    .chro-header-content {
        position: relative; z-index: 1;
        background: linear-gradient(-45deg, #6366F1, #4F46E5, #4338CA, #3730A3);
        background-size: 400% 400%;
        animation: gradient-shift 12s ease infinite;
        padding: 2rem; color: white;
    }
    .chro-header-content h1 { margin: 0; font-weight: 700; font-size: 2rem; }
    .chro-header-content p { margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 1.1rem; }
    </style>
    <div class="chro-header-wrap">
        <div class="chro-network-bg">
            <span class="chro-person" style="left: 15%; top: 25%; animation-delay: 0s;">👤</span>
            <span class="chro-person" style="left: 30%; top: 60%; animation-delay: 0.2s;">👤</span>
            <span class="chro-person" style="left: 50%; top: 30%; animation-delay: 0.4s;">👤</span>
            <span class="chro-person" style="left: 70%; top: 55%; animation-delay: 0.6s;">👤</span>
            <span class="chro-person" style="left: 85%; top: 25%; animation-delay: 0.8s;">👤</span>
            <div class="chro-line" style="left: 18%; top: 35%; width: 80px; transform: rotate(30deg);"></div>
            <div class="chro-line" style="left: 33%; top: 55%; width: 100px; transform: rotate(-20deg); animation-delay: 0.5s;"></div>
            <div class="chro-line" style="left: 53%; top: 40%; width: 90px; transform: rotate(25deg); animation-delay: 1s;"></div>
        </div>
        <div class="chro-header-content">
            <h1>CHRO People & Workforce Dashboard</h1>
            <p>Workforce Analytics, Engagement & Talent Management</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "👥 People Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['WORKFORCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # CHRO WORKFORCE PULSE ANIMATION
        st.markdown("""
        <style>
        @keyframes person-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes pulse-ring-hr { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }
        @keyframes chro-metric-pop { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes chro-val-count { 0% { opacity: 0; transform: translateY(10px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes chro-live-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .chro-pulse { background: linear-gradient(135deg, #7C3AED 0%, #5B21B6 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .pulse-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .pulse-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .pulse-live { color: #10B981; font-size: 0.8rem; animation: chro-live-blink 2s ease-in-out infinite; }
        .people-flow { display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 10px; }
        .person-icon { font-size: 1.5rem; animation: person-bounce 1s ease-in-out infinite; }
        .hr-metrics { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .hr-metric { background: rgba(255,255,255,0.1); border-radius: 10px; padding: 0.8rem; text-align: center; position: relative; animation: chro-metric-pop 0.5s ease-out forwards; opacity: 0; }
        .hr-metric:nth-child(2) { animation-delay: 0.1s; }
        .hr-metric:nth-child(3) { animation-delay: 0.2s; }
        .hr-metric:nth-child(4) { animation-delay: 0.3s; }
        .hr-metric::before { content: ''; position: absolute; top: 50%; left: 50%; width: 60px; height: 60px; border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; transform: translate(-50%, -50%); animation: pulse-ring-hr 2s ease-out infinite; }
        .hr-val { color: white; font-size: 1.4rem; font-weight: 700; position: relative; z-index: 1; animation: chro-val-count 0.6s ease-out 0.3s forwards; opacity: 0; }
        .hr-metric:nth-child(2) .hr-val { animation-delay: 0.4s; }
        .hr-metric:nth-child(3) .hr-val { animation-delay: 0.5s; }
        .hr-metric:nth-child(4) .hr-val { animation-delay: 0.6s; }
        .hr-label { color: rgba(255,255,255,0.7); font-size: 0.7rem; text-transform: uppercase; position: relative; z-index: 1; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="chro-pulse"><div class="pulse-header"><div class="pulse-title">👥 Workforce Pulse</div><div class="pulse-live">● 2,847 Active Today</div></div><div class="people-flow"><span class="person-icon" style="animation-delay:0s">👤</span><span class="person-icon" style="animation-delay:0.1s">👤</span><span class="person-icon" style="animation-delay:0.2s">👤</span><span class="person-icon" style="animation-delay:0.3s">👤</span><span class="person-icon" style="animation-delay:0.4s">👤</span><span class="person-icon" style="animation-delay:0.5s">👤</span><span class="person-icon" style="animation-delay:0.6s">👤</span><span class="person-icon" style="animation-delay:0.7s">👤</span><span class="person-icon" style="animation-delay:0.8s">👤</span><span class="person-icon" style="animation-delay:0.9s">👤</span><span class="person-icon" style="animation-delay:1.0s">👤</span><span class="person-icon" style="animation-delay:1.1s">👤</span></div><div class="hr-metrics"><div class="hr-metric"><div class="hr-val">3,247</div><div class="hr-label">Total Headcount</div></div><div class="hr-metric"><div class="hr-val">82%</div><div class="hr-label">Engagement</div></div><div class="hr-metric"><div class="hr-val">8.2%</div><div class="hr-label">Attrition</div></div><div class="hr-metric"><div class="hr-val">94%</div><div class="hr-label">Training Complete</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Workforce Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">Total Headcount</div>
                <div class="kpi-value">2,142</div>
                <div class="kpi-delta positive">↑ +48 YTD</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">💚</div>
                <div class="kpi-label">Engagement Score</div>
                <div class="kpi-value">3.8/5</div>
                <div class="kpi-delta positive">↑ +0.2 YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">⭐</div>
                <div class="kpi-label">eNPS</div>
                <div class="kpi-value">+25</div>
                <div class="kpi-delta positive">↑ +8 pts YoY</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">🔄</div>
                <div class="kpi-label">Turnover Rate</div>
                <div class="kpi-value">14%</div>
                <div class="kpi-delta positive">↓ -2% YoY</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">📈</div>
                <div class="kpi-label">Open Positions</div>
                <div class="kpi-value">68</div>
                <div class="kpi-delta positive">Active hiring</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">⏱️</div>
                <div class="kpi-label">Time to Hire</div>
                <div class="kpi-value">32 days</div>
                <div class="kpi-delta positive">↓ -8 days</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">🎓</div>
                <div class="kpi-label">Training Hours</div>
                <div class="kpi-value">4,280</div>
                <div class="kpi-delta positive">MTD completed</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">At-Risk Employees</div>
                <div class="kpi-value">142</div>
                <div class="kpi-delta negative">Turnover risk</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # New: Engagement Trend and Hiring Pipeline
        engagement_col, hiring_col = st.columns(2)
        
        with engagement_col:
            st.markdown('<div class="section-header">Engagement Trend (Quarterly)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                quarters = ['Q1 25', 'Q2 25', 'Q3 25', 'Q4 25', 'Q1 26']
                engagement_trend = pd.DataFrame({
                    'Quarter': quarters,
                    'Score': [3.5, 3.6, 3.7, 3.7, 3.8],
                    'eNPS': [15, 18, 20, 22, 25]
                })
                
                score_line = alt.Chart(engagement_trend).mark_line(color='#10B981', strokeWidth=3).encode(
                    x=alt.X('Quarter:N', sort=quarters, title=None),
                    y=alt.Y('Score:Q', scale=alt.Scale(domain=[3, 4.5]), title='Engagement')
                )
                
                score_points = alt.Chart(engagement_trend).mark_circle(color='#10B981', size=60).encode(
                    x=alt.X('Quarter:N', sort=quarters),
                    y=alt.Y('Score:Q'),
                    tooltip=['Quarter:N', alt.Tooltip('Score:Q', format='.1f'), 'eNPS:Q']
                )
                
                st.altair_chart((score_line + score_points).properties(height=160), use_container_width=True)
        
        with hiring_col:
            st.markdown('<div class="section-header">Hiring Pipeline</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Applied</span><span style="font-weight: 600;">420</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #6366F1; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Screened</span><span style="font-weight: 600;">168 (40%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #8B5CF6; width: 40%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Interview</span><span style="font-weight: 600;">84 (20%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #29B5E8; width: 20%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Offer</span><span style="font-weight: 600;">32 (8%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #F59E0B; width: 8%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Hired</span><span style="font-weight: 600;">18 (4%)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 16px;">
                            <div style="background: #10B981; width: 4%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)

        st.markdown('<div class="section-header">Talent & Retention Signals</div>', unsafe_allow_html=True)
        talent_col1, talent_col2 = st.columns(2)
        
        with talent_col1:
            st.markdown("**Attrition by Department**")
            with st.container(border=True):
                attr_df = pd.DataFrame({
                    'Department': ['Contact Centre', 'Network Ops', 'Sales', 'IT', 'Corporate'],
                    'Attrition': [18, 12, 14, 9, 7]
                })
                attr_bar = alt.Chart(attr_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Attrition:Q', title='%'),
                    y=alt.Y('Department:N', sort='-x', title=None),
                    color=alt.value('#EF4444'),
                    tooltip=['Department:N', alt.Tooltip('Attrition:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(attr_bar, use_container_width=True)
        
        with talent_col2:
            st.markdown("**Internal Mobility Rate**")
            with st.container(border=True):
                quarters = ['Q1 25', 'Q2 25', 'Q3 25', 'Q4 25', 'Q1 26']
                mobility_df = pd.DataFrame({
                    'Quarter': quarters,
                    'Mobility': [6.2, 6.8, 7.4, 7.9, 8.4]
                })
                mobility_line = alt.Chart(mobility_df).mark_line(point=True, color='#6366F1', strokeWidth=2).encode(
                    x=alt.X('Quarter:N', sort=quarters, title=None),
                    y=alt.Y('Mobility:Q', title='%'),
                    tooltip=['Quarter:N', alt.Tooltip('Mobility:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(mobility_line, use_container_width=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Headcount by Department</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Contact Centre</span><span style="font-weight: 600;">680 <span style="color: #6B7280; font-size: 0.75rem;">(3.6 eng)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Retail</span><span style="font-weight: 600;">520 <span style="color: #6B7280; font-size: 0.75rem;">(3.9 eng)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 76%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Network Ops</span><span style="font-weight: 600;">420 <span style="color: #6B7280; font-size: 0.75rem;">(4.1 eng)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 62%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>IT</span><span style="font-weight: 600;">280 <span style="color: #6B7280; font-size: 0.75rem;">(4.0 eng)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 41%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Corporate</span><span style="font-weight: 600;">242 <span style="color: #6B7280; font-size: 0.75rem;">(3.8 eng)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 36%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Skills Gaps</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>5G Core Engineering</span>
                        <span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">Critical</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>AI/ML</span>
                        <span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">Critical</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Cloud Architecture</span>
                        <span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">High</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Cybersecurity</span>
                        <span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">High</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        

    with tab_ops:
        st.markdown("""
        <style>
        @keyframes chro-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 24px rgba(59,130,246,0.4); }
        }
        @keyframes chro-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .chro-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: chro-ops-glow 3s ease-in-out infinite;
        }
        .chro-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: chro-ops-sweep 3s linear infinite;
        }
        .chro-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .chro-ops-title { font-weight: 700; color: #1E3A8A; }
        .chro-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .chro-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .chro-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .chro-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .chro-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .chro-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="chro-ops-pulse">
            <div class="chro-ops-header">
                <div class="chro-ops-title">👥 People Ops Pulse</div>
                <div class="chro-ops-tag">LIVE OPS</div>
            </div>
            <div class="chro-ops-grid">
                <div class="chro-ops-card">
                    <div class="chro-ops-label">Active Cases</div>
                    <div class="chro-ops-value">96</div>
                    <div class="chro-ops-delta">HR tickets</div>
                </div>
                <div class="chro-ops-card">
                    <div class="chro-ops-label">Offer Accept</div>
                    <div class="chro-ops-value">82%</div>
                    <div class="chro-ops-delta">Last 30d</div>
                </div>
                <div class="chro-ops-card">
                    <div class="chro-ops-label">Time to Fill</div>
                    <div class="chro-ops-value">32d</div>
                    <div class="chro-ops-delta">↓ 8d</div>
                </div>
                <div class="chro-ops-card">
                    <div class="chro-ops-label">Training Done</div>
                    <div class="chro-ops-value">94%</div>
                    <div class="chro-ops-delta">MTD</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Recruiting Operations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2 = st.columns(2)
        
        with rec_col1:
            st.markdown("**Offer Acceptance by Role**")
            with st.container(border=True):
                offer_df = pd.DataFrame({
                    'Role': ['Engineering', 'Sales', 'Retail', 'Corporate'],
                    'Acceptance': [78, 84, 88, 80]
                })
                offer_bar = alt.Chart(offer_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Acceptance:Q', title='%'),
                    y=alt.Y('Role:N', sort='-x', title=None),
                    color=alt.value('#10B981'),
                    tooltip=['Role:N', alt.Tooltip('Acceptance:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(offer_bar, use_container_width=True)
        
        with rec_col2:
            st.markdown("**Time-to-Fill by Department**")
            with st.container(border=True):
                ttf_df = pd.DataFrame({
                    'Department': ['Contact Centre', 'Network Ops', 'Sales', 'IT', 'Corporate'],
                    'Days': [38, 34, 29, 36, 26]
                })
                ttf_bar = alt.Chart(ttf_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Days:Q', title='Days'),
                    y=alt.Y('Department:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Department:N', 'Days:Q']
                ).properties(height=170)
                st.altair_chart(ttf_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Learning & Performance</div>', unsafe_allow_html=True)
        learn_col1, learn_col2 = st.columns(2)
        
        with learn_col1:
            st.markdown("**Training Completion by Department**")
            with st.container(border=True):
                train_df = pd.DataFrame({
                    'Department': ['Contact Centre', 'Network Ops', 'Sales', 'IT', 'Corporate'],
                    'Completion': [88, 92, 94, 90, 96]
                })
                train_bar = alt.Chart(train_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Completion:Q', title='%'),
                    y=alt.Y('Department:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Department:N', alt.Tooltip('Completion:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(train_bar, use_container_width=True)
        
        with learn_col2:
            st.markdown("**Performance Rating Mix**")
            with st.container(border=True):
                perf_df = pd.DataFrame({
                    'Rating': ['Exceeds', 'Meets', 'Below'],
                    'Share': [18, 68, 14]
                })
                perf_arc = alt.Chart(perf_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Rating:N', legend=None, scale=alt.Scale(
                        range=['#10B981', '#29B5E8', '#EF4444']
                    )),
                    tooltip=['Rating:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(perf_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Workforce Risk & Capacity</div>', unsafe_allow_html=True)
        cap_col1, cap_col2 = st.columns(2)
        
        with cap_col1:
            st.markdown("**Absence Rate by Department**")
            with st.container(border=True):
                abs_df = pd.DataFrame({
                    'Department': ['Contact Centre', 'Network Ops', 'Sales', 'IT', 'Corporate'],
                    'Absence': [4.2, 3.1, 2.8, 2.4, 1.9]
                })
                abs_bar = alt.Chart(abs_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Absence:Q', title='%'),
                    y=alt.Y('Department:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Department:N', alt.Tooltip('Absence:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(abs_bar, use_container_width=True)
        
        with cap_col2:
            st.markdown("**Span of Control**")
            with st.container(border=True):
                span_df = pd.DataFrame({
                    'Layer': ['Exec', 'Senior Mgr', 'Mgr', 'Lead'],
                    'Span': [5.2, 6.8, 8.1, 9.4]
                })
                span_line = alt.Chart(span_df).mark_line(point=True, color='#8B5CF6', strokeWidth=2).encode(
                    x=alt.X('Layer:N', title=None),
                    y=alt.Y('Span:Q', title='Direct reports'),
                    tooltip=['Layer:N', alt.Tooltip('Span:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(span_line, use_container_width=True)

    with tab_strategy:
        st.markdown("""
        <style>
        @keyframes sf-chro-glow { 0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.25); } 50% { box-shadow: 0 0 26px rgba(59,130,246,0.45); } }
        @keyframes sf-chro-sweep { 0% { transform: translateX(-100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        .sf-chro-pulse { position: relative; overflow: hidden; border-radius: 14px; padding: 1.25rem; margin-bottom: 1.5rem; background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%); border: 1px solid #93C5FD; animation: sf-chro-glow 3s ease-in-out infinite; }
        .sf-chro-pulse::after { content: ''; position: absolute; top: 0; left: 0; width: 40%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); animation: sf-chro-sweep 3s linear infinite; }
        .sf-chro-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; position: relative; z-index: 1; }
        .sf-chro-title { font-weight: 700; color: #1E3A8A; }
        .sf-chro-tag { background: rgba(59,130,246,0.2); color: #1E3A8A; padding: 0.25rem 0.6rem; border-radius: 999px; font-size: 0.7rem; font-weight: 700; letter-spacing: 0.04em; }
        .sf-chro-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; position: relative; z-index: 1; }
        .sf-chro-card { background: rgba(255,255,255,0.85); border-radius: 10px; padding: 0.75rem 0.85rem; border: 1px solid rgba(59,130,246,0.2); }
        .sf-chro-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .sf-chro-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .sf-chro-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="sf-chro-pulse">
            <div class="sf-chro-header">
                <div class="sf-chro-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="sf-chro-tag">AI INSIGHTS</div>
            </div>
            <div class="sf-chro-grid">
                <div class="sf-chro-card">
                    <div class="sf-chro-label">Engagement</div>
                    <div class="sf-chro-value">3.8/5</div>
                    <div class="sf-chro-delta">Target 4.0</div>
                </div>
                <div class="sf-chro-card">
                    <div class="sf-chro-label">Attrition</div>
                    <div class="sf-chro-value">14%</div>
                    <div class="sf-chro-delta">↓ 2% YoY</div>
                </div>
                <div class="sf-chro-card">
                    <div class="sf-chro-label">Hiring Velocity</div>
                    <div class="sf-chro-value">32d</div>
                    <div class="sf-chro-delta">Time to fill</div>
                </div>
                <div class="sf-chro-card">
                    <div class="sf-chro-label">Training</div>
                    <div class="sf-chro-value">94%</div>
                    <div class="sf-chro-delta">Completion</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        st.info("Engagement and eNPS continue to improve, but attrition remains elevated in contact centre roles. Hiring velocity is trending in the right direction while training completion is strong. Prioritize retention programs for high-attrition teams and accelerate internal mobility to close critical skills gaps.")
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        sig_col1, sig_col2, sig_col3 = st.columns(3)
        with sig_col1:
            with st.container(border=True):
                st.markdown("**Attrition Hotspots**")
                st.caption("Contact Centre attrition remains the highest at 18% despite improved engagement.")
        with sig_col2:
            with st.container(border=True):
                st.markdown("**Skills Gap Risk**")
                st.caption("5G Core and AI/ML remain critical gaps with limited internal pipeline.")
        with sig_col3:
            with st.container(border=True):
                st.markdown("**Mobility Lift**")
                st.caption("Internal mobility up to 8.4% as mentoring and rotations expand.")
        
        st.markdown('<div class="section-header">AI‑Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        rec_col1, rec_col2, rec_col3 = st.columns(3)
        with rec_col1:
            with st.container(border=True):
                st.markdown("**Targeted Retention**")
                st.caption("Deploy retention packages for contact centre and high-performer cohorts.")
        with rec_col2:
            with st.container(border=True):
                st.markdown("**Skills Acceleration**")
                st.caption("Expand 5G and AI/ML bootcamps to certify 200 employees by Q2.")
        with rec_col3:
            with st.container(border=True):
                st.markdown("**Manager Enablement**")
                st.caption("Scale manager training to lift engagement by 0.2 points.")
        
        st.markdown('<div class="section-header">Strategic Priorities</div>', unsafe_allow_html=True)
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Engagement 4.0</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **3.8**/5 score
                - Gap: **0.2** to target
                - Focus: Contact Centre
                - Action: Manager training
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Skills Gap Closure</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Critical: **5G**, **AI/ML**
                - Hires: **15** specialists
                - Training: **200** employees
                - Budget: **£420K** approved
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Turnover < 12%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **14%** turnover
                - Target: **<12%** by Q2
                - Focus: High performers
                - Action: Retention bonuses
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What is our headcount by department?", "What are our engagement scores by department?", "What is our eNPS and which teams have highest/lowest?", "What are our critical skills gaps?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_legal():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Legal & General Counsel Dashboard</h1>
        <p>Contracts, Regulatory Compliance & Risk Management</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "⚖️ Legal Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['B2B_CONTRACT', 'COMPLAINT', 'SLA', 'FINANCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP LEGAL - CONTRACT LIFECYCLE ANIMATION
        st.markdown("""
        <style>
        @keyframes legal-scale { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes legal-slide { 0% { transform: translateX(-10px); opacity: 0; } 100% { transform: translateX(0); opacity: 1; } }
        @keyframes legal-glow { 0%, 100% { box-shadow: 0 0 5px rgba(139,92,246,0.3); } 50% { box-shadow: 0 0 20px rgba(139,92,246,0.5); } }
        .legal-contracts { background: linear-gradient(135deg, #4C1D95 0%, #7C3AED 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .legal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .legal-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .legal-value { text-align: right; }
        .legal-value-amount { color: white; font-size: 1.5rem; font-weight: 700; }
        .legal-value-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; }
        .legal-pipeline { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 10px; }
        .legal-stage { text-align: center; flex: 1; animation: legal-slide 0.5s ease-out forwards; opacity: 0; }
        .legal-stage:nth-child(1) { animation-delay: 0.1s; }
        .legal-stage:nth-child(2) { animation-delay: 0.2s; }
        .legal-stage:nth-child(3) { animation-delay: 0.3s; }
        .legal-stage:nth-child(4) { animation-delay: 0.4s; }
        .legal-stage:nth-child(5) { animation-delay: 0.5s; }
        .legal-stage-icon { font-size: 1.3rem; margin-bottom: 0.3rem; animation: legal-scale 3s ease-in-out infinite; display: inline-block; }
        .legal-stage-name { color: rgba(255,255,255,0.7); font-size: 0.65rem; }
        .legal-stage-count { color: white; font-size: 1rem; font-weight: 700; }
        .legal-arrow { color: rgba(255,255,255,0.3); font-size: 1rem; }
        .legal-alerts { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
        .legal-alert { background: rgba(255,255,255,0.1); border-radius: 8px; padding: 0.6rem; text-align: center; animation: legal-glow 3s ease-in-out infinite; }
        .legal-alert:nth-child(2) { animation-delay: 1s; }
        .legal-alert:nth-child(3) { animation-delay: 2s; }
        .legal-alert-val { color: white; font-size: 1.1rem; font-weight: 700; }
        .legal-alert-label { color: rgba(255,255,255,0.6); font-size: 0.6rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="legal-contracts"><div class="legal-header"><div class="legal-title">📋 Contract Lifecycle</div><div class="legal-value"><div class="legal-value-amount">£52.4M</div><div class="legal-value-label">Portfolio Value</div></div></div><div class="legal-pipeline"><div class="legal-stage"><div class="legal-stage-icon">📝</div><div class="legal-stage-name">Draft</div><div class="legal-stage-count">24</div></div><span class="legal-arrow">→</span><div class="legal-stage"><div class="legal-stage-icon">🔍</div><div class="legal-stage-name">Review</div><div class="legal-stage-count">18</div></div><span class="legal-arrow">→</span><div class="legal-stage"><div class="legal-stage-icon">✍️</div><div class="legal-stage-name">Signing</div><div class="legal-stage-count">12</div></div><span class="legal-arrow">→</span><div class="legal-stage"><div class="legal-stage-icon">✅</div><div class="legal-stage-name">Active</div><div class="legal-stage-count">524</div></div><span class="legal-arrow">→</span><div class="legal-stage"><div class="legal-stage-icon">🔄</div><div class="legal-stage-name">Renewal</div><div class="legal-stage-count">47</div></div></div><div class="legal-alerts"><div class="legal-alert"><div class="legal-alert-val">18</div><div class="legal-alert-label">Open Disputes</div></div><div class="legal-alert"><div class="legal-alert-val">8</div><div class="legal-alert-label">Ombudsman Cases</div></div><div class="legal-alert"><div class="legal-alert-val">£420K</div><div class="legal-alert-label">Risk Exposure</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Legal Overview</div>', unsafe_allow_html=True)
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">📋</div>
                <div class="kpi-label">Contract Portfolio</div>
                <div class="kpi-value">£52.4M</div>
                <div class="kpi-delta positive">524 contracts</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">⚖️</div>
                <div class="kpi-label">Open Disputes</div>
                <div class="kpi-value">18</div>
                <div class="kpi-delta negative">£420K exposure</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">📑</div>
                <div class="kpi-label">Ombudsman Cases</div>
                <div class="kpi-value">8</div>
                <div class="kpi-delta negative">Active</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">✅</div>
                <div class="kpi-label">SLA Compliance</div>
                <div class="kpi-value">97.8%</div>
                <div class="kpi-delta positive">Above target</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">SLA Credits</div>
                <div class="kpi-value">£12.4K</div>
                <div class="kpi-delta negative">MTD liability</div>
            </div>
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🔒</div>
                <div class="kpi-label">GDPR Requests</div>
                <div class="kpi-value">24</div>
                <div class="kpi-delta positive">All within SLA</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">📅</div>
                <div class="kpi-label">Renewals (90d)</div>
                <div class="kpi-value">42</div>
                <div class="kpi-delta positive">£8.4M value</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">High-Risk Contracts</div>
                <div class="kpi-value">8</div>
                <div class="kpi-delta negative">Need review</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Contract Health Signals</div>', unsafe_allow_html=True)
        health_col1, health_col2 = st.columns(2)
        
        with health_col1:
            st.markdown("**Renewals by Risk Tier**")
            with st.container(border=True):
                risk_df = pd.DataFrame({
                    'Tier': ['Low', 'Medium', 'High'],
                    'Contracts': [24, 12, 6]
                })
                risk_bar = alt.Chart(risk_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Contracts:Q', title='Contracts'),
                    y=alt.Y('Tier:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Tier:N', 'Contracts:Q']
                ).properties(height=170)
                st.altair_chart(risk_bar, use_container_width=True)
        
        with health_col2:
            st.markdown("**Dispute Resolution Time**")
            with st.container(border=True):
                dispute_df = pd.DataFrame({
                    'Stage': ['Intake', 'Review', 'Negotiation', 'Closure'],
                    'Days': [5, 9, 14, 7]
                })
                dispute_bar = alt.Chart(dispute_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Days:Q', title='Days'),
                    y=alt.Y('Stage:N', sort='-x', title=None),
                    color=alt.value('#6366F1'),
                    tooltip=['Stage:N', 'Days:Q']
                ).properties(height=170)
                st.altair_chart(dispute_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Regulatory & Litigation Signals</div>', unsafe_allow_html=True)
        reg_col1, reg_col2 = st.columns(2)
        
        with reg_col1:
            st.markdown("**Regulatory Findings Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                findings_df = pd.DataFrame({
                    'Month': months,
                    'Findings': [6, 5, 7, 4, 3, 3]
                })
                findings_line = alt.Chart(findings_df).mark_line(point=True, color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Findings:Q', title='Findings'),
                    tooltip=['Month:N', 'Findings:Q']
                ).properties(height=170)
                st.altair_chart(findings_line, use_container_width=True)
        
        with reg_col2:
            st.markdown("**Litigation Mix**")
            with st.container(border=True):
                mix_df = pd.DataFrame({
                    'Type': ['Contract', 'Employment', 'Regulatory', 'IP'],
                    'Share': [42, 24, 20, 14]
                })
                mix_arc = alt.Chart(mix_df).mark_arc(innerRadius=55).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color(
                        'Type:N',
                        legend=alt.Legend(orient='bottom', title=None, direction='horizontal'),
                        scale=alt.Scale(range=['#EF4444', '#3B82F6', '#F59E0B', '#8B5CF6'])
                    ),
                    tooltip=['Type:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=170)
                st.altair_chart(mix_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Complaints & Privacy Signals</div>', unsafe_allow_html=True)
        comp_col1, comp_col2 = st.columns(2)
        
        with comp_col1:
            st.markdown("**Ombudsman Cases Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                omb_df = pd.DataFrame({
                    'Month': months,
                    'Cases': [9, 10, 8, 7, 8, 8]
                })
                omb_line = alt.Chart(omb_df).mark_line(point=True, color='#F59E0B', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Cases:Q', title='Cases'),
                    tooltip=['Month:N', 'Cases:Q']
                ).properties(height=170)
                st.altair_chart(omb_line, use_container_width=True)
        
        with comp_col2:
            st.markdown("**GDPR Request Mix**")
            with st.container(border=True):
                gdpr_df = pd.DataFrame({
                    'Type': ['Access', 'Deletion', 'Portability', 'Correction'],
                    'Requests': [12, 6, 4, 2]
                })
                gdpr_bar = alt.Chart(gdpr_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Requests:Q', title='Requests'),
                    y=alt.Y('Type:N', sort='-x', title=None),
                    color=alt.value('#29B5E8'),
                    tooltip=['Type:N', 'Requests:Q']
                ).properties(height=170)
                st.altair_chart(gdpr_bar, use_container_width=True)
        
    with tab_ops:
        st.markdown("""
        <style>
        @keyframes legal-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 24px rgba(59,130,246,0.4); }
        }
        @keyframes legal-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .legal-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: legal-ops-glow 3s ease-in-out infinite;
        }
        .legal-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: legal-ops-sweep 3s linear infinite;
        }
        .legal-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .legal-ops-title { font-weight: 700; color: #1E3A8A; }
        .legal-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .legal-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .legal-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .legal-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .legal-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .legal-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        </style>
        <div class="legal-ops-pulse">
            <div class="legal-ops-header">
                <div class="legal-ops-title">⚖️ Legal Ops Pulse</div>
                <div class="legal-ops-tag">LIVE OPS</div>
            </div>
            <div class="legal-ops-grid">
                <div class="legal-ops-card">
                    <div class="legal-ops-label">Active Matters</div>
                    <div class="legal-ops-value">18</div>
                    <div class="legal-ops-delta">Open disputes</div>
                </div>
                <div class="legal-ops-card">
                    <div class="legal-ops-label">Risk Exposure</div>
                    <div class="legal-ops-value">£420K</div>
                    <div class="legal-ops-delta">MTD</div>
                </div>
                <div class="legal-ops-card">
                    <div class="legal-ops-label">SLA Credits</div>
                    <div class="legal-ops-value">£12.4K</div>
                    <div class="legal-ops-delta">Liability</div>
                </div>
                <div class="legal-ops-card">
                    <div class="legal-ops-label">Compliance</div>
                    <div class="legal-ops-value">97.8%</div>
                    <div class="legal-ops-delta">Ofcom</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        spend_col, risk_col = st.columns(2)
        
        with spend_col:
            st.markdown('<div class="section-header">Legal Spend Trend</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                legal_spend = pd.DataFrame({
                    'Month': months,
                    'Internal': [42, 45, 48, 44, 46, 48],
                    'External': [28, 32, 35, 30, 38, 42]
                })
                
                internal_line = alt.Chart(legal_spend).mark_line(color='#29B5E8', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Internal:Q', scale=alt.Scale(domain=[0, 100]), title='Spend (£K)')
                )
                
                external_line = alt.Chart(legal_spend).mark_line(color='#F59E0B', strokeWidth=2, strokeDash=[4, 4]).encode(
                    x=alt.X('Month:N', sort=months),
                    y=alt.Y('External:Q')
                )
                
                st.altair_chart((internal_line + external_line).properties(height=160), use_container_width=True)
                st.markdown('<div style="text-align: center; font-size: 0.75rem;"><span style="color: #29B5E8;">—</span> Internal <span style="color: #F59E0B;">- -</span> External</div>', unsafe_allow_html=True)
        
        with risk_col:
            st.markdown('<div class="section-header">Risk Exposure by Type</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Contract</span><span style="font-weight: 600;">£180K</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #EF4444; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Employment</span><span style="font-weight: 600;">£105K</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #3B82F6; width: 58%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Regulatory</span><span style="font-weight: 600;">£85K</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #F59E0B; width: 47%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>IP</span><span style="font-weight: 600;">£50K</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #8B5CF6; width: 28%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Active Legal Matters</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid #E5E7EB;">
                            <th style="text-align: left; padding: 0.5rem;">Matter</th>
                            <th style="text-align: right; padding: 0.5rem;">Exposure</th>
                            <th style="text-align: right; padding: 0.5rem;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">Contract Dispute - TechCorp</td>
                            <td style="text-align: right; padding: 0.5rem;">£180K</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEE2E2; color: #DC2626; padding: 0.2rem 0.5rem; border-radius: 12px;">Litigation</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">SLA Breach Claim</td>
                            <td style="text-align: right; padding: 0.5rem;">£85K</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Negotiation</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #F3F4F6;">
                            <td style="padding: 0.5rem;">GDPR Complaint</td>
                            <td style="text-align: right; padding: 0.5rem;">£50K</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #E0F2FE; color: #0369A1; padding: 0.2rem 0.5rem; border-radius: 12px;">Review</span></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">Vendor Contract</td>
                            <td style="text-align: right; padding: 0.5rem;">£105K</td>
                            <td style="text-align: right; padding: 0.5rem;"><span style="background: #FEF3C7; color: #92400E; padding: 0.2rem 0.5rem; border-radius: 12px;">Mediation</span></td>
                        </tr>
                    </tbody>
                </table>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Regulatory Status</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Ofcom Compliance</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Compliant</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>GDPR</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Compliant</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Consumer Rights</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Compliant</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Competition Law</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">Compliant</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Matter Lifecycle & SLA Performance</div>', unsafe_allow_html=True)
        life_col1, life_col2 = st.columns(2)
        
        with life_col1:
            st.markdown("**Matter Aging Buckets**")
            with st.container(border=True):
                aging_df = pd.DataFrame({
                    'Bucket': ['0-30d', '31-60d', '61-90d', '90d+'],
                    'Matters': [6, 5, 4, 3]
                })
                aging_bar = alt.Chart(aging_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Matters:Q', title='Open Matters'),
                    y=alt.Y('Bucket:N', sort='-x', title=None),
                    color=alt.value('#F97316'),
                    tooltip=['Bucket:N', 'Matters:Q']
                ).properties(height=170)
                st.altair_chart(aging_bar, use_container_width=True)
        
        with life_col2:
            st.markdown("**SLA Compliance Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                sla_df = pd.DataFrame({
                    'Month': months,
                    'Compliance': [96.8, 97.2, 97.6, 98.1, 97.9, 97.8]
                })
                sla_line = alt.Chart(sla_df).mark_line(point=True, color='#2563EB', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Compliance:Q', title='Compliance %', scale=alt.Scale(domain=[95, 100])),
                    tooltip=['Month:N', alt.Tooltip('Compliance:Q', format='.1f')]
                ).properties(height=170)
                st.altair_chart(sla_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Workload & Resolution Flow</div>', unsafe_allow_html=True)
        work_col1, work_col2 = st.columns(2)
        
        with work_col1:
            st.markdown("**Case Volume by Practice**")
            with st.container(border=True):
                practice_df = pd.DataFrame({
                    'Practice': ['Contracts', 'Employment', 'Regulatory', 'IP'],
                    'Cases': [7, 5, 4, 2]
                })
                practice_bar = alt.Chart(practice_df).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Practice:N', title=None),
                    y=alt.Y('Cases:Q', title='Cases'),
                    color=alt.value('#10B981'),
                    tooltip=['Practice:N', 'Cases:Q']
                ).properties(height=170)
                st.altair_chart(practice_bar, use_container_width=True)
        
        with work_col2:
            st.markdown("**Settlement Pipeline (Weekly)**")
            with st.container(border=True):
                weeks = ['W1', 'W2', 'W3', 'W4', 'W5', 'W6']
                settle_df = pd.DataFrame({
                    'Week': weeks,
                    'Open': [12, 12, 11, 10, 9, 9],
                    'In Negotiation': [6, 7, 6, 6, 5, 4],
                    'Closed': [2, 3, 4, 5, 6, 7]
                })
                settle_area = alt.Chart(settle_df).transform_fold(
                    ['Open', 'In Negotiation', 'Closed'],
                    as_=['Stage', 'Count']
                ).mark_area(opacity=0.5).encode(
                    x=alt.X('Week:N', sort=weeks, title=None),
                    y=alt.Y('Count:Q', title='Matters'),
                    color=alt.Color('Stage:N', scale=alt.Scale(range=['#F97316', '#60A5FA', '#22C55E'])),
                    tooltip=['Stage:N', 'Count:Q']
                ).properties(height=170)
                st.altair_chart(settle_area, use_container_width=True)
        
        st.markdown('<div class="section-header">Matter Aging & Counsel Mix</div>', unsafe_allow_html=True)
        age_col, counsel_col = st.columns(2)
        
        with age_col:
            st.markdown("**Matter Aging Buckets**")
            with st.container(border=True):
                aging_df = pd.DataFrame({
                    'Bucket': ['0-30d', '31-60d', '61-90d', '90d+'],
                    'Matters': [6, 5, 4, 3]
                })
                aging_bar = alt.Chart(aging_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Matters:Q', title='Matters'),
                    y=alt.Y('Bucket:N', sort='-x', title=None),
                    color=alt.value('#2563EB'),
                    tooltip=['Bucket:N', 'Matters:Q']
                ).properties(height=170)
                st.altair_chart(aging_bar, use_container_width=True)
        
        with counsel_col:
            st.markdown("**Outside Counsel Mix**")
            with st.container(border=True):
                counsel_df = pd.DataFrame({
                    'Firm': ['Alpha', 'North & Co', 'Lexis', 'Kite'],
                    'Share': [38, 26, 20, 16]
                })
                counsel_arc = alt.Chart(counsel_df).mark_arc(innerRadius=50).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color(
                        'Firm:N',
                        legend=alt.Legend(orient='bottom', title=None, direction='horizontal'),
                        scale=alt.Scale(range=['#60A5FA', '#34D399', '#FBBF24', '#A78BFA'])
                    ),
                    tooltip=['Firm:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=190)
                st.altair_chart(counsel_arc, use_container_width=True)

    with tab_strategy:
        st.markdown('<div class="section-header">VP Legal Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Resolve TechCorp</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Exposure: **£180K**
                - Status: Active litigation
                - Target: Settlement Q1
                - Strategy: Mediation offer
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Contract Risk Review</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - High-risk: **8** contracts
                - Review: All by Feb
                - Focus: Liability terms
                - Action: Renegotiation
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">SLA Credits < £10K</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **£12.4K** MTD
                - Target: **<£10K** monthly
                - Action: SLA monitoring
                - Alert: Proactive triggers
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What is our B2B contract portfolio value?", "Show me our formal complaint trends.", "What's our SLA compliance rate and breach exposure?", "What active legal matters do we have?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_product():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Product Management Dashboard</h1>
        <p>Product Portfolio, Plan Performance & Pricing Strategy</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧭 Product Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['PLAN', 'MOBILE', 'MARKET_INTELLIGENCE']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP PRODUCT - PRODUCT LIFECYCLE ANIMATION
        st.markdown("""
        <style>
        @keyframes lifecycle-rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes stage-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .product-lifecycle { background: linear-gradient(135deg, #4F46E5 0%, #6366F1 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 2rem; }
        .lifecycle-wheel { width: 140px; height: 140px; position: relative; flex-shrink: 0; animation: lifecycle-rotate 20s linear infinite; }
        .wheel-segment { position: absolute; width: 50%; height: 50%; }
        .wheel-segment.launch { top: 0; left: 25%; background: #10B981; border-radius: 70px 70px 0 0; transform-origin: bottom center; }
        .wheel-segment.grow { top: 25%; right: 0; background: #3B82F6; border-radius: 0 70px 70px 0; transform-origin: left center; }
        .wheel-segment.mature { bottom: 0; left: 25%; background: #F59E0B; border-radius: 0 0 70px 70px; transform-origin: top center; }
        .wheel-segment.decline { top: 25%; left: 0; background: #EF4444; border-radius: 70px 0 0 70px; transform-origin: right center; }
        .wheel-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .product-stages { flex: 1; }
        .prod-title { color: white; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; }
        .stages-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }
        .stage-card { background: rgba(255,255,255,0.1); border-radius: 8px; padding: 0.6rem; text-align: center; animation: stage-pulse 2s ease-in-out infinite; }
        .stage-card:nth-child(2) { animation-delay: 0.5s; }
        .stage-card:nth-child(3) { animation-delay: 1s; }
        .stage-card:nth-child(4) { animation-delay: 1.5s; }
        .stage-icon { font-size: 1.2rem; margin-bottom: 0.3rem; }
        .stage-count { color: white; font-size: 1.2rem; font-weight: 700; }
        .stage-name { color: rgba(255,255,255,0.7); font-size: 0.65rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="product-lifecycle"><div class="lifecycle-wheel"><div class="wheel-segment launch"></div><div class="wheel-segment grow"></div><div class="wheel-segment mature"></div><div class="wheel-segment decline"></div><div class="wheel-center">📱</div></div><div class="product-stages"><div class="prod-title">📦 Product Lifecycle Status</div><div class="stages-grid"><div class="stage-card"><div class="stage-icon">🚀</div><div class="stage-count">3</div><div class="stage-name">Launch</div></div><div class="stage-card"><div class="stage-icon">📈</div><div class="stage-count">8</div><div class="stage-name">Growth</div></div><div class="stage-card"><div class="stage-icon">⭐</div><div class="stage-count">10</div><div class="stage-name">Mature</div></div><div class="stage-card"><div class="stage-icon">📉</div><div class="stage-count">3</div><div class="stage-name">Sunset</div></div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Product Portfolio Overview</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">📱</div>
                <div class="kpi-label">Active Plans</div>
                <div class="kpi-value">24</div>
                <div class="kpi-delta positive">Consumer + B2B</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">📡</div>
                <div class="kpi-label">5G Plans</div>
                <div class="kpi-value">14</div>
                <div class="kpi-delta positive">58% of portfolio</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">👥</div>
                <div class="kpi-label">5G Adoption</div>
                <div class="kpi-value">42%</div>
                <div class="kpi-delta positive">↑ +8% MoM</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Avg ARPU</div>
                <div class="kpi-value">£43.60</div>
                <div class="kpi-delta positive">↑ +£2.10 MoM</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">📊</div>
                <div class="kpi-label">Pay Monthly</div>
                <div class="kpi-value">62%</div>
                <div class="kpi-delta positive">ARPU: £52</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">💳</div>
                <div class="kpi-label">SIM Only</div>
                <div class="kpi-value">28%</div>
                <div class="kpi-delta positive">ARPU: £28</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">🔋</div>
                <div class="kpi-label">PAYG</div>
                <div class="kpi-value">10%</div>
                <div class="kpi-delta positive">ARPU: £18</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">📉</div>
                <div class="kpi-label">Underperforming</div>
                <div class="kpi-value">4</div>
                <div class="kpi-delta negative">Plans need review</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # New: 5G Adoption Trend and ARPU by Plan Type
        adoption_col, arpu_type_col = st.columns(2)
        
        with adoption_col:
            st.markdown('<div class="section-header">5G Adoption Trend</div>', unsafe_allow_html=True)
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                adoption_data = pd.DataFrame({
                    'Month': months,
                    '5G': [34, 36, 38, 39, 41, 42],
                    '4G': [66, 64, 62, 61, 59, 58]
                })
                
                adoption_area = alt.Chart(adoption_data.melt('Month', var_name='Network', value_name='Pct')).mark_area().encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Pct:Q', stack='normalize', title='%'),
                    color=alt.Color('Network:N', scale=alt.Scale(
                        domain=['5G', '4G'],
                        range=['#8B5CF6', '#E5E7EB']
                    ), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Month:N', 'Network:N', alt.Tooltip('Pct:Q', format='.0f')]
                ).properties(height=160)
                
                st.altair_chart(adoption_area, use_container_width=True)
        
        with arpu_type_col:
            st.markdown('<div class="section-header">ARPU by Plan Type</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 160px; padding: 1rem 0;">
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #29B5E8; width: 60px; height: 104px; margin: 0 auto; border-radius: 6px 6px 0 0;"></div>
                        <div style="font-weight: 600; margin-top: 0.5rem;">£52</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">Pay Monthly</div>
                        <div style="font-size: 0.7rem; color: #9CA3AF;">62% share</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #10B981; width: 60px; height: 56px; margin: 0 auto; border-radius: 6px 6px 0 0;"></div>
                        <div style="font-weight: 600; margin-top: 0.5rem;">£28</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">SIM Only</div>
                        <div style="font-size: 0.7rem; color: #9CA3AF;">28% share</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #F59E0B; width: 60px; height: 36px; margin: 0 auto; border-radius: 6px 6px 0 0;"></div>
                        <div style="font-weight: 600; margin-top: 0.5rem;">£18</div>
                        <div style="font-size: 0.75rem; color: #6B7280;">PAYG</div>
                        <div style="font-size: 0.7rem; color: #9CA3AF;">10% share</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Top Plans by Subscribers</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Unlimited 5G</span><span style="font-weight: 600;">8,420 <span style="color: #6B7280; font-size: 0.75rem;">(£55)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Essential 10GB</span><span style="font-weight: 600;">6,280 <span style="color: #6B7280; font-size: 0.75rem;">(£28)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 75%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Premium 100GB</span><span style="font-weight: 600;">4,120 <span style="color: #6B7280; font-size: 0.75rem;">(£45)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 49%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Family Share</span><span style="font-weight: 600;">3,840 <span style="color: #6B7280; font-size: 0.75rem;">(£42)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 46%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Business Pro</span><span style="font-weight: 600;">2,680 <span style="color: #6B7280; font-size: 0.75rem;">(£68)</span></span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 32%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Competitor Pricing</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="font-weight: 600; color: #6B7280; margin-bottom: 0.5rem;">Unlimited 5G Comparison</div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>SnowTelco</span>
                        <span style="background: #29B5E8; color: white; padding: 0.2rem 0.5rem; border-radius: 12px; font-weight: 600;">£45/mo</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>EE</span>
                        <span style="font-weight: 600;">£54/mo</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Three</span>
                        <span style="font-weight: 600;">£42/mo</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Vodafone</span>
                        <span style="font-weight: 600;">£48/mo</span>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; padding: 0.5rem; background: #D1FAE5; border-radius: 8px; font-size: 0.75rem; text-align: center;">
                    <span style="color: #065F46;">Competitive positioning: Mid-market value leader</span>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Plan Performance Signals</div>', unsafe_allow_html=True)
        perf_col1, perf_col2 = st.columns(2)
        
        with perf_col1:
            st.markdown("**Subscriber Growth by Plan**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                growth_df = pd.DataFrame({
                    'Month': months,
                    'Unlimited 5G': [7.8, 8.1, 8.3, 8.4, 8.5, 8.7],
                    'Essential 10GB': [5.9, 6.1, 6.2, 6.3, 6.3, 6.4],
                    'SIM Only': [2.4, 2.5, 2.6, 2.7, 2.8, 2.9]
                })
                growth_line = alt.Chart(growth_df).transform_fold(
                    ['Unlimited 5G', 'Essential 10GB', 'SIM Only'],
                    as_=['Plan', 'Subscribers']
                ).mark_line(point=True).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Subscribers:Q', title='Subscribers (M)'),
                    color=alt.Color('Plan:N', scale=alt.Scale(range=['#29B5E8', '#10B981', '#F59E0B'])),
                    tooltip=['Month:N', 'Plan:N', alt.Tooltip('Subscribers:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(growth_line, use_container_width=True)
        
        with perf_col2:
            st.markdown("**Churn Risk by Plan**")
            with st.container(border=True):
                churn_df = pd.DataFrame({
                    'Plan': ['Unlimited 5G', 'Essential 10GB', 'SIM Only', 'PAYG'],
                    'Risk': [1.8, 2.6, 3.2, 4.4]
                })
                churn_bar = alt.Chart(churn_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Risk:Q', title='Risk %'),
                    y=alt.Y('Plan:N', sort='-x', title=None),
                    color=alt.value('#EF4444'),
                    tooltip=['Plan:N', alt.Tooltip('Risk:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(churn_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Value & Usage Signals</div>', unsafe_allow_html=True)
        value_col1, value_col2 = st.columns(2)
        
        with value_col1:
            st.markdown("**Add-on Attachment Rate**")
            with st.container(border=True):
                add_on_df = pd.DataFrame({
                    'Add-on': ['Roaming', 'Streaming', 'Device Protect', 'Cloud'],
                    'Attach': [22, 18, 15, 10]
                })
                add_on_bar = alt.Chart(add_on_df).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Add-on:N', title=None),
                    y=alt.Y('Attach:Q', title='Attach %'),
                    color=alt.value('#6366F1'),
                    tooltip=['Add-on:N', alt.Tooltip('Attach:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(add_on_bar, use_container_width=True)
        
        with value_col2:
            st.markdown("**Data Utilization by Plan**")
            with st.container(border=True):
                util_df = pd.DataFrame({
                    'Plan': ['Unlimited 5G', 'Essential 10GB', 'SIM Only', 'PAYG'],
                    'Utilization': [78, 64, 58, 42]
                })
                util_bar = alt.Chart(util_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Utilization:Q', title='Utilization %'),
                    y=alt.Y('Plan:N', sort='-x', title=None),
                    color=alt.value('#14B8A6'),
                    tooltip=['Plan:N', alt.Tooltip('Utilization:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(util_bar, use_container_width=True)
        

    with tab_ops:
        st.markdown("""
        <style>
        @keyframes product-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 22px rgba(59,130,246,0.4); }
        }
        @keyframes product-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .product-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 1px solid #93C5FD;
            animation: product-ops-glow 3s ease-in-out infinite;
        }
        .product-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: product-ops-sweep 3s linear infinite;
        }
        .product-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .product-ops-title { font-weight: 700; color: #1E3A8A; }
        .product-ops-tag {
            background: rgba(59,130,246,0.2);
            color: #1E3A8A;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .product-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .product-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .product-ops-label { font-size: 0.7rem; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.06em; }
        .product-ops-value { font-size: 1.35rem; font-weight: 700; color: #1E3A8A; }
        .product-ops-delta { font-size: 0.75rem; color: #1E40AF; }
        @media (max-width: 900px) { .product-ops-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="product-ops-pulse">
            <div class="product-ops-header">
                <div class="product-ops-title">🧭 Product Ops Pulse</div>
                <div class="product-ops-tag">LIVE</div>
            </div>
            <div class="product-ops-grid">
                <div class="product-ops-card">
                    <div class="product-ops-label">Launches Q1</div>
                    <div class="product-ops-value">6</div>
                    <div class="product-ops-delta">2 in Feb</div>
                </div>
                <div class="product-ops-card">
                    <div class="product-ops-label">Roadmap On-Track</div>
                    <div class="product-ops-value">84%</div>
                    <div class="product-ops-delta">+6% vs last qtr</div>
                </div>
                <div class="product-ops-card">
                    <div class="product-ops-label">Active Price Tests</div>
                    <div class="product-ops-value">5</div>
                    <div class="product-ops-delta">2 enterprise</div>
                </div>
                <div class="product-ops-card">
                    <div class="product-ops-label">Backlog Health</div>
                    <div class="product-ops-value">92%</div>
                    <div class="product-ops-delta">Low risk</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Launch & Roadmap Operations</div>', unsafe_allow_html=True)
        road_col1, road_col2 = st.columns(2)
        
        with road_col1:
            st.markdown("**Feature Readiness**")
            with st.container(border=True):
                readiness_df = pd.DataFrame({
                    'Feature': ['Family Plan', '5G Bundles', 'IoT Starter', 'Biz Elite'],
                    'Readiness': [78, 86, 64, 72]
                })
                readiness_bar = alt.Chart(readiness_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Readiness:Q', title='Readiness %'),
                    y=alt.Y('Feature:N', sort='-x', title=None),
                    color=alt.value('#3B82F6'),
                    tooltip=['Feature:N', alt.Tooltip('Readiness:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(readiness_bar, use_container_width=True)
        
        with road_col2:
            st.markdown("**Release Cadence (Monthly)**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                release_df = pd.DataFrame({
                    'Month': months,
                    'Releases': [2, 3, 2, 4, 3, 5]
                })
                release_line = alt.Chart(release_df).mark_line(point=True, color='#10B981', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Releases:Q', title='Releases'),
                    tooltip=['Month:N', 'Releases:Q']
                ).properties(height=180)
                st.altair_chart(release_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Pricing & Experimentation</div>', unsafe_allow_html=True)
        price_col1, price_col2 = st.columns(2)
        
        with price_col1:
            st.markdown("**Promo Lift by Segment**")
            with st.container(border=True):
                lift_df = pd.DataFrame({
                    'Segment': ['Consumer', 'Family', 'SMB', 'Enterprise'],
                    'Lift': [12, 18, 9, 6]
                })
                lift_bar = alt.Chart(lift_df).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Segment:N', title=None),
                    y=alt.Y('Lift:Q', title='Lift %'),
                    color=alt.value('#F59E0B'),
                    tooltip=['Segment:N', alt.Tooltip('Lift:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(lift_bar, use_container_width=True)
        
        with price_col2:
            st.markdown("**Price Test Funnel**")
            with st.container(border=True):
                funnel_df = pd.DataFrame({
                    'Week': ['W1', 'W2', 'W3', 'W4', 'W5', 'W6'],
                    'Tested': [120, 115, 110, 108, 105, 104],
                    'Adopted': [45, 48, 52, 50, 53, 55],
                    'Rolled Back': [10, 9, 8, 7, 6, 6]
                })
                funnel_area = alt.Chart(funnel_df).transform_fold(
                    ['Tested', 'Adopted', 'Rolled Back'],
                    as_=['Stage', 'Count']
                ).mark_area(opacity=0.5).encode(
                    x=alt.X('Week:N', sort=['W1', 'W2', 'W3', 'W4', 'W5', 'W6'], title=None),
                    y=alt.Y('Count:Q', title='Experiments'),
                    color=alt.Color('Stage:N', scale=alt.Scale(range=['#60A5FA', '#22C55E', '#EF4444'])),
                    tooltip=['Stage:N', 'Count:Q']
                ).properties(height=180)
                st.altair_chart(funnel_area, use_container_width=True)
        
        st.markdown('<div class="section-header">Quality & Experience Signals</div>', unsafe_allow_html=True)
        qual_col1, qual_col2 = st.columns(2)
        
        with qual_col1:
            st.markdown("**NPS by Plan**")
            with st.container(border=True):
                nps_df = pd.DataFrame({
                    'Plan': ['Unlimited 5G', 'Essential 10GB', 'SIM Only', 'PAYG'],
                    'NPS': [42, 36, 31, 24]
                })
                nps_bar = alt.Chart(nps_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('NPS:Q', title='NPS'),
                    y=alt.Y('Plan:N', sort='-x', title=None),
                    color=alt.value('#8B5CF6'),
                    tooltip=['Plan:N', 'NPS:Q']
                ).properties(height=180)
                st.altair_chart(nps_bar, use_container_width=True)
        
        with qual_col2:
            st.markdown("**Defect Escape Rate**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                defect_df = pd.DataFrame({
                    'Month': months,
                    'Escape': [3.8, 3.4, 3.2, 2.9, 2.7, 2.6]
                })
                defect_line = alt.Chart(defect_df).mark_line(point=True, color='#EF4444', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Escape:Q', title='Rate %'),
                    tooltip=['Month:N', alt.Tooltip('Escape:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(defect_line, use_container_width=True)
    
    with tab_strategy:
        st.markdown("""
        <style>
        .prod-ai-pulse {
            background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
            border-radius: 16px;
            border: 1px solid #BAE6FD;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .prod-ai-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(41,181,232,0.18), transparent);
            animation: prod-ai-sweep 4s ease-in-out infinite;
        }
        @keyframes prod-ai-sweep {
            0% { left: -120%; }
            100% { left: 220%; }
        }
        .prod-ai-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .prod-ai-title { font-weight: 700; color: #0C4A6E; font-size: 1.05rem; }
        .prod-ai-tag { background: #0EA5E9; color: white; font-size: 0.75rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 999px; }
        .prod-ai-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; position: relative; z-index: 1; }
        .prod-ai-card { background: white; border-radius: 12px; border: 1px solid #E2E8F0; padding: 0.9rem 1rem; }
        .prod-ai-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9CA3AF; }
        .prod-ai-value { font-size: 1.4rem; font-weight: 700; color: #0C4A6E; }
        .prod-ai-sub { font-size: 0.8rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) { .prod-ai-grid { grid-template-columns: 1fr; } }
        </style>
        <div class="prod-ai-pulse">
            <div class="prod-ai-header">
                <div class="prod-ai-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="prod-ai-tag">AI LIVE</div>
            </div>
            <div class="prod-ai-grid">
                <div class="prod-ai-card">
                    <div class="prod-ai-label">Portfolio Health</div>
                    <div class="prod-ai-value">84%</div>
                    <div class="prod-ai-sub">Plans above target</div>
                </div>
                <div class="prod-ai-card">
                    <div class="prod-ai-label">5G Migration</div>
                    <div class="prod-ai-value">+8%</div>
                    <div class="prod-ai-sub">MoM uplift</div>
                </div>
                <div class="prod-ai-card">
                    <div class="prod-ai-label">Price Elasticity</div>
                    <div class="prod-ai-value">1.12</div>
                    <div class="prod-ai-sub">Low churn risk</div>
                </div>
                <div class="prod-ai-card">
                    <div class="prod-ai-label">Launch Velocity</div>
                    <div class="prod-ai-value">5.2/wk</div>
                    <div class="prod-ai-sub">Best quarter</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Summary synthesized from plan performance, pricing, and adoption signals.")
        
        with st.container(border=True):
            st.markdown("""
            **Executive Summary (Q1 2026):**
            - **5G adoption** reached **42%**, with strongest growth in Unlimited 5G plans.
            - **ARPU uplift** is tracking +£2.10 MoM, driven by add-on attachment.
            - **Churn risk** remains elevated in PAYG; targeted migration offers recommended.
            """)
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Unlimited 5G** contributes 33% of net adds
                - **Streaming add-ons** lead attachment at 18%
                - **Family plans** show highest NPS lift
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **PAYG churn** 4.4% with price sensitivity
                - **SIM-only** NPS trails by 11 points
                - **Release defects** above target in Dec
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Growth Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **SMB promo lift** +9% in Q1
                - **5G bundles** outperform targets by 6%
                - **IoT starter** shows 12% adoption potential
                """)
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                - **Accelerate 5G migrations** using family plan incentives
                - Expand targeted offers in high-churn regions
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                - **Reprice PAYG** to reduce churn sensitivity
                - Test add-on bundles to lift ARPU by £1.50
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                - **Improve release quality** via staged rollouts
                - Prioritize roadmap items with NPS impact
                """)
        
        st.markdown('<div class="section-header">VP Product Management Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">5G Adoption 50%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **42%** on 5G
                - Gap: **8%** to target
                - Action: Migration offers
                - Campaign: March 2026
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">ARPU £46</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **£43.60** ARPU
                - Gap: **£2.40** to target
                - Action: Value upselling
                - Focus: SIM Only to PM
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Family Plan Launch</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Target: **2,000** signups
                - Launch: February 2026
                - Pricing: **£35**/line
                - Revenue: **£840K** projected
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What is our mobile plan portfolio?", "Which plans have the most subscribers?", "What's our 5G adoption rate by segment?", "How do our prices compare to competitors?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_vp_procurement():
    import pandas as pd
    import altair as alt
    
    st.markdown("""
    <div class="main-header">
        <h1>VP Procurement Dashboard</h1>
        <p>Vendor Spend, Supplier Management & Cost Optimization</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_ops, tab_strategy = st.tabs(["📊 Overview & Analysis", "🧾 Procurement Operations", "❄️ Snowflake Intelligence"])

    with tab_overview:
        
        views_html = " ".join([f'<span class="semantic-view-badge">{v}</span>' for v in ['FINANCE', 'ASSET']])
        st.markdown(f'<div style="margin-bottom: 1.5rem;">{views_html}</div>', unsafe_allow_html=True)
        
        # VP PROCUREMENT - SPEND TRACKER ANIMATION
        st.markdown("""
        <style>
        @keyframes proc-fill { 0% { width: 0; } 100% { width: var(--fill-width); } }
        @keyframes proc-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes proc-coin { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .proc-spend { background: linear-gradient(135deg, #065F46 0%, #059669 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .proc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .proc-title { color: white; font-size: 1.1rem; font-weight: 600; }
        .proc-total { text-align: right; }
        .proc-total-val { color: white; font-size: 1.8rem; font-weight: 700; animation: proc-pulse 2s ease-in-out infinite; }
        .proc-total-label { color: rgba(255,255,255,0.6); font-size: 0.65rem; }
        .proc-bars { display: flex; flex-direction: column; gap: 0.6rem; margin-bottom: 1rem; }
        .proc-bar-item { display: flex; align-items: center; gap: 0.75rem; }
        .proc-bar-label { color: rgba(255,255,255,0.8); font-size: 0.7rem; width: 80px; }
        .proc-bar-track { flex: 1; height: 20px; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        .proc-bar-fill { height: 100%; border-radius: 10px; animation: proc-fill 1.5s ease-out forwards; }
        .proc-bar-fill.network { background: linear-gradient(90deg, #10B981, #34D399); --fill-width: 75%; }
        .proc-bar-fill.it { background: linear-gradient(90deg, #3B82F6, #60A5FA); --fill-width: 55%; }
        .proc-bar-fill.services { background: linear-gradient(90deg, #F59E0B, #FBBF24); --fill-width: 40%; }
        .proc-bar-fill.other { background: linear-gradient(90deg, #8B5CF6, #A78BFA); --fill-width: 30%; }
        .proc-bar-val { color: white; font-size: 0.75rem; font-weight: 600; width: 50px; text-align: right; }
        .proc-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; }
        .proc-stat { background: rgba(255,255,255,0.1); border-radius: 8px; padding: 0.6rem; text-align: center; }
        .proc-stat-icon { font-size: 1rem; animation: proc-coin 2s ease-in-out infinite; display: inline-block; }
        .proc-stat-val { color: white; font-size: 1rem; font-weight: 700; }
        .proc-stat-label { color: rgba(255,255,255,0.6); font-size: 0.6rem; text-transform: uppercase; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="proc-spend"><div class="proc-header"><div class="proc-title">💰 Procurement Spend Tracker</div><div class="proc-total"><div class="proc-total-val">£108M</div><div class="proc-total-label">Annual Spend</div></div></div><div class="proc-bars"><div class="proc-bar-item"><span class="proc-bar-label">Network Infra</span><div class="proc-bar-track"><div class="proc-bar-fill network"></div></div><span class="proc-bar-val">£42M</span></div><div class="proc-bar-item"><span class="proc-bar-label">IT Systems</span><div class="proc-bar-track"><div class="proc-bar-fill it"></div></div><span class="proc-bar-val">£28M</span></div><div class="proc-bar-item"><span class="proc-bar-label">Services</span><div class="proc-bar-track"><div class="proc-bar-fill services"></div></div><span class="proc-bar-val">£24M</span></div><div class="proc-bar-item"><span class="proc-bar-label">Other</span><div class="proc-bar-track"><div class="proc-bar-fill other"></div></div><span class="proc-bar-val">£14M</span></div></div><div class="proc-stats"><div class="proc-stat"><div class="proc-stat-icon">🤝</div><div class="proc-stat-val">248</div><div class="proc-stat-label">Vendors</div></div><div class="proc-stat"><div class="proc-stat-icon">📋</div><div class="proc-stat-val">42</div><div class="proc-stat-label">Pending</div></div><div class="proc-stat"><div class="proc-stat-icon">💵</div><div class="proc-stat-val">£2.4M</div><div class="proc-stat-label">Savings YTD</div></div><div class="proc-stat"><div class="proc-stat-icon">📊</div><div class="proc-stat-val">94%</div><div class="proc-stat-label">On Contract</div></div></div></div>""", unsafe_allow_html=True)
        
        st.markdown("""
        <style>
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .kpi-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; position: relative; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); }
        .kpi-label { font-size: 0.8rem; color: #6B7280; text-transform: uppercase; margin-bottom: 0.25rem; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: #1B2A4E; }
        .kpi-delta { font-size: 0.85rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 20px; margin-top: 0.5rem; display: inline-flex; }
        .kpi-delta.positive { background: #D1FAE5; color: #059669; }
        .kpi-delta.negative { background: #FEE2E2; color: #DC2626; }
        .kpi-icon { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; opacity: 0.3; }
        </style>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Procurement Overview</div>', unsafe_allow_html=True)
        st.markdown("""
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #29B5E8;">
                <div class="kpi-icon">💰</div>
                <div class="kpi-label">Annual Spend</div>
                <div class="kpi-value">£108M</div>
                <div class="kpi-delta positive">YTD tracked</div>
            </div>
            <div class="kpi-card" style="--accent: #10B981;">
                <div class="kpi-icon">🤝</div>
                <div class="kpi-label">Active Vendors</div>
                <div class="kpi-value">248</div>
                <div class="kpi-delta positive">Under contract</div>
            </div>
            <div class="kpi-card" style="--accent: #F59E0B;">
                <div class="kpi-icon">📋</div>
                <div class="kpi-label">Pending Approvals</div>
                <div class="kpi-value">42</div>
                <div class="kpi-delta negative">£2.4M value</div>
            </div>
            <div class="kpi-card" style="--accent: #8B5CF6;">
                <div class="kpi-icon">💹</div>
                <div class="kpi-label">Savings Identified</div>
                <div class="kpi-value">£2.1M</div>
                <div class="kpi-delta positive">Optimization opp.</div>
            </div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="--accent: #14B8A6;">
                <div class="kpi-icon">🏗️</div>
                <div class="kpi-label">Network/Tech</div>
                <div class="kpi-value">70%</div>
                <div class="kpi-delta positive">£75.6M spend</div>
            </div>
            <div class="kpi-card" style="--accent: #EC4899;">
                <div class="kpi-icon">🏢</div>
                <div class="kpi-label">Facilities</div>
                <div class="kpi-value">15%</div>
                <div class="kpi-delta positive">£16.2M spend</div>
            </div>
            <div class="kpi-card" style="--accent: #6366F1;">
                <div class="kpi-icon">💼</div>
                <div class="kpi-label">Professional Svcs</div>
                <div class="kpi-value">10%</div>
                <div class="kpi-delta positive">£10.8M spend</div>
            </div>
            <div class="kpi-card" style="--accent: #EF4444;">
                <div class="kpi-icon">⚠️</div>
                <div class="kpi-label">Emergency POs</div>
                <div class="kpi-value">8%</div>
                <div class="kpi-delta negative">Above 5% target</div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # New: Spend Trend and Contract Renewals
        spend_trend_col, renewal_col = st.columns(2)
        
        with spend_trend_col:
            st.markdown('<div class="section-header">Spend Trend (12 Months)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <svg viewBox="0 0 400 140" style="width: 100%; height: 160px;">
                    <!-- Network line (blue) - values 6.2-6.6 scaled -->
                    <polyline points="20,35 50,25 80,40 110,15 140,30 170,25 200,35 230,15 260,25 290,10 320,15 350,30" 
                        fill="none" stroke="#29B5E8" stroke-width="2"/>
                    <!-- Facilities line (green) - values 1.3-1.4 scaled -->
                    <polyline points="20,95 50,90 80,95 110,90 140,95 170,90 200,95 230,90 260,95 290,90 320,90 350,92" 
                        fill="none" stroke="#10B981" stroke-width="2"/>
                    <!-- Services line (amber) - values 0.8-0.92 scaled -->
                    <polyline points="20,115 50,110 80,112 110,110 140,111 170,108 200,112 230,110 260,111 290,108 320,110 350,110" 
                        fill="none" stroke="#F59E0B" stroke-width="2"/>
                    <!-- X-axis labels -->
                    <text x="20" y="135" font-size="8" fill="#6B7280" text-anchor="middle">Feb</text>
                    <text x="80" y="135" font-size="8" fill="#6B7280" text-anchor="middle">Apr</text>
                    <text x="140" y="135" font-size="8" fill="#6B7280" text-anchor="middle">Jun</text>
                    <text x="200" y="135" font-size="8" fill="#6B7280" text-anchor="middle">Aug</text>
                    <text x="260" y="135" font-size="8" fill="#6B7280" text-anchor="middle">Oct</text>
                    <text x="320" y="135" font-size="8" fill="#6B7280" text-anchor="middle">Dec</text>
                </svg>
                <div style="display: flex; justify-content: center; gap: 1rem; font-size: 0.75rem;">
                    <span><span style="color: #29B5E8;">—</span> Network (£6.3M)</span>
                    <span><span style="color: #10B981;">—</span> Facilities (£1.4M)</span>
                    <span><span style="color: #F59E0B;">—</span> Services (£0.9M)</span>
                </div>
                """, unsafe_allow_html=True)
        
        with renewal_col:
            st.markdown('<div class="section-header">Contract Renewals (Next 6 Mo)</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 140px; padding: 1rem 0;">
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #EF4444; width: 80px; height: 100px; margin: 0 auto; border-radius: 6px 6px 0 0;"></div>
                        <div style="font-weight: 600; margin-top: 0.5rem;">£28.4M</div>
                        <div style="font-size: 0.8rem; color: #6B7280;">Q1 2026</div>
                        <div style="font-size: 0.7rem; color: #9CA3AF;">8 contracts</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #F59E0B; width: 80px; height: 64px; margin: 0 auto; border-radius: 6px 6px 0 0;"></div>
                        <div style="font-weight: 600; margin-top: 0.5rem;">£18.2M</div>
                        <div style="font-size: 0.8rem; color: #6B7280;">Q2 2026</div>
                        <div style="font-size: 0.7rem; color: #9CA3AF;">12 contracts</div>
                    </div>
                </div>
                <div style="text-align: center; font-size: 0.75rem; color: #DC2626;"><strong>Ericsson</strong> renewal (£24.2M) in March 2026</div>
                """, unsafe_allow_html=True)
        
        col_left, col_right = st.columns([1.3, 1])
        
        with col_left:
            st.markdown('<div class="section-header">Top Vendors by Spend</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Ericsson</span><span style="font-weight: 600;">£24.2M (12)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Nokia</span><span style="font-weight: 600;">£18.4M (8)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 76%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Cisco</span><span style="font-weight: 600;">£12.8M (15)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 53%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 0.6rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>AWS</span><span style="font-weight: 600;">£8.4M (6)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 35%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                            <span>Microsoft</span><span style="font-weight: 600;">£6.2M (18)</span>
                        </div>
                        <div style="background: #E5E7EB; border-radius: 4px; height: 18px;">
                            <div style="background: #29B5E8; width: 26%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with col_right:
            st.markdown('<div class="section-header">Savings Opportunities</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Vendor Consolidation</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">£840K</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Contract Renegotiation</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">£620K</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Volume Discounts</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">£420K</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span>Process Efficiency</span>
                        <span style="background: #D1FAE5; color: #065F46; padding: 0.2rem 0.5rem; border-radius: 12px;">£220K</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Supplier & Process Signals</div>', unsafe_allow_html=True)
        sig_col1, sig_col2 = st.columns(2)
        
        with sig_col1:
            st.markdown("**Supplier Performance Score**")
            with st.container(border=True):
                perf_df = pd.DataFrame({
                    'Supplier': ['Ericsson', 'Nokia', 'Cisco', 'AWS'],
                    'Score': [92, 88, 85, 90]
                })
                perf_bar = alt.Chart(perf_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Score:Q', title='Score'),
                    y=alt.Y('Supplier:N', sort='-x', title=None),
                    color=alt.value('#10B981'),
                    tooltip=['Supplier:N', 'Score:Q']
                ).properties(height=180)
                st.altair_chart(perf_bar, use_container_width=True)
        
        with sig_col2:
            st.markdown("**PO Cycle Time (Days)**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                cycle_df = pd.DataFrame({
                    'Month': months,
                    'Days': [12.4, 11.8, 11.2, 10.6, 10.2, 9.6]
                })
                cycle_line = alt.Chart(cycle_df).mark_line(point=True, color='#3B82F6', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Days:Q', title='Days'),
                    tooltip=['Month:N', alt.Tooltip('Days:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(cycle_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Risk & Compliance Signals</div>', unsafe_allow_html=True)
        risk_col1, risk_col2 = st.columns(2)
        
        with risk_col1:
            st.markdown("**Contract Compliance Rate**")
            with st.container(border=True):
                comp_df = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Compliance': [91, 92, 93, 94, 93, 94]
                })
                comp_line = alt.Chart(comp_df).mark_line(point=True, color='#14B8A6', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None),
                    y=alt.Y('Compliance:Q', title='Compliance %', scale=alt.Scale(domain=[88, 100])),
                    tooltip=['Month:N', alt.Tooltip('Compliance:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(comp_line, use_container_width=True)
        
        with risk_col2:
            st.markdown("**Supplier Risk Tier Mix**")
            with st.container(border=True):
                risk_df = pd.DataFrame({
                    'Tier': ['Tier 1', 'Tier 2', 'Tier 3'],
                    'Share': [58, 28, 14]
                })
                risk_arc = alt.Chart(risk_df).mark_arc(innerRadius=50).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Tier:N', legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Tier:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=190)
                st.altair_chart(risk_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Spend Variance & Concentration</div>', unsafe_allow_html=True)
        var_col1, var_col2 = st.columns(2)
        
        with var_col1:
            st.markdown("**Category Spend Variance**")
            with st.container(border=True):
                var_df = pd.DataFrame({
                    'Category': ['Network', 'IT', 'Facilities', 'Services'],
                    'Variance': [4.2, -1.6, 2.1, -0.8]
                })
                var_bar = alt.Chart(var_df).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Category:N', title=None),
                    y=alt.Y('Variance:Q', title='Variance %'),
                    color=alt.condition(
                        alt.datum.Variance >= 0,
                        alt.value('#EF4444'),
                        alt.value('#10B981')
                    ),
                    tooltip=['Category:N', alt.Tooltip('Variance:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(var_bar, use_container_width=True)
        
        with var_col2:
            st.markdown("**Vendor Concentration Index**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                hhi_df = pd.DataFrame({
                    'Month': months,
                    'HHI': [0.28, 0.29, 0.30, 0.31, 0.30, 0.29]
                })
                hhi_line = alt.Chart(hhi_df).mark_line(point=True, color='#6366F1', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('HHI:Q', title='HHI'),
                    tooltip=['Month:N', alt.Tooltip('HHI:Q', format='.2f')]
                ).properties(height=180)
                st.altair_chart(hhi_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Invoice & Payment Accuracy</div>', unsafe_allow_html=True)
        inv_col1, inv_col2 = st.columns(2)
        
        with inv_col1:
            st.markdown("**Invoice Exception Rate**")
            with st.container(border=True):
                exc_df = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Rate': [4.1, 3.8, 3.5, 3.2, 3.0, 2.8]
                })
                exc_line = alt.Chart(exc_df).mark_line(point=True, color='#F59E0B', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None),
                    y=alt.Y('Rate:Q', title='Exception %'),
                    tooltip=['Month:N', alt.Tooltip('Rate:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(exc_line, use_container_width=True)
        
        with inv_col2:
            st.markdown("**Payment Timeliness**")
            with st.container(border=True):
                pay_df = pd.DataFrame({
                    'Status': ['On Time', '1-5 Days', '6-15 Days', '15+ Days'],
                    'Share': [72, 16, 8, 4]
                })
                pay_bar = alt.Chart(pay_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Share:Q', title='Share %'),
                    y=alt.Y('Status:N', sort='-x', title=None),
                    color=alt.value('#3B82F6'),
                    tooltip=['Status:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(pay_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Diversity & Discount Signals</div>', unsafe_allow_html=True)
        div_col1, div_col2 = st.columns(2)
        
        with div_col1:
            st.markdown("**Supplier Diversity Mix**")
            with st.container(border=True):
                div_df = pd.DataFrame({
                    'Type': ['SME', 'Minority-owned', 'Women-owned', 'Other'],
                    'Share': [46, 18, 14, 22]
                })
                div_arc = alt.Chart(div_df).mark_arc(innerRadius=50).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Type:N', legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Type:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=190)
                st.altair_chart(div_arc, use_container_width=True)
        
        with div_col2:
            st.markdown("**Early Payment Discount Uptake**")
            with st.container(border=True):
                disc_df = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Uptake': [22, 24, 26, 28, 29, 31]
                })
                disc_line = alt.Chart(disc_df).mark_line(point=True, color='#0EA5E9', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None),
                    y=alt.Y('Uptake:Q', title='Uptake %'),
                    tooltip=['Month:N', alt.Tooltip('Uptake:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(disc_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Budget & Forecast Signals</div>', unsafe_allow_html=True)
        bud_col1, bud_col2 = st.columns(2)
        
        with bud_col1:
            st.markdown("**Budget vs Actual Spend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                bud_df = pd.DataFrame({
                    'Month': months,
                    'Budget': [8.1, 8.0, 8.2, 8.1, 8.3, 8.4],
                    'Actual': [8.2, 8.1, 8.3, 8.4, 8.5, 8.6]
                })
                bud_line = alt.Chart(bud_df).transform_fold(
                    ['Budget', 'Actual'],
                    as_=['Type', 'Value']
                ).mark_line(point=True).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Value:Q', title='£M'),
                    color=alt.Color('Type:N', scale=alt.Scale(range=['#10B981', '#EF4444'])),
                    tooltip=['Month:N', 'Type:N', alt.Tooltip('Value:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(bud_line, use_container_width=True)
        
        with bud_col2:
            st.markdown("**Forecast Accuracy**")
            with st.container(border=True):
                acc_df = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'Accuracy': [92, 93, 94, 95, 94, 95]
                })
                acc_bar = alt.Chart(acc_df).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Month:N', title=None, sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']),
                    y=alt.Y('Accuracy:Q', title='Accuracy %'),
                    color=alt.value('#10B981'),
                    tooltip=['Month:N', alt.Tooltip('Accuracy:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(acc_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Supplier Diversity by Region</div>', unsafe_allow_html=True)
        divr_col1, divr_col2 = st.columns(2)
        
        with divr_col1:
            st.markdown("**Diversity Share by Region**")
            with st.container(border=True):
                region_df = pd.DataFrame({
                    'Region': ['UK', 'EU', 'US', 'APAC'],
                    'Diverse': [32, 28, 24, 26],
                    'Non-Diverse': [68, 72, 76, 74]
                })
                region_long = region_df.melt('Region', var_name='Type', value_name='Share')
                region_bar = alt.Chart(region_long).mark_bar().encode(
                    x=alt.X('Region:N', title=None),
                    y=alt.Y('Share:Q', title='Share %', stack='normalize'),
                    color=alt.Color('Type:N', scale=alt.Scale(range=['#22C55E', '#CBD5F5']), legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Region:N', 'Type:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(region_bar, use_container_width=True)
        
        with divr_col2:
            st.markdown("**Diverse Supplier Growth**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                div_growth_df = pd.DataFrame({
                    'Month': months,
                    'Suppliers': [82, 85, 88, 90, 92, 95]
                })
                div_growth_line = alt.Chart(div_growth_df).mark_line(point=True, color='#16A34A', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Suppliers:Q', title='Suppliers'),
                    tooltip=['Month:N', 'Suppliers:Q']
                ).properties(height=180)
                st.altair_chart(div_growth_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Payment Terms Distribution</div>', unsafe_allow_html=True)
        terms_col1, terms_col2 = st.columns(2)
        
        with terms_col1:
            st.markdown("**Terms Mix**")
            with st.container(border=True):
                terms_df = pd.DataFrame({
                    'Terms': ['Net 15', 'Net 30', 'Net 45', 'Net 60'],
                    'Share': [18, 44, 26, 12]
                })
                terms_bar = alt.Chart(terms_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Share:Q', title='Share %'),
                    y=alt.Y('Terms:N', sort='-x', title=None),
                    color=alt.value('#0EA5E9'),
                    tooltip=['Terms:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(terms_bar, use_container_width=True)
        
        with terms_col2:
            st.markdown("**Average Days Payable**")
            with st.container(border=True):
                dpo_df = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    'DPO': [33, 34, 35, 36, 35, 36]
                })
                dpo_line = alt.Chart(dpo_df).mark_line(point=True, color='#2563EB', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None),
                    y=alt.Y('DPO:Q', title='Days'),
                    tooltip=['Month:N', 'DPO:Q']
                ).properties(height=180)
                st.altair_chart(dpo_line, use_container_width=True)
        

    with tab_ops:
        st.markdown("""
        <style>
        @keyframes proc-ops-glow {
            0%, 100% { box-shadow: 0 0 12px rgba(16,185,129,0.2); }
            50% { box-shadow: 0 0 22px rgba(16,185,129,0.4); }
        }
        @keyframes proc-ops-sweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .proc-ops-pulse {
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #DCFCE7 0%, #BBF7D0 100%);
            border: 1px solid #86EFAC;
            animation: proc-ops-glow 3s ease-in-out infinite;
        }
        .proc-ops-pulse::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: proc-ops-sweep 3s linear infinite;
        }
        .proc-ops-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .proc-ops-title { font-weight: 700; color: #065F46; }
        .proc-ops-tag {
            background: rgba(16,185,129,0.2);
            color: #065F46;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .proc-ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        .proc-ops-card {
            background: rgba(255,255,255,0.85);
            border-radius: 10px;
            padding: 0.75rem 0.85rem;
            border: 1px solid rgba(16,185,129,0.2);
        }
        .proc-ops-label { font-size: 0.7rem; color: #047857; text-transform: uppercase; letter-spacing: 0.06em; }
        .proc-ops-value { font-size: 1.35rem; font-weight: 700; color: #065F46; }
        .proc-ops-delta { font-size: 0.75rem; color: #047857; }
        @media (max-width: 900px) { .proc-ops-grid { grid-template-columns: repeat(2, 1fr); } }
        </style>
        <div class="proc-ops-pulse">
            <div class="proc-ops-header">
                <div class="proc-ops-title">🧾 Procurement Ops Pulse</div>
                <div class="proc-ops-tag">LIVE</div>
            </div>
            <div class="proc-ops-grid">
                <div class="proc-ops-card">
                    <div class="proc-ops-label">Approvals SLA</div>
                    <div class="proc-ops-value">93%</div>
                    <div class="proc-ops-delta">+4% MoM</div>
                </div>
                <div class="proc-ops-card">
                    <div class="proc-ops-label">Pending PO Value</div>
                    <div class="proc-ops-value">£2.4M</div>
                    <div class="proc-ops-delta">42 requests</div>
                </div>
                <div class="proc-ops-card">
                    <div class="proc-ops-label">Savings Realized</div>
                    <div class="proc-ops-value">£1.6M</div>
                    <div class="proc-ops-delta">YTD</div>
                </div>
                <div class="proc-ops-card">
                    <div class="proc-ops-label">Emergency POs</div>
                    <div class="proc-ops-value">8%</div>
                    <div class="proc-ops-delta">Above target</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">Approval & Sourcing Flow</div>', unsafe_allow_html=True)
        flow_col1, flow_col2 = st.columns(2)
        
        with flow_col1:
            st.markdown("**Approval Backlog by Stage**")
            with st.container(border=True):
                backlog_df = pd.DataFrame({
                    'Stage': ['Intake', 'Finance', 'Legal', 'Final'],
                    'Count': [14, 12, 9, 7]
                })
                backlog_bar = alt.Chart(backlog_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Count:Q', title='Requests'),
                    y=alt.Y('Stage:N', sort='-x', title=None),
                    color=alt.value('#22C55E'),
                    tooltip=['Stage:N', 'Count:Q']
                ).properties(height=180)
                st.altair_chart(backlog_bar, use_container_width=True)
        
        with flow_col2:
            st.markdown("**Sourcing Cycle (Days)**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                sourcing_df = pd.DataFrame({
                    'Month': months,
                    'Days': [28, 26, 24, 23, 22, 21]
                })
                sourcing_line = alt.Chart(sourcing_df).mark_line(point=True, color='#059669', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Days:Q', title='Days'),
                    tooltip=['Month:N', alt.Tooltip('Days:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(sourcing_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Vendor Performance & Risk Ops</div>', unsafe_allow_html=True)
        ops_col1, ops_col2 = st.columns(2)
        
        with ops_col1:
            st.markdown("**Vendor SLA Adherence**")
            with st.container(border=True):
                sla_df = pd.DataFrame({
                    'Vendor': ['Ericsson', 'Nokia', 'Cisco', 'AWS'],
                    'SLA': [96, 94, 92, 95]
                })
                sla_bar = alt.Chart(sla_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('SLA:Q', title='SLA %'),
                    y=alt.Y('Vendor:N', sort='-x', title=None),
                    color=alt.value('#3B82F6'),
                    tooltip=['Vendor:N', alt.Tooltip('SLA:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(sla_bar, use_container_width=True)
        
        with ops_col2:
            st.markdown("**Contract Renewal Risk (90 Days)**")
            with st.container(border=True):
                risk_df = pd.DataFrame({
                    'Vendor': ['Ericsson', 'Nokia', 'Cisco', 'AWS'],
                    'Risk': [72, 38, 44, 30]
                })
                risk_bar = alt.Chart(risk_df).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Vendor:N', title=None),
                    y=alt.Y('Risk:Q', title='Risk %'),
                    color=alt.value('#EF4444'),
                    tooltip=['Vendor:N', alt.Tooltip('Risk:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(risk_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Savings Pipeline</div>', unsafe_allow_html=True)
        save_col1, save_col2 = st.columns(2)
        
        with save_col1:
            st.markdown("**Savings by Initiative**")
            with st.container(border=True):
                save_df = pd.DataFrame({
                    'Initiative': ['Consolidation', 'Renegotiation', 'Volume', 'Process'],
                    'Savings': [0.84, 0.62, 0.42, 0.22]
                })
                save_bar = alt.Chart(save_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Savings:Q', title='Savings (£M)'),
                    y=alt.Y('Initiative:N', sort='-x', title=None),
                    color=alt.value('#F59E0B'),
                    tooltip=['Initiative:N', alt.Tooltip('Savings:Q', format='.2f')]
                ).properties(height=180)
                st.altair_chart(save_bar, use_container_width=True)
        
        with save_col2:
            st.markdown("**Savings Run-Rate (Monthly)**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                run_df = pd.DataFrame({
                    'Month': months,
                    'Savings': [0.12, 0.16, 0.2, 0.22, 0.26, 0.3]
                })
                run_line = alt.Chart(run_df).mark_line(point=True, color='#F59E0B', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Savings:Q', title='£M'),
                    tooltip=['Month:N', alt.Tooltip('Savings:Q', format='.2f')]
                ).properties(height=180)
                st.altair_chart(run_line, use_container_width=True)
        
        st.markdown('<div class="section-header">Sourcing & Contract Ops</div>', unsafe_allow_html=True)
        src_col1, src_col2 = st.columns(2)
        
        with src_col1:
            st.markdown("**RFX Win Rate**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                win_df = pd.DataFrame({
                    'Month': months,
                    'WinRate': [48, 52, 55, 57, 60, 62]
                })
                win_line = alt.Chart(win_df).mark_line(point=True, color='#22C55E', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('WinRate:Q', title='Win %'),
                    tooltip=['Month:N', alt.Tooltip('WinRate:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(win_line, use_container_width=True)
        
        with src_col2:
            st.markdown("**Contract Coverage by Category**")
            with st.container(border=True):
                cov_df = pd.DataFrame({
                    'Category': ['Network', 'IT', 'Facilities', 'Services'],
                    'Coverage': [95, 92, 88, 86]
                })
                cov_bar = alt.Chart(cov_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Coverage:Q', title='Coverage %'),
                    y=alt.Y('Category:N', sort='-x', title=None),
                    color=alt.value('#0EA5E9'),
                    tooltip=['Category:N', alt.Tooltip('Coverage:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(cov_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Quality & Compliance Ops</div>', unsafe_allow_html=True)
        qc_col1, qc_col2 = st.columns(2)
        
        with qc_col1:
            st.markdown("**Audit Findings Trend**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                audit_df = pd.DataFrame({
                    'Month': months,
                    'Findings': [9, 8, 10, 7, 6, 5]
                })
                audit_line = alt.Chart(audit_df).mark_line(point=True, color='#F97316', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Findings:Q', title='Findings'),
                    tooltip=['Month:N', 'Findings:Q']
                ).properties(height=180)
                st.altair_chart(audit_line, use_container_width=True)
        
        with qc_col2:
            st.markdown("**Invoice Exception Mix**")
            with st.container(border=True):
                exc_df = pd.DataFrame({
                    'Type': ['Price', 'Quantity', 'PO Mismatch', 'Tax'],
                    'Share': [34, 28, 22, 16]
                })
                exc_arc = alt.Chart(exc_df).mark_arc(innerRadius=50).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Type:N', legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Type:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=190)
                st.altair_chart(exc_arc, use_container_width=True)
        
        st.markdown('<div class="section-header">Contract Leakage Hotspots</div>', unsafe_allow_html=True)
        leak_col1, leak_col2 = st.columns(2)
        
        with leak_col1:
            st.markdown("**Leakage Heatmap**")
            with st.container(border=True):
                leak_df = pd.DataFrame({
                    'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'] * 4,
                    'Category': ['Network'] * 6 + ['IT'] * 6 + ['Facilities'] * 6 + ['Services'] * 6,
                    'Leakage': [2.2, 2.4, 2.6, 2.1, 1.9, 1.7, 1.4, 1.5, 1.7, 1.3, 1.2, 1.1, 0.9, 1.1, 1.0, 0.8, 0.7, 0.6, 1.2, 1.3, 1.4, 1.1, 1.0, 0.9]
                })
                leak_heat = alt.Chart(leak_df).mark_rect().encode(
                    x=alt.X('Month:N', title=None, sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']),
                    y=alt.Y('Category:N', title=None),
                    color=alt.Color('Leakage:Q', scale=alt.Scale(scheme='oranges')),
                    tooltip=['Category:N', 'Month:N', alt.Tooltip('Leakage:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(leak_heat, use_container_width=True)
        
        with leak_col2:
            st.markdown("**Leakage by Category**")
            with st.container(border=True):
                leak_cat_df = pd.DataFrame({
                    'Category': ['Network', 'IT', 'Facilities', 'Services'],
                    'Leakage': [12.9, 8.2, 5.1, 7.0]
                })
                leak_bar = alt.Chart(leak_cat_df).mark_bar(cornerRadiusTopRight=6, cornerRadiusBottomRight=6).encode(
                    x=alt.X('Leakage:Q', title='Leakage (£M)'),
                    y=alt.Y('Category:N', sort='-x', title=None),
                    color=alt.value('#F97316'),
                    tooltip=['Category:N', alt.Tooltip('Leakage:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(leak_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Automation & Throughput</div>', unsafe_allow_html=True)
        auto_col1, auto_col2 = st.columns(2)
        
        with auto_col1:
            st.markdown("**PO Automation Rate**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                auto_df = pd.DataFrame({
                    'Month': months,
                    'Automation': [62, 64, 66, 69, 71, 73]
                })
                auto_line = alt.Chart(auto_df).mark_line(point=True, color='#22C55E', strokeWidth=2).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Automation:Q', title='Automation %'),
                    tooltip=['Month:N', alt.Tooltip('Automation:Q', format='.0f')]
                ).properties(height=180)
                st.altair_chart(auto_line, use_container_width=True)
        
        with auto_col2:
            st.markdown("**Requisition Throughput**")
            with st.container(border=True):
                thr_df = pd.DataFrame({
                    'Week': ['W1', 'W2', 'W3', 'W4', 'W5', 'W6'],
                    'Processed': [58, 62, 60, 65, 68, 72]
                })
                thr_bar = alt.Chart(thr_df).mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6).encode(
                    x=alt.X('Week:N', title=None),
                    y=alt.Y('Processed:Q', title='Requests'),
                    color=alt.value('#6366F1'),
                    tooltip=['Week:N', 'Processed:Q']
                ).properties(height=180)
                st.altair_chart(thr_bar, use_container_width=True)
        
        st.markdown('<div class="section-header">Savings vs Target</div>', unsafe_allow_html=True)
        tgt_col1, tgt_col2 = st.columns(2)
        
        with tgt_col1:
            st.markdown("**Cumulative Savings vs Target**")
            with st.container(border=True):
                months = ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                cum_df = pd.DataFrame({
                    'Month': months,
                    'Actual': [0.4, 0.7, 1.0, 1.3, 1.7, 2.1],
                    'Target': [0.5, 0.8, 1.2, 1.6, 2.0, 2.5]
                })
                cum_line = alt.Chart(cum_df).transform_fold(
                    ['Actual', 'Target'],
                    as_=['Series', 'Value']
                ).mark_line(point=True).encode(
                    x=alt.X('Month:N', sort=months, title=None),
                    y=alt.Y('Value:Q', title='£M'),
                    color=alt.Color('Series:N', scale=alt.Scale(range=['#22C55E', '#F59E0B'])),
                    tooltip=['Month:N', 'Series:N', alt.Tooltip('Value:Q', format='.1f')]
                ).properties(height=180)
                st.altair_chart(cum_line, use_container_width=True)
        
        with tgt_col2:
            st.markdown("**Pipeline Confidence**")
            with st.container(border=True):
                conf_df = pd.DataFrame({
                    'Stage': ['Identified', 'In Negotiation', 'Approved', 'Realized'],
                    'Share': [35, 28, 22, 15]
                })
                conf_arc = alt.Chart(conf_df).mark_arc(innerRadius=50).encode(
                    theta=alt.Theta('Share:Q', title=None),
                    color=alt.Color('Stage:N', legend=alt.Legend(orient='bottom', title=None)),
                    tooltip=['Stage:N', alt.Tooltip('Share:Q', format='.0f')]
                ).properties(height=190)
                st.altair_chart(conf_arc, use_container_width=True)
    
    with tab_strategy:
        st.markdown("""
        <style>
        .proc-ai-pulse {
            background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%);
            border-radius: 16px;
            border: 1px solid #BBF7D0;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .proc-ai-pulse::after {
            content: "";
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(34,197,94,0.18), transparent);
            animation: proc-ai-sweep 4s ease-in-out infinite;
        }
        @keyframes proc-ai-sweep {
            0% { left: -120%; }
            100% { left: 220%; }
        }
        .proc-ai-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; position: relative; z-index: 1; }
        .proc-ai-title { font-weight: 700; color: #14532D; font-size: 1.05rem; }
        .proc-ai-tag { background: #22C55E; color: white; font-size: 0.75rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 999px; }
        .proc-ai-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; position: relative; z-index: 1; }
        .proc-ai-card { background: white; border-radius: 12px; border: 1px solid #E2E8F0; padding: 0.9rem 1rem; }
        .proc-ai-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9CA3AF; }
        .proc-ai-value { font-size: 1.4rem; font-weight: 700; color: #14532D; }
        .proc-ai-sub { font-size: 0.8rem; color: #6B7280; margin-top: 0.2rem; }
        @media (max-width: 900px) { .proc-ai-grid { grid-template-columns: 1fr; } }
        </style>
        <div class="proc-ai-pulse">
            <div class="proc-ai-header">
                <div class="proc-ai-title">❄️ Snowflake Intelligence Pulse</div>
                <div class="proc-ai-tag">AI LIVE</div>
            </div>
            <div class="proc-ai-grid">
                <div class="proc-ai-card">
                    <div class="proc-ai-label">Spend Efficiency</div>
                    <div class="proc-ai-value">92%</div>
                    <div class="proc-ai-sub">On budget</div>
                </div>
                <div class="proc-ai-card">
                    <div class="proc-ai-label">Savings Velocity</div>
                    <div class="proc-ai-value">£0.30M</div>
                    <div class="proc-ai-sub">Monthly run-rate</div>
                </div>
                <div class="proc-ai-card">
                    <div class="proc-ai-label">Supplier Risk</div>
                    <div class="proc-ai-value">Low</div>
                    <div class="proc-ai-sub">Tier mix stable</div>
                </div>
                <div class="proc-ai-card">
                    <div class="proc-ai-label">Approval SLA</div>
                    <div class="proc-ai-value">93%</div>
                    <div class="proc-ai-sub">Improving</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown('<div class="section-header">AI Executive Summary</div>', unsafe_allow_html=True)
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Powered by Snowflake Cortex AI** — Summary synthesized from spend, supplier performance, and approval cycle data.")
        
        with st.container(border=True):
            st.markdown("""
            **Executive Summary (Q1 2026):**
            - **Savings** tracking £2.1M identified, with consolidation driving the largest impact.
            - **Approval SLA** improved to **93%**, reducing PO cycle time to 9.6 days.
            - **Vendor risk** concentrated in two top renewals; proactive renegotiation recommended.
            """)
        
        st.markdown('<div class="section-header">Signals & Insights</div>', unsafe_allow_html=True)
        insight_cols = st.columns(3)
        with insight_cols[0]:
            st.markdown('<div class="section-header">Top Insights</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Network infra** remains 70% of spend
                - **Sourcing cycle** dropped to 21 days
                - **Top 5 vendors** hold 58% of spend
                """)
        with insight_cols[1]:
            st.markdown('<div class="section-header">Risk Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Emergency POs** remain above 5% target
                - **Ericsson renewal** has high exposure
                - **Compliance** dip in Oct requires audit
                """)
        with insight_cols[2]:
            st.markdown('<div class="section-header">Growth Signals</div>', unsafe_allow_html=True)
            with st.container(border=True):
                st.markdown("""
                - **Supplier performance** improving QoQ
                - **Volume discounts** unlocked in Q1
                - **Contract renewals** provide negotiation leverage
                """)
        
        st.markdown('<div class="section-header">AI-Powered Strategic Recommendations</div>', unsafe_allow_html=True)
        action_cols = st.columns(3)
        with action_cols[0]:
            with st.container(border=True):
                st.markdown("""
                - **Accelerate consolidation** across tier-2 vendors
                - Target £0.4M savings gap by Q2
                """)
        with action_cols[1]:
            with st.container(border=True):
                st.markdown("""
                - **Reduce emergency POs** via demand forecasting
                - Implement pre-approved spend thresholds
                """)
        with action_cols[2]:
            with st.container(border=True):
                st.markdown("""
                - **Renegotiate top renewals** with SLA incentives
                - Lock in multi-year discounts
                """)
        
        st.markdown('<div class="section-header">VP Procurement Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #DC2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 1</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Savings £2.5M</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Identified: **£2.1M**
                - Gap: **£400K** to target
                - Focus: Vendor consolidation
                - Action: RFP refresh
                """)
        with col2:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #F59E0B; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 2</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Emergency PO < 5%</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Current: **8%** emergency
                - Target: **<5%** by Q2
                - Action: Planning improvements
                - Process: Forecast integration
                """)
        with col3:
            with st.container(border=True):
                st.markdown("""
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600;">PRIORITY 3</span>
                </div>
                <h4 style="color: #1B2A4E; margin: 0 0 0.5rem 0;">Ericsson Renewal</h4>
                """, unsafe_allow_html=True)
                st.markdown("""
                - Contract: **£24.2M** annual
                - Renewal: March 2026
                - Target: **5%** reduction
                - Savings: **£1.2M** potential
                """)
        
        st.markdown('<div class="section-header">Ask Snowflake Intelligence</div>', unsafe_allow_html=True)
        questions = ["What is our vendor spend by category?", "Who are our top vendors by spend?", "What's pending approval status?", "Where can we optimize vendor spend?"]
        sf_intel_url = "https://ai.snowflake.com/sfseeurope/pjose_aws3"
        cols = st.columns(2)
        for i, q in enumerate(questions):
            with cols[i % 2]:
                escaped_q = q.replace('"', '&quot;').replace("'", "&#39;")
                st.markdown(f"""
                <a href="{sf_intel_url}" target="_blank" onclick="navigator.clipboard.writeText('{escaped_q}')" style="text-decoration: none; color: inherit; display: block;">
                    <div class="question-card">
                        <p style="margin-bottom: 1.5rem;"><strong>Q{i+1}:</strong> "{q}"</p>
                    </div>
                </a>
                """, unsafe_allow_html=True)
        
        st.markdown(f"""
        <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%); border-radius: 8px;">
            <a href="{sf_intel_url}" target="_blank" style="color: white; text-decoration: none; font-weight: 600; font-size: 1rem;">
                ❄️ Ask these questions in Snowflake Intelligence →
            </a>
        </div>
        """, unsafe_allow_html=True)


def render_data_monetization():
    st.markdown("""
    <div class="main-header">
        <h1>Data Monetization & Data Sharing</h1>
        <p>Unlocking Value from Telco Data Assets — Powered by Snowflake Data Cloud</p>
    </div>
    """, unsafe_allow_html=True)

    # Dashboard Tabs
    tab_overview, tab_strategy = st.tabs(["📊 Overview & Analysis", "🎯 Strategy & Priorities"])

    with tab_overview:
        
        # DATA MONETIZATION - VALUE STREAM ANIMATION
        st.markdown("""
        <style>
        @keyframes coin-fall { 0% { transform: translateY(-20px) rotate(0deg); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(20px) rotate(360deg); opacity: 0; } }
        @keyframes value-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes data-stream { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
        @keyframes dm-value-count { 0% { opacity: 0; transform: scale(0.5) translateY(20px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes dm-shine { 0% { left: -100%; } 100% { left: 100%; } }
        @keyframes dm-glow { 0%, 100% { text-shadow: 0 0 10px rgba(255,255,255,0.3); } 50% { text-shadow: 0 0 30px rgba(255,255,255,0.8); } }
        .monetization-hero { background: linear-gradient(135deg, #059669 0%, #047857 100%); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; position: relative; overflow: hidden; }
        .monetization-hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%); background-size: 200% 100%; animation: data-stream 3s linear infinite; }
        .hero-content { position: relative; z-index: 1; display: flex; align-items: center; gap: 2rem; }
        .value-display { text-align: center; }
        .value-amount { font-size: 3rem; font-weight: 700; color: white; animation: dm-value-count 0.8s ease-out forwards, value-pulse 2s ease-in-out 0.8s infinite, dm-glow 3s ease-in-out infinite; opacity: 0; }
        .value-label { color: rgba(255,255,255,0.8); font-size: 0.9rem; }
        .coin-rain { position: relative; width: 80px; height: 80px; }
        .coin { position: absolute; font-size: 1.5rem; animation: coin-fall 2s ease-in-out infinite; }
        .data-sources { flex: 1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; }
        .source-card { background: rgba(255,255,255,0.15); border-radius: 8px; padding: 0.6rem; text-align: center; }
        .source-icon { font-size: 1.2rem; }
        .source-name { color: white; font-size: 0.7rem; font-weight: 600; }
        .source-val { color: rgba(255,255,255,0.8); font-size: 0.85rem; font-weight: 700; }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("""<div class="monetization-hero"><div class="hero-content"><div class="value-display"><div class="value-amount">£38.6M</div><div class="value-label">Annual Data Revenue</div></div><div class="coin-rain"><span class="coin" style="left:10px;animation-delay:0s">💰</span><span class="coin" style="left:30px;animation-delay:0.3s">💎</span><span class="coin" style="left:50px;animation-delay:0.6s">💰</span><span class="coin" style="left:20px;animation-delay:0.9s">💎</span><span class="coin" style="left:40px;animation-delay:1.2s">💰</span></div><div class="data-sources"><div class="source-card"><div class="source-icon">📱</div><div class="source-name">Mobility Data</div><div class="source-val">£12.4M</div></div><div class="source-card"><div class="source-icon">📊</div><div class="source-name">Analytics</div><div class="source-val">£9.8M</div></div><div class="source-card"><div class="source-icon">📍</div><div class="source-name">Location Intel</div><div class="source-val">£8.2M</div></div><div class="source-card"><div class="source-icon">🎯</div><div class="source-name">Audience</div><div class="source-val">£8.2M</div></div></div></div></div>""", unsafe_allow_html=True)
        
        # Create tabs
        tab1, tab2, tab3, tab4, tab5, tab6, tab7 = st.tabs([
            "📊 Monetization Overview",
            "📦 Data Products",
            "🔗 Data Sharing Architecture",
            "👥 Customer Intelligence",
            "📡 Network Data Products",
            "🤝 Partner Ecosystem",
            "🌍 Cross-Industry Use Cases"
        ])
        
        # ==================== TAB 1: MONETIZATION OVERVIEW ====================
        with tab1:
            st.markdown('<div class="section-header">Data Monetization Performance</div>', unsafe_allow_html=True)
            
            if st.session_state.get('sf_highlights', True):
                st.info("❄️ **Powered by Snowflake Marketplace & Data Sharing** — Secure data monetization via Snowflake Data Clean Rooms, Private Listings, and Native App Framework")
            
            # Top KPIs
            kpi_cols = st.columns(5)
            kpis = [
                ("£38.6M", "Annual Data Revenue", "+22.4%", "green"),
                ("18", "Active Data Products", "+4", "green"),
                ("86", "Data Partners", "+18", "green"),
                ("1.8B", "API Calls/Month", "+28%", "green"),
                ("£2.85", "Revenue per 1K Records", "+12%", "green")
            ]
            for col, (value, label, delta, color) in zip(kpi_cols, kpis):
                with col:
                    with st.container(border=True):
                        st.metric(label, value, delta)
            
            # Revenue Trends
            st.markdown("---")
            rev_col1, rev_col2 = st.columns(2)
            
            with rev_col1:
                st.markdown("**Data Revenue by Category (Monthly Trend)**")
                with st.container(border=True):
                    months = ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan']
                    revenue_data = pd.DataFrame({
                        'Month': months * 4,
                        'Category': ['Customer Insights']*7 + ['Network Data']*7 + ['Location Intelligence']*7 + ['Partner Data']*7,
                        'Revenue': [1.2, 1.4, 1.5, 1.8, 2.0, 2.2, 2.4,
                                   0.8, 0.9, 1.0, 1.1, 1.2, 1.4, 1.5,
                                   0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1,
                                   0.3, 0.4, 0.4, 0.5, 0.6, 0.7, 0.8],
                        'MonthOrder': [1,2,3,4,5,6,7]*4
                    })
                    chart = alt.Chart(revenue_data).mark_area(opacity=0.7).encode(
                        x=alt.X('Month:N', sort=['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None),
                        y=alt.Y('Revenue:Q', title='Revenue ($M)', stack='zero'),
                        color=alt.Color('Category:N', scale=alt.Scale(scheme='tableau10')),
                        tooltip=['Category', 'Month', 'Revenue']
                    ).properties(height=250)
                    st.altair_chart(chart, use_container_width=True)
            
            with rev_col2:
                st.markdown("**Revenue Mix by Data Type**")
                with st.container(border=True):
                    st.markdown("""
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; padding: 0.5rem;">
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <span style="font-weight: 500;">Customer Insights</span>
                                <span style="font-weight: 600; color: #29B5E8;">£14.8M (38%)</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                                <div style="background: #29B5E8; width: 38%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <span style="font-weight: 500;">Network Intelligence</span>
                                <span style="font-weight: 600; color: #10B981;">£10.4M (27%)</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                                <div style="background: #10B981; width: 27%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <span style="font-weight: 500;">Location Data</span>
                                <span style="font-weight: 600; color: #8B5CF6;">£7.7M (20%)</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                                <div style="background: #8B5CF6; width: 20%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <span style="font-weight: 500;">Partner/B2B Data</span>
                                <span style="font-weight: 600; color: #F59E0B;">£5.7M (15%)</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 12px;">
                                <div style="background: #F59E0B; width: 15%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
            
            # Top Products
            st.markdown("**Top Performing Data Products**")
            top_products = pd.DataFrame({
                'Product': ['Customer Propensity Scores', 'Network Coverage API', 'Audience Segments', 'Location Footfall', 'Churn Risk Indicators'],
                'Category': ['Customer Intelligence', 'Network Data', 'Customer Intelligence', 'Location Data', 'Customer Intelligence'],
                'Subscribers': [48, 32, 28, 24, 21],
                'Monthly Revenue': ['£420K', '£380K', '£320K', '£290K', '£245K'],
                'Growth': ['+24%', '+18%', '+32%', '+15%', '+28%'],
                'Status': ['✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active']
            })
            st.dataframe(top_products, use_container_width=True, hide_index=True)
        
        # ==================== TAB 2: DATA PRODUCTS ====================
        with tab2:
            st.markdown('<div class="section-header">Data Products Catalog</div>', unsafe_allow_html=True)
            
            # Product Categories
            cat_cols = st.columns(4)
            categories = [
                ("Customer Intelligence", "6 Products", "£14.8M ARR", "#29B5E8"),
                ("Network & Coverage", "5 Products", "£10.4M ARR", "#10B981"),
                ("Location & Mobility", "4 Products", "£7.7M ARR", "#8B5CF6"),
                ("Partner & B2B", "3 Products", "£5.7M ARR", "#F59E0B")
            ]
            for col, (name, count, revenue, color) in zip(cat_cols, categories):
                with col:
                    with st.container(border=True):
                        st.markdown(f"**{name}**")
                        st.metric(count, revenue)
            
            st.markdown("---")
            
            # Full Product Catalog
            st.markdown("**Complete Product Catalog**")
            products_df = pd.DataFrame({
                'Product Name': [
                    'Customer Propensity Scores', 'Churn Risk API', 'CLV Predictions', 'Audience Segments',
                    'Network Coverage Maps', 'QoE Benchmarks', '5G Availability Index', 'Cell Site Analytics',
                    'Footfall Analytics', 'Mobility Patterns', 'Geo-Demographics', 'POI Insights',
                    'MVNO Benchmarks', 'Wholesale Analytics', 'B2B Firmographics', 'IoT Device Insights'
                ],
                'Category': [
                    'Customer', 'Customer', 'Customer', 'Customer',
                    'Network', 'Network', 'Network', 'Network',
                    'Location', 'Location', 'Location', 'Location',
                    'Partner', 'Partner', 'Partner', 'Partner'
                ],
                'Delivery': [
                    'API + Share', 'API', 'Data Share', 'Clean Room',
                    'API + Share', 'Data Share', 'API', 'Data Share',
                    'Clean Room', 'API', 'Data Share', 'API',
                    'Data Share', 'Data Share', 'Clean Room', 'API'
                ],
                'Pricing Model': [
                    'Per 1K records', 'Per API call', 'Monthly flat', 'Per query',
                    'Monthly flat', 'Per 1K records', 'Per API call', 'Monthly flat',
                    'Per query', 'Per 1K records', 'Monthly flat', 'Per API call',
                    'Revenue share', 'Monthly flat', 'Per query', 'Per device'
                ],
                'Price': [
                    '£2.50', '£0.005', '£15,000', '£0.02',
                    '£8,500', '£1.80', '£0.008', '£12,000',
                    '£0.03', '£3.20', '£6,500', '£0.012',
                    '12%', '£18,000', '£0.025', '£0.50'
                ],
                'Active Subscribers': [48, 42, 38, 28, 32, 24, 45, 18, 24, 32, 22, 28, 8, 6, 14, 36],
                'MRR': ['£42K', '£38K', '£38K', '£32K', '£38K', '£28K', '£24K', '£22K', '£29K', '£26K', '£22K', '£18K', '£48K', '£18K', '£24K', '£28K']
            })
            st.dataframe(products_df, use_container_width=True, hide_index=True)
            
            # Product Performance
            st.markdown("---")
            perf_col1, perf_col2 = st.columns(2)
            
            with perf_col1:
                st.markdown("**Subscriber Growth by Category**")
                with st.container(border=True):
                    growth_data = pd.DataFrame({
                        'Month': ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'] * 4,
                        'Category': ['Customer']*6 + ['Network']*6 + ['Location']*6 + ['Partner']*6,
                        'Subscribers': [120, 128, 135, 142, 148, 156,
                                       85, 92, 98, 105, 112, 119,
                                       62, 68, 74, 78, 84, 91,
                                       42, 45, 48, 52, 58, 64],
                        'MonthOrder': [1,2,3,4,5,6]*4
                    })
                    chart = alt.Chart(growth_data).mark_line(point=True, strokeWidth=2).encode(
                        x=alt.X('Month:N', sort=['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], title=None),
                        y=alt.Y('Subscribers:Q', title='Total Subscribers'),
                        color=alt.Color('Category:N', scale=alt.Scale(scheme='tableau10')),
                        tooltip=['Category', 'Month', 'Subscribers']
                    ).properties(height=220)
                    st.altair_chart(chart, use_container_width=True)
            
            with perf_col2:
                st.markdown("**API Usage (Last 30 Days)**")
                with st.container(border=True):
                    api_data = pd.DataFrame({
                        'API': ['Propensity API', 'Coverage API', 'Churn API', 'Location API', 'Segments API'],
                        'Calls': [842, 724, 612, 548, 423],
                        'Percentage': [24.8, 21.3, 18.0, 16.1, 12.5]
                    })
                    st.markdown("""
                    <div style="font-size: 0.85rem;">
                        <div style="margin-bottom: 0.75rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                                <span>Propensity API</span><span style="font-weight: 600;">842M calls</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 10px;">
                                <div style="background: #29B5E8; width: 100%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 0.75rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                                <span>Coverage API</span><span style="font-weight: 600;">724M calls</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 10px;">
                                <div style="background: #10B981; width: 86%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 0.75rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                                <span>Churn API</span><span style="font-weight: 600;">612M calls</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 10px;">
                                <div style="background: #8B5CF6; width: 73%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 0.75rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                                <span>Location API</span><span style="font-weight: 600;">548M calls</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 10px;">
                                <div style="background: #F59E0B; width: 65%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.2rem;">
                                <span>Segments API</span><span style="font-weight: 600;">423M calls</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 10px;">
                                <div style="background: #EF4444; width: 50%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
        
        # ==================== TAB 3: DATA SHARING ARCHITECTURE ====================
        with tab3:
            st.markdown('<div class="section-header">Snowflake Data Sharing Architecture</div>', unsafe_allow_html=True)
            
            # Sharing Overview KPIs
            share_kpis = st.columns(5)
            share_metrics = [
                ("48", "Active Data Shares", "Direct shares"),
                ("12", "Marketplace Listings", "Public products"),
                ("6", "Clean Rooms", "Privacy-preserving"),
                ("3", "Private Exchanges", "Controlled access"),
                ("142", "Connected Partners", "Total consumers")
            ]
            for col, (val, label, desc) in zip(share_kpis, share_metrics):
                with col:
                    with st.container(border=True):
                        st.metric(label, val)
                        st.caption(desc)
            
            st.markdown("---")
            
            # Data Sharing Types Architecture
            st.markdown("**Snowflake Data Sharing Methods**")
            
            share_cols = st.columns(4)
            
            with share_cols[0]:
                with st.container(border=True):
                    st.markdown("### 🔗 Direct Data Shares")
                    st.markdown("**Point-to-Point Sharing**")
                    st.caption("Real-time, zero-copy data sharing directly with specific Snowflake accounts")
                    st.markdown("---")
                    st.markdown("**Use Cases:**")
                    st.markdown("- MVNO partner data feeds")
                    st.markdown("- Enterprise customer dashboards")
                    st.markdown("- Regulatory reporting")
                    st.markdown("---")
                    st.metric("Active Shares", "48")
                    st.metric("Partners", "32")
            
            with share_cols[1]:
                with st.container(border=True):
                    st.markdown("### 🏪 Snowflake Marketplace")
                    st.markdown("**Public Data Products**")
                    st.caption("List and sell data products to any Snowflake customer globally")
                    st.markdown("---")
                    st.markdown("**Listed Products:**")
                    st.markdown("- Coverage Maps API")
                    st.markdown("- Network QoE Benchmarks")
                    st.markdown("- Mobility Patterns")
                    st.markdown("---")
                    st.metric("Listings", "12")
                    st.metric("Subscribers", "89")
            
            with share_cols[2]:
                with st.container(border=True):
                    st.markdown("### 🔒 Data Clean Rooms")
                    st.markdown("**Privacy-Preserving Analytics**")
                    st.caption("Secure collaboration without exposing raw data")
                    st.markdown("---")
                    st.markdown("**Active Clean Rooms:**")
                    st.markdown("- Advertiser overlap analysis")
                    st.markdown("- Cross-industry insights")
                    st.markdown("- Attribution modeling")
                    st.markdown("---")
                    st.metric("Clean Rooms", "6")
                    st.metric("Queries/Month", "2.4K")
            
            with share_cols[3]:
                with st.container(border=True):
                    st.markdown("### 🏢 Private Data Exchange")
                    st.markdown("**Controlled Access Hub**")
                    st.caption("Curated data marketplace for approved partners only")
                    st.markdown("---")
                    st.markdown("**Exchange Members:**")
                    st.markdown("- Tier 1 enterprise partners")
                    st.markdown("- Government agencies")
                    st.markdown("- Research institutions")
                    st.markdown("---")
                    st.metric("Exchanges", "3")
                    st.metric("Members", "21")
            
            # Data Sharing Architecture Diagram
            st.markdown("---")
            st.markdown("**Data Sharing Flow Architecture**")
            
            import graphviz
            
            sharing_arch = graphviz.Digraph('sharing_architecture')
            sharing_arch.attr(rankdir='LR', bgcolor='transparent', compound='true')
            sharing_arch.attr('node', shape='box', style='rounded,filled', fontname='Inter', fontsize='10')
            
            # Data Sources cluster
            with sharing_arch.subgraph(name='cluster_sources') as c:
                c.attr(label='SnowTelco Data Assets', style='rounded', bgcolor='#E0F2FE')
                c.node('cust_data', 'Customer\nData', fillcolor='#29B5E8', fontcolor='white')
                c.node('network_data', 'Network\nData', fillcolor='#29B5E8', fontcolor='white')
                c.node('location_data', 'Location\nData', fillcolor='#29B5E8', fontcolor='white')
                c.node('partner_data', 'Partner\nData', fillcolor='#29B5E8', fontcolor='white')
            
            # Snowflake Platform
            with sharing_arch.subgraph(name='cluster_snowflake') as c:
                c.attr(label='Snowflake Data Cloud', style='rounded', bgcolor='#F0FDF4')
                c.node('secure_views', 'Secure Views\n& Policies', fillcolor='#10B981', fontcolor='white')
                c.node('governance', 'Access Control\n& Governance', fillcolor='#10B981', fontcolor='white')
            
            # Sharing Methods
            with sharing_arch.subgraph(name='cluster_sharing') as c:
                c.attr(label='Sharing Methods', style='rounded', bgcolor='#FEF3C7')
                c.node('direct', 'Direct\nShares', fillcolor='#F59E0B', fontcolor='white')
                c.node('marketplace', 'Marketplace\nListings', fillcolor='#F59E0B', fontcolor='white')
                c.node('cleanroom', 'Clean\nRooms', fillcolor='#F59E0B', fontcolor='white')
                c.node('exchange', 'Private\nExchange', fillcolor='#F59E0B', fontcolor='white')
            
            # Consumers
            with sharing_arch.subgraph(name='cluster_consumers') as c:
                c.attr(label='Data Consumers', style='rounded', bgcolor='#F3E8FF')
                c.node('mvno', 'MVNO\nPartners', fillcolor='#8B5CF6', fontcolor='white')
                c.node('enterprise', 'Enterprise\nCustomers', fillcolor='#8B5CF6', fontcolor='white')
                c.node('advertisers', 'Advertisers\n& Media', fillcolor='#8B5CF6', fontcolor='white')
                c.node('gov', 'Government\n& Research', fillcolor='#8B5CF6', fontcolor='white')
            
            # Edges
            sharing_arch.edge('cust_data', 'secure_views')
            sharing_arch.edge('network_data', 'secure_views')
            sharing_arch.edge('location_data', 'secure_views')
            sharing_arch.edge('partner_data', 'secure_views')
            
            sharing_arch.edge('secure_views', 'governance')
            
            sharing_arch.edge('governance', 'direct')
            sharing_arch.edge('governance', 'marketplace')
            sharing_arch.edge('governance', 'cleanroom')
            sharing_arch.edge('governance', 'exchange')
            
            sharing_arch.edge('direct', 'mvno')
            sharing_arch.edge('direct', 'enterprise')
            sharing_arch.edge('marketplace', 'enterprise')
            sharing_arch.edge('marketplace', 'advertisers')
            sharing_arch.edge('cleanroom', 'advertisers')
            sharing_arch.edge('exchange', 'gov')
            
            st.graphviz_chart(sharing_arch, use_container_width=True)
            
            # Active Shares Table
            st.markdown("---")
            st.markdown("**Active Data Shares Inventory**")
            
            shares_df = pd.DataFrame({
                'Share Name': ['MVNO_Partner_Feed', 'Enterprise_Dashboard', 'Marketplace_Coverage', 'CleanRoom_MediaCo', 'Regulatory_Reporting', 'Research_Academic'],
                'Type': ['Direct Share', 'Direct Share', 'Marketplace', 'Clean Room', 'Direct Share', 'Private Exchange'],
                'Consumer': ['VirginMedia, Sky Mobile', 'Vodafone Enterprise', 'Public (89 subscribers)', 'WPP, Publicis, Omnicom', 'Ofcom, FCA', 'UCL, Imperial, Oxford'],
                'Data Products': ['Usage, Billing, Network KPIs', 'Customer 360, Support Tickets', 'Coverage Maps, QoE Index', 'Audience Segments, Attribution', 'Compliance Reports, CDRs', 'Anonymized Network Data'],
                'Records Shared': ['142M/day', '2.4M/day', '50M static', '12M/query', '8M/month', '500M static'],
                'Revenue/Month': ['£124,000', '£48,000', '£86,000', '£52,000', 'Regulatory', '£18,000'],
                'Status': ['✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active']
            })
            st.dataframe(shares_df, use_container_width=True, hide_index=True)
        
        # ==================== TAB 4: CUSTOMER INTELLIGENCE ====================
        with tab4:
            st.markdown('<div class="section-header">Customer Intelligence Monetization</div>', unsafe_allow_html=True)
            
            # Customer Data Products
            cust_kpis = st.columns(4)
            cust_metrics = [
                ("8.2M", "Customer Profiles", "Enriched & scored"),
                ("6", "Intelligence Products", "In market"),
                ("£14.8M", "Annual Revenue", "+24% YoY"),
                ("92", "Active Subscribers", "+18 this quarter")
            ]
            for col, (val, label, desc) in zip(cust_kpis, cust_metrics):
                with col:
                    with st.container(border=True):
                        st.metric(label, val)
                        st.caption(desc)
            
            st.markdown("---")
            cust_col1, cust_col2 = st.columns(2)
            
            with cust_col1:
                st.markdown("**Customer Intelligence Products**")
                with st.container(border=True):
                    st.markdown("**Propensity Scores** &nbsp;&nbsp; <span style='color: #10B981;'>● Live</span>", unsafe_allow_html=True)
                    st.caption("Churn, Upsell, Cross-sell propensity scores • Updated daily")
                    st.progress(0.92)
                    st.caption("92% model accuracy • 48 subscribers • £420K MRR")
                    st.divider()
                    st.markdown("**Audience Segments** &nbsp;&nbsp; <span style='color: #10B981;'>● Live</span>", unsafe_allow_html=True)
                    st.caption("500+ pre-built segments • Custom segment builder")
                    st.progress(0.88)
                    st.caption("88% match rate • 28 subscribers • £320K MRR")
                    st.divider()
                    st.markdown("**CLV Predictions** &nbsp;&nbsp; <span style='color: #10B981;'>● Live</span>", unsafe_allow_html=True)
                    st.caption("Customer lifetime value forecasts • 3, 6, 12 month horizons")
                    st.progress(0.87)
                    st.caption("87% accuracy • 38 subscribers • £380K MRR")
                    st.divider()
                    st.markdown("**Churn Risk API** &nbsp;&nbsp; <span style='color: #10B981;'>● Live</span>", unsafe_allow_html=True)
                    st.caption("Real-time churn scoring via REST API")
                    st.progress(0.94)
                    st.caption("94% AUC-ROC • 42 subscribers • £380K MRR")
            
            with cust_col2:
                st.markdown("**Privacy & Compliance Framework**")
                with st.container(border=True):
                    st.markdown("**Data Anonymization**")
                    st.markdown("- k-anonymity (k=50) for all shared datasets")
                    st.markdown("- Differential privacy for aggregate statistics")
                    st.markdown("- PII tokenization with secure vaults")
                    st.divider()
                    st.markdown("**Consent Management**")
                    st.markdown("- GDPR Article 6 legal basis tracking")
                    st.markdown("- Opt-out propagation across all products")
                    st.markdown("- Purpose limitation enforcement")
                    st.divider()
                    st.markdown("**Audit & Governance**")
                    st.markdown("- Complete data lineage tracking")
                    st.markdown("- Access logging for all queries")
                    st.markdown("- Automated compliance reporting")
            
            # Segment Catalog
            st.markdown("---")
            st.markdown("**Pre-Built Audience Segments**")
            segments_df = pd.DataFrame({
                'Segment': ['High-Value Millennials', 'At-Risk Premium', 'Digital First', '5G Early Adopters', 'Family Plan Prospects', 'Business Switchers'],
                'Size': ['1.2M', '842K', '2.4M', '680K', '1.8M', '420K'],
                'Refresh': ['Daily', 'Real-time', 'Daily', 'Weekly', 'Daily', 'Daily'],
                'Match Rate': ['94%', '92%', '96%', '88%', '91%', '89%'],
                'Use Case': ['Upsell campaigns', 'Retention programs', 'App engagement', 'Network marketing', 'Bundle offers', 'Competitive wins'],
                'Price/1K': ['£2.80', '£3.20', '£2.20', '£4.50', '£2.40', '£3.80']
            })
            st.dataframe(segments_df, use_container_width=True, hide_index=True)
        
        # ==================== TAB 5: NETWORK DATA PRODUCTS ====================
        with tab5:
            st.markdown('<div class="section-header">Network Data Monetization</div>', unsafe_allow_html=True)
            
            # Network Data KPIs
            net_kpis = st.columns(4)
            net_metrics = [
                ("18K", "Cell Sites", "Coverage data"),
                ("5", "Data Products", "In market"),
                ("£10.4M", "Annual Revenue", "+18% YoY"),
                ("74", "Active Subscribers", "+16 this quarter")
            ]
            for col, (val, label, desc) in zip(net_kpis, net_metrics):
                with col:
                    with st.container(border=True):
                        st.metric(label, val)
                        st.caption(desc)
            
            st.markdown("---")
            
            net_col1, net_col2 = st.columns(2)
            
            with net_col1:
                st.markdown("**Network Data Products**")
                with st.container(border=True):
                    products = [
                        ("Coverage Maps API", "Real-time 4G/5G coverage data by location", "£8,500/mo", "32 subs"),
                        ("QoE Benchmarks", "Network quality metrics by region/operator", "£1.80/1K", "24 subs"),
                        ("5G Availability Index", "5G rollout tracking and forecasts", "£0.008/call", "45 subs"),
                        ("Cell Site Analytics", "Site performance and capacity metrics", "£12K/mo", "18 subs"),
                        ("Spectrum Utilization", "Frequency band usage and efficiency", "£15K/mo", "12 subs"),
                        ("Network Event Data", "Anonymized signaling and mobility events", "£2.40/1K", "28 subs")
                    ]
                    for name, desc, price, subs in products:
                        st.markdown(f"**{name}**")
                        st.caption(f"{desc}")
                        st.markdown(f"💰 {price} • 👥 {subs}")
                        st.divider()
            
            with net_col2:
                st.markdown("**Coverage Data Applications**")
                with st.container(border=True):
                    st.markdown("""
                    <div style="font-size: 0.9rem;">
                        <div style="padding: 0.75rem; background: #F0FDF4; border-radius: 8px; margin-bottom: 0.75rem;">
                            <strong style="color: #10B981;">🏢 Real Estate & Property</strong><br>
                            <span style="color: #6B7280; font-size: 0.8rem;">Property valuations, connectivity scoring, site selection</span>
                        </div>
                        <div style="padding: 0.75rem; background: #EFF6FF; border-radius: 8px; margin-bottom: 0.75rem;">
                            <strong style="color: #3B82F6;">🚗 Automotive & Fleet</strong><br>
                            <span style="color: #6B7280; font-size: 0.8rem;">Connected car routing, fleet optimization, V2X planning</span>
                        </div>
                        <div style="padding: 0.75rem; background: #FEF3C7; border-radius: 8px; margin-bottom: 0.75rem;">
                            <strong style="color: #F59E0B;">📱 App Developers</strong><br>
                            <span style="color: #6B7280; font-size: 0.8rem;">Network-aware features, offline mode triggers, QoS adaptation</span>
                        </div>
                        <div style="padding: 0.75rem; background: #F3E8FF; border-radius: 8px; margin-bottom: 0.75rem;">
                            <strong style="color: #8B5CF6;">🏛️ Government & Smart Cities</strong><br>
                            <span style="color: #6B7280; font-size: 0.8rem;">Digital inclusion mapping, emergency services, infrastructure planning</span>
                        </div>
                        <div style="padding: 0.75rem; background: #FEE2E2; border-radius: 8px;">
                            <strong style="color: #EF4444;">🏥 Healthcare & Emergency</strong><br>
                            <span style="color: #6B7280; font-size: 0.8rem;">Telemedicine feasibility, ambulance routing, remote patient monitoring</span>
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
            
            # Location Intelligence
            st.markdown("---")
            st.markdown("**Location Intelligence Products**")
            
            loc_cols = st.columns(3)
            with loc_cols[0]:
                with st.container(border=True):
                    st.markdown("### 📍 Footfall Analytics")
                    st.metric("Subscribers", "24")
                    st.metric("MRR", "£290K")
                    st.caption("Anonymized visitor counts and dwell times for retail locations, venues, and POIs")
            
            with loc_cols[1]:
                with st.container(border=True):
                    st.markdown("### 🚶 Mobility Patterns")
                    st.metric("Subscribers", "32")
                    st.metric("MRR", "£260K")
                    st.caption("Origin-destination flows, commute patterns, and population movement insights")
            
            with loc_cols[2]:
                with st.container(border=True):
                    st.markdown("### 🗺️ Geo-Demographics")
                    st.metric("Subscribers", "22")
                    st.metric("MRR", "£220K")
                    st.caption("Population density, demographic profiles, and socioeconomic indicators by area")
        
        # ==================== TAB 6: PARTNER ECOSYSTEM ====================
        with tab6:
            st.markdown('<div class="section-header">Partner Data Ecosystem</div>', unsafe_allow_html=True)
            
            # 3D Globe - Global Data Sharing Network
            components.html("""
            <!DOCTYPE html>
            <html>
            <head>
            <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
            @keyframes globe-pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
            @keyframes connection-flow { 0% { stroke-dashoffset: 100; } 100% { stroke-dashoffset: 0; } }
            @keyframes ping-ring { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            .globe-container {
                background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
                border-radius: 16px;
                padding: 1.5rem;
                position: relative;
                overflow: hidden;
            }
            .globe-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
            }
            .globe-title { color: white; font-size: 1.1rem; font-weight: 600; }
            .globe-live { display: flex; align-items: center; gap: 6px; color: #10B981; font-size: 0.8rem; }
            .globe-live-dot { width: 8px; height: 8px; background: #10B981; border-radius: 50%; animation: globe-pulse 1.5s ease-in-out infinite; }
            .globe-svg { width: 100%; height: 280px; }
            .globe-base { fill: none; stroke: rgba(41, 181, 232, 0.3); stroke-width: 1; }
            .globe-landmass { fill: rgba(41, 181, 232, 0.2); stroke: rgba(41, 181, 232, 0.5); stroke-width: 1; }
            .globe-connection { stroke: #29B5E8; stroke-width: 2; stroke-dasharray: 100; animation: connection-flow 3s linear infinite; fill: none; }
            .globe-partner { animation: globe-pulse 2s ease-in-out infinite; }
            .globe-ping { animation: ping-ring 2s ease-out infinite; }
            .globe-stats { display: flex; justify-content: space-around; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); }
            .globe-stat { text-align: center; }
            .globe-stat-value { font-size: 1.3rem; font-weight: 700; color: #29B5E8; }
            .globe-stat-label { font-size: 0.7rem; color: rgba(255,255,255,0.6); text-transform: uppercase; }
            </style>
            </head>
            <body>
            <div class="globe-container">
                <div class="globe-header">
                    <div class="globe-title">Global Data Sharing Network</div>
                    <div class="globe-live"><div class="globe-live-dot"></div>Live Connections</div>
                </div>
                <svg class="globe-svg" viewBox="0 0 600 260">
                    <ellipse cx="300" cy="130" rx="110" ry="110" class="globe-base"/>
                    <ellipse cx="300" cy="130" rx="110" ry="40" class="globe-base"/>
                    <ellipse cx="300" cy="130" rx="40" ry="110" class="globe-base"/>
                    <ellipse cx="300" cy="130" rx="80" ry="80" class="globe-base"/>
                    <path class="globe-landmass" d="M240,70 Q260,60 290,65 Q310,70 320,85 Q340,80 350,95 Q340,110 320,105 Q300,115 280,100 Q260,110 245,90 Z"/>
                    <path class="globe-landmass" d="M320,130 Q340,125 360,135 Q380,130 390,150 Q385,170 365,175 Q345,180 330,165 Q315,155 320,140 Z"/>
                    <path class="globe-landmass" d="M250,140 Q270,135 285,145 Q295,160 285,175 Q265,185 250,170 Q240,155 250,140 Z"/>
                    <path class="globe-landmass" d="M215,100 Q235,95 240,115 Q235,130 220,130 Q205,125 210,110 Z"/>
                    <circle cx="300" cy="80" r="8" fill="#29B5E8" class="globe-partner"/>
                    <circle cx="300" cy="80" r="8" fill="none" stroke="#29B5E8" stroke-width="2" class="globe-ping"/>
                    <text x="300" y="65" text-anchor="middle" fill="white" font-size="9" font-weight="600">UK HQ</text>
                    <circle cx="380" cy="90" r="6" fill="#10B981" class="globe-partner" style="animation-delay: 0.3s;"/>
                    <text x="395" y="85" fill="#10B981" font-size="8">Germany</text>
                    <circle cx="420" cy="140" r="5" fill="#8B5CF6" class="globe-partner" style="animation-delay: 0.6s;"/>
                    <text x="440" y="140" fill="#8B5CF6" font-size="8">UAE</text>
                    <circle cx="250" cy="75" r="5" fill="#F59E0B" class="globe-partner" style="animation-delay: 0.9s;"/>
                    <text x="230" y="68" fill="#F59E0B" font-size="8">Ireland</text>
                    <circle cx="200" cy="110" r="6" fill="#EC4899" class="globe-partner" style="animation-delay: 1.2s;"/>
                    <text x="175" y="105" fill="#EC4899" font-size="8">USA</text>
                    <circle cx="360" cy="170" r="5" fill="#14B8A6" class="globe-partner" style="animation-delay: 1.5s;"/>
                    <text x="375" y="180" fill="#14B8A6" font-size="8">India</text>
                    <circle cx="430" cy="180" r="5" fill="#6366F1" class="globe-partner" style="animation-delay: 1.8s;"/>
                    <text x="450" y="185" fill="#6366F1" font-size="8">Singapore</text>
                    <path class="globe-connection" d="M300,80 Q340,60 380,90" style="animation-delay: 0s;"/>
                    <path class="globe-connection" d="M300,80 Q370,100 420,140" style="animation-delay: 0.5s;"/>
                    <path class="globe-connection" d="M300,80 Q275,70 250,75" style="animation-delay: 1s;"/>
                    <path class="globe-connection" d="M300,80 Q250,85 200,110" style="animation-delay: 1.5s;"/>
                    <path class="globe-connection" d="M300,80 Q340,130 360,170" style="animation-delay: 2s;"/>
                    <path class="globe-connection" d="M300,80 Q380,140 430,180" style="animation-delay: 2.5s;"/>
                    <circle r="3" fill="#29B5E8"><animateMotion dur="3s" repeatCount="indefinite" path="M300,80 Q340,60 380,90"/></circle>
                    <circle r="3" fill="#29B5E8"><animateMotion dur="4s" repeatCount="indefinite" path="M300,80 Q370,100 420,140" begin="1s"/></circle>
                    <circle r="3" fill="#29B5E8"><animateMotion dur="2.5s" repeatCount="indefinite" path="M300,80 Q250,85 200,110" begin="2s"/></circle>
                    <rect x="30" y="30" width="100" height="80" rx="8" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.1)"/>
                    <text x="80" y="55" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="8">ACTIVE SHARES</text>
                    <text x="80" y="80" text-anchor="middle" fill="#29B5E8" font-size="22" font-weight="700">86</text>
                    <text x="80" y="100" text-anchor="middle" fill="#10B981" font-size="9">+12 this month</text>
                    <rect x="470" y="30" width="110" height="90" rx="8" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.1)"/>
                    <text x="525" y="50" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="8">PARTNER TYPES</text>
                    <text x="490" y="70" fill="#10B981" font-size="9">MVNOs: 6</text>
                    <text x="490" y="85" fill="#8B5CF6" font-size="9">Analytics: 24</text>
                    <text x="490" y="100" fill="#F59E0B" font-size="9">IoT: 18</text>
                    <text x="490" y="115" fill="#EC4899" font-size="9">Enterprise: 38</text>
                </svg>
                <div class="globe-stats">
                    <div class="globe-stat"><div class="globe-stat-value">5.7M</div><div class="globe-stat-label">Revenue YTD</div></div>
                    <div class="globe-stat"><div class="globe-stat-value">12</div><div class="globe-stat-label">Countries</div></div>
                    <div class="globe-stat"><div class="globe-stat-value">2.4TB</div><div class="globe-stat-label">Data Shared/Mo</div></div>
                    <div class="globe-stat"><div class="globe-stat-value">99.9%</div><div class="globe-stat-label">SLA Compliance</div></div>
                </div>
            </div>
            </body>
            </html>
            """, height=420, scrolling=False)
            
            # Partner KPIs
            partner_kpis = st.columns(4)
            partner_metrics = [
                ("86", "Data Partners", "Connected accounts"),
                ("6", "MVNOs", "Active data shares"),
                ("£5.7M", "Partner Revenue", "+22% YoY"),
                ("42", "B2B Subscribers", "+12 this quarter")
            ]
            for col, (val, label, desc) in zip(partner_kpis, partner_metrics):
                with col:
                    with st.container(border=True):
                        st.metric(label, val)
                        st.caption(desc)
            
            st.markdown("---")
            
            # MVNO Data Sharing
            st.markdown("**MVNO Partner Data Feeds**")
            mvno_df = pd.DataFrame({
                'MVNO Partner': ['Virgin Media Mobile', 'Sky Mobile', 'Tesco Mobile', 'BT Mobile', 'Lebara', 'Lycamobile', 'giffgaff', 'VOXI'],
                'Share Type': ['Direct Share', 'Direct Share', 'Direct Share', 'Direct Share', 'Direct Share', 'API', 'Direct Share', 'Direct Share'],
                'Data Products': ['Full CDRs, Network KPIs, Billing', 'Usage, Coverage, Support', 'Usage, Billing, Retail', 'Full Suite', 'Usage, Top-ups, Roaming', 'Usage API, Coverage', 'Usage, Network, Community', 'Usage, Streaming Analytics'],
                'Records/Day': ['42M', '38M', '24M', '18M', '12M', '8M', '15M', '10M'],
                'Revenue Share': ['12%', '10%', '8%', '15%', '6%', '5%', '8%', '7%'],
                'Monthly Revenue': ['£48K', '£42K', '£28K', '£38K', '£18K', '£12K', '£22K', '£16K'],
                'Status': ['✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active']
            })
            st.dataframe(mvno_df, use_container_width=True, hide_index=True)
            
            st.markdown("---")
            
            partner_col1, partner_col2 = st.columns(2)
            
            with partner_col1:
                st.markdown("**B2B Data Products**")
                with st.container(border=True):
                    b2b_products = [
                        ("Enterprise Firmographics", "Company profiles with telco usage patterns", "14 subscribers", "£24K MRR"),
                        ("B2B Propensity Scores", "SMB/Enterprise acquisition propensity", "18 subscribers", "£32K MRR"),
                        ("IoT Device Intelligence", "Connected device analytics & benchmarks", "36 subscribers", "£28K MRR"),
                        ("Wholesale Benchmarks", "Interconnect and wholesale performance data", "6 subscribers", "£18K MRR")
                    ]
                    for name, desc, subs, revenue in b2b_products:
                        st.markdown(f"**{name}**")
                        st.caption(desc)
                        st.markdown(f"👥 {subs} • 💰 {revenue}")
                        st.divider()
            
            with partner_col2:
                st.markdown("**Partner Revenue by Type**")
                with st.container(border=True):
                    st.markdown("""
                    <div style="font-size: 0.85rem;">
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <span style="font-weight: 500;">MVNO Data Feeds</span>
                                <span style="font-weight: 600; color: #29B5E8;">£2.2M (38%)</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                                <div style="background: #29B5E8; width: 38%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <span style="font-weight: 500;">Enterprise/B2B Products</span>
                                <span style="font-weight: 600; color: #10B981;">£2.2M (30%)</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                                <div style="background: #10B981; width: 30%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <span style="font-weight: 500;">Wholesale Analytics</span>
                                <span style="font-weight: 600; color: #8B5CF6;">£1.4M (19%)</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                                <div style="background: #8B5CF6; width: 19%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <span style="font-weight: 500;">IoT/Connected Devices</span>
                                <span style="font-weight: 600; color: #F59E0B;">£1.0M (13%)</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 4px; height: 14px;">
                                <div style="background: #F59E0B; width: 13%; height: 100%; border-radius: 4px;"></div>
                            </div>
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
        
        # ==================== TAB 7: CROSS-INDUSTRY USE CASES ====================
        with tab7:
            st.markdown('<div class="section-header">Telco Data Monetization — Cross-Industry Use Cases</div>', unsafe_allow_html=True)
            
            st.markdown("""
            <div style="background: #F8FAFC; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid #E2E8F0;">
                <div style="text-align: center;">
                    <div style="font-size: 1.3rem; font-weight: 600; margin-bottom: 0.5rem; color: #1B2A4E;">Unlocking Value Across Industries</div>
                    <div style="font-size: 0.9rem; color: #64748B;">Telco data assets — mobility, location, network quality, and customer insights — create unique value propositions for diverse industries</div>
                </div>
            </div>
            """, unsafe_allow_html=True)
            
            # Row 1: Retail, Financial Services, Advertising
            row1 = st.columns(3)
            
            with row1[0]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #FEF3C7; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🛍️</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Retail & Real Estate</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Site Selection & Customer Analytics</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Footfall Analytics:</strong> Understand store visitor patterns, dwell time, and peak hours using anonymised mobility data.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Catchment Analysis:</strong> Map where customers travel from to optimise store locations and marketing spend.</p>
                        <p><strong>Competitive Intelligence:</strong> Benchmark foot traffic against competitors in the same retail park or high street.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            with row1[1]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #DBEAFE; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🏦</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Financial Services</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Risk Assessment & Fraud Prevention</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Alternative Credit Scoring:</strong> Use mobile top-up patterns and payment history for thin-file customers.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Identity Verification:</strong> Confirm customer identity using SIM ownership and device binding data.</p>
                        <p><strong>Fraud Detection:</strong> Detect anomalous location patterns that indicate potential fraud or account takeover.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            with row1[2]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #FCE7F3; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">📺</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Advertising & Media</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Audience Targeting & Attribution</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Audience Segments:</strong> Build privacy-safe segments based on demographics, interests, and behaviours.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Campaign Attribution:</strong> Measure real-world store visits after exposure to digital advertising.</p>
                        <p><strong>Clean Room Analytics:</strong> Enable advertisers to match and analyse without exposing raw customer data.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            # Row 2: Transportation, Government, Healthcare
            row2 = st.columns(3)
            
            with row2[0]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #D1FAE5; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🚗</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Transport & Logistics</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Route Optimisation & Traffic Analytics</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Traffic Flow Analysis:</strong> Real-time and historical traffic patterns from anonymised device movement data.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Fleet Optimisation:</strong> Optimise delivery routes based on network coverage and congestion patterns.</p>
                        <p><strong>Connected Vehicle Services:</strong> Enable V2X applications with real-time network quality and coverage data.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            with row2[1]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #E0E7FF; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🏛️</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Government & Smart Cities</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Urban Planning & Public Services</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Population Dynamics:</strong> Understand population movement for transport and infrastructure planning.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Digital Inclusion:</strong> Identify areas with poor connectivity to prioritise broadband investment.</p>
                        <p><strong>Emergency Response:</strong> Support disaster response with real-time population density and evacuation patterns.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            with row2[2]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #FEE2E2; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🏥</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Healthcare</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Telehealth & Population Health</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Telehealth Feasibility:</strong> Map network quality to identify areas suitable for remote patient monitoring.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Ambulance Routing:</strong> Optimise emergency vehicle routes based on real-time network and traffic data.</p>
                        <p><strong>Population Health:</strong> Anonymised mobility data for epidemiological studies and health service planning.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            # Row 3: Insurance, Tourism, Energy
            row3 = st.columns(3)
            
            with row3[0]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #F3E8FF; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🛡️</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Insurance</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Risk Assessment & Claims</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Usage-Based Insurance:</strong> Support UBI models with driving behaviour insights from connected devices.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Risk Scoring:</strong> Enhance property and casualty risk models with location and mobility patterns.</p>
                        <p><strong>Claims Verification:</strong> Verify claim locations and timing using anonymised network data.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            with row3[1]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #FFEDD5; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">✈️</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Tourism & Hospitality</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Visitor Analytics & Destination Planning</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Tourism Analytics:</strong> Understand visitor origins, dwell time, and travel patterns at destinations.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Event Impact:</strong> Measure footfall and economic impact of festivals, concerts, and sporting events.</p>
                        <p><strong>Roaming Insights:</strong> Analyse international visitor patterns from roaming data for tourism boards.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            with row3[2]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #DCFCE7; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">⚡</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Energy & Utilities</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Smart Grid & Demand Management</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Demand Forecasting:</strong> Predict energy demand using population presence and movement patterns.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Smart Meter Connectivity:</strong> Network coverage data for IoT smart meter rollout planning.</p>
                        <p><strong>EV Charging:</strong> Optimise electric vehicle charging station placement based on mobility patterns.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            # Row 4: Automotive, Research, App Developers
            row4 = st.columns(3)
            
            with row4[0]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #FEF9C3; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🚙</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Automotive</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Connected Cars & Navigation</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Network-Aware Navigation:</strong> Route vehicles based on network coverage for uninterrupted connectivity.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>OTA Updates:</strong> Optimise over-the-air software update scheduling based on coverage and data speeds.</p>
                        <p><strong>Autonomous Vehicle Support:</strong> Provide coverage maps for autonomous vehicle route planning and safety.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            with row4[1]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #E0F2FE; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🔬</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">Academic Research</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Urban Studies & Social Science</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Urban Mobility Research:</strong> Support academic studies on commuting, urban sprawl, and social dynamics.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Economic Analysis:</strong> Measure economic activity and recovery using mobility as a proxy indicator.</p>
                        <p><strong>Behavioural Studies:</strong> Anonymised data for research on human behaviour and social patterns.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
            with row4[2]:
                st.markdown("""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 1.25rem; height: 320px;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: #CFFAFE; width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">📱</div>
                        <div style="margin-left: 0.75rem;">
                            <div style="font-weight: 700; color: #1B2A4E; font-size: 1.1rem;">App Developers</div>
                            <div style="font-size: 0.75rem; color: #6B7280;">Network-Aware Applications</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                        <p style="margin-bottom: 0.75rem;"><strong>Adaptive Streaming:</strong> Adjust video quality dynamically based on predicted network conditions.</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Offline Mode Triggers:</strong> Pre-download content before users enter poor coverage areas.</p>
                        <p><strong>QoS Optimisation:</strong> Prioritise features based on available bandwidth and latency conditions.</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
            
        
        # Strategic Priorities
        st.markdown("---")

    with tab_strategy:
        st.markdown('<div class="section-header">Data Monetization Strategic Priorities — Q1 2026</div>', unsafe_allow_html=True)
        
        priority_cols = st.columns(3)
        with priority_cols[0]:
            with st.container(border=True):
                st.markdown("### 🚀 Product Expansion")
                st.markdown("- Launch 5G coverage premium tier")
                st.markdown("- New clean room partnerships (retail, finance)")
                st.markdown("- Real-time streaming data products")
                st.markdown("- Expand Marketplace listings to 20")
        
        with priority_cols[1]:
            with st.container(border=True):
                st.markdown("### 💰 Revenue Growth")
                st.markdown("- Target £50M ARR by Q4 2026")
                st.markdown("- Increase MVNO revenue share 15%")
                st.markdown("- Launch usage-based pricing tier")
                st.markdown("- Cross-sell to existing partners")
        
        with priority_cols[2]:
            with st.container(border=True):
                st.markdown("### 🔐 Trust & Governance")
                st.markdown("- ISO 27701 privacy certification")
                st.markdown("- Enhanced consent management")
                st.markdown("- Automated data classification")
                st.markdown("- Expand audit capabilities")


def render_architecture_page():
    st.markdown("""
    <div class="main-header">
        <h1>SnowTelco Technical Architecture</h1>
        <p>Enterprise Data & AI Platform — Powered by Snowflake Intelligence</p>
    </div>
    """, unsafe_allow_html=True)
    
    # Architecture Tabs
    tab1, tab2, tab3, tab4, tab5, tab6 = st.tabs([
        "🏗️ Overview", 
        "⚙️ Data Engineering", 
        "🧠 Data Science & AI",
        "🤖 Snowflake Intelligence",
        "📊 Visualization",
        "🔒 Security & Governance"
    ])
    
    # ==================== OVERVIEW TAB ====================
    with tab1:
        st.markdown('<div class="section-header">Platform Architecture Overview</div>', unsafe_allow_html=True)
        
        if st.session_state.get('sf_highlights', True):
            st.info("❄️ **Snowflake Data Cloud** — Unified platform for data engineering, data science, data sharing, and AI/ML with governance and security built-in")
        
        # Architecture Diagram using Graphviz
        import graphviz
        
        arch_diagram = graphviz.Digraph('Architecture', format='svg')
        arch_diagram.attr(rankdir='TB', bgcolor='#1B2A4E', fontcolor='white', fontname='Arial')
        arch_diagram.attr('node', shape='box', style='rounded,filled', fontname='Arial', fontsize='11')
        arch_diagram.attr('edge', color='#29B5E8', penwidth='2')
        
        # Data Sources cluster
        with arch_diagram.subgraph(name='cluster_sources') as c:
            c.attr(label='DATA SOURCES', style='rounded', color='#3B82F6', fontcolor='white', bgcolor='#2D3E63')
            c.node('bss', 'BSS/OSS', fillcolor='#3B82F6', fontcolor='white')
            c.node('crm', 'CRM', fillcolor='#3B82F6', fontcolor='white')
            c.node('network', 'Network', fillcolor='#3B82F6', fontcolor='white')
            c.node('finance', 'Finance', fillcolor='#3B82F6', fontcolor='white')
            c.node('iot', 'IoT', fillcolor='#3B82F6', fontcolor='white')
            c.node('docs', 'Documents', fillcolor='#3B82F6', fontcolor='white')
        
        # Ingestion cluster
        with arch_diagram.subgraph(name='cluster_ingestion') as c:
            c.attr(label='INGESTION & TRANSFORMATION', style='rounded', color='#10B981', fontcolor='white', bgcolor='#2D3E63')
            c.node('snowpipe', 'Snowpipe', fillcolor='#10B981', fontcolor='white')
            c.node('dynamic', 'Dynamic Tables', fillcolor='#10B981', fontcolor='white')
            c.node('streams', 'Streams/Tasks', fillcolor='#10B981', fontcolor='white')
            c.node('dbt', 'dbt', fillcolor='#10B981', fontcolor='white')
        
        # Snowflake Platform cluster
        with arch_diagram.subgraph(name='cluster_snowflake') as c:
            c.attr(label='SNOWFLAKE DATA CLOUD', style='rounded,bold', color='#29B5E8', fontcolor='#29B5E8', bgcolor='#1E3A5F', penwidth='3')
            c.node('cortex', 'Cortex AI\\nLLM • ML • Search', fillcolor='#29B5E8', fontcolor='white')
            c.node('intelligence', 'Intelligence\\nAgents • Analyst', fillcolor='#29B5E8', fontcolor='white')
            c.node('semantic', 'Semantic Layer\\nViews • Models', fillcolor='#29B5E8', fontcolor='white')
        
        # Consumption cluster
        with arch_diagram.subgraph(name='cluster_consumption') as c:
            c.attr(label='CONSUMPTION & APPLICATIONS', style='rounded', color='#8B5CF6', fontcolor='white', bgcolor='#2D3E63')
            c.node('streamlit', 'Streamlit', fillcolor='#8B5CF6', fontcolor='white')
            c.node('chat', 'AI Chat', fillcolor='#8B5CF6', fontcolor='white')
            c.node('bi', 'BI Tools', fillcolor='#8B5CF6', fontcolor='white')
            c.node('api', 'APIs', fillcolor='#8B5CF6', fontcolor='white')
        
        # Edges - Sources to Ingestion
        arch_diagram.edge('bss', 'snowpipe')
        arch_diagram.edge('crm', 'snowpipe')
        arch_diagram.edge('network', 'streams')
        arch_diagram.edge('finance', 'dbt')
        arch_diagram.edge('iot', 'streams')
        arch_diagram.edge('docs', 'dynamic')
        
        # Edges - Ingestion to Snowflake
        arch_diagram.edge('snowpipe', 'semantic')
        arch_diagram.edge('dynamic', 'semantic')
        arch_diagram.edge('streams', 'semantic')
        arch_diagram.edge('dbt', 'semantic')
        
        # Edges - Internal Snowflake
        arch_diagram.edge('semantic', 'cortex')
        arch_diagram.edge('semantic', 'intelligence')
        arch_diagram.edge('cortex', 'intelligence')
        
        # Edges - Snowflake to Consumption
        arch_diagram.edge('intelligence', 'streamlit')
        arch_diagram.edge('intelligence', 'chat')
        arch_diagram.edge('cortex', 'bi')
        arch_diagram.edge('semantic', 'api')
        
        # Display smaller architecture diagram
        col_arch, col_empty = st.columns([2, 1])
        with col_arch:
            st.graphviz_chart(arch_diagram)
        
        # Simple Data Flow Stats
        st.markdown('<div class="section-header">Live Data Pipeline</div>', unsafe_allow_html=True)
        
        flow_cols = st.columns(5)
        flow_data = [
            ("📥", "Sources", "6", "CRM, Billing, Network..."),
            ("⚡", "Ingestion", "2.4M/day", "Snowpipe, Streams"),
            ("❄️", "Processing", "<100ms", "Cortex AI"),
            ("📊", "Outputs", "32", "Dashboards, APIs"),
            ("✅", "Uptime", "99.9%", "SLA Compliance")
        ]
        for col, (icon, label, value, desc) in zip(flow_cols, flow_data):
            with col:
                st.markdown(f"""
                <div style="background: linear-gradient(135deg, #1B2A4E 0%, #0F172A 100%); border-radius: 12px; padding: 1rem; text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: 0.3rem;">{icon}</div>
                    <div style="color: rgba(255,255,255,0.6); font-size: 0.7rem; text-transform: uppercase;">{label}</div>
                    <div style="color: #29B5E8; font-size: 1.3rem; font-weight: 700;">{value}</div>
                    <div style="color: rgba(255,255,255,0.5); font-size: 0.65rem; margin-top: 0.2rem;">{desc}</div>
                </div>
                """, unsafe_allow_html=True)
        
        # Platform Stats
        stat_cols = st.columns(6)
        stats = [
            ("30K+", "Subscribers", "#29B5E8"),
            ("34", "Semantic Views", "#10B981"),
            ("41", "Agent Tools", "#8B5CF6"),
            ("7", "Search Services", "#F59E0B"),
            ("32", "Dashboards", "#EC4899"),
            ("99.9%", "Platform SLA", "#10B981")
        ]
        for col, (value, label, color) in zip(stat_cols, stats):
            with col:
                st.markdown(f"""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: {color};">{value}</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">{label}</div>
                </div>
                """, unsafe_allow_html=True)
        
        st.markdown("<br>", unsafe_allow_html=True)
        
        # Key Capabilities
        st.markdown('<div class="section-header">Platform Capabilities</div>', unsafe_allow_html=True)
        
        cap_cols = st.columns(4)
        capabilities = [
            ("Real-Time Analytics", "Sub-second query performance on live operational data", "⚡"),
            ("AI-Powered Insights", "Natural language queries with Cortex Analyst", "🧠"),
            ("Unified Data", "Single source of truth across all domains", "🔗"),
            ("Enterprise Scale", "Elastic compute with automatic scaling", "📈")
        ]
        for col, (title, desc, icon) in zip(cap_cols, capabilities):
            with col:
                st.markdown(f"""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 8px; padding: 1.25rem; height: 140px;">
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">{icon}</div>
                    <div style="font-weight: 600; color: #1B2A4E; margin-bottom: 0.3rem;">{title}</div>
                    <div style="font-size: 0.8rem; color: #6B7280;">{desc}</div>
                </div>
                """, unsafe_allow_html=True)
    
    # ==================== DATA ENGINEERING TAB ====================
    with tab2:
        st.markdown('<div class="section-header">Data Engineering Architecture</div>', unsafe_allow_html=True)
        
        # Data Pipeline Overview
        pipe_col1, pipe_col2 = st.columns(2)
        
        with pipe_col1:
            st.markdown("**Data Ingestion Pipelines**")
            with st.container(border=True):
                st.markdown("**Snowpipe Streaming** &nbsp;&nbsp; <span style='color: #10B981;'>● Active</span>", unsafe_allow_html=True)
                st.caption("Real-time CDC from BSS/OSS systems • 2.4M events/hour")
                st.divider()
                st.markdown("**Batch ETL (dbt)** &nbsp;&nbsp; <span style='color: #10B981;'>● Active</span>", unsafe_allow_html=True)
                st.caption("Daily transforms • 847 models • 99.8% success rate")
                st.divider()
                st.markdown("**Dynamic Tables** &nbsp;&nbsp; <span style='color: #10B981;'>● Active</span>", unsafe_allow_html=True)
                st.caption("Incremental processing • 5-minute lag • Auto-refresh")
                st.divider()
                st.markdown("**File Ingestion** &nbsp;&nbsp; <span style='color: #10B981;'>● Active</span>", unsafe_allow_html=True)
                st.caption("S3/Azure/GCS stages • CSV, Parquet, JSON • Auto-ingest")
        
        with pipe_col2:
            st.markdown("**Data Quality Framework**")
            with st.container(border=True):
                st.markdown("Completeness: **99.2%**")
                st.progress(0.992)
                st.markdown("Accuracy: **98.8%**")
                st.progress(0.988)
                st.markdown("Timeliness: **99.5%**")
                st.progress(0.995)
                st.markdown("Consistency: **97.4%**")
                st.progress(0.974)
                st.markdown("Uniqueness: **99.9%**")
                st.progress(0.999)
                st.success("Overall DQ Score: **98.9%**")
        
        # Data Layers
        st.markdown('<div class="section-header">Data Lakehouse Layers</div>', unsafe_allow_html=True)
        
        layer_cols = st.columns(4)
        
        with layer_cols[0]:
            with st.container(border=True):
                st.markdown("🥉 **Bronze**")
                st.subheader("RAW")
                st.caption("Source system replicas, CDC logs, raw files")
                st.metric("Tables", "42")
        
        with layer_cols[1]:
            with st.container(border=True):
                st.markdown("🥈 **Silver**")
                st.subheader("STAGING")
                st.caption("Cleansed, deduplicated, standardized")
                st.metric("Tables", "128")
        
        with layer_cols[2]:
            with st.container(border=True):
                st.markdown("🥇 **Gold**")
                st.subheader("CURATED")
                st.caption("Business entities, aggregations, KPIs")
                st.metric("Tables", "86")
        
        with layer_cols[3]:
            with st.container(border=True):
                st.markdown("💎 **Platinum**")
                st.subheader("SEMANTIC")
                st.caption("Semantic views, AI-ready datasets")
                st.metric("Views", "37")
        
        # Data Flow Diagram
        st.markdown('<div class="section-header">Data Flow Architecture</div>', unsafe_allow_html=True)
        
        data_flow = graphviz.Digraph('DataFlow', format='svg')
        data_flow.attr(rankdir='LR', bgcolor='white', fontname='Arial', nodesep='0.5')
        data_flow.attr('node', shape='box', style='rounded,filled', fontname='Arial', fontsize='9')
        data_flow.attr('edge', color='#29B5E8', penwidth='1.5')
        
        # Bronze layer nodes
        with data_flow.subgraph(name='cluster_bronze') as c:
            c.attr(label='BRONZE (RAW)', style='rounded,dashed', color='#9CA3AF', fontcolor='#6B7280')
            c.node('raw_billing', 'Billing CDC', fillcolor='#E5E7EB', fontcolor='#374151')
            c.node('raw_network', 'Network Logs', fillcolor='#E5E7EB', fontcolor='#374151')
            c.node('raw_customer', 'Customer Events', fillcolor='#E5E7EB', fontcolor='#374151')
        
        # Silver layer nodes
        with data_flow.subgraph(name='cluster_silver') as c:
            c.attr(label='SILVER (STAGING)', style='rounded,dashed', color='#6B7280', fontcolor='#6B7280')
            c.node('stg_billing', 'STG_BILLING', fillcolor='#D1D5DB', fontcolor='#374151')
            c.node('stg_network', 'STG_NETWORK', fillcolor='#D1D5DB', fontcolor='#374151')
            c.node('stg_customer', 'STG_CUSTOMER', fillcolor='#D1D5DB', fontcolor='#374151')
        
        # Gold layer nodes
        with data_flow.subgraph(name='cluster_gold') as c:
            c.attr(label='GOLD (CURATED)', style='rounded,dashed', color='#F59E0B', fontcolor='#D97706')
            c.node('dim_customer', 'DIM_CUSTOMER', fillcolor='#FEF3C7', fontcolor='#92400E')
            c.node('fact_usage', 'FACT_USAGE', fillcolor='#FEF3C7', fontcolor='#92400E')
            c.node('fact_revenue', 'FACT_REVENUE', fillcolor='#FEF3C7', fontcolor='#92400E')
        
        # Platinum layer nodes
        with data_flow.subgraph(name='cluster_platinum') as c:
            c.attr(label='PLATINUM (SEMANTIC)', style='rounded,bold', color='#29B5E8', fontcolor='#0369A1', penwidth='2')
            c.node('sem_mobile', 'MOBILE_VIEW', fillcolor='#E0F2FE', fontcolor='#0369A1')
            c.node('sem_finance', 'FINANCE_VIEW', fillcolor='#E0F2FE', fontcolor='#0369A1')
            c.node('sem_propensity', 'PROPENSITY_VIEW', fillcolor='#E0F2FE', fontcolor='#0369A1')
        
        # Edges
        data_flow.edge('raw_billing', 'stg_billing')
        data_flow.edge('raw_network', 'stg_network')
        data_flow.edge('raw_customer', 'stg_customer')
        data_flow.edge('stg_billing', 'fact_revenue')
        data_flow.edge('stg_network', 'fact_usage')
        data_flow.edge('stg_customer', 'dim_customer')
        data_flow.edge('dim_customer', 'sem_mobile')
        data_flow.edge('fact_usage', 'sem_mobile')
        data_flow.edge('fact_revenue', 'sem_finance')
        data_flow.edge('dim_customer', 'sem_propensity')
        data_flow.edge('fact_usage', 'sem_propensity')
        
        st.graphviz_chart(data_flow, use_container_width=True)
        
        # Comprehensive Data Sources Inventory
        st.markdown('<div class="section-header">Data Sources Inventory</div>', unsafe_allow_html=True)
        
        # Summary metrics using native Streamlit
        inv_cols = st.columns(5)
        with inv_cols[0]:
            st.metric("Active Sources", "24")
        with inv_cols[1]:
            st.metric("Real-time Streams", "18")
        with inv_cols[2]:
            st.metric("Events/Hour", "2.4M")
        with inv_cols[3]:
            st.metric("Daily Volume", "4.2TB")
        with inv_cols[4]:
            st.metric("Availability", "99.7%")
        
        st.markdown("<br>", unsafe_allow_html=True)
        
        # BSS/OSS Systems
        st.markdown("**BSS/OSS Systems** — Business & Operations Support")
        bss_data = pd.DataFrame({
            'System': ['Amdocs Billing', 'Salesforce CRM', 'Siebel Order Mgmt', 'Cerillion Revenue Mgmt', 'Comverse IN Platform'],
            'Vendor': ['Amdocs', 'Salesforce', 'Oracle', 'Cerillion', 'Comverse'],
            'Data Type': ['Invoices, CDRs, Payments', 'Customers, Accounts, Cases', 'Orders, Provisioning, SIMs', 'Rating, Charging, Mediation', 'Prepaid Balance, Top-ups'],
            'Ingestion': ['Kafka CDC', 'REST API', 'DB Link CDC', 'Kafka CDC', 'SFTP Batch'],
            'Frequency': ['Real-time', '5 minutes', 'Real-time', 'Real-time', 'Hourly'],
            'Volume/Day': ['142M records', '2.8M records', '890K records', '48M records', '12M records'],
            'Status': ['✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active'],
            'Last Sync': ['2 min ago', '3 min ago', '1 min ago', '30 sec ago', '18 min ago']
        })
        st.dataframe(bss_data, use_container_width=True, hide_index=True)
        
        # Network Systems
        st.markdown("**Network OSS** — Network Operations & Performance")
        network_data = pd.DataFrame({
            'System': ['Ericsson ENM', 'Nokia NetAct', 'Huawei iManager', 'TEOCO Helix', 'Netcracker Inventory'],
            'Vendor': ['Ericsson', 'Nokia', 'Huawei', 'TEOCO', 'Netcracker'],
            'Data Type': ['RAN Performance, KPIs', 'Alarms, Faults, Config', 'Transport, Backhaul KPIs', 'Network Analytics, QoE', 'Network Inventory, Topology'],
            'Ingestion': ['Kafka Stream', 'SNMP Trap', 'REST API', 'SFTP Batch', 'DB Link CDC'],
            'Frequency': ['15 seconds', 'Real-time', '5 minutes', '15 minutes', 'Hourly'],
            'Volume/Day': ['1.8B metrics', '24M events', '420M metrics', '86M records', '2.4M records'],
            'Status': ['✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active'],
            'Last Sync': ['15 sec ago', '5 sec ago', '2 min ago', '8 min ago', '42 min ago']
        })
        st.dataframe(network_data, use_container_width=True, hide_index=True)
        
        # Enterprise Systems
        st.markdown("**Enterprise Systems** — Finance, HR & Operations")
        enterprise_data = pd.DataFrame({
            'System': ['SAP S/4HANA', 'Workday HCM', 'ServiceNow ITSM', 'Coupa Procurement', 'ClickSoftware FSM'],
            'Vendor': ['SAP', 'Workday', 'ServiceNow', 'Coupa', 'Salesforce'],
            'Data Type': ['GL, AP, AR, Fixed Assets', 'Employees, Payroll, Absence', 'Incidents, Changes, Assets', 'POs, Invoices, Contracts', 'Work Orders, Technicians, GPS'],
            'Ingestion': ['SAP CDC', 'REST API', 'REST API', 'REST API', 'Kafka Stream'],
            'Frequency': ['Daily', 'Daily', '15 minutes', 'Hourly', 'Real-time'],
            'Volume/Day': ['4.2M records', '48K records', '124K records', '18K records', '890K records'],
            'Status': ['✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active'],
            'Last Sync': ['6:00 AM', '5:30 AM', '8 min ago', '24 min ago', '45 sec ago']
        })
        st.dataframe(enterprise_data, use_container_width=True, hide_index=True)
        
        # Marketing & Digital Systems
        st.markdown("**Marketing & Digital** — Campaigns, Digital & Analytics")
        marketing_data = pd.DataFrame({
            'System': ['Adobe Campaign', 'Google Analytics 4', 'Sprinklr Social', 'Braze', 'Medallia Experience'],
            'Vendor': ['Adobe', 'Google', 'Sprinklr', 'Braze', 'Medallia'],
            'Data Type': ['Campaigns, Journeys, Emails', 'Web/App Events, Conversions', 'Social Mentions, Sentiment', 'Push, In-App, User Profiles', 'NPS, CSAT, Surveys'],
            'Ingestion': ['REST API', 'BigQuery Export', 'Webhook', 'S3 Export', 'REST API'],
            'Frequency': ['Hourly', 'Daily', 'Real-time', 'Hourly', 'Hourly'],
            'Volume/Day': ['2.4M events', '48M events', '124K mentions', '8.4M events', '42K responses'],
            'Status': ['✅ Active', '✅ Active', '✅ Active', '✅ Active', '✅ Active'],
            'Last Sync': ['18 min ago', '4:00 AM', '2 min ago', '32 min ago', '48 min ago']
        })
        st.dataframe(marketing_data, use_container_width=True, hide_index=True)
        
        # External & Partner Systems
        st.markdown("**External & Partner Data** — Third-Party & Reference Data")
        external_data = pd.DataFrame({
            'System': ['Experian Consumer', 'Ofcom Porting Hub', 'ONS Statistics', 'Weather API', 'Snowflake Marketplace'],
            'Provider': ['Experian', 'Ofcom', 'UK Gov', 'Met Office', 'Various'],
            'Data Type': ['Credit Scores, Demographics', 'Port-in/out, PAC Codes', 'Census, Postcode, Economic', 'Weather, Forecasts, Alerts', 'Market Data, Benchmarks'],
            'Ingestion': ['SFTP Batch', 'API Gateway', 'S3 Download', 'REST API', 'Data Share'],
            'Frequency': ['Weekly', 'Real-time', 'Monthly', 'Hourly', 'Live'],
            'Volume/Day': ['2.4M records', '4.2K records', '86K records', '24K records', '—'],
            'Status': ['✅ Active', '✅ Active', '✅ Active', '✅ Active', '🔗 Live Share'],
            'Last Sync': ['Mon 6AM', '12 min ago', 'Jan 15', '28 min ago', 'Always']
        })
        st.dataframe(external_data, use_container_width=True, hide_index=True)
        
        # Document & Unstructured Sources
        st.markdown("**Documents & Unstructured** — Content & Knowledge Sources")
        docs_data = pd.DataFrame({
            'System': ['SharePoint Online', 'Confluence', 'Contract Repository', 'Email Archive'],
            'Vendor': ['Microsoft', 'Atlassian', 'DocuSign CLM', 'Mimecast'],
            'Data Type': ['Policies, Reports, Guides', 'Technical Docs, Runbooks', 'Contracts, Agreements, NDAs', 'Customer Correspondence'],
            'Ingestion': ['Graph API', 'REST API', 'REST API', 'S3 Archive'],
            'Frequency': ['Daily', 'Daily', 'On-change', 'Daily'],
            'Volume': ['2,847 docs', '1,248 pages', '4,820 docs', '124K emails'],
            'Status': ['✅ Active', '✅ Active', '✅ Active', '⚠️ Partial'],
            'Last Sync': ['3:00 AM', '4:00 AM', '2 hrs ago', '5:30 AM']
        })
        st.dataframe(docs_data, use_container_width=True, hide_index=True)
    
    # ==================== DATA SCIENCE & AI TAB ====================
    with tab3:
        st.markdown('<div class="section-header">Data Science & AI Platform</div>', unsafe_allow_html=True)
        
        # ML Models Overview
        ml_col1, ml_col2 = st.columns(2)
        
        with ml_col1:
            st.markdown("**Production ML Models**")
            ml_models_data = pd.DataFrame({
                'Model': ['Churn Propensity', 'Upsell Propensity', 'CLV Prediction', 'Fraud Detection', 'Network Anomaly', 'Next Best Action'],
                'Type': ['XGBoost', 'Random Forest', 'Neural Net', 'Isolation Forest', 'LSTM', 'Ensemble'],
                'Accuracy': ['92.4%', '89.1%', '87.6%', '94.2%', '91.8%', '84.3%'],
                'Status': ['✅ Live', '✅ Live', '✅ Live', '✅ Live', '✅ Live', '🟡 Beta']
            })
            st.dataframe(ml_models_data, use_container_width=True, hide_index=True)
        
        with ml_col2:
            st.markdown("**Snowflake Cortex AI Services**")
            with st.container(border=True):
                st.markdown("**Cortex LLM Functions** &nbsp;&nbsp; <span style='color: #10B981;'>● Active</span>", unsafe_allow_html=True)
                st.caption("COMPLETE, SUMMARIZE, TRANSLATE, SENTIMENT, EXTRACT_ANSWER")
                st.divider()
                st.markdown("**Cortex ML Functions** &nbsp;&nbsp; <span style='color: #10B981;'>● Active</span>", unsafe_allow_html=True)
                st.caption("FORECAST, ANOMALY_DETECTION, CLASSIFICATION, CONTRIBUTION_EXPLORER")
                st.divider()
                st.markdown("**Cortex Search** &nbsp;&nbsp; <span style='color: #10B981;'>● Active</span>", unsafe_allow_html=True)
                st.caption("Vector embeddings, semantic search, RAG pipelines")
                st.divider()
                st.markdown("**Snowpark ML** &nbsp;&nbsp; <span style='color: #10B981;'>● Active</span>", unsafe_allow_html=True)
                st.caption("Feature engineering, model training, ML pipelines")
        
        # Feature Store
        st.markdown('<div class="section-header">ML Feature Store</div>', unsafe_allow_html=True)
        
        feat_cols = st.columns(4)
        
        with feat_cols[0]:
            with st.container(border=True):
                st.metric("Customer Features", "248")
                st.caption("Demographics, tenure, value, behavior")
        
        with feat_cols[1]:
            with st.container(border=True):
                st.metric("Usage Features", "186")
                st.caption("Voice, data, SMS, roaming patterns")
        
        with feat_cols[2]:
            with st.container(border=True):
                st.metric("Network Features", "124")
                st.caption("QoE, coverage, device, technology")
        
        with feat_cols[3]:
            with st.container(border=True):
                st.metric("Financial Features", "92")
                st.caption("ARPU, payment, billing, disputes")
        
        # MLOps Pipeline using Graphviz
        st.markdown('<div class="section-header">MLOps Pipeline</div>', unsafe_allow_html=True)
        
        mlops_diagram = graphviz.Digraph('MLOps', format='svg')
        mlops_diagram.attr(rankdir='LR', bgcolor='white', fontname='Arial')
        mlops_diagram.attr('node', shape='box', style='rounded,filled', fontname='Arial', fontsize='10', height='0.8')
        mlops_diagram.attr('edge', color='#29B5E8', penwidth='2', arrowsize='0.8')
        
        mlops_diagram.node('feature', 'Feature Eng\\nSnowpark', fillcolor='#3B82F6', fontcolor='white')
        mlops_diagram.node('train', 'Training\\nSnowpark ML', fillcolor='#8B5CF6', fontcolor='white')
        mlops_diagram.node('validate', 'Validation\\nA/B Testing', fillcolor='#EC4899', fontcolor='white')
        mlops_diagram.node('registry', 'Registry\\nModel Store', fillcolor='#F59E0B', fontcolor='white')
        mlops_diagram.node('serve', 'Serving\\nUDFs/APIs', fillcolor='#10B981', fontcolor='white')
        mlops_diagram.node('monitor', 'Monitoring\\nDrift Detection', fillcolor='#29B5E8', fontcolor='white')
        
        mlops_diagram.edge('feature', 'train')
        mlops_diagram.edge('train', 'validate')
        mlops_diagram.edge('validate', 'registry')
        mlops_diagram.edge('registry', 'serve')
        mlops_diagram.edge('serve', 'monitor')
        mlops_diagram.edge('monitor', 'feature', style='dashed', color='#9CA3AF', label='retrain')
        
        st.graphviz_chart(mlops_diagram, use_container_width=True)
    
    # ==================== SNOWFLAKE INTELLIGENCE TAB ====================
    with tab4:
        st.markdown('<div class="section-header">Snowflake Intelligence Platform</div>', unsafe_allow_html=True)
        
        # Agent Configuration
        st.markdown("**Executive Intelligence Agent**")
        with st.container(border=True):
            st.markdown("""
            <div style="background: #F8FAFC; border-radius: 8px; padding: 1.5rem; border: 1px solid #E2E8F0;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <div>
                        <div style="font-size: 0.75rem; color: #64748B;">AGENT NAME</div>
                        <div style="font-size: 1.1rem; font-weight: 600; color: #29B5E8;">SnowTelco_V2_Executive_Agent</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: #9CA3AF;">DATABASE</div>
                        <div style="font-size: 1rem;">SnowTelco_V2</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: #9CA3AF;">SCHEMA</div>
                        <div style="font-size: 1rem;">SnowTelco_V2_SCHEMA</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: #9CA3AF;">WAREHOUSE</div>
                        <div style="font-size: 1rem;">SnowTelco_V2_Demo_WH</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: #9CA3AF;">STATUS</div>
                        <div style="font-size: 1rem; color: #10B981;">● Active</div>
                    </div>
                </div>
            </div>
            """, unsafe_allow_html=True)
        
        # Semantic Views and Search Tools
        tool_col1, tool_col2 = st.columns(2)
        
        with tool_col1:
            st.markdown("**Semantic Views (34 Tools)**")
            with st.container(border=True):
                semantic_views = [
                    "FINANCE", "SALES", "HR", "MARKETING", "MOBILE", "PORTING", "ORDER", "BILLING",
                    "PAYMENT", "NETWORK_OPS", "SUPPORT", "PARTNER", "ASSET", "IT_OPS", "SLA",
                    "NETWORK_ALARM", "REVENUE_ASSURANCE", "ACTIVATION", "DISPUTE", "SALES_PIPELINE",
                    "CUSTOMER_EXPERIENCE", "NETWORK_QOE", "PROPENSITY", "FIELD_OPERATIONS",
                    "MARKET_INTELLIGENCE", "SOCIAL_SENTIMENT", "SUSTAINABILITY", "FRAUD_DETECTION",
                    "B2B_CONTRACT", "WHOLESALE_MVNO", "RETAIL", "WORKFORCE", "RAN", "COMPLAINT",
                    "LEGAL_MATTER", "SUPPORT_TICKET", "PLAN"
                ]
                views_html = " ".join([f'<span style="background: #E0F2FE; color: #0369A1; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin: 0.1rem; display: inline-block;">{v}</span>' for v in semantic_views])
                st.markdown(f'<div style="max-height: 250px; overflow-y: auto;">{views_html}</div>', unsafe_allow_html=True)
        
        with tool_col2:
            st.markdown("**Document Search Services (7)**")
            with st.container(border=True):
                doc_services = [
                    ("Search_finance_docs", "Financial reports, budgets, audit docs"),
                    ("Search_hr_docs", "HR policies, handbooks, procedures"),
                    ("Search_marketing_docs", "Campaign briefs, brand guidelines"),
                    ("Search_sales_docs", "Sales playbooks, pricing, proposals"),
                    ("Search_strategy_docs", "Strategy documents, roadmaps"),
                    ("Search_demo_docs", "Demo guides, key facts, FAQs"),
                    ("Search_network_docs", "Technical docs, network specs")
                ]
                for name, desc in doc_services:
                    st.markdown(f"""
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB; font-size: 0.8rem;">
                        <strong style="color: #8B5CF6;">{name}</strong>
                        <span style="color: #6B7280;">{desc}</span>
                    </div>
                    """, unsafe_allow_html=True)
        
        # Agent Architecture Diagram
        st.markdown('<div class="section-header">Agent Architecture</div>', unsafe_allow_html=True)
        
        agent_diagram = graphviz.Digraph('AgentArch', format='svg')
        agent_diagram.attr(rankdir='LR', bgcolor='white', fontname='Arial')
        agent_diagram.attr('node', shape='box', style='rounded,filled', fontname='Arial', fontsize='10')
        agent_diagram.attr('edge', color='#29B5E8', penwidth='1.5')
        
        # User Input
        agent_diagram.node('user', 'User Query', fillcolor='#E0F2FE', fontcolor='#0369A1', shape='ellipse')
        
        # Agent Orchestrator
        with agent_diagram.subgraph(name='cluster_agent') as c:
            c.attr(label='SNOWFLAKE INTELLIGENCE AGENT', style='rounded,bold', color='#29B5E8', fontcolor='#0369A1', bgcolor='#F0F9FF', penwidth='2')
            c.node('orchestrator', 'Orchestrator\\nTool Selection', fillcolor='#29B5E8', fontcolor='white')
            c.node('planner', 'Query Planner', fillcolor='#0EA5E9', fontcolor='white')
        
        # Tools
        with agent_diagram.subgraph(name='cluster_tools') as c:
            c.attr(label='TOOLS (41)', style='rounded', color='#10B981', fontcolor='#059669')
            c.node('analyst', 'Cortex Analyst\\nText-to-SQL', fillcolor='#10B981', fontcolor='white')
            c.node('search', 'Cortex Search\\nRAG', fillcolor='#059669', fontcolor='white')
            c.node('semantic', 'Semantic Views\\n34 domains', fillcolor='#047857', fontcolor='white')
        
        # Output
        agent_diagram.node('response', 'Response\\n+ Visualization', fillcolor='#8B5CF6', fontcolor='white', shape='ellipse')
        
        # Edges
        agent_diagram.edge('user', 'orchestrator')
        agent_diagram.edge('orchestrator', 'planner')
        agent_diagram.edge('planner', 'analyst')
        agent_diagram.edge('planner', 'search')
        agent_diagram.edge('planner', 'semantic')
        agent_diagram.edge('analyst', 'response')
        agent_diagram.edge('search', 'response')
        agent_diagram.edge('semantic', 'response')
        
        st.graphviz_chart(agent_diagram, use_container_width=True)
        
        # Cortex Analyst Configuration
        st.markdown('<div class="section-header">Cortex Analyst Configuration</div>', unsafe_allow_html=True)
        
        analyst_cols = st.columns(3)
        
        with analyst_cols[0]:
            st.markdown("**Text-to-SQL Engine**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Model</span><span style="font-weight: 600;">Claude 3.5 Sonnet</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Context Window</span><span style="font-weight: 600;">200K tokens</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>SQL Accuracy</span><span style="font-weight: 600; color: #10B981;">94.2%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>Avg Response</span><span style="font-weight: 600;">2.4s</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with analyst_cols[1]:
            st.markdown("**RAG Configuration**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Embedding Model</span><span style="font-weight: 600;">e5-base-v2</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Vector Dimension</span><span style="font-weight: 600;">768</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Documents Indexed</span><span style="font-weight: 600;">2,847</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>Chunk Size</span><span style="font-weight: 600;">512 tokens</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with analyst_cols[2]:
            st.markdown("**Agent Capabilities**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Multi-turn Conv.</span><span style="color: #10B981;">✓ Enabled</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Tool Selection</span><span style="color: #10B981;">✓ Enabled</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span>Visualization</span><span style="color: #10B981;">✓ Enabled</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.4rem 0;">
                        <span>Export Results</span><span style="color: #10B981;">✓ Enabled</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
    
    # ==================== VISUALIZATION TAB ====================
    with tab5:
        st.markdown('<div class="section-header">Visualization & Analytics Layer</div>', unsafe_allow_html=True)
        
        # Dashboard Overview
        dash_col1, dash_col2 = st.columns(2)
        
        with dash_col1:
            st.markdown("**Executive Dashboards (28)**")
            with st.container(border=True):
                dashboards = [
                    ("C-Suite", ["CEO", "CFO", "CMO", "CTO", "COO", "CCO", "CXO", "CNO", "CDO", "CSO"]),
                    ("VP Level", ["Customer Service", "Network Ops", "Partners", "Billing", "IT", "Field Ops", "Strategy", "Communications"]),
                    ("Specialist", ["Regulatory", "Security", "Enterprise Sales", "Wholesale", "Retail", "CHRO", "Legal", "Product", "Procurement"])
                ]
                for category, items in dashboards:
                    st.markdown(f"""
                    <div style="margin-bottom: 0.75rem;">
                        <div style="font-weight: 600; color: #1B2A4E; margin-bottom: 0.3rem;">{category}</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                            {"".join([f'<span style="background: #F3F4F6; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem;">{item}</span>' for item in items])}
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
        
        with dash_col2:
            st.markdown("**Visualization Components**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><strong>KPI Cards</strong></span>
                        <span style="color: #6B7280;">Real-time metrics with trends</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><strong>Charts (Altair)</strong></span>
                        <span style="color: #6B7280;">Line, bar, area, scatter plots</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><strong>HTML Visuals</strong></span>
                        <span style="color: #6B7280;">Custom progress bars, funnels</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <span><strong>Data Tables</strong></span>
                        <span style="color: #6B7280;">Sortable, filterable grids</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                        <span><strong>AI Chat Interface</strong></span>
                        <span style="color: #6B7280;">Natural language queries</span>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        # Semantic Layer
        st.markdown('<div class="section-header">Semantic Layer Architecture</div>', unsafe_allow_html=True)
        
        st.markdown("""
        <div style="background: white; border: 1px solid #E5E7EB; border-radius: 8px; padding: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: stretch; gap: 1rem; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 150px; background: #F0F9FF; border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="font-weight: 600; color: #0369A1; margin-bottom: 0.5rem;">Business Metrics</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">KPIs, calculations, derived measures</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: #29B5E8; margin-top: 0.5rem;">248</div>
                </div>
                <div style="flex: 1; min-width: 150px; background: #F0FDF4; border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="font-weight: 600; color: #166534; margin-bottom: 0.5rem;">Dimensions</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">Hierarchies, attributes, lookups</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: #10B981; margin-top: 0.5rem;">186</div>
                </div>
                <div style="flex: 1; min-width: 150px; background: #FEF3C7; border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="font-weight: 600; color: #92400E; margin-bottom: 0.5rem;">Relationships</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">Joins, foreign keys, mappings</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: #F59E0B; margin-top: 0.5rem;">124</div>
                </div>
                <div style="flex: 1; min-width: 150px; background: #F5F3FF; border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="font-weight: 600; color: #5B21B6; margin-bottom: 0.5rem;">Security Rules</div>
                    <div style="font-size: 0.75rem; color: #6B7280;">Row-level, column-level policies</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: #8B5CF6; margin-top: 0.5rem;">42</div>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        # Streamlit App Architecture
        st.markdown('<div class="section-header">Application Architecture</div>', unsafe_allow_html=True)
        
        app_cols = st.columns(4)
        app_components = [
            ("Streamlit", "Frontend framework", "Python-based UI", "#FF4B4B"),
            ("Snowpark", "Data processing", "Server-side Python", "#29B5E8"),
            ("Altair", "Visualizations", "Declarative charts", "#F59E0B"),
            ("Cortex", "AI Services", "LLM & ML APIs", "#8B5CF6")
        ]
        for col, (name, role, desc, color) in zip(app_cols, app_components):
            with col:
                st.markdown(f"""
                <div style="background: white; border: 2px solid {color}; border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="font-weight: 700; color: {color}; font-size: 1.1rem;">{name}</div>
                    <div style="font-size: 0.8rem; color: #1B2A4E; margin: 0.3rem 0;">{role}</div>
                    <div style="font-size: 0.7rem; color: #6B7280;">{desc}</div>
                </div>
                """, unsafe_allow_html=True)
    
    # ==================== SECURITY & GOVERNANCE TAB ====================
    with tab6:
        st.markdown('<div class="section-header">Security & Data Governance</div>', unsafe_allow_html=True)
        
        sec_col1, sec_col2 = st.columns(2)
        
        with sec_col1:
            st.markdown("**Access Control**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>Role-Based Access (RBAC)</strong>
                            <span style="color: #10B981;">● Enabled</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem;">12 functional roles, hierarchy-based inheritance</div>
                    </div>
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>Row-Level Security</strong>
                            <span style="color: #10B981;">● Enabled</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem;">Region, department, customer segment filters</div>
                    </div>
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>Column Masking</strong>
                            <span style="color: #10B981;">● Enabled</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem;">PII, financial data, sensitive fields</div>
                    </div>
                    <div style="padding: 0.5rem 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>MFA Requirement</strong>
                            <span style="color: #10B981;">● Enforced</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem;">SSO with Azure AD, Duo MFA</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        with sec_col2:
            st.markdown("**Data Governance**")
            with st.container(border=True):
                st.markdown("""
                <div style="font-size: 0.85rem;">
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>Data Classification</strong>
                            <span style="color: #10B981;">● Active</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem;">Public, Internal, Confidential, Restricted</div>
                    </div>
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>Lineage Tracking</strong>
                            <span style="color: #10B981;">● Active</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem;">End-to-end data flow visibility</div>
                    </div>
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>Audit Logging</strong>
                            <span style="color: #10B981;">● Active</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem;">Query history, access logs, 90-day retention</div>
                    </div>
                    <div style="padding: 0.5rem 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>Data Retention</strong>
                            <span style="color: #10B981;">● Configured</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.2rem;">Time Travel 14 days, Fail-safe 7 days</div>
                    </div>
                </div>
                """, unsafe_allow_html=True)
        
        # Compliance Frameworks
        st.markdown('<div class="section-header">Compliance & Certifications</div>', unsafe_allow_html=True)
        
        comp_cols = st.columns(6)
        compliance = [
            ("GDPR", "EU Data Protection", "#3B82F6"),
            ("SOC 2", "Type II Certified", "#10B981"),
            ("ISO 27001", "InfoSec Management", "#8B5CF6"),
            ("PCI DSS", "Payment Security", "#F59E0B"),
            ("HIPAA", "Health Data Ready", "#EC4899"),
            ("Ofcom", "UK Telecom Regs", "#29B5E8")
        ]
        for col, (name, desc, color) in zip(comp_cols, compliance):
            with col:
                st.markdown(f"""
                <div style="background: white; border: 2px solid {color}; border-radius: 8px; padding: 0.75rem; text-align: center;">
                    <div style="font-weight: 700; color: {color}; font-size: 0.9rem;">{name}</div>
                    <div style="font-size: 0.65rem; color: #6B7280; margin-top: 0.2rem;">{desc}</div>
                </div>
                """, unsafe_allow_html=True)
        
        # Warehouse Configuration
        st.markdown('<div class="section-header">Compute Resources</div>', unsafe_allow_html=True)
        
        wh_cols = st.columns(3)
        warehouses = [
            ("SnowTelco_ETL_WH", "X-Large", "Data Engineering", "Multi-cluster auto-scale", "#10B981"),
            ("SnowTelco_Analytics_WH", "Large", "BI & Analytics", "Auto-suspend 5 min", "#29B5E8"),
            ("SnowTelco_ML_WH", "2X-Large", "ML Training", "Snowpark optimized", "#8B5CF6")
        ]
        for col, (name, size, purpose, config, color) in zip(wh_cols, warehouses):
            with col:
                st.markdown(f"""
                <div style="background: white; border: 1px solid #E5E7EB; border-radius: 8px; padding: 1rem;">
                    <div style="font-weight: 600; color: #1B2A4E; font-size: 0.9rem;">{name}</div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.8rem;">
                        <span style="color: #6B7280;">Size:</span>
                        <span style="font-weight: 600; color: {color};">{size}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                        <span style="color: #6B7280;">Purpose:</span>
                        <span>{purpose}</span>
                    </div>
                    <div style="font-size: 0.7rem; color: #6B7280; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #E5E7EB;">{config}</div>
                </div>
                """, unsafe_allow_html=True)

def main():
    st.set_page_config(
        page_title="SnowTelco Demo Dashboard",
        page_icon="❄️",
        layout="wide",
        initial_sidebar_state="expanded"
    )
    
    st.markdown(SNOWFLAKE_CSS, unsafe_allow_html=True)
    
    # Floating AI Chat Widget - Snowflake Intelligence
    st.markdown("""
    <style>
    .ai-chat-widget {
        position: fixed;
        bottom: 24px;
        right: 24px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 12px;
    }
    .ai-chat-button {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%);
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(41, 181, 232, 0.4);
        transition: all 0.3s ease;
        text-decoration: none;
        animation: chat-pulse 2s ease-in-out infinite;
    }
    .ai-chat-button:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 30px rgba(41, 181, 232, 0.6);
    }
    .ai-chat-button span {
        font-size: 28px;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }
    .ai-chat-label {
        background: white;
        padding: 8px 16px;
        border-radius: 20px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.15);
        font-size: 0.85rem;
        font-weight: 600;
        color: #1B2A4E;
        white-space: nowrap;
        animation: chat-label-bounce 3s ease-in-out infinite;
    }
    @keyframes chat-pulse {
        0%, 100% { box-shadow: 0 4px 20px rgba(41, 181, 232, 0.4); }
        50% { box-shadow: 0 4px 30px rgba(41, 181, 232, 0.7); }
    }
    @keyframes chat-label-bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-3px); }
    }
    </style>
    <div class="ai-chat-widget">
        <div class="ai-chat-label">Ask Snowflake Intelligence</div>
        <a href="https://ai.snowflake.com/sfseeurope/pjose_aws3" target="_blank" class="ai-chat-button">
            <span>❄️</span>
        </a>
    </div>
    """, unsafe_allow_html=True)
    
    # Visualization Index for Search
    VISUALIZATION_INDEX = [
        # Executive Summary
        {"name": "Company Health Overview", "dashboard": "Executive_Summary", "label": "Executive Summary"},
        {"name": "Key Performance Indicators", "dashboard": "Executive_Summary", "label": "Executive Summary"},

        # SnowTelco Website
        {"name": "Homepage Highlights", "dashboard": "SnowTelco_Website", "label": "SnowTelco Website"},
        {"name": "Plan Comparison", "dashboard": "SnowTelco_Website", "label": "SnowTelco Website"},
        {"name": "Coverage Map", "dashboard": "SnowTelco_Website", "label": "SnowTelco Website"},

        # Persona Hub
        {"name": "Persona Explorer", "dashboard": "Persona_Hub", "label": "Persona Hub"},
        {"name": "Persona Highlights", "dashboard": "Persona_Hub", "label": "Persona Hub"},
        {"name": "Persona Navigation", "dashboard": "Persona_Hub", "label": "Persona Hub"},

        # Executive Showcase
        {"name": "Executive Performance Signals", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "Revenue Bridge (YoY)", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "Revenue & EBITDA Margin Trend", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "Cash Flow vs Capex", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "Product Mix Momentum", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "ARPU by Segment", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "Plan Mix by Type", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "Regional Performance Heatmap", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "Competitive Porting Analysis", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "Experience vs NPS", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        {"name": "Churn Cohort Waterfall", "dashboard": "00_WOW_Executive_Showcase", "label": "Executive Showcase"},
        
        # CEO Strategic
        {"name": "Revenue Trend", "dashboard": "01_CEO_Strategic", "label": "CEO Strategic Dashboard"},
        {"name": "Customer Growth", "dashboard": "01_CEO_Strategic", "label": "CEO Strategic Dashboard"},
        {"name": "Market Share", "dashboard": "01_CEO_Strategic", "label": "CEO Strategic Dashboard"},
        {"name": "NPS Score Trend", "dashboard": "01_CEO_Strategic", "label": "CEO Strategic Dashboard"},
        {"name": "AI Executive Briefing", "dashboard": "01_CEO_Strategic", "label": "CEO Strategic Dashboard"},
        {"name": "Customer Overview", "dashboard": "01_CEO_Strategic", "label": "CEO Strategic Dashboard"},
        
        # CFO Finance
        {"name": "Revenue by Segment", "dashboard": "02_CFO_Finance", "label": "CFO Finance Dashboard"},
        {"name": "ARPU Analysis", "dashboard": "02_CFO_Finance", "label": "CFO Finance Dashboard"},
        {"name": "Cost Structure", "dashboard": "02_CFO_Finance", "label": "CFO Finance Dashboard"},
        {"name": "EBITDA Margin", "dashboard": "02_CFO_Finance", "label": "CFO Finance Dashboard"},
        {"name": "What-If Scenario Analysis", "dashboard": "02_CFO_Finance", "label": "CFO Finance Dashboard"},
        {"name": "Budget vs Actual", "dashboard": "02_CFO_Finance", "label": "CFO Finance Dashboard"},
        {"name": "Cash Flow", "dashboard": "02_CFO_Finance", "label": "CFO Finance Dashboard"},
        
        # CMO Marketing
        {"name": "Campaign Performance", "dashboard": "03_CMO_Marketing", "label": "CMO Marketing Dashboard"},
        {"name": "Customer Acquisition Cost", "dashboard": "03_CMO_Marketing", "label": "CMO Marketing Dashboard"},
        {"name": "Channel ROI", "dashboard": "03_CMO_Marketing", "label": "CMO Marketing Dashboard"},
        {"name": "Brand Sentiment", "dashboard": "03_CMO_Marketing", "label": "CMO Marketing Dashboard"},
        {"name": "Social Media Analytics", "dashboard": "03_CMO_Marketing", "label": "CMO Marketing Dashboard"},
        {"name": "B2C Customer Insights", "dashboard": "03_CMO_Marketing", "label": "CMO Marketing Dashboard"},
        {"name": "Customer Segmentation", "dashboard": "03_CMO_Marketing", "label": "CMO Marketing Dashboard"},
        
        # CTO Technology
        {"name": "System Availability", "dashboard": "04_CTO_Technology", "label": "CTO Technology Dashboard"},
        {"name": "IT Incidents", "dashboard": "04_CTO_Technology", "label": "CTO Technology Dashboard"},
        {"name": "Digital Transformation", "dashboard": "04_CTO_Technology", "label": "CTO Technology Dashboard"},
        {"name": "Cloud Migration", "dashboard": "04_CTO_Technology", "label": "CTO Technology Dashboard"},
        
        # COO Operations
        {"name": "Operational Efficiency", "dashboard": "05_COO_Operations", "label": "COO Operations Dashboard"},
        {"name": "SLA Compliance", "dashboard": "05_COO_Operations", "label": "COO Operations Dashboard"},
        {"name": "Field Operations", "dashboard": "05_COO_Operations", "label": "COO Operations Dashboard"},
        {"name": "Workforce Productivity", "dashboard": "05_COO_Operations", "label": "COO Operations Dashboard"},
        
        # CCO Commercial
        {"name": "Sales Pipeline", "dashboard": "06_CCO_Commercial", "label": "CCO Commercial Dashboard"},
        {"name": "Revenue by Product", "dashboard": "06_CCO_Commercial", "label": "CCO Commercial Dashboard"},
        {"name": "Subscriber Growth", "dashboard": "06_CCO_Commercial", "label": "CCO Commercial Dashboard"},
        {"name": "Churn Analysis", "dashboard": "06_CCO_Commercial", "label": "CCO Commercial Dashboard"},
        {"name": "Port-in Port-out", "dashboard": "06_CCO_Commercial", "label": "CCO Commercial Dashboard"},
        
        # CXO Customer Experience
        {"name": "Customer Satisfaction", "dashboard": "07_CXO_Customer_Experience", "label": "CXO Customer Experience"},
        {"name": "NPS by Segment", "dashboard": "07_CXO_Customer_Experience", "label": "CXO Customer Experience"},
        {"name": "Customer Journey", "dashboard": "07_CXO_Customer_Experience", "label": "CXO Customer Experience"},
        {"name": "Support Tickets", "dashboard": "07_CXO_Customer_Experience", "label": "CXO Customer Experience"},
        
        # CNO Network
        {"name": "Network Availability", "dashboard": "08_CNO_Network_QoE", "label": "CNO Network Dashboard"},
        {"name": "5G Coverage Map", "dashboard": "08_CNO_Network_QoE", "label": "CNO Network Dashboard"},
        {"name": "UK Coverage Map", "dashboard": "08_CNO_Network_QoE", "label": "CNO Network Dashboard"},
        {"name": "Network Quality", "dashboard": "08_CNO_Network_QoE", "label": "CNO Network Dashboard"},
        {"name": "Cell Site Performance", "dashboard": "08_CNO_Network_QoE", "label": "CNO Network Dashboard"},
        {"name": "Coverage by Region", "dashboard": "08_CNO_Network_QoE", "label": "CNO Network Dashboard"},
        
        # CDO Data Science
        {"name": "Churn Prediction Model", "dashboard": "09_CDO_Data_Science", "label": "CDO AI/ML Dashboard"},
        {"name": "Propensity Scores", "dashboard": "09_CDO_Data_Science", "label": "CDO AI/ML Dashboard"},
        {"name": "Customer Lifetime Value", "dashboard": "09_CDO_Data_Science", "label": "CDO AI/ML Dashboard"},
        {"name": "ML Model Performance", "dashboard": "09_CDO_Data_Science", "label": "CDO AI/ML Dashboard"},
        {"name": "Customer 360 Deep Dive", "dashboard": "11_VP_Customer_Service", "label": "VP Customer Service"},
        {"name": "Next Best Action", "dashboard": "09_CDO_Data_Science", "label": "CDO AI/ML Dashboard"},
        
        # CSO Sustainability
        {"name": "Carbon Footprint", "dashboard": "10_CSO_Sustainability", "label": "CSO Sustainability Dashboard"},
        {"name": "Energy Consumption", "dashboard": "10_CSO_Sustainability", "label": "CSO Sustainability Dashboard"},
        {"name": "ESG Metrics", "dashboard": "10_CSO_Sustainability", "label": "CSO Sustainability Dashboard"},
        {"name": "Renewable Energy", "dashboard": "10_CSO_Sustainability", "label": "CSO Sustainability Dashboard"},
        
        # VP Customer Service
        {"name": "Call Center Metrics", "dashboard": "11_VP_Customer_Service", "label": "VP Customer Service"},
        {"name": "Average Handle Time", "dashboard": "11_VP_Customer_Service", "label": "VP Customer Service"},
        {"name": "First Contact Resolution", "dashboard": "11_VP_Customer_Service", "label": "VP Customer Service"},
        {"name": "Customer Effort Score", "dashboard": "11_VP_Customer_Service", "label": "VP Customer Service"},
        
        # VP Network Operations
        {"name": "Network Alarms", "dashboard": "12_VP_Network_Operations", "label": "VP Network Operations"},
        {"name": "Capacity Utilization", "dashboard": "12_VP_Network_Operations", "label": "VP Network Operations"},
        {"name": "Fault Management", "dashboard": "12_VP_Network_Operations", "label": "VP Network Operations"},
        {"name": "RF Optimization", "dashboard": "12_VP_Network_Operations", "label": "VP Network Operations"},
        {"name": "Signal Quality (RSRP/RSRQ/SINR)", "dashboard": "12_VP_Network_Operations", "label": "VP Network Operations"},
        {"name": "Handover Success", "dashboard": "12_VP_Network_Operations", "label": "VP Network Operations"},
        {"name": "Call Drop Rate", "dashboard": "12_VP_Network_Operations", "label": "VP Network Operations"},
        
        # Alert Center
        {"name": "UK Network Map", "dashboard": "Alert_Center", "label": "Network Alert Center"},
        {"name": "Live Alert Feed", "dashboard": "Alert_Center", "label": "Network Alert Center"},
        {"name": "Critical Alerts", "dashboard": "Alert_Center", "label": "Network Alert Center"},
        {"name": "MTTR Analysis", "dashboard": "Alert_Center", "label": "Network Alert Center"},
        {"name": "SLA Compliance", "dashboard": "Alert_Center", "label": "Network Alert Center"},
        {"name": "Incident Response", "dashboard": "Alert_Center", "label": "Network Alert Center"},
        {"name": "Alert Trend", "dashboard": "Alert_Center", "label": "Network Alert Center"},
        {"name": "Tower Status", "dashboard": "Alert_Center", "label": "Network Alert Center"},
        
        # Head of Partners
        {"name": "Partner Revenue", "dashboard": "13_Head_of_Partners", "label": "Head of Partners"},
        {"name": "MVNO Performance", "dashboard": "13_Head_of_Partners", "label": "Head of Partners"},
        {"name": "Partner Pipeline", "dashboard": "13_Head_of_Partners", "label": "Head of Partners"},
        
        # VP Billing
        {"name": "Billing Accuracy", "dashboard": "14_VP_Billing_Revenue", "label": "VP Billing & Revenue"},
        {"name": "Revenue Assurance", "dashboard": "14_VP_Billing_Revenue", "label": "VP Billing & Revenue"},
        {"name": "Invoice Status", "dashboard": "14_VP_Billing_Revenue", "label": "VP Billing & Revenue"},
        
        # VP IT Digital
        {"name": "System Health", "dashboard": "15_VP_IT_Digital", "label": "VP IT & Digital"},
        {"name": "Incident Management", "dashboard": "15_VP_IT_Digital", "label": "VP IT & Digital"},
        {"name": "Application Performance", "dashboard": "15_VP_IT_Digital", "label": "VP IT & Digital"},
        
        # VP Field Operations
        {"name": "Technician Performance", "dashboard": "16_VP_Field_Operations", "label": "VP Field Operations"},
        {"name": "First Time Fix Rate", "dashboard": "16_VP_Field_Operations", "label": "VP Field Operations"},
        {"name": "Work Order Status", "dashboard": "16_VP_Field_Operations", "label": "VP Field Operations"},
        
        # VP Strategy
        {"name": "Competitor Analysis", "dashboard": "17_VP_Strategy", "label": "VP Strategy"},
        {"name": "Market Share Trend", "dashboard": "17_VP_Strategy", "label": "VP Strategy"},
        {"name": "ARPU Comparison", "dashboard": "17_VP_Strategy", "label": "VP Strategy"},
        
        # VP Communications
        {"name": "Social Sentiment", "dashboard": "18_VP_Communications", "label": "VP Communications"},
        {"name": "Media Coverage", "dashboard": "18_VP_Communications", "label": "VP Communications"},
        {"name": "Brand Mentions", "dashboard": "18_VP_Communications", "label": "VP Communications"},
        
        # Regulatory Compliance
        {"name": "Compliance Status", "dashboard": "19_Regulatory_Compliance", "label": "Regulatory Compliance"},
        {"name": "Ofcom Metrics", "dashboard": "19_Regulatory_Compliance", "label": "Regulatory Compliance"},
        {"name": "SLA Performance", "dashboard": "19_Regulatory_Compliance", "label": "Regulatory Compliance"},
        
        # VP Security
        {"name": "Fraud Detection", "dashboard": "20_VP_Security", "label": "VP Security"},
        {"name": "Security Incidents", "dashboard": "20_VP_Security", "label": "VP Security"},
        {"name": "Fraud by Category", "dashboard": "20_VP_Security", "label": "VP Security"},
        
        # VP Enterprise Sales
        {"name": "B2B Pipeline", "dashboard": "21_VP_Enterprise_Sales", "label": "VP Enterprise Sales"},
        {"name": "Contract Portfolio", "dashboard": "21_VP_Enterprise_Sales", "label": "VP Enterprise Sales"},
        {"name": "Enterprise Revenue", "dashboard": "21_VP_Enterprise_Sales", "label": "VP Enterprise Sales"},
        {"name": "Account Health", "dashboard": "21_VP_Enterprise_Sales", "label": "VP Enterprise Sales"},
        
        # VP Wholesale
        {"name": "Wholesale Revenue", "dashboard": "22_VP_Wholesale", "label": "VP Wholesale"},
        {"name": "MVNO Partners", "dashboard": "22_VP_Wholesale", "label": "VP Wholesale"},
        {"name": "Interconnect Traffic", "dashboard": "22_VP_Wholesale", "label": "VP Wholesale"},
        
        # VP Retail
        {"name": "Store Performance", "dashboard": "23_VP_Retail", "label": "VP Retail"},
        {"name": "Footfall Analytics", "dashboard": "23_VP_Retail", "label": "VP Retail"},
        {"name": "Retail Sales", "dashboard": "23_VP_Retail", "label": "VP Retail"},
        
        # CHRO People
        {"name": "Headcount", "dashboard": "24_CHRO_People", "label": "CHRO People"},
        {"name": "Employee Turnover", "dashboard": "24_CHRO_People", "label": "CHRO People"},
        {"name": "Training Completion", "dashboard": "24_CHRO_People", "label": "CHRO People"},
        
        # VP Legal
        {"name": "Legal Matters", "dashboard": "25_VP_Legal", "label": "VP Legal"},
        {"name": "Contract Risk", "dashboard": "25_VP_Legal", "label": "VP Legal"},
        {"name": "Litigation Status", "dashboard": "25_VP_Legal", "label": "VP Legal"},
        
        # VP Product
        {"name": "Product Performance", "dashboard": "26_VP_Product", "label": "VP Product Management"},
        {"name": "Plan Subscribers", "dashboard": "26_VP_Product", "label": "VP Product Management"},
        {"name": "ARPU by Plan", "dashboard": "26_VP_Product", "label": "VP Product Management"},
        
        # VP Procurement
        {"name": "Vendor Spend", "dashboard": "27_VP_Procurement", "label": "VP Procurement"},
        {"name": "Contract Renewals", "dashboard": "27_VP_Procurement", "label": "VP Procurement"},
        {"name": "Procurement Pipeline", "dashboard": "27_VP_Procurement", "label": "VP Procurement"},
        
        # Data Monetization
        {"name": "Data Revenue", "dashboard": "data_monetization", "label": "Data Monetization"},
        {"name": "Data Products", "dashboard": "data_monetization", "label": "Data Monetization"},
        {"name": "Data Sharing Architecture", "dashboard": "data_monetization", "label": "Data Monetization"},
        {"name": "Clean Rooms", "dashboard": "data_monetization", "label": "Data Monetization"},
        {"name": "Marketplace Listings", "dashboard": "data_monetization", "label": "Data Monetization"},
        {"name": "Partner Data Ecosystem", "dashboard": "data_monetization", "label": "Data Monetization"},
        {"name": "Cross-Industry Use Cases", "dashboard": "data_monetization", "label": "Data Monetization"},
        
        # Architecture
        {"name": "Platform Architecture", "dashboard": "architecture", "label": "Architecture Overview"},
        {"name": "Data Engineering", "dashboard": "architecture", "label": "Architecture Overview"},
        {"name": "Data Flow", "dashboard": "architecture", "label": "Architecture Overview"},
        {"name": "ML Models", "dashboard": "architecture", "label": "Architecture Overview"},
        {"name": "Snowflake Intelligence", "dashboard": "architecture", "label": "Architecture Overview"},
        {"name": "Data Sources Inventory", "dashboard": "architecture", "label": "Architecture Overview"},
    ]

    # Add generic search entries for every dashboard
    generic_terms = ["Overview", "KPIs", "Insights"]
    label_overrides = {
        "Executive_Summary": "Executive Summary",
        "03_CMO_Marketing": "CMO Marketing Dashboard",
        "04_CTO_Technology": "CTO Technology Dashboard",
        "05_COO_Operations": "COO Operations Dashboard",
        "06_CCO_Commercial": "CCO Commercial Dashboard",
        "07_CXO_Customer_Experience": "CXO Customer Experience Dashboard",
        "08_CNO_Network_QoE": "CNO Network Quality Dashboard",
        "09_CDO_Data_Science": "CDO AI/ML Analytics Dashboard",
        "10_CSO_Sustainability": "CSO Sustainability Dashboard"
    }
    extra_pages = {
        "data_monetization": "Data Monetization",
        "architecture": "Architecture Overview"
    }
    all_keys = set(PAGES.keys()) | set(label_overrides.keys()) | set(extra_pages.keys())
    existing = {(v["name"], v["dashboard"]) for v in VISUALIZATION_INDEX}
    for key in sorted(all_keys):
        label = extra_pages.get(key) or label_overrides.get(key) or PAGES[key]["title"]
        for term in generic_terms:
            name = f"{label} {term}"
            if (name, key) not in existing:
                VISUALIZATION_INDEX.append({"name": name, "dashboard": key, "label": label})
                existing.add((name, key))

    role_terms = {
        "Executive_Summary": ["executive summary", "company health", "kpi", "overview"],
        "SnowTelco_Website": ["website", "plans", "coverage", "pricing"],
        "Persona_Hub": ["persona", "role", "dashboard"],
        "00_WOW_Executive_Showcase": ["executive showcase", "performance", "market", "customers", "revenue", "nps"],
        "01_CEO_Strategic": ["strategy", "growth", "market share", "revenue", "nps"],
        "02_CFO_Finance": ["finance", "ebitda", "cash flow", "budget", "capex", "arpu"],
        "03_CMO_Marketing": ["marketing", "campaign", "cac", "roi", "sentiment", "social"],
        "04_CTO_Technology": ["technology", "availability", "incidents", "cloud", "digital transformation"],
        "05_COO_Operations": ["operations", "sla", "efficiency", "workforce", "field operations"],
        "06_CCO_Commercial": ["commercial", "pipeline", "revenue", "churn", "subscriber growth"],
        "07_CXO_Customer_Experience": ["customer experience", "nps", "csat", "journey", "tickets"],
        "08_CNO_Network_QoE": ["network", "5g", "coverage", "qoe", "cell site"],
        "09_CDO_Data_Science": ["data science", "ml", "churn prediction", "propensity", "clv", "model"],
        "10_CSO_Sustainability": ["sustainability", "esg", "carbon", "energy", "renewable"],
        "11_VP_Customer_Service": ["customer service", "call center", "aht", "fcr", "ces"],
        "12_VP_Network_Operations": ["network ops", "alarms", "capacity", "fault", "handover", "rsrp"],
        "Alert_Center": ["alerts", "incidents", "mttr", "sla", "network map"],
        "13_Head_of_Partners": ["partners", "mvno", "pipeline", "partner revenue"],
        "14_VP_Billing_Revenue": ["billing", "revenue assurance", "invoice", "disputes", "accuracy"],
        "15_VP_IT_Digital": ["it", "digital", "system health", "application performance", "incident management"],
        "16_VP_Field_Operations": ["field ops", "technician", "work orders", "first time fix"],
        "17_VP_Strategy": ["strategy", "competitor", "market share", "arpu", "pricing"],
        "18_VP_Communications": ["communications", "sentiment", "media", "brand"],
        "19_Regulatory_Compliance": ["regulatory", "compliance", "ofcom", "sla"],
        "20_VP_Security": ["security", "fraud", "incidents", "risk"],
        "21_VP_Enterprise_Sales": ["enterprise sales", "pipeline", "contracts", "account health"],
        "22_VP_Wholesale": ["wholesale", "mvno", "interconnect", "wholesale revenue"],
        "23_VP_Retail": ["retail", "stores", "footfall", "retail sales"],
        "24_CHRO_People": ["people", "headcount", "turnover", "training", "attrition"],
        "25_VP_Legal": ["legal", "litigation", "contracts", "compliance", "outside counsel"],
        "26_VP_Product": ["product", "roadmap", "launch", "pricing", "nps", "churn"],
        "27_VP_Procurement": ["procurement", "spend", "sourcing", "savings", "vendors"],
        "data_monetization": ["data monetization", "data products", "clean rooms", "marketplace"],
        "architecture": ["architecture", "data flow", "engineering", "ml models", "snowflake intelligence"]
    }

    for key, terms in role_terms.items():
        if key not in all_keys:
            continue
        label = extra_pages.get(key) or label_overrides.get(key) or PAGES[key]["title"]
        for term in terms:
            name = term.title() if term.islower() else term
            if (name, key) not in existing:
                VISUALIZATION_INDEX.append({"name": name, "dashboard": key, "label": label})
                existing.add((name, key))
    
    with st.sidebar:
        # Live Alerts Ticker
        st.markdown("""
        <style>
        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        @keyframes alert-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .sidebar-ticker {
            background: linear-gradient(135deg, #1E3A5F 0%, #0F2744 100%);
            border-radius: 8px;
            padding: 0.5rem;
            margin-bottom: 1rem;
            overflow: hidden;
            position: relative;
        }
        .ticker-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .ticker-live {
            background: #EF4444;
            color: white;
            font-size: 0.6rem;
            font-weight: 700;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            text-transform: uppercase;
            animation: alert-pulse 1.5s ease-in-out infinite;
        }
        .ticker-title {
            color: #94A3B8;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .ticker-container {
            overflow: hidden;
            white-space: nowrap;
        }
        .ticker-content {
            display: inline-block;
            animation: ticker-scroll 30s linear infinite;
        }
        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            margin-right: 2rem;
            color: white;
            font-size: 0.75rem;
        }
        .ticker-item .alert-icon {
            font-size: 0.9rem;
        }
        .ticker-item.critical { color: #F87171; }
        .ticker-item.warning { color: #FBBF24; }
        .ticker-item.success { color: #34D399; }
        .ticker-item.info { color: #60A5FA; }
        </style>
        <div class="sidebar-ticker">
            <div class="ticker-header">
                <span class="ticker-live">● LIVE</span>
                <span class="ticker-title">Key Alerts</span>
            </div>
            <div class="ticker-container">
                <div class="ticker-content">
                    <span class="ticker-item critical"><span class="alert-icon">🚨</span> Network outage detected in London Central</span>
                    <span class="ticker-item warning"><span class="alert-icon">⚠️</span> Churn risk: 847 high-value customers flagged</span>
                    <span class="ticker-item success"><span class="alert-icon">✅</span> 5G rollout: Manchester region complete</span>
                    <span class="ticker-item info"><span class="alert-icon">📈</span> Revenue up 12% vs target this month</span>
                    <span class="ticker-item critical"><span class="alert-icon">🔴</span> SLA breach risk: 3 enterprise accounts</span>
                    <span class="ticker-item warning"><span class="alert-icon">💳</span> £2.3M billing disputes pending review</span>
                    <span class="ticker-item success"><span class="alert-icon">🎯</span> NPS score hit 72 - new record high</span>
                    <span class="ticker-item info"><span class="alert-icon">🤖</span> AI model retrained: churn accuracy 94%</span>
                    <span class="ticker-item critical"><span class="alert-icon">🚨</span> Network outage detected in London Central</span>
                    <span class="ticker-item warning"><span class="alert-icon">⚠️</span> Churn risk: 847 high-value customers flagged</span>
                    <span class="ticker-item success"><span class="alert-icon">✅</span> 5G rollout: Manchester region complete</span>
                    <span class="ticker-item info"><span class="alert-icon">📈</span> Revenue up 12% vs target this month</span>
                    <span class="ticker-item critical"><span class="alert-icon">🔴</span> SLA breach risk: 3 enterprise accounts</span>
                    <span class="ticker-item warning"><span class="alert-icon">💳</span> £2.3M billing disputes pending review</span>
                    <span class="ticker-item success"><span class="alert-icon">🎯</span> NPS score hit 72 - new record high</span>
                    <span class="ticker-item info"><span class="alert-icon">🤖</span> AI model retrained: churn accuracy 94%</span>
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        render_snowflake_logo()
        
        # Search functionality
        st.markdown("""
        <style>
        .search-chip {
            display: inline-block;
            padding: 0.2rem 0.55rem;
            margin: 0 0.35rem 0.35rem 0;
            border-radius: 16px;
            background: #EEF2FF;
            color: #4338CA;
            font-size: 0.75rem;
            border: 1px solid #E0E7FF;
        }
        </style>
        """, unsafe_allow_html=True)
        st.markdown("**🔍 Search Insights**")
        search_query = st.text_input(
            "Search",
            placeholder="e.g., revenue, churn, NPS, CEO, network...",
            label_visibility="collapsed"
        )
        suggested_searches = [
            "Revenue", "Churn", "NPS", "ARPU", "Market Share",
            "Network", "5G", "SLA", "Cash Flow", "Procurement"
        ]
        if not search_query:
            st.caption("Popular searches:")
            st.markdown(
                " ".join([f"<span class='search-chip'>{term}</span>" for term in suggested_searches]),
                unsafe_allow_html=True
            )
        
        # Determine matching dashboards from search
        matching_dashboards = set()
        search_results = []
        
        if search_query and search_query.strip():
            query = search_query.strip().lower()
            # Filter visualizations based on search
            search_results = [
                v for v in VISUALIZATION_INDEX
                if query in v["name"].lower()
                or query in v["label"].lower()
                or query in v["dashboard"].lower()
            ]
            matching_dashboards = set(v["dashboard"] for v in search_results)
            
            if search_results:
                st.caption(f"Found in {len(matching_dashboards)} dashboard(s)")
            else:
                st.caption("No matches found")
        
        c_suite = ["Executive_Summary", "SnowTelco_Website", "Persona_Hub", "00_WOW_Executive_Showcase", "01_CEO_Strategic", "02_CFO_Finance", 
                   "03_CMO_Marketing", "04_CTO_Technology", "05_COO_Operations", 
                   "06_CCO_Commercial", "07_CXO_Customer_Experience", "08_CNO_Network_QoE",
                   "09_CDO_Data_Science", "10_CSO_Sustainability"]
        
        vp_level = ["11_VP_Customer_Service", "12_VP_Network_Operations", "Alert_Center", "13_Head_of_Partners",
                    "14_VP_Billing_Revenue", "15_VP_IT_Digital", "16_VP_Field_Operations",
                    "17_VP_Strategy", "18_VP_Communications", "19_Regulatory_Compliance",
                    "20_VP_Security", "21_VP_Enterprise_Sales", "22_VP_Wholesale",
                    "23_VP_Retail", "24_CHRO_People", "25_VP_Legal", "26_VP_Product",
                    "27_VP_Procurement"]
        
        # Build full page options and labels first
        all_page_options = []
        page_labels = {}
        
        for key in c_suite:
            if key in PAGES:
                label = "Executive Summary" if key == "Executive_Summary" else PAGES[key]['title']
                all_page_options.append(key)
                page_labels[key] = label
            elif key == "03_CMO_Marketing":
                all_page_options.append(key)
                page_labels[key] = "CMO Marketing Dashboard"
            elif key == "04_CTO_Technology":
                all_page_options.append(key)
                page_labels[key] = "CTO Technology Dashboard"
            elif key == "05_COO_Operations":
                all_page_options.append(key)
                page_labels[key] = "COO Operations Dashboard"
            elif key == "06_CCO_Commercial":
                all_page_options.append(key)
                page_labels[key] = "CCO Commercial Dashboard"
            elif key == "07_CXO_Customer_Experience":
                all_page_options.append(key)
                page_labels[key] = "CXO Customer Experience Dashboard"
            elif key == "08_CNO_Network_QoE":
                all_page_options.append(key)
                page_labels[key] = "CNO Network Quality Dashboard"
            elif key == "09_CDO_Data_Science":
                all_page_options.append(key)
                page_labels[key] = "CDO AI/ML Analytics Dashboard"
            elif key == "10_CSO_Sustainability":
                all_page_options.append(key)
                page_labels[key] = "CSO Sustainability Dashboard"
        
        for key in vp_level:
            if key in PAGES:
                all_page_options.append(key)
                page_labels[key] = PAGES[key]['title']
        
        all_page_options.append("data_monetization")
        page_labels["data_monetization"] = "Data Monetization & Sharing"
        
        all_page_options.append("architecture")
        page_labels["architecture"] = "Architecture Overview"
        
        # Tools section
        tools_section = ["data_monetization", "architecture"]
        
        # Filter based on search
        if search_query and matching_dashboards:
            filtered_csuite = [p for p in c_suite if p in matching_dashboards]
            filtered_vp = [p for p in vp_level if p in matching_dashboards]
            filtered_tools = [p for p in tools_section if p in matching_dashboards]
        else:
            filtered_csuite = c_suite
            filtered_vp = vp_level
            filtered_tools = tools_section
        
        # Initialize selected page in session state
        if 'selected_page' not in st.session_state:
            st.session_state.selected_page = "Executive_Summary"
        
        # Build combined list with section markers for styling
        all_nav_options = []
        section_boundaries = {'exec_end': 0, 'vp_end': 0}
        
        # Add filtered items from each section
        if filtered_csuite:
            all_nav_options.extend(filtered_csuite)
            section_boundaries['exec_end'] = len(all_nav_options)
        
        if filtered_vp:
            all_nav_options.extend(filtered_vp)
            section_boundaries['vp_end'] = len(all_nav_options)
        
        if filtered_tools:
            all_nav_options.extend(filtered_tools)
        
        # Find current index in combined list
        current_page = st.session_state.selected_page
        if current_page in all_nav_options:
            current_index = all_nav_options.index(current_page)
        else:
            current_index = 0
        
        # Single unified radio for all navigation
        selected_page = st.radio(
            "Navigation",
            all_nav_options,
            format_func=lambda x: page_labels.get(x, x),
            label_visibility="collapsed",
            key="nav_unified",
            index=current_index
        )
        
        # Update session state
        st.session_state.selected_page = selected_page
        
        # Inject JavaScript to apply section colors and highlight the current page
        current_page_label = page_labels.get(selected_page, selected_page)
        exec_end = section_boundaries['exec_end']
        vp_end = section_boundaries['vp_end']
        
        # Define section colors
        exec_color = '#E8F4FD'  # Light blue
        exec_border = '#29B5E8'
        vp_color = '#F3E8FD'    # Light purple  
        vp_border = '#8B5CF6'
        tools_color = '#E8FDF3'  # Light green
        tools_border = '#10B981'
        
        components.html(f'''
        <script>
            function styleNavigation() {{
                const allLabels = parent.document.querySelectorAll('section[data-testid="stSidebar"] .stRadio label');
                const execEnd = {exec_end};
                const vpEnd = {vp_end};
                
                // Apply section colors based on index
                allLabels.forEach((label, index) => {{
                    let bgColor, borderColor;
                    
                    if (index < execEnd) {{
                        // Executive section - blue
                        bgColor = '{exec_color}';
                        borderColor = '{exec_border}';
                    }} else if (index < vpEnd) {{
                        // VP section - purple
                        bgColor = '{vp_color}';
                        borderColor = '{vp_border}';
                    }} else {{
                        // Tools section - green
                        bgColor = '{tools_color}';
                        borderColor = '{tools_border}';
                    }}
                    
                    label.style.background = bgColor;
                    label.style.borderColor = borderColor;
                    label.style.borderLeftWidth = '3px';
                    label.style.color = '#1B2A4E';
                    label.style.boxShadow = '0 1px 2px rgba(0,0,0,0.04)';
                    label.style.transform = 'none';
                }});
                
                // Now highlight the selected item
                allLabels.forEach(label => {{
                    const labelText = label.innerText.trim();
                    if (labelText === "{current_page_label}") {{
                        label.style.background = 'linear-gradient(135deg, #29B5E8 0%, #1A8BC4 100%)';
                        label.style.borderColor = '#29B5E8';
                        label.style.borderLeftWidth = '3px';
                        label.style.color = 'white';
                        label.style.boxShadow = '0 2px 8px rgba(41, 181, 232, 0.3)';
                        label.style.transform = 'translateX(4px)';
                    }}
                }});
            }}
            
            // Run after delays to ensure DOM is ready
            setTimeout(styleNavigation, 50);
            setTimeout(styleNavigation, 200);
            setTimeout(styleNavigation, 500);
        </script>
        ''', height=0)
        
        selected_page = st.session_state.selected_page
        
        # Demo Settings
        st.markdown("---")
        st.markdown("**⚙️ Demo Settings**")
        
        # Snowflake Highlights
        show_sf_highlights = st.toggle("❄️ Snowflake Features", value=True, key="sf_highlights", help="Highlight Snowflake-powered features")
        
        # Real-time simulation
        realtime_mode = st.toggle("📡 Live Data Simulation", value=False, key="realtime", help="Simulate real-time data updates")
        
        # Footer credits
        st.markdown("<br><br>", unsafe_allow_html=True)
        st.markdown("""
        <div style="text-align: center; padding: 1rem; border-top: 1px solid #E5E7EB; margin-top: 1rem;">
            <div style="font-size: 0.75rem; color: #6B7280; margin-bottom: 0.5rem;">Built with ❤️ by</div>
            <div style="font-weight: 600; color: #1B2A4E; font-size: 0.9rem;">Pedro Jose</div>
            <div style="font-size: 0.75rem; color: #29B5E8;">Field CTO Telecom - Snowflake</div>
        </div>
        """, unsafe_allow_html=True)
    
    # Scroll to top when page changes
    js_scroll = f"""
    <script>
        // Streamlit scroll to top
        const streamlitDoc = window.parent.document;
        
        // Method 1: Direct scroll on main containers
        ['section.main', '.main', '[data-testid="stAppViewContainer"]', '[data-testid="block-container"]'].forEach(sel => {{
            const el = streamlitDoc.querySelector(sel);
            if (el) el.scrollTop = 0;
        }});
        
        // Method 2: Find the scrollable element (usually has overflow-y: auto or scroll)
        const allElements = streamlitDoc.querySelectorAll('*');
        allElements.forEach(el => {{
            const style = window.parent.getComputedStyle(el);
            if ((style.overflowY === 'auto' || style.overflowY === 'scroll') && el.scrollTop > 0) {{
                el.scrollTop = 0;
            }}
        }});
        
        // Method 3: Scroll the window
        window.parent.scrollTo(0, 0);
        
        // Method 4: Use location hash trick
        if (window.parent.location.hash !== '#top') {{
            window.parent.location.hash = '#top';
            setTimeout(() => {{ window.parent.location.hash = ''; }}, 100);
        }}
    </script>
    <a name="top" id="top"></a>
    """
    st.markdown(js_scroll, unsafe_allow_html=True)
    components.html(js_scroll, height=0)
    
    # Add top anchor for scroll - use unique key to force scroll position reset
    st.markdown(f'<div id="page-top-{selected_page}"></div>', unsafe_allow_html=True)
    
    if selected_page == "data_monetization":
        render_data_monetization()
    elif selected_page == "architecture":
        render_architecture_page()
    elif selected_page == "Executive_Summary":
        render_executive_summary()
    elif selected_page == "SnowTelco_Website":
        render_snowtelco_website()
    elif selected_page == "Persona_Hub":
        render_persona_hub()
    elif selected_page == "00_WOW_Executive_Showcase":
        render_executive_showcase()
    elif selected_page == "01_CEO_Strategic":
        render_ceo_strategic()
    elif selected_page == "02_CFO_Finance":
        render_cfo_financial()
    elif selected_page == "03_CMO_Marketing":
        render_cmo_marketing()
    elif selected_page == "04_CTO_Technology":
        render_cto_technology()
    elif selected_page == "05_COO_Operations":
        render_coo_operations()
    elif selected_page == "06_CCO_Commercial":
        render_cco_commercial()
    elif selected_page == "07_CXO_Customer_Experience":
        render_cxo_customer_experience()
    elif selected_page == "08_CNO_Network_QoE":
        render_cno_network()
    elif selected_page == "09_CDO_Data_Science":
        render_cdo_data_science()
    elif selected_page == "10_CSO_Sustainability":
        render_cso_sustainability()
    elif selected_page == "11_VP_Customer_Service":
        render_vp_customer_service()
    elif selected_page == "12_VP_Network_Operations":
        render_vp_network_operations()
    elif selected_page == "Alert_Center":
        render_alert_center()
    elif selected_page == "13_Head_of_Partners":
        render_head_of_partners()
    elif selected_page == "14_VP_Billing_Revenue":
        render_vp_billing_revenue()
    elif selected_page == "15_VP_IT_Digital":
        render_vp_it_digital()
    elif selected_page == "16_VP_Field_Operations":
        render_vp_field_operations()
    elif selected_page == "17_VP_Strategy":
        render_vp_strategy()
    elif selected_page == "18_VP_Communications":
        render_vp_communications()
    elif selected_page == "19_Regulatory_Compliance":
        render_regulatory_compliance()
    elif selected_page == "20_VP_Security":
        render_vp_security()
    elif selected_page == "21_VP_Enterprise_Sales":
        render_vp_enterprise_sales()
    elif selected_page == "22_VP_Wholesale":
        render_vp_wholesale()
    elif selected_page == "23_VP_Retail":
        render_vp_retail()
    elif selected_page == "24_CHRO_People":
        render_chro_people()
    elif selected_page == "25_VP_Legal":
        render_vp_legal()
    elif selected_page == "26_VP_Product":
        render_vp_product()
    elif selected_page == "27_VP_Procurement":
        render_vp_procurement()
    elif selected_page in PAGES:
        page_data = PAGES[selected_page]
        render_page_header(
            page_data["title"],
            page_data["persona"],
            page_data["duration"],
            page_data["focus"]
        )
        render_semantic_views(page_data["views"])
        
        col1, col2 = st.columns([2, 1])
        
        with col1:
            render_questions(page_data["questions"])
        
        with col2:
            render_insights(page_data["insights"])
            
            st.markdown('<div class="section-header">Key Talking Points</div>', unsafe_allow_html=True)
            st.markdown("""
            <div class="talking-point">
                💡 All insights powered by natural language - no SQL required
            </div>
            <div class="talking-point">
                🔒 Governed data access through Snowflake's security model
            </div>
            <div class="talking-point">
                📊 Real-time data from operational systems
            </div>
            """, unsafe_allow_html=True)

if __name__ == "__main__":
    main()
